/*Version 1.0.32.0*/VA012=window.VA012||{},function(n,t){function i(){function de(n){n!=null&&n!=""&&(l=t(n),c.getControls(),c.setBankAndAccount(),u.newRecord(),c.getBaseCurrency(),c.loadPayments("0","0","PY",vt.val()),ge(),c.dragPayments(),c.dropPayments())}function ge(){yf.on(VIS.Events.onTouchStartOrClick,function(n){n.stopPropagation();var i=bu.width();i>50&&t(".va012-left-content").hide();bu.animate({width:i>50?40:200},300,"swing",function(){i<50&&t(".va012-left-content").show()})});vi.on("change",function(){a.val("0");c.loadBankAccount()});a.on("change",function(){u.loadPayment();u.loadCurrency();u.loadCashLine();ui.html("");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();pi=1;storepaymentdata=[];c.loadPayments(a.val()==null?0:a.val(),yt.val(),ot.val(),vt.val());bt=[];ct.html("");hi=1;tt.loadStatement(fi)});yt.on("change",function(){ui.html("");pi=1;storepaymentdata=[];c.loadPayments(a.val()==null?0:a.val(),yt.val(),ot.val(),vt.val())});ot.on("change",function(){ot.val()=="CO"?(yt.prop("selectedIndex",0),yt.prop("disabled",!0)):(yt.prop("selectedIndex",0),yt.prop("disabled",!1));ui.html("");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();pi=1;ff=0;ee=50;ve=1;storepaymentdata=[];c.loadPayments(a.val()==null?0:a.val(),yt.val(),ot.val(),vt.val())});cf.on(VIS.Events.onTouchStartOrClick,function(){vt.val()==""?VIS.ADialog.info("VA012_PleaseEnterStatementDate",null,"",""):tt.statementDialog()});lf.on(VIS.Events.onTouchStartOrClick,function(){tt.matchStatementDialog()});iu.on(VIS.Events.onTouchStartOrClick,function(){tt.paymentScheduleDialog()});wf.on(VIS.Events.onTouchStartOrClick,function(){tt.prepayOrderDialog()});gf.on(VIS.Events.onTouchStartOrClick,function(){ri.val()!=null&&ri.val()!=""?(bi=!0,bt=[],ct.html(""),hi=1,tt.loadStatement(fi)):(bt=[],ct.html(""),hi=1,tt.loadStatement(fi))});ri.keypress(function(n){n.which==13&&(ri.val()!=null&&ri.val()!=""?(bi=!0,bt=[],ct.html(""),hi=1,tt.loadStatement(fi)):(bt=[],ct.html(""),hi=1,tt.loadStatement(fi)))});af.on(VIS.Events.onTouchStartOrClick,function(){bt.length>0?t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/UnmatchStatement",contentType:"application/json; charset=utf-8",data:JSON.stringify({_statementLinesList:bt.toString()}),success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n[0]._status=="Success"&&n[0]._statementOk!=null&&VIS.ADialog.info("VA012_StatementsUnmatched",null," "+n[0]._statementOk,""),n[0]._error!=null&&VIS.ADialog.info(n[0]._error,null,"",""),n[0]._statementNo!=null&&VIS.ADialog.info("VA012_CompletedRecord",null," "+n[0]._statementNo,""),n[0]._statementNoNotUpdate!=null&&VIS.ADialog.info("VA012_ErrorSaving",null," "+n[0]._statementNoNotUpdate,""),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),bt=[],storepaymentdata=[],ct.html(""),hi=1,tt.loadStatement(fi),ui.html(""),u.scheduleRefresh(),u.prepayRefresh(),pi=1,c.loadPayments(a.val(),yt.val(),ot.val(),vt.val()))},error:function(n){VIS.ADialog.info(n,null,"","")}}):VIS.ADialog.info("VA012_NoRecordSelected",null,"","")});vf.on(VIS.Events.onTouchStartOrClick,function(){if(a.val()==null||a.val()==""||a.val()=="0"){VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"","");return}t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/ProcessStatement",contentType:"application/json; charset=utf-8",data:JSON.stringify({_statementLinesList:bt.toString(),_accountID:a.val()}),success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n[0]._error!=null?VIS.ADialog.info("",null,n[0]._error,""):n[0]._statementProcessed!=null?VIS.ADialog.info("",null,n[0]._statementProcessed+" "+VIS.Msg.getMsg("VA012_StatementsProcessed"),""):n[0]._statementNotProcessed!=null?VIS.ADialog.info("",null,n[0]._statementNotProcessed+" "+VIS.Msg.getMsg("VA012_StatementsNotProcessed"),""):n[0]._statementUnmatchedLines!=null&&VIS.ADialog.info("",null,n[0]._statementUnmatchedLines+" "+VIS.Msg.getMsg("VA012_ExistsUnmatched"),""),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),storepaymentdata=[],bt=[],ct.html(""),hi=1,tt.loadStatement(fi),ui.html(""),u.scheduleRefresh(),u.prepayRefresh(),pi=1,c.loadPayments(a.val(),yt.val(),ot.val(),vt.val()))},error:function(n){VIS.ADialog.info(n,null,"","")}})});kf.on(VIS.Events.onTouchStartOrClick,function(){bt.length>0||parseInt(h.attr("data-uid"))>0?VIS.ADialog.ask(VIS.Msg.getMsg("VA012_WantToDelete"))&&t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/DeleteStatement",contentType:"application/json; charset=utf-8",data:JSON.stringify({_statementLinesList:bt.toString(),_statementLineID:h.attr("data-uid")}),success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n[0]._status=="Success"&&n[0]._statementProcessed!=null&&VIS.ADialog.info(n[0]._statementProcessed+" "+VIS.Msg.getMsg("VA012_StatementsDeleted"),null,"",""),n[0]._statementNotProcessed!=null&&VIS.ADialog.info(n[0]._statementNotProcessed+" "+VIS.Msg.getMsg("VA012_StatementsNotDeleted"),null,"",""),n[0]._error!=null&&VIS.ADialog.info(n[0]._error,null,"",""),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),bt=[],storepaymentdata=[],ct.html(""),hi=1,tt.loadStatement(fi),ui.html(""),u.scheduleRefresh(),u.prepayRefresh(),pi=1,c.loadPayments(a.val(),yt.val(),ot.val(),vt.val()))},error:function(n){VIS.ADialog.info(n,null,"","")}}):VIS.ADialog.info("VA012_NoRecordSelected",null,"","")});ui.on("scroll",c.paymentScroll);ct.on("scroll",c.statementScroll);ct.on(VIS.Events.onTouchStartOrClick,tt.statementListEdit);ct.on(VIS.Events.onTouchStartOrClick,tt.openStatement);ct.on(VIS.Events.onTouchStartOrClick,tt.selectedStatementLinesList);ui.on(VIS.Events.onTouchStartOrClick,tt.selectedScheduleList);ui.on(VIS.Events.onTouchStartOrClick,function(n){n.target.type!="checkbox"&&(t(n.target).closest(".row").find(":checkbox").is(":checked")?t(n.target).closest(".row").find(":checkbox").prop("checked",!1):t(n.target).closest(".row").find(":checkbox").prop("checked",!0));i.getControl().trigger("blur",[r(i.getControl().val()),r(s.getControl().val())])});vt.addClass("va012-mandatory");vt.on("change",function(){if(vt.val()=="")vt.addClass("va012-mandatory");else{if(new Date(vt.val())>new Date)return VIS.ADialog.info("VA012_StatementDateToday",null,"",""),vt.val(""),!1;vt.removeClass("va012-mandatory")}storepaymentdata=[];c.loadPayments(a.val()==null?0:a.val(),yt.val(),ot.val(),vt.val())})}function no(n){t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/getMatchRecData",contentType:"application/json; charset=utf-8",success:function(t){if(n.html(""),n.append("<option value=0 >-<\/option>"),t=JSON.parse(t),t!=null&&t.length>0)for(var i=0;i<t.length;i++)n.append("<option value="+t[i].Value+">"+t[i].Name+"<\/option>")},error:function(n){VIS.ADialog.info(n,null,"","")}})}function ae(n,t){w2ui["VA012_gridPayment_"+$self.windowNo]!=null&&w2ui["VA012_gridPayment_"+$self.windowNo].destroy();var i=null;i=n.w2grid({name:"VA012_gridPayment_"+$self.windowNo,recordHeight:25,show:{toolbar:!1,selectColumn:!1,toolbarReload:!1,toolbarColumns:!1,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1},records:[],columns:[{field:"_trxDate",caption:"Tran. Date",sortable:!1,size:"80px",display:!1},{field:"_trxNo",caption:"Auth Code/ Trx no.",sortable:!1,size:"30%",hidden:!1},{field:"_salesAmt",caption:"Trx Amount",sortable:!1,size:"15%",hidden:!1,style:"text-align: right"},{field:"_netAmt",caption:"Statement Amount",sortable:!1,size:"15%",hidden:!1,style:"text-align: right"},{field:"_difference",caption:"Difference",sortable:!1,size:"15%",hidden:!1,style:"text-align: right"},{field:"_chargeType",caption:"Charge Type",sortable:!1,size:"80px",display:!0},{field:"_taxRate",caption:"Tax Rate",sortable:!1,size:"80px",display:!0},{field:"_taxAmt",caption:"Tax Amt",sortable:!1,size:"15%",hidden:!1,style:"text-align: right"},],onChange:function(){},onClick:function(){},onDelete:function(){},onSubmit:function(){}});i.add(t)}function vu(n){if(n!=null&&b.length>0){t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetCurrencyandConversionType",dataType:"json",data:{_invoiceSchedules:n},success:function(n){var t=JSON.parse(n);(t!=null||t!="")&&i(t)}});function i(n){if(n.currencyId!=0&&b!=null){o.val(n.currencyId).prop("selected",!0);for(var i=0;o[0].length>i;i++)VIS.Utility.Util.getValueOfInt(o[0][i].value)==n.currencyId||VIS.Utility.Util.getValueOfInt(o[0][i].value)==st?t(o[0][i]).show():t(o[0][i]).hide();o.removeClass("va012-mandatory");o.attr("disabled",!1);v.val(n.conversionTypeId).prop("selected",!0)}else o.val(st).prop("selected",!0),o.attr("disabled",!0),o.removeClass("va012-mandatory"),v.val(n.conversionTypeId).prop("selected",!0);v.trigger("change")}}else o.prop("selectedIndex",0),o.addClass("va012-mandatory"),o.attr("disabled",!1),v.prop("selectedIndex",0),v.addClass("va012-mandatory")}function r(n){var t=0;return dotFormatter=$self.dotFormatter,typeof n=="string"?n:n=n.toString(),dotFormatter?(n=n.contains("−")?(-1*fu.GetConvertedNumber(n,dotFormatter)).toString():fu.GetConvertedNumber(n,dotFormatter).toString(),t=n!=""?n:t):(n.contains("−")&&!n.contains(".")?n=(-1*fu.GetConvertedNumber(n,dotFormatter)).toString():n.contains("−")&&n.contains(".")?n=(-1*fu.GetConvertedNumber(n,dotFormatter)).toString():n.contains(",")&&(n=fu.GetConvertedNumber(n,dotFormatter).toString()),t=n!=""?n:t),parseFloat(t).toFixed(y)}function sf(n,i,r,u){var f=VIS.Utility.Util.getValueOfInt(n),e,o;if(f==0){u(n);return}e=VIS.Utility.Util.getValueOfDecimal(i);o=VIS.Utility.Util.getValueOfInt(r);t.ajax({url:VIS.Application.contextUrl+"VA012/BankStatement/CalculateSurcharge",type:"GET",contentType:"application/json; charset=utf-8",data:{_tax_ID:f,_chargeAmt:e,_stdPrecision:o},success:function(n){u(n)},error:function(n){VIS.ADialog.info(n,null,"","")}})}function hf(n,t){return t.indexOf(n)>-1}function wt(n,i,r){if(yu=t("<div class='vis-apanel-busy va012-busy-bank-statement'>"),yu.css({position:r,width:"95%",height:"95%","text-align":"center",visibility:"hidden"}),i)yu.css({visibility:"visible"});else{n.find(".va012-busy-bank-statement").remove();return}n.append(yu)}var l,fu,c,tt,u;this.windowNo;$self=this;l=t("<div/>");this.frame;var yu=null,vi=null,a=null,pu=null,vt=null,cf=null,lf=null,yt=null,ot=null,ct=null,ui=null,wu=null,fi="",kr=null,dr=null,eu=null,fe=null,bi=!1,bt=[],b=[],li=[],ht=[],pr=[],wr=[],af=null,vf=null,yf=null,bu=null,ku=null,st=0,y=2,ei=!1,ki=!1,pi=1,ve=1,hi=1,pf=50,ee=50,du=0,gu=0,oe=null,h=null,nf=null,kt=null,tf=null,ci=null,ir=null,nt=null,gi=null,ut=null,di=null,nr=null,br=null,k=null,i=null,s=null,p=null,w=null,gr=null,rr=null,tr=null,g=null,it=null,lt=null,nu=null,ou=null,lr=null,su=null,hu=null,tu=null,cu=null,iu=null,wf=null,wi=null,rf=null,at=null,bf=null,kf=null,ye=null,pe=null,ur=null,ar=null,fr=null,vr=null,oi=null,se=null,ru=null,yi=null,gt=null,df=null,ni=null,si=null,er=null,or=null,sr=null,hr=null,cr=null,ri=null,gf=null,ai=null,he=null,uf=null,f=null,e=null,ne=0,ff=0,ce=null,ft=null,ti=null,te=null,et=null,ii=null,ie=null,d=null,dt=null,we=null,ef=null,rt=null,uu=null,re=null,pt=null,yr=null,o=null,v=null,lu=!1;storepaymentdata=[];fu=VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount);this.dotFormatter=VIS.Env.isDecimalPoint();var of=new Date,ue=of.getFullYear()+"-"+("0"+(of.getMonth()+1)).slice(-2)+"-"+("0"+of.getDate()).slice(-2),au,be,le,ke;this.Initialize=function(){de(c.loadFormDesign());s.addVetoableChangeListener(this);lt.addVetoableChangeListener(this);i.addVetoableChangeListener(this);p.addVetoableChangeListener(this)};c={loadFormDesign:function(){return _formDesign=t('<div class="va012-assign-content">'),divContainer=t('  <div id="VA012_mainContainer_'+$self.windowNo+'" class="va012-main-container">'),divTable=t('<table id="VA012_table_'+$self.windowNo+'" style="width: 100%;">'),tableTr=t("<tr>"),tableTd=t('<td id="VA012_tdLeft_'+$self.windowNo+'" style="width: 200px;position: relative;">   <div class="va012-left-part">              <div class="va012-left-title">                  <h4>    <i id="VA012_btnHide_'+$self.windowNo+'" class="fa fa-bars" alt="lines" style="cursor: pointer;background: rgba(var(--v-c-primary),1);"><\/i> <\/h4>              <\/div>              <div class="va012-left-content">                  <div class="va012-left-data">                      <label  id="VA012_lblBank_'+$self.windowNo+'" >'+VIS.Msg.getMsg("VA012_Bank")+'<sup style="color: red;">*<\/sup><\/label>                      <select id="VA012_cmbBank_'+$self.windowNo+'" ><\/select>                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <label  id="VA012_lblBankAccount_'+$self.windowNo+'" >'+VIS.Msg.getMsg("VA012_BankAccount")+'<sup style="color: red;">*<\/sup><\/label>                      <select id="VA012_cmbBankAccount_'+$self.windowNo+'"   ><\/select>                  <\/div>                  <!-- end of left-data -->                  <div class="va012-left-data">                      <label  id="VA012_lblStatementDate_'+$self.windowNo+'" >'+VIS.Msg.getMsg("VA012_StatementDate")+'<sup style="color: red;">*<\/sup><\/label>                      <input type="date" max="9999-12-31" id="VA012_statementDate_'+$self.windowNo+'"   >                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <a id="VA012_btnLoadStatement_'+$self.windowNo+'">'+VIS.Msg.getMsg("VA012_LoadStatement")+'<\/a>                      <a id="VA012_btnMatchStatement_'+$self.windowNo+'">'+VIS.Msg.getMsg("VA012_MatchStatement")+"<\/a>                  <\/div>                  <!-- end of left-data -->              <\/div>              <!-- end of left-content -->          <\/div>          <!-- end of left-part --> <\/td>"),tableTd1=t('<td style="position: relative;">'),contentDiv=t('<div id="VA012_contentArea_'+$self.windowNo+'" class="va012-content-area" style="position: absolute;" >'),divMidWrap=t('<div id="VA012_middleWrap_'+$self.windowNo+'" class="va012-middle-wrap">'),divtopWrap=t('<div class="va012-mid-top-wrap" id="VA012_formBtnNewRecord_'+$self.windowNo+'">                      <div class="va012-icons-wrap">                          <span>                              <i class="va012-undo vis vis-ignore" alt="undo" title="Undo" id="VA012_btnUndo_'+$self.windowNo+'"><\/i><\/span>                          <span>                              <i class="va012-hide-show-newform vis vis-plus" activestatus="0" alt="add" title = "Expand" id="VA012_btnNewRecord_'+$self.windowNo+'"><\/i><\/span>                      <\/div>                      <!-- end of icons-wrap -->                  <\/div>'),divformWrap=t('<div class="va012-form-wrap va012-newform" id="VA012_formNewRecord_'+$self.windowNo+'" data-uid="0" style="height:55%;overflow-y:auto;width:101%;">'),divRow1=t('<div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementNumber")+' <sup style="color: red;">*<\/sup><\/label>                                  <input  tabindex="1" id="VA012_txtStatementNo_'+$self.windowNo+'" type="text" class="va012-input-size">                                  <i  id="VA012_btnStatementNo_'+$self.windowNo+'" class="fa fa-plus va012-add-icon"><\/i>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementPage")+'<\/label>                                  <input tabindex="2" value="1" id="VA012_txtStatementPage_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementLine")+'<\/label>                                  <input tabindex="3" value="10" id="VA012_txtStatementLine_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  '),divRow2=t('<div class="row va012-fl-padd" style="width:102%">'),row2Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementDate")+'<sup style="color: red;">*<\/sup><\/label>                                  <input tabindex="4" id="VA012_dtStatementDate_'+$self.windowNo+'" type="date" max="9999-12-31">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->'),row2Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">'),row2Col2divAmt=t('<div class="va012-form-group va012-form-data" >'),row2Col2Lble=t("<label>"+VIS.Msg.getMsg("VA012_Amount")+'<sup style="color: red;">*<\/sup><\/label>'),row2Col2btnIn=t('<a tabindex="5" id="VA012_btnIn_'+$self.windowNo+'" v_active="1" class="va012-inout-icon va012-active">In<\/a>'),row2Col2btnOut=t('<a tabindex="6" id="VA012_btnOut_'+$self.windowNo+'" v_active="0" class="va012-inout-icon va012-inactive">Out<\/a>'),i=new VIS.Controls.VAmountTextBox("VA012_txtAmount_"+$self.windowNo+"",!1,!1,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount")),i.setValue(0),i.getControl().addClass("va012-input-size-amt va012-right-align va012-txtamount"),row2Col2btnIcon=t('<a id="VA012_btnAmount_'+$self.windowNo+'" class="va012-info-icon"><\/a>'),row2Col3=t('<div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_VoucherMatch")+'<sup style="color: red;">*<\/sup><\/label>                                  <select tabindex="8" id="VA012_cmbVoucherMatch_'+$self.windowNo+'">                                  <\/select>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  '),divRow3=t('                      <div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-8 col-sm-8 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_Description")+'<\/label>                                  <input tabindex="9" id="VA012_txtDescription_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divVoucherNo_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_VoucherNo")+'<\/label>                                  <input tabindex="9" id="VA012_txtVoucherNo_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  '),divRow4=t('<div class="row va012-fl-padd" style="width:102%">'),divRow4Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">'),divRow4Col1TrxAmt=t('<div id="VA012_divTrxAmt_'+$self.windowNo+'" class="va012-form-group va012-form-data">'),divRow4Col1Lbl=t("<label>"+VIS.Msg.getMsg("VA012_TrxAmt")+"<\/label>"),s=new VIS.Controls.VAmountTextBox("VA012_txtTrxAmt_"+$self.windowNo+"",!1,!0,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount")),s.getControl().addClass("va012-right-align"),s.setValue(0..toFixed(y)),divRow4Col1TrxAmt.append(divRow4Col1Lbl).append(s.getControl()),divRow4Col1.append(divRow4Col1TrxAmt),divRow4Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">'),divRow4Col2Diff=t('<div id="VA012_divDifference_'+$self.windowNo+'" class="va012-form-group va012-form-data">'),divRow4Col2DiffLbl=t("<label>"+VIS.Msg.getMsg("VA012_Difference")+"<\/label>"),p=new VIS.Controls.VAmountTextBox("VA012_txtDifference_"+$self.windowNo+"",!1,!0,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount")),p.getControl().addClass("va012-right-align"),p.setValue(0),p.getControl().trigger("blur"),divRow4Col2Diff.append(divRow4Col2DiffLbl).append(p.getControl()),divRow4Col2.append(divRow4Col2Diff),divRow4Col3=t('<div class="col-md-4 col-sm-4 va012-padd-0">'),divRow4Col3DiffType=t('<div id="VA012_divDifferenceType_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_DifferenceType")+'<\/label>                                  <select tabindex="9" id="VA012_cmbDifferenceType_'+$self.windowNo+'">                                  <\/select>                              <\/div>                              <!-- end of form-group -->'),divRow4Col3.append(divRow4Col3DiffType),divRow4.append(divRow4Col1).append(divRow4Col2).append(divRow4Col3),divRow5=t('<div class="row va012-fl-padd" style="width:102%">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divContraType_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_ContraType")+'<\/label>                                      <select tabindex="10" id="VA012_cmbContraType_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCashBook_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CashBook")+'<\/label>                                      <select tabindex="10" id="VA012_cmbCashBook_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <div id="VA012_divCtrlCashLine_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CashJournalLine")+'<\/label>                                      <div id="VA012_ctrlCashLine_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCheckNo_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CheckNo")+'<\/label>                                      <input  disabled tabindex="12" id="VA012_txtCheckNo_'+$self.windowNo+'" type="text">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->  '),divRow6=t('<div class="row va012-fl-padd" style="width:102%">'),divRow6Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCharge_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Charge")+'<\/label>                                      <div style=" position: relative; float: left; width: 100%; ">                                      <input tabindex="10" chargeid="" type="text" id="VA012_txtCharge_'+$self.windowNo+'" style=" width: 100%; ">                                      <img id="VA012_btnCharge_'+$self.windowNo+'" class="VA012-img-combo" alt="">                                     <\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->'),divRow6Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divTaxRate_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_TaxRate")+'<\/label>                                      <select tabindex="11" id="VA012_cmbTaxRate_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->'),divRow6Col3=t('<div class="col-md-4 col-sm-4 va012-padd-0">'),divRow6Col3divTax=t('<div id="VA012_divTaxAmount_'+$self.windowNo+'" class="va012-form-group va012-form-data">'),divRow6Col3divTaxLbl=t("<label>"+VIS.Msg.getMsg("VA012_TaxAmount")+"<\/label>"),lt=new VIS.Controls.VAmountTextBox("VA012_txtTaxAmount_"+$self.windowNo+"",!1,!0,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount")),lt.setValue(0),lt.getControl().addClass("va012-right-align"),divRow6Col3divTax.append(divRow6Col3divTaxLbl).append(lt.getControl()),divRow6Col3.append(divRow6Col3divTax),divRow6.append(divRow6Col1).append(divRow6Col2).append(divRow6Col3),divRow7=t('<div class="row va012-fl-padd" style="width:102%">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlPayment_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Payment")+'<\/label>                                      <div id="VA012_ctrlPayment_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlInvoice_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Invoice")+'<\/label>                                      <div id="VA012_ctrlInvoice_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlBusinessPartner_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_BusinessPartner")+'<\/label>                                      <div id="VA012_ctrlBusinessPartner_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->  '),divRow8=t('<div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPaymentSchedule_'+$self.windowNo+'" class="va012-form-data" >                              <label>'+VIS.Msg.getMsg("VA012_PaymentSchedules")+'<\/label>                              <input disabled id="VA012_txtPaymentSchedule_'+$self.windowNo+'" type="text" class="va012-input-size">                              <a tabindex="13"  id="VA012_btnPaymentSchedule_'+$self.windowNo+'" class="va012-edit-icon"><\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPrepayOrder_'+$self.windowNo+'" class="va012-form-data" >                              <label>'+VIS.Msg.getMsg("VA012_PrepayOrders")+'<\/label>                              <div id="VA012_ctrlOrder_'+$self.windowNo+'" ><\/div>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  '),divRow9=t('<div class="row va012-fl-padd" style="width:102%">                       <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-check">                                  <input tabindex="13" id="VA012_chkUseNextTime_'+$self.windowNo+'" type="checkbox">                                  <label style="position: absolute;">'+VIS.Msg.getMsg("VA012_UseNextTime")+'<\/label>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-2 col-sm-2 va012-padd-0" >                              <div class="va012-form-data" id="VA012_divMore_'+$self.windowNo+'">                                  <a tabindex="14" visiblestatus="0" class="va012-more" id="VA012_btnMore_'+$self.windowNo+'" href="#">'+VIS.Msg.getMsg("VA012_More")+'<\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-6 col-sm-6 va012-padd-0" >                          <div style="float:right;">                              <a tabindex="15" title="Save Record" id="VA012_btnSave_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue" style=" float: left;">'+VIS.Msg.getMsg("VA012_SaveandNew")+"<\/a>                          <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->"),divRow10=t('<div class="row va012-fl-padd" style="width:102%">'),divRow10Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCurrency_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Currency")+'<\/label>                                      <select tabindex="10" id="VA012_txtCurrency_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->'),divRow10Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divConversionType_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_ConversionType")+'<\/label>                                      <select tabindex="11" id="VA012_txtConversionType_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->'),divRow10.append(divRow10Col1).append(divRow10Col2),payHeaderWrap=t('<div id="VA012_paymentHeaderWrap_'+$self.windowNo+'" class="va012-payment-header-wrap">                          <div class="pull-left">                              <a class="va012-frm-btn va012-btn-gray" style="cursor: default;">'+VIS.Msg.getMsg("VA012_UpcomingTransactions")+'<\/a>                          <\/div>                      <div style=" float: right; width: 60%; ">                           <div class="va012-width-30" style=" float: left; width: 49%; ">                              <select id="VA012_cmbTransactionType_'+$self.windowNo+'">                             <option value="PY">'+VIS.Msg.getMsg("VA012_Payments")+'<\/option>                             <option value="PO">'+VIS.Msg.getMsg("VA012_PrepayOrders")+'<\/option>                              <option value="IS">'+VIS.Msg.getMsg("VA012_InvoiceSchedule")+'<\/option>                              <option value="CO">'+VIS.Msg.getMsg("VA012_Contra")+'<\/option>                              <\/select>                          <\/div>                          <div class="va012-width-30" style=" float: right; width: 49%; ">                              <select id="VA012_cmbSearchPaymentMethod_'+$self.windowNo+'">                              <\/select>                          <\/div>                          <\/div>                      <\/div>                      <!-- end of payment-header-wrap -->                  <div id="VA012_paymentList_'+$self.windowNo+'" class="va012-payment-list">                                           <div class="va012-payment-content" id="VA012_lstPayments_'+$self.windowNo+'">                   <\/div>                  <\/div>                  <!-- end of payment-list -->                <\/div>'),rightWrap=t('<div id="VA012_rightWrap_'+$self.windowNo+'" class="va012-right-wrap">                  <div id="VA012_rightTop_'+$self.windowNo+'" class="va012-right-top">                      <div class="row">                          <div class="col-md-3 col-sm-3" style=" padding-right: 5px; ">                              <div class="va012-pay-text" id="VA012_secReconciled_'+$self.windowNo+'" >                                <p>'+VIS.Msg.getMsg("VA012_Reconciled")+'<\/p>                                <p style="margin-top: 4px;">'+VIS.Msg.getMsg("VA012_Unreconciled")+'<\/p>                              <\/div>                          <\/div>                          <!-- end of col -->                          <div class="col-md-9 col-sm-9" style=" padding-left: 5px; ">                              <div class="va012-pay-text" id="VA012_secUnreconciled_'+$self.windowNo+'">                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-green"><span class="va012-base-curr"><\/span> 0<\/span>                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-red"><span class="va012-base-curr"><\/span> 0<\/span>                              <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                      <div class="row">                          <div class="col-md-12 col-sm-12" style=" padding-left: 5px; ">                      <div style=" /* float: right; */ padding-left: 10px;">                               <a id="VA012_btnUnmatch_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue" title="Show Unmatched Record" style=" float: left; ">'+VIS.Msg.getMsg("VA012_Unmatch")+'<\/a>                              <a id="VA012_btnProcess_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue" title="Clear Matched Record" style=" float: left; margin-left: 5px; ">'+VIS.Msg.getMsg("VA012_Process")+'<\/a>                             <a id="VA012_btnDelete_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue" title="Delete Selected Record" style=" float: left; margin-left: 5px; ">'+VIS.Msg.getMsg("VA012_Delete")+'<\/a>                       <\/div>                           <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <div class="row">                          <div class="col-md-12 col-sm-12" style=" padding-right: 5px; ">                           <div class="va012-right-search">                            <div class="va012-search-wrap">                               <input id="VA012_txtSearch_'+$self.windowNo+'" value="" placeholder="'+VIS.Msg.getMsg("VA012_Search")+'..." type="text">                               <a id="VA012_btnSearch_'+$self.windowNo+'" class="va012-search-icon"><span class="glyphicon glyphicon-search"><\/span><\/a>                          <\/div>                      <!-- end of search-wrap -->                         <\/div>                  <!-- end of right-search -->                        <\/div>                       <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <\/div>                  <!-- end of right-top -->                    <div class="va012-right-content" id="VA012_lstStatement_'+$self.windowNo+'">                  <\/div>                  <!-- end of right-content -->              <\/div>'),row2Col2divAmt.append(row2Col2Lble).append(row2Col2btnIn).append(row2Col2btnOut).append(i.getControl()).append(row2Col2btnIcon),row2Col2.append(row2Col2divAmt),divRow2.append(row2Col1).append(row2Col2).append(row2Col3),divformWrap.append(divRow1).append(divRow2).append(divRow10).append(divRow3).append(divRow4).append(divRow5).append(divRow6).append(divRow7).append(divRow8).append(divRow9),divMidWrap.append(divtopWrap).append(divformWrap).append(payHeaderWrap),contentDiv.append(divMidWrap).append(rightWrap),tableTd1.append(contentDiv),tableTr.append(tableTd).append(tableTd1),au=t('<div  id="VA012_gridMatchStatePopUp_'+$self.windowNo+'"" style="display:block;width:auto;height:auto"><div  style="    width: 50%;float: left;" ><label>'+VIS.Msg.getMsg("VA012_ChargeType")+'<\/label><div  id="VA012_ChargeSrch_'+$self.windowNo+'"><\/div><\/div><div ><label>'+VIS.Msg.getMsg("VA012_Taxrate")+'<\/label><select  id="VA012_cmbTaxRate_'+$self.windowNo+'"><\/select><\/div><div style="width:auto;height:270px" id="VA012_gridMatchState_'+$self.windowNo+'""><\/div><\/div>'),be=au.find("#VA012_gridMatchState_"+$self.windowNo),le=au.find("#VA012_ChargeSrch_"+$self.windowNo),ke=au.find("#VA012_cmbTaxRate_"+$self.windowNo),_ChargeLookUp=VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(),$self.windowNo,3787,VIS.DisplayType.Search),$ChargeControl=new VIS.Controls.VTextBoxButton("C_Charge_ID",!0,!1,!0,VIS.DisplayType.Search,_ChargeLookUp),le.append($ChargeControl.getControl().css("width","93%")).append($ChargeControl.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")),divTable.append(tableTr),_formDesign.append(divContainer).append(divTable),_formDesign},setBankAndAccount:function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/SetBankAndAccount",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n!=null&&(gu=n.Table[0].C_BANK_ID,du=n.Table[0].C_BANKACCOUNT_ID));c.loadBank()}})},addEffect:function(n,t,i){var r={to:t,className:"wsp-ui-effects-transfer"};n.effect("transfer",r,600,i)},setInvoiceAndBPartner:function(n,i){t.ajax({url:VIS.Application.contextUrl+"BankStatement/SetInvoiceAndBPartner",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_paymentID:n,_cmbTransactionType:i},success:function(n){if(n!=null&&n!="")if(n=t.parseJSON(t.parseJSON(n)),i=="PY"){n._invoiceID>0?pt.setValue(n._invoiceID,!1,!0):pt.setValue();n._bPartnerID>0?rt.setValue(n._bPartnerID,!1,!0):rt.setValue();var r=VIS.DB.executeScalar("SELECT COUNT(*) FROM AD_ModuleInfo WHERE Prefix='VA034_' AND IsActive='Y'");r==1&&n.VA034_DepositSlipNo!=""&&rr.val(n.VA034_DepositSlipNo)}else i=="PO"?rt.value||rt.setValue(n._bPartnerID,!1,!0):i=="IS"&&(rt.value||rt.setValue(n._bPartnerID,!1,!0))}})},setBPartner:function(n){t.ajax({url:VIS.Application.contextUrl+"BankStatement/SetBPartner",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_invoiceID:n},success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n>0?rt.setValue(n,!1,!0):rt.setValue())}})},getMaxStatement:function(n){t.ajax({url:VIS.Application.contextUrl+"BankStatement/MaxStatement",type:"GET",datatype:"json",data:{_bankAccount:a.val()==null?0:a.val(),_origin:n,_pageNo:0},contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),kt.val(n.statementNo),ci.val(n.pageno),ir.val(n.lineno))}})},getOverUnderPayment:function(n){t.ajax({url:VIS.Application.contextUrl+"BankStatement/getOverUnderPayment",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_paymentID:n},success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),n._difference!=0&&(p.setValue(VIS.Utility.Util.getValueOfDecimal(Math.abs(n._difference))),yi.find("*").prop("disabled",!1),w.val(n._differenceType).prop("selected",!0),p.getControl().attr("vchangable","N"),k.val()=="M"&&s.setValue(VIS.Utility.Util.getValueOfDecimal(n._payamt.toFixed(y)))))}})},getControls:function(){vi=l.find("#VA012_cmbBank_"+$self.windowNo);a=l.find("#VA012_cmbBankAccount_"+$self.windowNo);pu=l.find("#VA012_STAT_cmbBankAccountClassName_"+$self.windowNo);vt=l.find("#VA012_statementDate_"+$self.windowNo);oe=l.find("#VA012_BankChargeDiv"+$self.windowNo);yt=l.find("#VA012_cmbSearchPaymentMethod_"+$self.windowNo);ot=l.find("#VA012_cmbTransactionType_"+$self.windowNo);cf=l.find("#VA012_btnLoadStatement_"+$self.windowNo);lf=l.find("#VA012_btnMatchStatement_"+$self.windowNo);ct=l.find("#VA012_lstStatement_"+$self.windowNo);ui=l.find("#VA012_lstPayments_"+$self.windowNo);wu=l.find("#VA012_paymentList_"+$self.windowNo);kr=l.find("#VA012_secReconciled_"+$self.windowNo);dr=l.find("#VA012_secUnreconciled_"+$self.windowNo);ri=l.find("#VA012_txtSearch_"+$self.windowNo);gf=l.find("#VA012_btnSearch_"+$self.windowNo);af=l.find("#VA012_btnUnmatch_"+$self.windowNo);vf=l.find("#VA012_btnProcess_"+$self.windowNo);yf=l.find("#VA012_btnHide_"+$self.windowNo);bu=l.find("#VA012_tdLeft_"+$self.windowNo);ku=l.find("#VA012_table_"+$self.windowNo);ai=l.find("#VA012_btnMore_"+$self.windowNo);he=l.find("#VA012_divMore_"+$self.windowNo);ur=l.find("#VA012_divContraType_"+$self.windowNo);ar=l.find("#VA012_divCashBook_"+$self.windowNo);_divCtrlCashLine=l.find("#VA012_divCtrlCashLine_"+$self.windowNo);fr=l.find("#VA012_divTransferType_"+$self.windowNo);vr=l.find("#VA012_divCheckNo_"+$self.windowNo);oi=l.find("#VA012_divVoucherNo_"+$self.windowNo);se=l.find("#VA012_divTrxAmt_"+$self.windowNo);ru=l.find("#VA012_divDifference_"+$self.windowNo);yi=l.find("#VA012_divDifferenceType_"+$self.windowNo);gt=l.find("#VA012_divCharge_"+$self.windowNo);df=l.find("#VA012_btnCharge_"+$self.windowNo);ni=l.find("#VA012_divTaxRate_"+$self.windowNo);si=l.find("#VA012_divTaxAmount_"+$self.windowNo);er=l.find("#VA012_divCtrlPayment_"+$self.windowNo);or=l.find("#VA012_divCtrlInvoice_"+$self.windowNo);sr=l.find("#VA012_divCtrlBusinessPartner_"+$self.windowNo);hr=l.find("#VA012_divPrepayOrder_"+$self.windowNo);cr=l.find("#VA012_divPaymentSchedule_"+$self.windowNo)},getBaseCurrency:function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetBaseCurrency",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),eu=n._code,fe=n._id,t(".va012-base-curr").text(eu))}})},loadBank:function(){function n(n){if(vi.html(""),vi.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)vi.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].Value)+">"+n[t].Name+"<\/option>");vi.prop("selectedIndex",0);gu>0&&(vi.val(gu).prop("selected",!0),gu=0);c.loadBankAccount()}t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetBank",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",success:function(i){i!=null&&i!=""&&(_ds=t.parseJSON(i),n(_ds))}})},loadBankAccount:function(){function t(t){if(a.html(""),a.append("<option value=0 ><\/option>"),t!=null)for(var i=0;i<t.tables[0].rows.length;i++)a.append("<option value="+VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_bankaccount_id)+">"+VIS.Utility.encodeText(t.tables[0].rows[i].cells.accountno)+"<\/option>");t.dispose();t=null;n=null;a.prop("selectedIndex",0);du>0&&(a.val(du).prop("selected",!0),du=0);c.getMaxStatement("LO");c.loadSearchPaymentMethod()}var n="SELECT ACCOUNTNO,C_BANKACCOUNT_ID FROM C_BANKACCOUNT WHERE ISACTIVE='Y' AND C_BANK_ID="+vi.val(),i=VIS.DB.executeDataSet(n.toString(),null,t)},LoadPaymentsPages:function(n,i,r){bi=ri.val()!=null&&ri.val()!=""?!0:!1;t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadPaymentsPages",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_accountID:n,_paymentPageNo:pi,_PAGESIZE:ee,_paymentMethodID:i,_transactionType:r},success:function(n){n!=null&&n!=""&&(ff=JSON.parse(n))}})},loadPayments:function(n,i,r,u){function f(n){var u,i,f,e,o;if(n=t.parseJSON(n),n.length>0&&(storepaymentdata=storepaymentdata.concat(n)),n=storepaymentdata,u="",ui.html(""),n!=null&&n.length>0)for(i=0;i<n.length;i++)f=new Date(n[i].DateAcct).toLocaleDateString(),e="va012-red-color",e=n[i].c_bankstatementline_id==null||n[i].c_bankstatementline_id=="0"||n[i].c_bankstatementline_id==0?"va012-red-color":"va012-green-color",u="",u='<div class="drag-no-drag"><div draggable="true" class="va012-mid-data-wrap ',(r=="PY"||r=="CO")&&(u+=e),u+=' " paymentdata="'+VIS.Utility.encodeText(new Date(n[i].DueDate).toLocaleDateString())+"_"+VIS.Utility.encodeText(n[i].DueAmt)+'" data-uid="'+n[i].c_payment_id,u+=' " paymentamount = " '+VIS.Utility.Util.getValueOfDecimal(n[i].convertedamount,"N")+'"><div class="va012-payment-wrap" ><div class="row"> <div class="col-md-3 col-sm-3">    <div class="va012-form-check">        <input type="checkbox" data-uid="'+n[i].c_payment_id+'"  >    <div title="'+VIS.Msg.getMsg("VA012_PaymentAmount")+'" class="va012-inside-form-check" style=" float: left; width: 85%; ">      <label style=" width: 100%; ">'+n[i].currency+" "+parseFloat(n[i].paymentamount).toLocaleString(navigator.language,{minimumFractionDigits:y,maximumFractionDigits:y})+"<\/label>",n[i].isconverted=="Y"&&(u+="      <span>"+n[i].basecurrency+" "+parseFloat(n[i].convertedamount).toLocaleString(navigator.language,{minimumFractionDigits:y,maximumFractionDigits:y})+"<\/span>"),u+='   <\/div><\/div>    <!-- end of form-group -->  <\/div>  <!-- end of col -->  <div class="col-md-4 col-sm-4">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Business Partner">'+VIS.Utility.encodeText(n[i].businesspartner)+'<\/p>         <span title="'+VIS.Msg.getMsg("VA012_InvReference")+'">'+VIS.Utility.encodeText(n[i].bpgroup)+'<\/span>       <span title="Document No.">'+VIS.Utility.encodeText(n[i].paymentno)+'<\/span>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col --> <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text"><p title="Payment Type">'+VIS.Utility.encodeText(n[i].paymenttype)+"<\/p><\/div><\/div><!-- end of form-group --><\/div><!-- end of col -->",o=VIS.Utility.Util.getValueOfInt(VIS.DB.executeScalar("SELECT Count(AD_ModuleInfo_ID) FROM AD_ModuleInfo WHERE PREFIX='VA034_' AND IsActive = 'Y'")),u+=r=="PY"&&o>0?'  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Deposit Slip No">'+VIS.Utility.encodeText(n[i].depositslipno)+'<\/p>           <p title="Authentication Code">'+VIS.Utility.encodeText(n[i].authcode)+'<\/p>           <p title="Account Date">'+f+'<\/p>           <p title="Payment Method">'+n[i].PaymentMethod+"<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->":'  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Authentication Code">'+VIS.Utility.encodeText(n[i].authcode)+'<\/p>           <p title="Account Date">'+f+'<\/p>           <p title="Payment Method">'+n[i].PaymentMethod+"<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->",u+="<\/div><!-- end of row --><\/div> <!-- end of payment-wrap --><\/div> <!-- end of mid-data-wrap -->",ui.append(u);_sql=null;c.setPaymentListHeight();c.dragPayments()}wt(t(wu),!0,"inherit");window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadPayments",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_accountID:n,_paymentPageNo:pi,_PAGESIZE:pf,_paymentMethodID:i,_transactionType:r,statementDate:u==null||u==""?new Date:u},success:function(n){n!=null&&n!=""&&(f(n),wt(t(wu),!1,"inherit"))},error:function(){wt(t(wu),!1,"inherit")}})},2)},setPaymentListHeight:function(){var n;clearTimeout(n);n=setTimeout(function(){t("#VA012-content-area"+$self.windowNo).height(t("#VA012_mainContainer_"+$self.windowNo).height()-20);at.attr("activestatus")=="1"?t("#VA012_paymentList_"+$self.windowNo).height(t("#VA012_middleWrap_"+$self.windowNo).height()-t("#VA012_formBtnNewRecord_"+$self.windowNo).height()-t("#VA012_formNewRecord_"+$self.windowNo).height()-t("#VA012_paymentHeaderWrap_"+$self.windowNo).height()-42):t("#VA012_paymentList_"+$self.windowNo).height(t("#VA012_middleWrap_"+$self.windowNo).height()-t("#VA012_formBtnNewRecord_"+$self.windowNo).height()-t("#VA012_paymentHeaderWrap_"+$self.windowNo).height()-27)},2)},loadSearchPaymentMethod:function(){function n(n){if(yt.html(""),yt.append("<option value=0 >"+VIS.Msg.getMsg("VA012_SelectPaymentMethod")+"<\/option>"),n!=null)for(var t=0;t<n.length;t++)yt.append("<option value="+n[t].chargeID+">"+VIS.Utility.encodeText(n[t].name)+"<\/option>");yt.prop("selectedIndex",0);a.trigger("change")}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetPaymentMethods",null,n)},paymentScroll:function(){ff=0;t(this).scrollTop()+t(this).innerHeight()+2>=this.scrollHeight&&(c.LoadPaymentsPages(a.val(),yt.val(),ot.val()),pi<ff&&(pi++,c.loadPayments(a.val(),yt.val(),ot.val(),vt.val())))},statementScroll:function(){ne=0;t(this).scrollTop()>0&&t(this).scrollTop()+t(this).innerHeight()+1>=this.scrollHeight&&(tt.LoadStatementsPages(),hi<ne&&(hi++,tt.loadStatement(fi)))},dragPayments:function(){ui.find(".va012-mid-data-wrap").draggable({start:function(n,t){t.helper.addClass("va012-dragging")},drag:function(){},stop:function(n,t){t.helper.removeClass("va012-dragging")},cursor:"move",cursorAt:{left:5},revert:"invalid",helper:"clone"})},dropPayments:function(){ct.find(".va012-right-data-wrap").droppable({hoverClass:"va012-dropping",drop:function(n,o){var w,it,a,p,k,g,l;if(t(o.draggable).data("uid")>0&&t(this).data("uid")>0){if(ot.val()=="PY"){if(w=t(o.draggable).data("uid"),t(o.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_PaymentAlreadyMatchedOthrStatement",null,"","");return}l=t(this).data("uid");c.checkPaymentCondition(t(o.draggable).data("uid"),t(this).data("uid"),r(i.getControl().val()))&&(tt.statementOpenEdit(t(this).data("uid"),w),window.setTimeout(function(){if(r(s.getControl().val())==0){var n=nt.val();u.refreshForm();nt.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}nt.attr("readonly",!0);ei=!0;d.setValue(w,!1,!0);v.val()>0?v.attr("disabled",!0):v.attr("disabled",!1);c.setInvoiceAndBPartner(t(o.draggable).data("uid"),"PY");ei=!1},500))}else if(ot.val()=="IS"){if(it=t(o.draggable).data("uid"),parseInt(h.attr("data-uid"))!=t(this).data("uid")&&u.scheduleRefresh(),c.checkScheduleCondition(t(o.draggable).data("uid"),t(this).data("uid"),b.toString(),r(i.getControl().val()))){if(hf(parseInt(t(o.draggable).data("uid")),b))VIS.ADialog.info("VA012_AlreadySelected",null,"","");else if(b.push(parseInt(t(o.draggable).data("uid"))),li.push(t(o.draggable).attr("paymentdata")),ht.push(t(o.draggable).attr("paymentamount")),Number(ht[0])=="0"){for(a=0,p=0;p<ht.length;p++)a+=VIS.Utility.Util.getValueOfDecimal(ht[p]);a<0?(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),f.removeClass("va012-active"),f.addClass("va012-inactive"),f.attr("v_active","0")):(f.removeClass("va012-inactive"),f.addClass("va012-active"),f.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"));i.setValue(VIS.Utility.Util.getValueOfDecimal(a.toFixed(y)))}ei=!0;tt.statementOpenEdit(t(this).data("uid"),it);wi.val(li.toString());window.setTimeout(function(){if(r(s.getControl().val())==0){var n=nt.val();u.refreshForm();u.scheduleRefresh();nt.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}c.setInvoiceAndBPartner(t(o.draggable).data("uid"),"IS");nt.attr("readonly",!0);ht.length==1&&(ht[0]=VIS.Utility.Util.getValueOfString(r(s.getControl().val())));s.getControl().trigger("blur",[r(i.getControl().val()),r(s.getControl().val())])},500)}}else ot.val()=="PO"&&(k=t(o.draggable).data("uid"),parseInt(h.attr("data-uid"))!=t(this).data("uid")&&u.prepayRefresh(),c.checkPrepayCondition(t(o.draggable).data("uid"),t(this).data("uid"),pr.toString(),r(i.getControl().val()))&&(tt.statementOpenEdit(t(this).data("uid"),k),window.setTimeout(function(){if(r(s.getControl().val())==0){var n=nt.val();u.refreshForm();u.prepayRefresh();nt.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}nt.attr("readonly",!0);ei=!0;ft.setValue(k,!1,!0);c.setInvoiceAndBPartner(t(o.draggable).data("uid"),"PO");ei=!1},500)));if(ot.val()=="CO"){if(g=t(o.draggable).data("uid"),t(o.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_CashLineAlreadyMatchedOthrStmt",null,"","");return}l=t(this).data("uid");c.checkContraCondition(t(o.draggable).data("uid"),t(this).data("uid"),r(i.getControl().val()))&&(tt.statementOpenEdit(l,g),window.setTimeout(function(){if(r(s.getControl().val())==0){var n=nt.val();u.refreshForm();nt.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}nt.attr("readonly",!0);ei=!0;et.setValue(g,!1,!0);ei=!1},500))}}}});h.droppable({hoverClass:"va012-dropping",drop:function(n,u){var h,o,l,v;if(t(u.draggable).data("uid")>0){if(ot.val()=="CO")if(k.val()=="C"){if(ut.val()!="CB"){VIS.ADialog.info("VA012_ContraSelectCashToBank",null,"","");return}}else{VIS.ADialog.info("VA012_SelectVoucherContra",null,"","");return}else if(k.val()!="M"){VIS.ADialog.info("VA012_SelectVoucherPayment",null,"","");return}if(ot.val()=="PY"){if(t(u.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_PaymentAlreadyMatchedOthrStatement",null,"","");return}if(t(u.draggable).data("uid")>0)if(VIS.Utility.Util.getValueOfInt(dt)==0)d.setValue(t(u.draggable).data("uid"),!1,!0);else{VIS.Utility.Util.getValueOfInt(dt)==VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid"))?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"","");return}}if(ot.val()=="IS"&&c.checkScheduleCondition(t(u.draggable).data("uid"),t(this).attr("data-uid"),b.toString(),r(i.getControl().val()))){if(o=0,hf(parseInt(t(u.draggable).data("uid")),b)){VIS.ADialog.info("VA012_AlreadySelected",null,"","");return}if(h=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetConvtAmount",{recordID:parseInt(t(u.draggable).data("uid")),bnkAct_Id:a.val(),transcType:ot.val(),stmtDate:nt.val()}),h.length==0||h[0].DueAmount==0){VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}if(b.push(parseInt(t(u.draggable).data("uid"))),li.push(t(u.draggable).attr("paymentdata")),ht.push(h[0].DueAmount),o=0,Number(ht.length)>0)for(l=0;l<ht.length;l++)o+=VIS.Utility.Util.getValueOfDecimal(ht[l]);o<0?(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),f.removeClass("va012-active"),f.addClass("va012-inactive"),f.attr("v_active","0")):(f.removeClass("va012-inactive"),f.addClass("va012-active"),f.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"),o>0&&i.getControl().removeClass("va012-mandatory"));i.setValue(VIS.Utility.Util.getValueOfDecimal(o.toFixed(y)));c.setInvoiceAndBPartner(t(u.draggable).data("uid"),"IS");wi.val(li.toString());s.setValue(VIS.Utility.Util.getValueOfDecimal(o.toFixed(y)));s.getControl().trigger("blur",[r(i.getControl().val()),r(s.getControl().val())]);v=b!=null?b.toString():null;vu(v)}if(ot.val()=="PO"){if(VIS.Utility.Util.getValueOfInt(ti)!=0){VIS.Utility.Util.getValueOfInt(ti)==VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid"))?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"","");return}ft.setValue(t(u.draggable).data("uid"),!1,!0)}if(ot.val()=="CO"&&t(u.draggable).data("uid")>0){if(t(u.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_CashLineAlreadyMatchedOthrStmt",null,"","");return}if(VIS.Utility.Util.getValueOfInt(ii)!=0){VIS.Utility.Util.getValueOfInt(ii)==VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid"))?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"","");return}if(c.checkContraCondition(t(u.draggable).data("uid"),t(this).attr("data-uid"),r(i.getControl().val()))){if(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))==0){VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}s.setValue(r(i.getControl().val()));i.getControl().trigger("blur",[r(i.getControl().val()),r(s.getControl().val())]);et.setValue(t(u.draggable).data("uid"),!1,!0)}}}ei=!1}})},checkFormPaymentCondition:function(n,u){var o=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckFormPaymentCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_paymentID:n,_amount:u},success:function(n){n=t.parseJSON(n);n._status=="Success"?(o=!0,n._amount!=null&&n._amount!=0&&(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(y))),r(i.getControl().val())<0?(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),f.removeClass("va012-active"),f.addClass("va012-inactive"),f.attr("v_active","0")):(f.removeClass("va012-inactive"),f.addClass("va012-active"),f.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")))):(VIS.ADialog.info(n._status,null,"",""),o=!1)},error:function(){VIS.ADialog.info("error",null,"","");o=!1}}),o},checkFormPrepayCondition:function(n,u){var s=0,o;return rt.value&&(s=rt.value),o=!1,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckFormPrepayCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_orderID:n,_amount:u,_currencyId:st,_formBPartnerID:s},success:function(n){n=t.parseJSON(n);n._status=="Success"?(o=!0,n._amount>0&&(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(y))),r(i.getControl().val())<0?(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),f.removeClass("va012-active"),f.addClass("va012-inactive"),f.attr("v_active","0")):(f.removeClass("va012-inactive"),f.addClass("va012-active"),f.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")))):(VIS.ADialog.info(n._status,null,"",""),o=!1)},error:function(){VIS.ADialog.info("error",null,"","");o=!1}}),o},checkInvoiceCondition:function(n,i){var r=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckInvoiceCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_invoiceID:n,_amount:i},success:function(n){n=t.parseJSON(n);n=="Success"?r=!0:(VIS.ADialog.info(n,null,"",""),r=!1)},error:function(){VIS.ADialog.info("error",null,"","");r=!1}}),r},checkPaymentCondition:function(n,c,l){var p=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckPaymentCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:c,_amount:l,statmtDate:nt.val(),accountID:a.val()},success:function(n){if(n=t.parseJSON(n),n._status=="Success")if(p=!0,n._amount!=null&&n._amount!=0){if(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(y))),r(i.getControl().val())<0?(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),f.removeClass("va012-active"),f.addClass("va012-inactive"),f.attr("v_active","0"),i.getControl().addClass("va012-mandatory"),s.getControl().addClass("va012-mandatory")):(f.removeClass("va012-inactive"),f.addClass("va012-active"),f.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"),i.getControl().removeClass("va012-mandatory"),s.getControl().removeClass("va012-mandatory")),s.setValue(VIS.Utility.Util.getValueOfDecimal(n._trxamount.toFixed(y))),n._currency_Id!=0&&VIS.Utility.Util.getValueOfString(d.value)!=null){o.val(st).prop("selected",!0);for(var a=0;o[0].length>a;a++)VIS.Utility.Util.getValueOfInt(o[0][a].value)==st?t(o[0][a]).show():t(o[0][a]).hide();o.removeClass("va012-mandatory");o.attr("disabled",!1);t(v[0][0]).hide();v.val(n._conversionType_Id).prop("selected",!0);v.attr("disabled",!0)}else o.val(st).prop("selected",!0),o.attr("disabled",!0),o.removeClass("va012-mandatory"),v.val(n._conversionType_Id).prop("selected",!0);v.trigger("change")}else if(c==0&&l!=0){if(h[0].attributes["data-uid"].value>0&&(c=h[0].attributes["data-uid"].value),d!=null&&d.value>0&&c>0)return tt.statementListRecordEdit(c,d.value),p=!0}else c==0&&(u.refreshForm(),VIS.ADialog.info("VA012_ConversionRateNotFound",null,"",""),p=!1);else VIS.ADialog.info(n._status,null,"",""),p=!1},error:function(){VIS.ADialog.info("error",null,"","");p=!1}}),p},checkScheduleCondition:function(n,i,r,u){var e,f;if(st==null||st==0){VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"","");return}return e=0,rt.value&&(e=rt.value),f=!1,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckScheduleCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:i,_listToCheck:r,_amount:u,_currencyId:st,_formBPartnerID:e},success:function(n){n=t.parseJSON(n);n=="Success"?f=!0:(VIS.ADialog.info(n,null,"",""),f=!1)},error:function(){VIS.ADialog.info("error",null,"","");f=!1}}),f},checkScheduleTotal:function(n,i,r){var u=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckScheduleTotal",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_listToCheck:n,_amount:i,_currencyId:st,_destinationID:r},success:function(n){n=t.parseJSON(n);n=="Success"?u=!0:(VIS.ADialog.info(n,null,"",""),u=!1)},error:function(){VIS.ADialog.info("error",null,"","");u=!1}}),u},checkPrepayCondition:function(n,u,s,h){var l=0,c,a;return rt.value&&(l=rt.value),c=!1,a=u,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckPrepayCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:u,_listToCheck:s,_amount:h,_currencyId:st,_formBPartnerID:l,stateDate:nt.val()},success:function(n){if(n=t.parseJSON(n),n._status=="Success")if(c=!0,n._amount!=0){if(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(y))),r(i.getControl().val())<0?(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),f.removeClass("va012-active"),f.addClass("va012-inactive"),f.attr("v_active","0")):(f.removeClass("va012-inactive"),f.addClass("va012-active"),f.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"),r(i.getControl().val())>0&&i.getControl().removeClass("va012-mandatory")),n._currency_Id!=0&&VIS.Utility.Util.getValueOfString(ft.value)!=null){o.val(n._currency_Id).prop("selected",!0);for(var u=0;o[0].length>u;u++)VIS.Utility.Util.getValueOfInt(o[0][u].value)==n._currency_Id||VIS.Utility.Util.getValueOfInt(o[0][u].value)==st?t(o[0][u]).show():t(o[0][u]).hide();o.removeClass("va012-mandatory");o.attr("disabled",!1);t(v[0][0]).hide();v.val(n._conversionType_Id).prop("selected",!0);v.attr("disabled",!1)}else o.val(st).prop("selected",!0),o.attr("disabled",!0),o.removeClass("va012-mandatory"),v.val(n._conversionType_Id).prop("selected",!0);v.trigger("change")}else c=a>0?!0:!1;else VIS.ADialog.info(n._status,null,"",""),c=!1},error:function(){VIS.ADialog.info("error",null,"","");c=!1}}),c},checkContraCondition:function(n,u,s){var l=0,c;return rt.value&&(l=rt.value),c=!1,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckContraCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:u,_amount:s,_currencyId:st,_formBPartnerID:l,stateDate:nt.val()},success:function(l){if(l=t.parseJSON(l),l._status=="Success")if(c=!0,i.setValue(VIS.Utility.Util.getValueOfDecimal(l._amount.toFixed(y))),r(i.getControl().val())<0?(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),f.removeClass("va012-active"),f.addClass("va012-inactive"),f.attr("v_active","0")):(f.removeClass("va012-inactive"),f.addClass("va012-active"),f.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"),r(i.getControl().val())>0&&i.getControl().removeClass("va012-mandatory")),l._amount!=0&&VIS.Utility.Util.getValueOfString(et.value)!=null){o.val(st).prop("selected",!0);for(var a=0;o[0].length>a;a++)VIS.Utility.Util.getValueOfInt(o[0][a].value)==st?t(o[0][a]).show():t(o[0][a]).hide();if(o.removeClass("va012-mandatory"),o.attr("disabled",!1),t(v[0][0]).hide(),v.val(l._conversionType_Id).prop("selected",!0),v.removeClass("va012-mandatory"),v.attr("disabled",!0),u==0&&s!=0&&(h[0].attributes["data-uid"].value>0&&(u=h[0].attributes["data-uid"].value),n>0&&u>0))return tt.statementOpenEdit(u,n),c=!0}else VIS.Utility.Util.getValueOfInt(u)>0?c=!0:(VIS.ADialog.info("VA012_ConversionRateNotFound",null,"",""),c=!1);else VIS.ADialog.info(l._status,null,"",""),c=!1},error:function(){VIS.ADialog.info("error",null,"","");c=!1}}),c},matchByDrag:function(n,u){var o=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/MatchByDrag",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragPaymentID:n,_dragStatementID:u},success:function(n){n=t.parseJSON(n);n._status=="Success"?(o=!0,n._amount!=null&&n._amount!=0&&(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(y))),r(i.getControl().val())<0?(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),f.removeClass("va012-active"),f.addClass("va012-inactive"),f.attr("v_active","0")):(f.removeClass("va012-inactive"),f.addClass("va012-active"),f.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")),g.trigger("focus"))):(VIS.ADialog.info(n._status,null,"",""),o=!1)},error:function(){VIS.ADialog.info("error",null,"","");o=!1}}),o}};this.vetoablechange=function(n){if(n.propertyName=="VA012_txtDifference_"+$self.windowNo+"")p.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(y)));else if(n.propertyName=="VA012_txtTaxAmount_"+$self.windowNo+"")lt.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(y)));else if(n.propertyName=="VA012_txtTrxAmt_"+$self.windowNo+"")s.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(y)));else if(n.propertyName=="VA012_txtAmount_"+$self.windowNo+""){var t=r(i.getControl().val());i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(t).toFixed(y)))}};tt={statementDialog:function(){function p(){s=$statement.find("#VA012_STAT_cmbBank_"+$self.windowNo);r=$statement.find("#VA012_STAT_cmbBankAccount_"+$self.windowNo);e=$statement.find("#VA012_STAT_cmbBankAccountClassName_"+$self.windowNo);v=$statement.find("#VA012_STAT_statementDate_"+$self.windowNo);h=$statement.find("#VA012_STAT_txtStatementNo_"+$self.windowNo);o=$statement.find("#VA012_ctrlLoadFile_"+$self.windowNo);STAT_ctrlLoadFileTxt=$statement.find("#VA012_ctrlLoadFileTxt_"+$self.windowNo);_tabFile=$statement.find("#VA012_STAT_tabFile_"+$self.windowNo);_tabSchedule=$statement.find("#VA012_STAT_tabSchedule_"+$self.windowNo);pu=$statement.find("#VA012_STAT_cmbBankAccountClassName_"+$self.windowNo)}function w(){s.html("");s.append("<option value="+vi.val()+">"+vi.children()[vi[0].selectedIndex].text+"<\/option>");s.prop("selectedIndex",0)}function b(){r.html("");r.append("<option value="+a.val()+">"+a.children()[a[0].selectedIndex].text+"<\/option>");r.prop("selectedIndex",0)}function k(){function t(t){var i,r;if(e.html(""),e.append("<option value=0 ><\/option>"),t!=null)for(i=0;i<t.tables[0].rows.length;i++)r=t.tables[0].rows[i].cells.va012_bankstatementclass_id,e.append("<option value="+r+">"+VIS.Utility.encodeText(t.tables[0].rows[i].cells.name)+"<\/option>");t.dispose();t=null;n=null;e.prop("selectedIndex",0)}var n=" SELECT BSC.VA012_BANKSTATEMENTCLASSNAME AS NAME, CONCAT(CONCAT(SC.NAME,'_'),VA012_BANKSTATEMENTCLASS_ID) AS VA012_BANKSTATEMENTCLASS_ID FROM VA012_BankStatementClass BSC INNER JOIN VA012_STATEMENTCLASS SC ON (BSC.VA012_STATEMENTCLASS_ID=SC.VA012_STATEMENTCLASS_ID) WHERE C_BANKACCOUNT_ID = "+a.val(),i=VIS.DB.executeDataSet(n.toString(),null,t)}function d(){function t(t){if(t!=null)for(var i=0;i<t.tables[0].rows.length;i++)y=VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_charge_id);t.dispose();t=null;n=null}var n="SELECT C_CHARGE_ID, NAME FROM C_CHARGE WHERE ISACTIVE = 'Y' AND AD_CLIENT_ID = "+VIS.Env.getCtx().getAD_Client_ID()+" AND ROWNUM = 1 ORDER BY NAME  ",i=VIS.DB.executeDataSet(n.toString(),null,t)}function g(){c=null;$statement=null;s=null;r=null;h=null;o=null;STAT_ctrlLoadFileTxt=null;_tabSchedule=null;_tabFile=null;i=null}var s=null,r=null,e=null,v=null,y=null,h=null,o=null,i=null,c,f;$statement=t("<div class='va012-popform-content'>");c="";c="<div><div class='va012-left-btn'><a id='VA012_STAT_tabFile_"+$self.windowNo+"' class='btn va012-blueBtn' activestatus='1'>"+VIS.Msg.getMsg("VA012_File")+"<\/a><\/div><\/div><div style='border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left;'><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_Bank")+"<\/label><select id='VA012_STAT_cmbBank_"+$self.windowNo+"' class='vis-ev-col-readonly' disabled><\/select><\/div> <div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_BankAccount")+"<\/label><select id='VA012_STAT_cmbBankAccount_"+$self.windowNo+"' class='vis-ev-col-readonly' disabled><\/select><\/div><div class=va012-popform-data><label id=VA012_STAT_lblStatementDate_"+$self.windowNo+">"+VIS.Msg.getMsg("VA012_StatementDate")+'<\/label><input type=date max="9999-12-31" class=vis-ev-col-readonly disabled id=VA012_STAT_statementDate_'+$self.windowNo+"><\/div><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_ClassName")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_STAT_cmbBankAccountClassName_'+$self.windowNo+"'><\/select><\/div><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_StatementNumber")+"<sup style=\"color: red;\">*<\/sup><\/label><input type='text' id='VA012_STAT_txtStatementNo_"+$self.windowNo+"' /> <\/div><div class='va012-popform-data va012-pop-file'><label>"+VIS.Msg.getMsg("VA012_SelectFile")+"<sup style=\"color: red;\">*<\/sup><\/label><input type='text' id='VA012_ctrlLoadFileTxt_"+$self.windowNo+"' disabled><div class='va012-file-upload'><label for='file-input' class='va012-file-label'>"+VIS.Msg.getMsg("VA012_Browse")+"<\/label><input id='VA012_ctrlLoadFile_"+$self.windowNo+"' type='file' accept='.csv,text/plain,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel'/><\/div><\/div><\/div>";$statement.append(c);p();w();b();k();v.val(Globalize.format(new Date(vt.val()),"yyyy-MM-dd"));d();f=new VIS.ChildDialog;f.setContent($statement);f.setTitle(VIS.Msg.getMsg("VA012_LoadStatement"));f.setWidth("500px");f.setEnableResize(!1);f.setModal(!0);f.show();o.on("change",function(){var u=this;r.val()!=null&&r.val()>0?(i=t.parseJSON(n.UploadExcel(u,null,null)),STAT_ctrlLoadFileTxt.val(i._orgfilename)):(o=null,VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"",""))});f.onOkClick=function(){if(ri.val(""),_tabFile.attr("activestatus")=="1"){if(r.val()==null||r.val()==""||r.val()=="0")return VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"",""),!1;if(e.val()==null||e.val()==""||e.val()=="0")return VIS.ADialog.info("VA012_PleaseSelectClassFirst",null,"",""),!1;if(h.val()==null||h.val()=="")return VIS.ADialog.info("VA012_PleaseEnterStatementNo",null,"",""),!1;if(o.val()==""==null||o.val()=="")return VIS.ADialog.info("VA012_SelectFileFirst",null,"",""),!1;if(i!=null){if(i._filename==null||i._filename==""||i._path==null||i._path==""){VIS.ADialog.info("VA012_ErrorInGettingFile",null,"","");return}if(i._error!=null&&i._error!=""){VIS.ADialog.info(i._error,null,"","");return}var n=i._path,f=i._filename,s=r.val(),c=h.val(),w=$statement,a=e.val(),p=y;wt(l,!0,"absolute");window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/ImportStatement",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_path:n,_filename:f,_bankaccount:s,_bankAccountCurrency:st,_statementno:c,_statementClassName:a,_statementCharges:p,statementDate:v.val()},success:function(n){fi=n._statementID;fi!=null&&fi!=""?(bt=[],ct.html(""),hi=1,wt(l,!1,"absolute"),tt.loadStatement(fi),u.refreshForm()):n._error!=null&&n._error!=""&&(wt(l,!1,"absolute"),VIS.ADialog.info(n._error,null,"",""))},error:function(){wt(l,!1,"absolute");VIS.ADialog.info("error",null,"","")}})},2)}}if(_tabSchedule.attr("activestatus")=="1")return alert("Schedule"),!1};f.onCancelClick=function(){};f.onClose=function(){g()};_tabFile.on(VIS.Events.onTouchStartOrClick,function(){_tabFile.removeClass("va012-grayBtn");_tabFile.addClass("va012-blueBtn");_tabFile.attr("activestatus","1");_tabSchedule.removeClass("va012-blueBtn");_tabSchedule.addClass("va012-grayBtn");_tabSchedule.attr("activestatus","0")});_tabSchedule.on(VIS.Events.onTouchStartOrClick,function(){_tabSchedule.removeClass("va012-grayBtn");_tabSchedule.addClass("va012-blueBtn");_tabSchedule.attr("activestatus","1");_tabFile.removeClass("va012-blueBtn");_tabFile.addClass("va012-grayBtn");_tabFile.attr("activestatus","0")})},LoadStatementsPages:function(){bi=ri.val()!=null&&ri.val()!=""?!0:!1;t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadStatementsPages",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_cmbBankAccount:a.val(),_txtSearch:ri.val(),_statementPageNo:hi,_PAGESIZE:pf,_SEARCHREQUEST:bi},success:function(n){n!=null&&n!=""&&(ne=JSON.parse(n))}})},loadStatement:function(){function i(n){n!=null&&n.length>0?(dr.html(""),kr.html(""),kr.append("<p>"+VIS.Msg.getMsg("VA012_Reconciled")+"<\/p><p style='margin-top: 4px;'>"+VIS.Msg.getMsg("VA012_Unreconciled")+"<\/p>"),dr.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>"+n[0].basecurrency+"<\/span> "+parseFloat(n[0].reconciled).toLocaleString(navigator.language,{minimumFractionDigits:y,maximumFractionDigits:y})+"<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'> <span class='va012-base-curr'>"+n[0].basecurrency+"<\/span> "+parseFloat(n[0].unreconciled).toLocaleString(navigator.language,{minimumFractionDigits:y,maximumFractionDigits:y})+"<\/span>")):(dr.html(""),kr.html(""),kr.append("<p>"+VIS.Msg.getMsg("VA012_Reconciled")+"<\/p><p style='margin-top: 4px;'>"+VIS.Msg.getMsg("VA012_Unreconciled")+"<\/p>"),dr.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>"+eu+"<\/span> 0<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'><span class='va012-base-curr'>"+eu+"<\/span> 0<\/span>"));tt.setStatementListHeight()}function r(i){var u,r;if(i=t.parseJSON(i),u="",i!=null&&i.length>0)for(r=0;r<i.length;r++)u="",n=i[r].docstatus=="CO"||i[r].docstatus=="CL"||i[r].docstatus=="RE"?"va012-gray-color":i[r].c_payment_id==null||i[r].c_payment_id=="0"||i[r].c_payment_id==0?i[r].c_cashline_id!=null&&i[r].c_cashline_id!="0"&&i[r].c_cashline_id!=0?"va012-green-color":i[r].c_charge_id!=null&&i[r].c_charge_id!="0"&&i[r].c_charge_id!=0?i[r].STMTAMT==i[r].trxamount?"va012-green-color":"va012-red-color":(i[r].c_charge_id==null||i[r].c_charge_id=="")&&(i[r].trxno==null||i[r].trxno=="")?"va012-red-color":"va012-red-color":"va012-green-color",u='<div  data-uid="'+i[r].c_bankstatementline_id+'" class="va012-right-data-wrap '+n+'"><div class="va012-statement-wrap"><div class="va012-fl-padd"><div class="col-md-4 col-sm-4 va012-padd-0"><div class="va012-form-check"> <input type="checkbox" data-uid="'+i[r].c_bankstatementline_id+'" > <div class="va012-form-text"> <span style="background: rgba(var(--v-c-on-secondary), .4);color: rgba(var(--v-c-on-primary), 1); padding: 3px;margin-left: 2px;">'+i[r].statementno+"/"+i[r].page+"/"+i[r].line+"<\/span><label>"+new Date(i[r].stmtLineDate).toLocaleDateString()+"<\/label><label>"+i[r].currency+" "+parseFloat(i[r].trxamount).toLocaleString(navigator.language,{minimumFractionDigits:y,maximumFractionDigits:y})+"<\/label>",u+=i[r].trxno==""||i[r].trxno==null?'<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p>'+VIS.Utility.encodeText(i[r].description)+"<\/p><span>"+VIS.Utility.encodeText(i[r].invoiceno)+'<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="'+i[r].c_bankstatementline_id+'" class="glyphicon glyphicon-edit" title='+VIS.Msg.getMsg("EditRecord")+'><\/span> <span data-uid="'+i[r].c_bankstatement_id+'" class="glyphicon glyphicon-zoom-in" title='+VIS.Msg.getMsg("ZoomToRecord")+'><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0 va012-width-xs"><div class="va012-form-data">':'<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p>'+VIS.Utility.encodeText(i[r].description)+"<\/p> <span>"+VIS.Utility.encodeText(i[r].bpgroup)+"<\/span><span>"+VIS.Utility.encodeText(i[r].invoiceno)+'<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p>'+VIS.Utility.encodeText(i[r].trxno)+'<\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="'+i[r].c_bankstatementline_id+'" class="glyphicon glyphicon-edit"><\/span> <span data-uid="'+i[r].c_bankstatement_id+'" class="glyphicon glyphicon-zoom-in"><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0 va012-width-xs"><div class="va012-form-data">',u+=" <\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <\/div> <!-- end of row --><\/div><!-- end of payment-wrap --><\/div><!-- end of right-data-wrap -->",ct.append(u);_sql=null;tt.setStatementListHeight();c.dropPayments()}bi=ri.val()!=null&&ri.val()!=""?!0:!1;wt(t(ct),!0,"inherit");window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadConciledOrUnConciledStatements",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_cmbBankAccount:a.val(),_txtSearch:ri.val(),_currencyID:st!=null?st:0,_searchRequest:bi},success:function(n){var r=t.parseJSON(n);i(r);wt(t(ct),!1,"inherit")},error:function(){wt(t(ct),!1,"inherit")}})},2);var n="va012-red-color";window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadStatements",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_cmbBankAccount:a.val(),_txtSearch:ri.val(),_statementPageNo:hi,_PAGESIZE:pf,_SEARCHREQUEST:bi},success:function(n){n!=null&&n!=""&&(r(n),wt(t(ct),!1,"inherit"))},error:function(){wt(t(ct),!1,"inherit")}})},2)},setStatementListHeight:function(){var n=t("#VA012_mainContainer_"+$self.windowNo).height();n==0&&(n=window.innerHeight-107);t("#VA012_contentArea_"+$self.windowNo).height(n-20);t("#VA012_lstStatement_"+$self.windowNo).height(t("#VA012_rightWrap_"+$self.windowNo).height()-t("#VA012_rightTop_"+$self.windowNo).height()-18)},statementOpenEdit:function(n,t){return at.attr("activestatus","1"),at.attr("src","Areas/VA012/Images/hide.png"),at.attr("title","Collapse"),at.removeClass("vis vis-plus"),at.addClass("fa fa-minus"),h.show(),c.setPaymentListHeight(),tt.statementListRecordEdit(n,t),n=0,!0},statementListEdit:function(n){var i=t(n.target),r=0;i.hasClass("glyphicon-edit")&&(r=i.data("uid"),at.attr("activestatus","1"),at.attr("src","Areas/VA012/Images/hide.png"),at.attr("title","Collapse"),h.show(),at.removeClass("vis vis-plus"),at.addClass("fa fa-minus"),c.setPaymentListHeight(),u.scheduleRefresh(),u.prepayRefresh(),ki=!0,tt.statementListRecordEdit(r,0),r=0,c.addEffect(i,h))},openStatement:function(n){var e=t(n.target),f=0,o,i,r,u;if(e.hasClass("glyphicon glyphicon-zoom-in")){f=e.data("uid");o="select ad_window_id from ad_window where name = 'Bank Statement'";i=0;try{r=VIS.DB.executeDataReader(o);r.read()&&(i=r.getInt(0));r.dispose();i>0&&(u=new VIS.Query,u.addRestriction("C_BankStatement_ID",VIS.Query.prototype.EQUAL,f),u.setRecordCount(1),VIS.viewManager.startWindow(i,u))}catch(n){console.log(n)}f=0}},selectedStatementLinesList:function(n){var i=t(n.target);n.target.type=="checkbox"&&(i.is(":checked")&&(_bankStatementLineID=parseInt(i.data("uid")),bt.push(_bankStatementLineID),_bankStatementLineID=0),i.is(":checked")||(_bankStatementLineID=parseInt(i.data("uid")),bt.splice(bt.indexOf(_bankStatementLineID),1),_bankStatementLineID=0))},statementListRecordEdit:function(n,t){VIS.Utility.Util.getValueOfInt(t)==0&&u.refreshForm();tt.getStatementLineForEdit(n,t,tt.afterRecordGet)},selectedScheduleList:function(n){var i=t(n.target);n.target.type=="checkbox"&&(i.is(":checked"),!i.is(":checked"))},getStatementLineForEdit:function(n,i,r){t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/GetStatementLine",contentType:"application/json; charset=utf-8",data:JSON.stringify({_bankStatementLineID:n,trxType:ot.val(),payment_ID:i!=null?i:0}),success:function(n){r(n)},error:function(n){VIS.ADialog.info(n,null,"","")}})},afterRecordGet:function(n){var u,l,a,c;if(n!=null&&n!=""){if(u=t.parseJSON(n),h.attr("data-uid",u._bankStatementLineID),kt.val(u._txtStatementNo),ci.val(u._txtStatementPage),ir.val(u._txtStatementLine),nt.val(Globalize.format(new Date(u._dtStatementDate),"yyyy-MM-dd")),gi.val(u._cmbPaymentMethod).prop("selected",!0),u._cmbVoucherMatch!=null&&u._cmbVoucherMatch!=""?k.val(u._cmbVoucherMatch).prop("selected",!0):k.prop("selectedIndex",0),ot.val()=="CO"&&k.val("C").prop("selected",!0),k.trigger("change"),u._cmbContraType!=null&&u._cmbContraType!=""?ut.val(u._cmbContraType).prop("selected",!0):ut.prop("selectedIndex",0),k.val()!=null&&k.val()!=""&&ut.val()!=null&&ut.val()!=""&&(ut.val("CB").prop("selected",!0),ut.trigger("change")),di.val(u._cmbCashBook).prop("selected",!0),br.val(u._txtCheckNo),i.setValue(VIS.Utility.Util.getValueOfDecimal(u._txtAmount.toFixed(y))),s.setValue(VIS.Utility.Util.getValueOfDecimal(u._txtTrxAmt.toFixed(y))),r(i.getControl().val())<=0?i.getControl().addClass("va012-mandatory"):i.getControl().removeClass("va012-mandatory"),u._reconciled&&(i.getControl().attr("disabled",!0),lu=u._reconciled),r(s.getControl().val())<=0?s.getControl().addClass("va012-mandatory"):s.getControl().removeClass("va012-mandatory"),(k.val()=="M"||k.val()=="C")&&r(s.getControl().val())!=0&&(l=VIS.Utility.Util.getValueOfDecimal(u._txtDifference.toFixed(y)),p.setValue(l),p.getControl().trigger("blur"),u._txtDifference<0?p.getControl().addClass("va012-mandatory"):p.getControl().removeClass("va012-mandatory"),k.val()=="C"&&k.trigger("change")),u._cmbDifferenceType!=null&&u._cmbDifferenceType!=""?(yi.find("*").prop("disabled",!1),w.val(u._cmbDifferenceType).prop("selected",!0)):w.prop("selectedIndex",0),w.trigger("change"),r(i.getControl().val())<0?(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),f.removeClass("va012-active"),f.addClass("va012-inactive"),f.attr("v_active","0")):(f.removeClass("va012-inactive"),f.addClass("va012-active"),f.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")),rr.val(u._txtVoucherNo),gr.val(u._txtDescription),tr.val(u._cmbCharge).prop("selected",!0),g.val(u._txtCharge),g.attr("chargeid",u._cmbCharge),VIS.Utility.Util.getValueOfInt(u._cmbCharge)==0&&u._cmbDifferenceType!=""&&u._cmbDifferenceType!=null?g.addClass("va012-mandatory"):g.removeClass("va012-mandatory"),it.val(u._cmbTaxRate).prop("selected",!0),VIS.Utility.Util.getValueOfInt(u._cmbTaxRate)==0&&u._cmbDifferenceType!=""&&u._cmbDifferenceType!=null?it.addClass("va012-mandatory"):it.removeClass("va012-mandatory"),lt.setValue(VIS.Utility.Util.getValueOfDecimal(u._txtTaxAmount.toFixed(y))),tu.prop("checked",u._chkUseNextTime),u._ctrlCashLine>0?(et.setValue(u._ctrlCashLine,!1,!0),ki=!1):ei||(et.setValue(),u._ctrlPayment<=0&&(ki=!1)),d&&d.value>0&&u._ctrlPayment==0&&(u._ctrlPayment=d.value),u._ctrlPayment>0?(d.setValue(u._ctrlPayment,!1,!0),rr.val()==""&&(a=VIS.Utility.Util.getValueOfString(VIS.DB.executeScalar("select trxno from C_Payment where C_Payment_ID="+u._ctrlPayment)),rr.val(a)),ki=!1):ei||(d.setValue(),ki=!1),u._ctrlOrder>0?ft.setValue(u._ctrlOrder,!1,!0):ei||ft.setValue(),u._ctrlBusinessPartner>0?rt.setValue(u._ctrlBusinessPartner,!1,!0):ei||rt.setValue(),u._ctrlInvoice>0?pt.setValue(u._ctrlInvoice,!1,!0):ei||pt.setValue(),u._txtCurrency!=0){for(o.val(u._txtCurrency).prop("selected",!0),c=0;o[0].length>c;c++)VIS.Utility.Util.getValueOfInt(o[0][c].value)==u._txtCurrency||VIS.Utility.Util.getValueOfInt(o[0][c].value)==st?t(o[0][c]).show():t(o[0][c]).hide();o.removeClass("va012-mandatory");o.attr("disabled",!1)}u._txtConversionType==0?(v.prop("selectedIndex",0),v.addClass("va012-mandatory"),v.attr("disabled",!1)):(v.val(u._txtConversionType).prop("selected",!0),v.removeClass("va012-mandatory"),u._ctrlPayment>0?v.attr("disabled",!0):u._ctrlCashLine>0?v.attr("disabled",!0):(v.attr("disabled",!1),t(v[0][0]).hide()));VIS.Utility.Util.getValueOfDecimal(u._txtDifference.toFixed(y))!=0&&(b.length==0||b.length>0&&h.attr("data-uid")!=0&&Math.abs(r(s.getControl().val()))<Math.abs(r(i.getControl().val())))&&(VIS.Utility.Util.getValueOfInt(ft.value)==0&&h.attr("data-uid")==0||h.attr("data-uid")!=0)&&(w.find("option[value=0]").prop("disabled",!0),w.find("option[value=OU]").prop("disabled",!0),w.find("option[value=DA]").prop("disabled",!0),w.find("option[value=WO]").prop("disabled",!0));g.trigger("focus")}},matchStatementDialog:function(){function p(){function t(t){if(e.html(""),e.append("<option value=0 >-<\/option>"),t!=null)for(var i=0;i<t.tables[0].rows.length;i++)e.append("<option value="+VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_bankstatement_id)+">"+VIS.Utility.encodeText(t.tables[0].rows[i].cells.name)+"<\/option>");t.dispose();t=null;n=null}var n="Select Cb.C_Bankstatement_Id, CB.NAME,Cb.Docstatus, COUNT(VA012_ISMATCHINGCONFIRMED) FROM C_BankStatement CB INNER JOIN C_BankStatementLine CBL ON (cbl.C_BANKSTATEMENT_ID = Cb.C_BANKSTATEMENT_ID) Where Cb.Isactive = 'Y' And Cb.Ad_Client_Id = "+VIS.Env.getCtx().getAD_Client_ID()+" And Cb.C_Bankaccount_Id = "+a.val()+" And Cb.Docstatus NOT IN  ('CO','CL','VO') GROUP BY CB.C_BANKSTATEMENT_ID,Cb.Docstatus, CB.NAME",i=VIS.DB.executeDataSet(n.toString(),null,t)}function w(){function n(n){if(o.html(""),o.append("<option value=0 >-<\/option>"),n!=null)for(var t=0;t<n.length;t++)o.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_Tax_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>")}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/LoadTaxRate",null,n)}function b(){n=$match.find("#VA012_cmbMatchingBase_"+$self.windowNo);i=$match.find("#VA012_divMatchingBase_"+$self.windowNo);s=$match.find("#VA012_cmbMatchingCriteria_"+$self.windowNo);e=$match.find("#VA012_cmbStatementNo_"+$self.windowNo);v=$match.find("#VA012_ChargeSrch_"+$self.windowNo);o=$match.find("#VA012_cmbTaxRate_"+$self.windowNo);y=$match.find("#VA012_accept_"+$self.windowNo);_ChargeLookUp=VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(),$self.windowNo,3787,VIS.DisplayType.Search);h=new VIS.Controls.VTextBoxButton("C_Charge_ID",!0,!1,!0,VIS.DisplayType.Search,_ChargeLookUp);v.append(h.getControl().css("width","93%")).append(h.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"))}function k(n){var i=t(n.target);i.hasClass("glyphicon-remove")&&(r.splice(r.indexOf(i.data("uid")),1),i.parent().parent().remove())}function d(){n=null;i=null;r=[];s=null;w2ui["VA012_gridPayment_"+$self.windowNo]!=null&&w2ui["VA012_gridPayment_"+$self.windowNo].destroy()}var n=null,i=null,r=[],s=null,e=null,v=null,h=null,o=null,y=null,l,f;$match=t("<div class='va012-popform-content'>");l="";l="<div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_StatementNo")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbStatementNo_'+$self.windowNo+"'><\/select><\/div> <div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_MatchingBase")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbMatchingBase_'+$self.windowNo+"'><\/select><\/div> <div id='VA012_divMatchingBase_"+$self.windowNo+"' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_MatchingCriteria")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbMatchingCriteria_'+$self.windowNo+"'><option value='0'><\/option><option value='AT'>"+VIS.Msg.getMsg("VA012_MatchAnyTwo")+"<\/option><option value='AR'>"+VIS.Msg.getMsg("VA012_MatchAnyThree")+"<\/option><option value='AL'>"+VIS.Msg.getMsg("VA012_MatchAll")+"<\/option><\/select><\/div> <div class='va012-popform-data'><label title = '"+VIS.Msg.getMsg("VA012_SetChargeType")+"' > "+VIS.Msg.getMsg("VA012_Charge")+'<sup style="color: red;">*<\/sup><\/label><div id=\'VA012_ChargeSrch_'+$self.windowNo+"'><\/div><\/div> <div class='va012-popform-data'><label title =' "+VIS.Msg.getMsg("VA012_SetTaxRate")+"' >"+VIS.Msg.getMsg("VA012_TaxRate")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbTaxRate_'+$self.windowNo+"'><\/select><\/div> <div class='va012-frm-btn va012-btn-blue' style='float: right;'><label style='font-weight: normal;' id ='VA012_accept_"+$self.windowNo+"'>"+VIS.Msg.getMsg("VA012_Accept")+"<\/label><\/div> <\/div>";$match.append(l);b();no(n);p();w();f=new VIS.ChildDialog;f.setContent($match);f.setTitle(VIS.Msg.getMsg("VA012_MatchStatement"));f.setWidth(700);f.setHeight(650);f.setEnableResize(!1);f.setModal(!0);f.show();f.hideButtons();y.click(function(){if(r.length>0){if(e.val()==null||e.val()==""||e.val()=="0")return VIS.ADialog.info("VA012_NoLinesFoundToMatch",null,"",""),!1;if(a.val()==null||a.val()==""||a.val()=="0")return VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"",""),!1;if(s.val()==null||s.val()==""||s.val()=="0")return VIS.ADialog.info("VA012_SelectMatchingCriteria",null,"",""),!1;if(s.val()=="AT"&&r.length<2)return VIS.ADialog.info("VA012_SelectMin2MatchingBase",null,"",""),!1;if(s.val()=="AR"&&r.length<3)return VIS.ADialog.info("VA012_SelectMin3MatchingBase",null,"",""),!1;if(h.value==null||VIS.Utility.Util.getValueOfInt(h.value)==0)return VIS.ADialog.info("VA012_NoChargeSelected",null,"",""),!1;if(o.val()==null||o.val()==""||o.val()=="0")return VIS.ADialog.info("VA012_NoTaxRateSelected",null,"",""),!1;wt($match,!0,"absolute");window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/MatchStatementGridData",type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_matchingBaseItemList:r.toString(),_cmbMatchingCriteria:s.val(),_BankAccount:a.val(),_StatementNo:e.val(),_BankCharges:VIS.Utility.Util.getValueOfInt(h.value),_TaxRate:o.val()},success:function(f){if(f!=null&&f!=""){f=t.parseJSON(f);n.prop("selectedIndex",0);e.prop("selectedIndex",0);h.value=null;o.prop("selectedIndex",0);r=[];var s="";i.html("");f.length>0?(ae(i,f),_statementlineslist=[],ct.html(""),hi=1,tt.loadStatement(fi),ui.html(""),u.scheduleRefresh(),u.prepayRefresh(),pi=1,c.loadPayments(a.val(),yt.val(),ot.val(),vt.val())):(s="<div> <p> <b>"+VIS.Msg.getMsg("va012_norecordmatched")+"<\/b> <\/div>",i.append(s));wt($match,!1,"absolute")}else wt($match,!1,"absolute"),VIS.ADialog.info(f.toString(),null,"","")},error:function(){wt($match,!1,"absolute");VIS.ADialog.info("error",null,"","")}})},2)}else return VIS.ADialog.info("VA012_NoMatchingBaseSelected",null,"",""),!1;return!1});f.onCancelClick=function(){w2ui["VA012_gridPayment_"+$self.windowNo]!=null&&w2ui["VA012_gridPayment_"+$self.windowNo].destroy()};f.onClose=function(){d()};n.on("change",function(){if(r.length<=0&&i.html(""),!hf(n.val(),r)&&n.val()!="0"&&n.val()!=""){r.push(n.val());var u="<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='"+n.val()+"'class='glyphicon glyphicon-remove'><\/span><\/a> <span>"+n.children()[n[0].selectedIndex].text;t(i)[0]!=undefined&&t(i)[0].classList.contains("w2ui-reset","w2ui-grid")&&i.removeClass("w2ui-reset w2ui-grid");i.append(u)}});i.on(VIS.Events.onTouchStartOrClick,k)},matchStatementGridDialog:function(){var n=new VIS.ChildDialog;n.setContent(au);n.setTitle(VIS.Msg.getMsg("VA012_MatchStatementGrid"));n.setWidth("780px");n.setHeight(450);n.setEnableResize(!0);n.setModal(!0);n.show();ae()},paymentScheduleDialog:function(){function ut(){var u="",t=0,n;for($_divPaymentSchedules.html(""),n=0;n<b.length;n++)u="<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='"+b[n]+"'  data-udata='"+li[n]+"' class='glyphicon glyphicon-remove'><\/span><\/a> <span>"+li[n]+"<\/span> <\/div>",$_divPaymentSchedules.append(u),ht.length>0&&(t+=VIS.Utility.Util.getValueOfDecimal(ht[n]));i.setValue(VIS.Utility.Util.getValueOfDecimal(t.toFixed(y)));s.setValue(VIS.Utility.Util.getValueOfDecimal(t.toFixed(y)));r(i.getControl().val())<0&&f.attr("v_active","0");i.getControl().trigger("blur",[r(i.getControl().val()),r(s.getControl().val())]);b!=null&&b.length>0?vu(b.toString()):vu(null)}function et(n){var h=t(n.target),u,o;if(h.hasClass("glyphicon-remove")){if(ht!=null&&ht.length>0){if(ht.length>b.length?ht.splice(b.indexOf(h.data("uid"))+1,1):ht.length==b.length&&ht.splice(b.indexOf(h.data("uid")),1),u=0,Number(ht.length)>0)for(o=0;o<ht.length;o++)u+=VIS.Utility.Util.getValueOfDecimal(ht[o]);u<0?(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),f.removeClass("va012-active"),f.addClass("va012-inactive"),f.attr("v_active","0")):(f.removeClass("va012-inactive"),f.addClass("va012-active"),f.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"));i.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(y)))}for(b.splice(b.indexOf(h.data("uid")),1),li.splice(li.indexOf(h.data("udata")),1),h.parent().parent().remove(),wi.val(li.toString()),u=0,o=0;o<ht.length;o++)u+=VIS.Utility.Util.getValueOfDecimal(ht[o]);i.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(y)));s.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(y)));i.getControl().trigger("blur",[r(i.getControl().val()),r(s.getControl().val())]);u==0&&rt.setValue();b!=null&&b.length>0?vu(b.toString()):vu(null)}}function ot(){$_divPaymentSchedules=$paymentSchedule.find("#VA012_divPaymentSchedules_"+$self.windowNo);p=$paymentSchedule.find("#VA012_ctrlPSInvoice_"+$self.windowNo);w=$paymentSchedule.find("#VA012_ctrlPSBP_"+$self.windowNo);n=$paymentSchedule.find("#VA012_cmbPaymentSchedule_"+$self.windowNo)}function ft(){g=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,3484,VIS.DisplayType.MultiKey,"C_Invoice_ID",0,!1,"DocStatus IN ('CO','CL') AND C_Invoice.C_BPartner_ID="+tt);o=new VIS.Controls.VTextBoxButton("C_Invoice_ID",!1,!1,!0,VIS.DisplayType.MultiKey,g);o.isMultiKeyTextBox=!0;o.getControl().addClass("va012-input-size-2");p.append(o.getControl());p.append(o.getBtn(0));p.append(o.getBtn(1));o.fireValueChanged=function(){d=null;d=o.value;n.html("");ct()}}function st(){it=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,2893,VIS.DisplayType.Search,"C_BPartner_ID",0,!1,null);l=new VIS.Controls.VTextBoxButton("C_BPartner_ID",!1,!1,!0,VIS.DisplayType.Search,ef);l.getControl().addClass("va012-input-size-2");w.append(l.getControl());w.append(l.getBtn(0));w.append(l.getBtn(1));l.fireValueChanged=function(){tt=0;tt=l.value;g=null;o=null;p.html("");d=null;ft()}}function ct(){function i(t){if(n.html(""),n.append("<option value=0 ><\/option>"),t!=null)for(var i=0;i<t.length;i++){if(t[i].DueAmount==0){VIS.ADialog.info("VA012_ConversionRateNotFound",null," "+VIS.Msg.getMsg("VA012_InvoiceSchedule")+": "+VIS.Utility.Util.getValueOfString(t[i].c_invoicepayschedule_id),"");return}n.append("<option paymentamount="+t[i].DueAmount+" paymentdata='"+VIS.Utility.encodeText(new Date(t[i].DueDate).toLocaleDateString())+"_"+VIS.Utility.encodeText(t[i].DueAmt)+"' value="+VIS.Utility.Util.getValueOfInt(t[i].c_invoicepayschedule_id)+">"+VIS.Utility.encodeText(new Date(t[i].DueDate).toLocaleDateString()+"_"+t[i].DueAmt)+"<\/option>")}n.prop("selectedIndex",0)}t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetInvPaySchedule",dataType:"json",data:{seltdInvoice:d,accountID:a.val(),statemtDate:nt.val()},success:function(n){var t=JSON.parse(n);(t!=null||t!="")&&i(t)}})}function lt(){g=null;o=null;d=null;p=null;it=null;l=null;tt=null;w=null;n=null}var k,v;if(b.length==0&&li.length==0)var g=null,o=null,d=null,p=null,it=null,l=null,tt=null,w=null,n=null;$paymentSchedule=t("<div class='va012-popform-content'>");k="";k="<div> <label>"+VIS.Msg.getMsg("VA012_BusinessPartner")+"<\/label> <div id='VA012_ctrlPSBP_"+$self.windowNo+"' ><\/div> <\/div>";k+="<div> <label>"+VIS.Msg.getMsg("VA012_Invoice")+"<\/label> <div id='VA012_ctrlPSInvoice_"+$self.windowNo+"' ><\/div> <\/div>";k+="<div> <label>"+VIS.Msg.getMsg("VA012_PaymentSchedules")+"<\/label> <select id='VA012_cmbPaymentSchedule_"+$self.windowNo+"'  style=' width: 100%; ' ><\/select> <\/div>";k+="<div id='VA012_divPaymentSchedules_"+$self.windowNo+"' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px;margin-top: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>";$paymentSchedule.append(k);ot();v=new VIS.ChildDialog;v.setContent($paymentSchedule);v.setTitle(VIS.Msg.getMsg("VA012_PaymentSchedules"));v.setWidth("500px");ut();v.setEnableResize(!1);v.setModal(!0);v.show();st();ft();rt.value&&(l.setValue(rt.value,!1,!0),w.find("*").prop("disabled",!0));pt.value&&(o.setValue(pt.value,!1,!0),p.find("*").prop("disabled",!0));n.on("change",function(){n.val()>0&&c.checkScheduleCondition(n.val(),parseInt(h.attr("data-uid")),b.toString(),r(i.getControl().val()))&&(hf(parseInt(n.val()),b)?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(b.push(parseInt(n.val())),li.push(this.options[this.selectedIndex].getAttribute("paymentdata")),ht.push(this.options[this.selectedIndex].getAttribute("paymentamount")),ut(),c.setInvoiceAndBPartner(n.val(),"IS")),wi.val(li.toString()))});$_divPaymentSchedules.on(VIS.Events.onTouchStartOrClick,et);v.onOkClick=function(){};v.onCancelClick=function(){u.scheduleRefresh();u.refreshForm();lt()}},prepayOrderDialog:function(){function r(){var t="",n;for($_divPrepayOrders.html(""),n=0;n<pr.length;n++)t="<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='"+pr[n]+"'  data-udata='"+wr[n]+"' class='glyphicon glyphicon-remove'><\/span><\/a> <span>"+wr[n]+"<\/span> <\/div>",$_divPrepayOrders.append(t)}function u(n){var i=t(n.target);i.hasClass("glyphicon-remove")&&(pr.splice(pr.indexOf(i.data("uid")),1),wr.splice(wr.indexOf(i.data("udata")),1),i.parent().parent().remove(),rf.val(wr.toString()))}function f(){$_divPrepayOrders=$prepayOrder.find("#VA012_divPrepayOrders_"+$self.windowNo)}var i,n;$prepayOrder=t("<div class='va012-popform-content'>");i="";i="<div id='VA012_divPrepayOrders_"+$self.windowNo+"' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>";$prepayOrder.append(i);f();n=new VIS.ChildDialog;n.setContent($prepayOrder);n.setTitle(VIS.Msg.getMsg("VA012_PrepayOrders"));n.setWidth("500px");r();n.setEnableResize(!1);n.setModal(!0);n.show();$_divPrepayOrders.on(VIS.Events.onTouchStartOrClick,u)}};u={newRecord:function(){function tt(n){datasource=[];for(var t=0;t<n.length;t++)datasource.push({label:n[t].name,value:n[t].name,ids:n[t].chargeID});g.autocomplete("option","source",datasource);g.autocomplete("search","");g.trigger("focus")}function ot(n,i){g.attr("chargeid",0);t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetCharge",dataType:"json",data:{searchText:n},success:function(n){var r=JSON.parse(n);datasource=[];i(t.map(r,function(n){return{label:n.name,value:n.name,ids:n.chargeID}}));t(self.div).autocomplete("search","");t(self.div).trigger("focus")}})}function n(){k.val()=="V"?(o.val(st).prop("selected",!0),o.removeClass("va012-mandatory"),o.attr("disabled",!0)):(t(o[0]).siblings().show(),o.val(0).prop("selected",!0),o.addClass("va012-mandatory"),o.attr("disabled",!1))}h=l.find("#VA012_formNewRecord_"+$self.windowNo);nf=l.find("#VA012_formBtnNewRecord_"+$self.windowNo);u.getNewRecordDesign();u.getNewRecordControls();u.loadCurrency();u.loadPaymentMethod();u.loadVoucherMatch();u.loadContraType();u.loadCashBook();u.loadDifferenceType();u.loadTransferType();u.loadNewFormCurrency();u.loadConversionTypes();u.loadCharge();u.loadTaxRate();u.loadPayment();u.loadOrder();u.loadBusinessPartner();u.loadInvoice();u.loadCashLine();r(i.getControl().val())<=0&&i.getControl().addClass("va012-mandatory");kt.val()!=""&&kt.removeClass("va012-mandatory");nt.val()!=""&&nt.removeClass("va012-mandatory");g.on("blur",function(){(g.val()==""||g.val()==null)&&g.attr("chargeid",0)});df.on(VIS.Events.onTouchStartOrClick,function(){VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetCharge",{searchText:""},tt)});g.autocomplete({minLength:0,scroll:!0,source:function(n,t){n.term.trim().length!=0&&ot(n.term,t)},select:function(n,i){t(this).val(i.item.ids);t(this).attr("chargeid",i.item.ids);parseInt(t(this).val())&&g.removeClass("va012-mandatory")}});at.on(VIS.Events.onTouchStartOrClick,function(){at.attr("activestatus")=="0"?(h.show(),at.attr("activestatus","1"),at.removeClass("vis vis-plus"),at.addClass("fa fa-minus"),at.attr("title","Collapse")):(h.hide(),at.attr("activestatus","0"),at.addClass("vis vis-plus"),at.removeClass("fa fa-minus"),at.attr("title","Expand"));r(i.getControl().val())<=0&&i.getControl().addClass("va012-mandatory");kt.val()!=""&&kt.removeClass("va012-mandatory");nt.val()!=""&&nt.removeClass("va012-mandatory");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();o.trigger("change");c.setPaymentListHeight()});bf.on(VIS.Events.onTouchStartOrClick,function(){u.scheduleRefresh();u.prepayRefresh();u.refreshForm();o.trigger("change")});h.hide();k.on("change",function(){if(k.val()=="M"){(VIS.Utility.Util.getValueOfInt(ii)!=0||VIS.Utility.Util.getValueOfInt(ti)!=0&&event!=null&&event.currentTarget.className!=ai[0].className)&&(u.refreshSelectedValues(),n());_divCtrlCashLine.find("*").prop("disabled",!0);_divCtrlCashLine.hide();ur.find("*").prop("disabled",!0);ar.find("*").prop("disabled",!0);fr.find("*").prop("disabled",!0);vr.find("*").prop("disabled",!0);ur.hide();ar.hide();fr.hide();vr.hide();var t=VIS.Utility.Util.getValueOfInt(VIS.DB.executeScalar("SELECT Count(AD_ModuleInfo_ID) FROM AD_ModuleInfo WHERE PREFIX='VA034_' AND IsActive = 'Y'"));t>0?(oi.show(),oi.find("*").prop("disabled",!1)):(oi.find("*").prop("disabled",!0),oi.hide());w.val()=="CH"?(gt.find("*").prop("disabled",!1),ni.find("*").prop("disabled",!1),si.find("*").prop("disabled",!1)):(gt.hide(),ni.hide(),si.hide(),gt.find("*").prop("disabled",!0),ni.find("*").prop("disabled",!0),si.find("*").prop("disabled",!0));divRow4Col1TrxAmt.show();ru.show();yi.show();er.show();or.show();sr.show();hr.show();cr.show();er.find("*").prop("disabled",!1);or.find("*").prop("disabled",!1);sr.find("*").prop("disabled",!1);hr.find("*").prop("disabled",!1);cr.find("*").prop("disabled",!1);wi.prop("disabled",!0);iu.css("pointer-events","auto");it.removeClass("va012-mandatory");g.removeClass("va012-mandatory");w.val()!="CH"&&(ut.prop("selectedIndex",0),g.attr("chargeid",0),g.val(""),it.prop("selectedIndex",0),lt.setValue(0))}else k.val()=="V"?((ii!=0||dt!=0||b.length>0||ti!=0&&event!=null&&event.currentTarget.className!=ai[0].className)&&(u.refreshSelectedValues(),n()),_divCtrlCashLine.find("*").prop("disabled",!0),_divCtrlCashLine.hide(),ur.find("*").prop("disabled",!0),ar.find("*").prop("disabled",!0),fr.find("*").prop("disabled",!0),vr.find("*").prop("disabled",!0),ur.hide(),ut.prop("selectedIndex",0),ar.hide(),fr.hide(),vr.hide(),oi.show(),gt.show(),ni.show(),si.show(),oi.find("*").prop("disabled",!1),gt.find("*").prop("disabled",!1),ni.find("*").prop("disabled",!1),VIS.Utility.Util.getValueOfInt(g.attr("chargeid"))==0&&g.addClass("va012-mandatory"),VIS.Utility.Util.getValueOfInt(it.val())==0&&it.addClass("va012-mandatory"),er.find("*").prop("disabled",!0),or.find("*").prop("disabled",!0),sr.find("*").prop("disabled",!1),hr.find("*").prop("disabled",!0),cr.find("*").prop("disabled",!0),iu.css("pointer-events","none"),divRow4Col1TrxAmt.hide(),ru.hide(),yi.hide(),er.hide(),or.hide(),sr.hide(),hr.hide(),cr.hide()):k.val()=="C"&&((dt!=0||b.length>0||ti!=0&&event!=null&&event.currentTarget.className!=ai[0].className)&&(u.refreshSelectedValues(),n()),ur.show(),fr.show(),ur.find("*").prop("disabled",!1),fr.find("*").prop("disabled",!1),divRow4Col1TrxAmt.show(),ru.show(),yi.show(),r(p.getControl().val())==0&&(oi.find("*").prop("disabled",!0),gt.find("*").prop("disabled",!0),ni.find("*").prop("disabled",!0),si.find("*").prop("disabled",!0),oi.hide(),gt.hide(),ni.hide(),si.hide()),er.find("*").prop("disabled",!0),or.find("*").prop("disabled",!0),sr.find("*").prop("disabled",!0),hr.find("*").prop("disabled",!0),cr.find("*").prop("disabled",!0),iu.css("pointer-events","none"),er.hide(),or.hide(),sr.hide(),hr.hide(),cr.hide(),(ut.val()==null||ut.val()==""||ut.val()==0)&&ut.addClass("va012-mandatory"),it.removeClass("va012-mandatory"),g.removeClass("va012-mandatory"));ai.text(VIS.Msg.getMsg("VA012_More"));c.setPaymentListHeight()});w.on("change",function(){w.val()=="CH"?(oi.show(),gt.show(),ni.show(),si.show(),oi.find("*").prop("disabled",!1),gt.find("*").prop("disabled",!1),ni.find("*").prop("disabled",!1),(g.val()==null||g.val()=="")&&g.addClass("va012-mandatory"),it.val()==0&&it.addClass("va012-mandatory")):(k.val()=="M"||k.val()=="C")&&(gt.find("*").prop("disabled",!0),ni.find("*").prop("disabled",!0),si.find("*").prop("disabled",!0),gt.hide(),ni.hide(),si.hide(),tr.prop("selectedIndex",0),g.attr("chargeid",0),g.val(""),it.prop("selectedIndex",0),lt.setValue(0),g.removeClass("va012-mandatory"),it.removeClass("va012-mandatory"));w.val()<=0&&r(p.getControl().val())!=0?w.addClass("va012-mandatory"):w.removeClass("va012-mandatory");c.setPaymentListHeight()});ut.on("change",function(){ut.val()!=null&&ut.val()!=""&&ut.val()!=0?ut.removeClass("va012-mandatory"):ut.addClass("va012-mandatory");ut.val()=="CB"?(ar.find("*").prop("disabled",!1),vr.find("*").prop("disabled",!1)):(di.prop("selectedIndex",0),br.val(""),ar.find("*").prop("disabled",!0),vr.find("*").prop("disabled",!0));ut.val()=="BB"?(_divCtrlCashLine.find("*").prop("disabled",!0),_divCtrlCashLine.hide(),oi.show(),gt.show(),ni.show(),si.show(),oi.find("*").prop("disabled",!1),gt.find("*").prop("disabled",!1),ni.find("*").prop("disabled",!1),g.addClass("va012-mandatory"),it.addClass("va012-mandatory")):k.val()=="C"&&(_divCtrlCashLine.show(),_divCtrlCashLine.find("*").prop("disabled",!1),oi.find("*").prop("disabled",!0),r(p.getControl().val())==0&&(gt.find("*").prop("disabled",!0),ni.find("*").prop("disabled",!0),si.find("*").prop("disabled",!0),gt.hide(),ni.hide(),si.hide()),si.hide());c.setPaymentListHeight()});o.on("change",function(){VIS.Utility.Util.getValueOfInt(o.val())>0?o.removeClass("va012-mandatory"):o.addClass("va012-mandatory")});v.on("change",function(){if(VIS.Utility.Util.getValueOfInt(v.val())>0){var n=null;b!=null&&b.length>0&&(n=b.toString());n!=null||VIS.Utility.Util.getValueOfInt(ft.value)!=0||VIS.Utility.Util.getValueOfInt(d.value)!=0||VIS.Utility.Util.getValueOfInt(et.value)!=0?t.ajax({type:"POST",url:VIS.Application.contextUrl+"BankStatement/GetConvertedAmount",contentType:"application/json; charset=utf-8",data:JSON.stringify({currency:st,conversionType:v.val(),stmtDate:nt.val(),_schedules:n,_accountId:a.val(),orderId:ti,paymentId:dt,cashLineId:ii}),success:function(n){n=JSON.parse(n);n!=null&&(n._convertedAmt==0?n.schedule_Ids!=null&&n.schedule_Ids.length>0&&(VIS.Utility.Util.getValueOfInt(h.attr("data-uid"))==0&&i.setValue(),s.setValue(),i.getControl().addClass("va012-mandatory"),s.getControl().addClass("va012-mandatory"),VIS.ADialog.info("VA012_ConversionRateNotFound",null," - DocNo: "+n.schedule_Ids.toString(),"")):(VIS.Utility.Util.getValueOfInt(h.attr("data-uid"))==0?(i.setValue(n._convertedAmt),n._convertedAmt>0?i.getControl().removeClass("va012-mandatory"):i.getControl().addClass("va012-mandatory")):(s.setValue(n._convertedAmt),i.getControl().trigger("blur",[r(i.getControl().val()),r(s.getControl().val())])),ti==0&&VIS.Utility.Util.getValueOfInt(h.attr("data-uid"))==0&&(s.setValue(n._convertedAmt),i.getControl().trigger("blur",[r(i.getControl().val()),r(s.getControl().val())]))));t(v[0][0]).hide();v.removeClass("va012-mandatory")},error:function(n){VIS.ADialog.info(n,null,"","")}}):v.removeClass("va012-mandatory")}else v.addClass("va012-mandatory")});it.on("change",function(){if(lt.setValue(0),it.val()>0){var n=0;if(n=r(p.getControl().val())!=0&&k.val()!="V"?r(p.getControl().val()):r(i.getControl().val()),n!=0){sf(it.val(),n,y,t);function t(n){n=JSON.parse(n);n!=null&&(lt.setValue(VIS.Utility.Util.getValueOfDecimal(n.TaxAmt)),it.removeClass("va012-mandatory"))}}}else it.addClass("va012-mandatory")});ai.on(VIS.Events.onTouchStartOrClick,function(){ai.text()==VIS.Msg.getMsg("VA012_More")?(ai.attr("visiblestatus","1"),ai.text(VIS.Msg.getMsg("VA012_Hide")),ur.show(),fr.show(),_divCtrlCashLine.show(),oi.show(),gt.show(),ni.show(),si.show(),divRow4Col1TrxAmt.show(),ru.show(),yi.show(),er.show(),or.show(),sr.show(),hr.show(),cr.show()):(ai.attr("visiblestatus","0"),ai.text(VIS.Msg.getMsg("VA012_More")),k.trigger("change"));c.setPaymentListHeight()});h.on("keyup",function(n){n.which==32&&(f.is(":focus")&&f.trigger("click"),e.is(":focus")&&e.trigger("click"),ai.is(":focus")&&ai.trigger("click"));n.which==13&&cu.is(":focus")&&cu.trigger("click")});cu.on(VIS.Events.onTouchStartOrClick,function(){var n=u.getFormData(),f,t;if(lu){VIS.ADialog.info("VA012_BSLAlreadyReconciled",null,"","");return}if(n[0]._cmbBankAccount==null||n[0]._cmbBankAccount==""||n[0]._cmbBankAccount=="0"){VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"","");return}if(n[0]._txtStatementNo==null||n[0]._txtStatementNo==""||n[0]._txtStatementNo=="0"){VIS.ADialog.info("VA012_PleaseEnterStatementNo",null,"","");return}if(n[0]._dtStatementDate==null||n[0]._dtStatementDate==""||n[0]._dtStatementDate=="0"){VIS.ADialog.info("VA012_PleaseEnterStatementDate",null,"","");return}if(VIS.Utility.Util.getValueOfInt(n[0]._txtCurrency)==0){VIS.ADialog.info("VA012_PleaseSelectCurrency",null,"","");return}if(VIS.Utility.Util.getValueOfInt(n[0]._txtConversionType)==0){VIS.ADialog.info("VA012_PleaseSelectConversionType",null,"","");return}if(n[0]._txtAmount==null||n[0]._txtAmount==""||n[0]._txtAmount=="0"||n[0]._txtAmount=="0.00"){VIS.ADialog.info("VA012_PleaseEnterAmount",null,"","");return}if(!(n[0]._ctrlInvoice==null||n[0]._ctrlInvoice==""||n[0]._ctrlInvoice=="0")&&!(n[0]._ctrlBusinessPartner==null||n[0]._ctrlBusinessPartner==""||n[0]._ctrlBusinessPartner=="0")&&(n[0]._ctrlPayment==null||n[0]._ctrlPayment==""||n[0]._ctrlPayment=="0")&&(n[0]._scheduleList==null||n[0]._scheduleList=="")){VIS.ADialog.info("VA012_PleaseSelectPaySchedule",null,"","");return}if(!(n[0]._ctrlBusinessPartner==null||n[0]._ctrlBusinessPartner==""||n[0]._ctrlBusinessPartner=="0")&&(n[0]._ctrlInvoice==null||n[0]._ctrlInvoice==""||n[0]._ctrlInvoice=="0")&&(n[0]._ctrlPayment==null||n[0]._ctrlPayment==""||n[0]._ctrlPayment=="0")&&(n[0]._scheduleList==null||n[0]._scheduleList=="")&&(n[0]._ctrlOrder==null||n[0]._ctrlOrder==""||n[0]._ctrlOrder=="0")&&(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0")){VIS.ADialog.info("VA012_PleaseSelectAnyOne",null,"","");return}if(n[0]._cmbVoucherMatch=="C")if(n[0]._cmbContraType=="BB"){if(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0"){VIS.ADialog.info("VA012_PleaseSelectCharge",null,"","");g.addClass("va012-mandatory");return}if(n[0]._cmbTaxRate==null||n[0]._cmbTaxRate==""||n[0]._cmbTaxRate=="0"){VIS.ADialog.info("VA012_PleaseSelectTaxRate",null,"","");it.addClass("va012-mandatory");return}}else if(n[0]._cmbContraType=="CB"){if(n[0]._ctrlCashLine==null||n[0]._ctrlCashLine==""||n[0]._ctrlCashLine=="0"){VIS.ADialog.info("VA012_PleaseSelectCashJournalLine",null,"","");return}}else{VIS.ADialog.info("VA012_PleaseSelectContraType",null,"","");return}if(n[0]._cmbVoucherMatch=="V"){if(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0"){VIS.ADialog.info("VA012_PleaseSelectCharge",null,"","");g.addClass("va012-mandatory");return}if(n[0]._cmbTaxRate==null||n[0]._cmbTaxRate==""||n[0]._cmbTaxRate=="0"){VIS.ADialog.info("VA012_PleaseSelectTaxRate",null,"","");it.addClass("va012-mandatory");return}}if(parseFloat(n[0]._txtDifference)!=0&&n[0]._cmbVoucherMatch=="M"&&(n[0]._cmbDifferenceType==null||n[0]._cmbDifferenceType==""||n[0]._cmbDifferenceType=="0")){VIS.ADialog.info("VA012_PleaseSelectDifferenceType",null,"","");return}if(parseFloat(n[0]._txtDifference)!=0&&n[0]._cmbDifferenceType=="CH"){if(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0"){VIS.ADialog.info("VA012_PleaseSelectCharge",null,"","");g.addClass("va012-mandatory");return}if(n[0]._cmbTaxRate==null||n[0]._cmbTaxRate==""||n[0]._cmbTaxRate=="0"){VIS.ADialog.info("VA012_PleaseSelectTaxRate",null,"","");it.addClass("va012-mandatory");return}}if(parseFloat(n[0]._txtDifference)!=0&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlPayment)!=0&&n[0]._cmbDifferenceType!="CH"){VIS.ADialog.info("VA012_PlsSelectDiffTypeCharge",null,"","");return}if(VIS.Utility.Util.getValueOfDecimal(n[0]._txtDifference)!=0&&VIS.Utility.Util.getValueOfInt(n[0]._scheduleList.length)>0&&Math.abs(r(i.getControl().val()))>Math.abs(r(s.getControl().val()))&&n[0]._cmbDifferenceType!="CH"){VIS.ADialog.info("MoreScheduleAmount",null,"","");return}if(VIS.Utility.Util.getValueOfString(n[0]._scheduleList)==""&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlPayment)==0&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlOrder)==0&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlCashLine)==0&&VIS.Utility.Util.getValueOfInt(n[0]._cmbCharge)==0){VIS.ADialog.info("VA012_PleaseSelectAnyOne",null,"","");return}if(VIS.Utility.Util.getValueOfString(n[0]._cmbDifferenceType)=="CH"||VIS.Utility.Util.getValueOfString(n[0]._cmbVoucherMatch)=="V"){if(f=VIS.Utility.Util.getValueOfInt(n[0]._cmbTaxRate),t=0,t=VIS.Utility.Util.getValueOfString(n[0]._cmbDifferenceType)=="CH"?VIS.Utility.Util.getValueOfDecimal(n[0]._txtDifference):VIS.Utility.Util.getValueOfDecimal(n[0]._txtAmount),f>0&&t!=0){sf(n[0]._cmbTaxRate,t,y,e);function e(t){t=JSON.parse(t);t!=null&&(n[0]._surChargeAmt=t.SurchargeAmt,n[0]._txtTaxAmount=t.TaxAmt,wt(l,!0,"absolute"),u.insertNewRecord(n,u.afterInsertion))}}}else wt(l,!0,"absolute"),u.insertNewRecord(n,u.afterInsertion)});kt.on("keypress",function(){ci.val("1");ir.val("10")});kt.on("change",function(){kt.val()==""?kt.addClass("va012-mandatory"):kt.removeClass("va012-mandatory")});ir.on("keypress",function(n){if(n.which!=8&&n.which!=0&&(n.which<48||n.which>57))return!1});ci.on("keypress",function(n){if(n.which!=8&&n.which!=0&&(n.which<48||n.which>57))return!1});ci.on("change",function(){_origin="LO";t.ajax({url:VIS.Application.contextUrl+"BankStatement/MaxStatement",type:"GET",datatype:"json",data:{_bankAccount:a.val()==null?0:a.val(),_origin:_origin,_pageNo:ci.val()<=0?0:ci.val()},contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),ci.val()<=0&&kt.val()==n.statementNo?(ir.val(n.lineno),ci.val(n.pageno),VIS.ADialog.info("VA012_NotAcceptZero",null,"","")):ci.val()>0&&kt.val()==n.statementNo?ir.val(n.lineno):ci.val()<=0&&(ci.val("1"),VIS.ADialog.info("VA012_NotAcceptZero",null,"","")))}})});tf.on(VIS.Events.onTouchStartOrClick,function(){u.scheduleRefresh();u.prepayRefresh();u.refreshForm();(kt.val()==""||kt.val()==null)&&kt.val("0");c.getMaxStatement("BT");h.attr("data-uid",0)});lt.getControl().on("change",function(){r(lt.getControl().val())==0||r(lt.getControl().val())==null?lt.setValue(0):lt.setValue(VIS.Utility.Util.getValueOfDecimal(r(lt.getControl().val())))});s.getControl().on("blur",function(n,t,u){if(k.val()!="V")if(VIS.Utility.Util.getValueOfDecimal(t)!=0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(t).toFixed(y)))),VIS.Utility.Util.getValueOfDecimal(u)!=0&&(s.setValue(),s.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(u).toFixed(y)))),VIS.Utility.Util.getValueOfDecimal(r(s.getControl().val()))==0?(s.setValue(0),s.getControl().addClass("va012-mandatory")):VIS.Utility.Util.getValueOfDecimal(r(s.getControl().val()))<0?s.getControl().addClass("va012-mandatory"):(s.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(r(s.getControl().val())).toFixed(y))),s.getControl().removeClass("va012-mandatory")),p.getControl().attr("vchangable")=="Y"&&(p.setValue(0),yi.find("*").prop("disabled",!0)),k.val()=="M"||k.val()=="C"){if(p.getControl().attr("vchangable")=="Y"&&(p.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(r(s.getControl().val())-r(i.getControl().val())).toFixed(y))),VIS.Utility.Util.getValueOfDecimal(r(p.getControl().val()))!=0?(VIS.Utility.Util.getValueOfDecimal(r(p.getControl().val()))<0?p.getControl().addClass("va012-mandatory"):p.getControl().removeClass("va012-mandatory"),yi.find("*").prop("disabled",!1),(b.length==0||b.length>0&&h.attr("data-uid")!=0&&Math.abs(r(s.getControl().val()))<Math.abs(r(i.getControl().val())))&&(VIS.Utility.Util.getValueOfInt(ft.value)==0&&h.attr("data-uid")==0||h.attr("data-uid")!=0)&&(w.find("option[value=0]").prop("disabled",!0),w.find("option[value=OU]").prop("disabled",!0),w.find("option[value=DA]").prop("disabled",!0),w.find("option[value=WO]").prop("disabled",!0),w.val()!="CH"&&w.val("0").prop("selected",!0)),w.val()<=0?w.addClass("va012-mandatory"):w.removeClass("va012-mandatory")):(yi.find("*").prop("disabled",!0),w.val("0").prop("selected",!0),w.trigger("change"),w.removeClass("va012-mandatory"))),VIS.Utility.Util.getValueOfDecimal(r(p.getControl().val()))!=0&&it.val()>0){sf(it.val(),r(p.getControl().val()),y,f);function f(n){n=JSON.parse(n);n!=null&&n!=0&&lt.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(n.TaxAmt).toFixed(y)));it.val()>0&&VIS.Utility.Util.getValueOfDecimal(r(p.getControl().val()))!=0&&(VIS.Utility.Util.getValueOfDecimal(r(p.getControl().val()))<0?p.getControl().addClass("va012-mandatory"):p.getControl().removeClass("va012-mandatory"));VIS.Utility.Util.getValueOfDecimal(r(p.getControl().val()))!=0&&(VIS.Utility.Util.getValueOfInt(d.getValue())!=0||VIS.Utility.Util.getValueOfInt(et.getValue())!=0)?(w.val("CH").prop("selected",!0),w.trigger("change")):VIS.Utility.Util.getValueOfDecimal(r(p.getControl().val()))!=0&&b.toString()!=""||(w.val("0").prop("selected",!0),w.trigger("change"))}}}else VIS.Utility.Util.getValueOfDecimal(r(p.getControl().val()))!=0&&VIS.Utility.Util.getValueOfInt(d.getValue())!=0&&(w.val("CH").prop("selected",!0),w.trigger("change"))});p.getControl().on("blur",function(){r(p.getControl().val())==0||r(p.getControl().val())==null?yi.find("*").prop("disabled",!0):yi.find("*").prop("disabled",!1)});i.getControl().on("blur",function(n,t){VIS.Utility.Util.getValueOfDecimal(t)!=0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(t).toFixed(y))));VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))==0&&(i.setValue(0),i.getControl().addClass("va012-mandatory"));var u=VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()));if(e.attr("v_active")=="1"&&u>0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(-1*u).toFixed(y)))),f.attr("v_active")=="1"&&u<0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(-1*u).toFixed(y)))),VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))<0?(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),f.removeClass("va012-active"),f.addClass("va012-inactive"),f.attr("v_active","0"),i.getControl().addClass("va012-mandatory")):VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))>0&&(f.removeClass("va012-inactive"),f.addClass("va012-active"),f.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"),i.getControl().removeClass("va012-mandatory")),VIS.Utility.Util.getValueOfInt(it.val())>0&&r(i.getControl().val())!=0&&k.val()=="V"){sf(it.val(),r(i.getControl().val()),y,o);function o(n){n=JSON.parse(n);n!=null&&n!=0&&(lt.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(n.TaxAmt).toFixed(y))),it.removeClass("va012-mandatory"));s.getControl().trigger("blur",[r(i.getControl().val()),r(s.getControl().val())])}}else s.getControl().trigger("blur",[r(i.getControl().val()),r(s.getControl().val())])});uf.hover(function(){$tooltip=t('<div  class="va012-div-tooltip"><h4>'+VIS.Msg.getMsg("VA012_Information")+"<\/h4><p>"+VIS.Msg.getMsg("VA012_InformationText")+"<\/p><\/div>");l.append($tooltip);t(".va012-div-tooltip").show()},function(){l.find(".va012-div-tooltip").remove()});nt.on("blur",function(){if(nt.val()=="")nt.addClass("va012-mandatory");else{nt.removeClass("va012-mandatory");var u=0,n=null,t=null;if(k.val()=="M"?wi.val()!=0&&(d.getValue()==null||d.getValue()==0)?b.length!=0&&(n="IS",t=b.join()):(wi.val()==null||wi.val()==0)&&d.getValue()!=null&&d.getValue()!=0?(n="PY",t=d.getValue()):VIS.Utility.Util.getValueOfInt(ft.value)!=0&&VIS.Utility.Util.getValueOfInt(rt.value)!=0&&(n="PO",t=ft.value,i.getControl().attr("disabled",!0)):k.val()=="C"&&VIS.Utility.Util.getValueOfInt(et.value)!=0&&VIS.Utility.Util.getValueOfInt(d.getValue())==0&&VIS.Utility.Util.getValueOfInt(wi.val())==0&&(n="CO",t=et.value),n!=null&&t!=null){VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetConvtAmount",{recordID:t,bnkAct_Id:a.val(),transcType:n,stmtDate:nt.val()},o);function o(t){for(var o=0;o<t.length;o++){if(t.length==0||t[o].DueAmount==0){i.setValue();s.setValue();p.setValue();p.getControl().trigger("blur");i.getControl().trigger("blur",[r(i.getControl().val()),r(s.getControl().val())]);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}u+=t[o].DueAmount}if(u!=0)i.setValue(u),n!="PO"?(s.setValue(u),i.getControl().trigger("blur",[r(i.getControl().val()),r(s.getControl().val())])):(i.getControl().removeClass("va012-mandatory"),i.getControl().attr("disabled",!0),f.removeClass("va012-inactive"),f.addClass("va012-active"),f.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"));else{i.setValue();s.setValue();p.setValue();p.getControl().trigger("blur");VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}}}}});uf.mousemove(function(n){t(".va012-div-tooltip").css("top",n.pageY-50).css("left",n.pageX)});f.on(VIS.Events.onTouchStartOrClick,function(){r(s.getControl().val())==0&&VIS.Utility.Util.getValueOfInt(ft.value)>0||k.val()=="V"&&(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))<0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))*-1),f.removeClass("va012-inactive"),f.addClass("va012-active"),f.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"),i.getControl().trigger("blur",[r(i.getControl().val()),r(s.getControl().val())]))});e.on(VIS.Events.onTouchStartOrClick,function(){r(s.getControl().val())==0&&VIS.Utility.Util.getValueOfInt(ft.value)>0||k.val()=="V"&&(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))>0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))*-1),e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),f.removeClass("va012-active"),f.addClass("va012-inactive"),f.attr("v_active","0"),i.getControl().trigger("blur",[r(i.getControl().val()),r(s.getControl().val())]))})},getNewRecordDesign:function(){},getNewRecordControls:function(){kt=h.find("#VA012_txtStatementNo_"+$self.windowNo);tf=h.find("#VA012_btnStatementNo_"+$self.windowNo);ci=h.find("#VA012_txtStatementPage_"+$self.windowNo);ir=h.find("#VA012_txtStatementLine_"+$self.windowNo);nt=h.find("#VA012_dtStatementDate_"+$self.windowNo);gi=h.find("#VA012_cmbPaymentMethod_"+$self.windowNo);ut=h.find("#VA012_cmbContraType_"+$self.windowNo);di=h.find("#VA012_cmbCashBook_"+$self.windowNo);nr=h.find("#VA012_cmbTransferType_"+$self.windowNo);br=h.find("#VA012_txtCheckNo_"+$self.windowNo);k=h.find("#VA012_cmbVoucherMatch_"+$self.windowNo);i.getControl().addClass("va012-mandatory");s.getControl().addClass("va012-mandatory");w=h.find("#VA012_cmbDifferenceType_"+$self.windowNo);rr=h.find("#VA012_txtVoucherNo_"+$self.windowNo);gr=h.find("#VA012_txtDescription_"+$self.windowNo);tr=h.find("#VA012_cmbCharge_"+$self.windowNo);g=h.find("#VA012_txtCharge_"+$self.windowNo);it=h.find("#VA012_cmbTaxRate_"+$self.windowNo);nu=h.find("#VA012_ctrlCashLine_"+$self.windowNo);lr=h.find("#VA012_ctrlPayment_"+$self.windowNo);ou=h.find("#VA012_ctrlOrder_"+$self.windowNo);su=h.find("#VA012_ctrlInvoice_"+$self.windowNo);hu=h.find("#VA012_ctrlBusinessPartner_"+$self.windowNo);tu=h.find("#VA012_chkUseNextTime_"+$self.windowNo);cu=h.find("#VA012_btnSave_"+$self.windowNo);iu=h.find("#VA012_btnPaymentSchedule_"+$self.windowNo);wf=h.find("#VA012_btnPrepay_"+$self.windowNo);wi=h.find("#VA012_txtPaymentSchedule_"+$self.windowNo);rf=h.find("#VA012_txtPrepayOrder_"+$self.windowNo);at=nf.find("#VA012_btnNewRecord_"+$self.windowNo);bf=nf.find("#VA012_btnUndo_"+$self.windowNo);kf=l.find("#VA012_btnDelete_"+$self.windowNo);uf=h.find("#VA012_btnAmount_"+$self.windowNo);f=h.find("#VA012_btnIn_"+$self.windowNo);e=h.find("#VA012_btnOut_"+$self.windowNo);o=h.find("#VA012_txtCurrency_"+$self.windowNo);v=h.find("#VA012_txtConversionType_"+$self.windowNo)},loadPaymentMethod:function(){function t(t){if(gi.html(""),gi.append("<option value=0 ><\/option>"),t!=null)for(var i=0;i<t.tables[0].rows.length;i++)gi.append("<option value="+VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.va009_paymentmethod_id)+">"+VIS.Utility.encodeText(t.tables[0].rows[i].cells.va009_name)+"<\/option>");t.dispose();t=null;n=null;gi.prop("selectedIndex",0)}var n="SELECT VA009_NAME,VA009_PAYMENTMETHOD_ID FROM VA009_PAYMENTMETHOD WHERE ISACTIVE='Y'  AND AD_CLIENT_ID="+VIS.Env.getCtx().getAD_Client_ID()+" AND AD_ORG_ID="+VIS.Env.getCtx().getAD_Org_ID(),i=VIS.DB.executeDataSet(n.toString(),null,t)},loadCurrency:function(){st=VIS.DB.executeScalar("SELECT C_CURRENCY_ID FROM C_BANKACCOUNT WHERE C_BANKACCOUNT_ID="+a.val());y=VIS.DB.executeScalar("SELECT STDPRECISION FROM C_CURRENCY WHERE C_CURRENCY_ID="+st)},loadCashBook:function(){function t(t){if(di.html(""),di.append("<option value=0 ><\/option>"),t!=null)for(var i=0;i<t.tables[0].rows.length;i++)di.append("<option value="+VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_cashbook_id)+">"+VIS.Utility.encodeText(t.tables[0].rows[i].cells.name)+"<\/option>");t.dispose();t=null;n=null;di.prop("selectedIndex",0)}var n="SELECT NAME,C_CashBook_ID FROM C_CashBook WHERE ISACTIVE='Y'  AND AD_CLIENT_ID="+VIS.Env.getCtx().getAD_Client_ID()+" AND AD_ORG_ID="+VIS.Env.getCtx().getAD_Org_ID(),i=VIS.DB.executeDataSet(n.toString(),null,t)},loadContraType:function(){ut.html("");ut.append("<option value=0 ><\/option>");ut.append("<option value='BB' >"+VIS.Msg.getMsg("VA012_BankToBank")+"<\/option>");ut.append("<option value='CB' >"+VIS.Msg.getMsg("VA012_CashToBank")+"<\/option>");ut.prop("selectedIndex",0)},loadTransferType:function(){nr.html("");nr.append("<option value=0 ><\/option>");nr.append("<option value='CH' >"+VIS.Msg.getMsg("VA012_Cash")+"<\/option>");nr.append("<option value='CK' >"+VIS.Msg.getMsg("VA012_Check")+"<\/option>");nr.prop("selectedIndex",0)},loadVoucherMatch:function(){k.html("");k.append("<option value='M' >"+VIS.Msg.getMsg("VA012_Payment")+"<\/option>");k.append("<option value='V' >"+VIS.Msg.getMsg("VA012_Voucher")+"<\/option>");k.append("<option value='C' >"+VIS.Msg.getMsg("VA012_Contra")+"<\/option>");k.prop("selectedIndex",0)},loadDifferenceType:function(){w.html("");w.append("<option value=0 ><\/option>");w.append("<option value='OU' >"+VIS.Msg.getMsg("VA012_OverUnderPayment")+"<\/option>");w.append("<option value='DA' >"+VIS.Msg.getMsg("VA012_DiscountAmount")+"<\/option>");w.append("<option value='WO' >"+VIS.Msg.getMsg("VA012_WriteoffAmount")+"<\/option>");w.append("<option value='CH' >"+VIS.Msg.getMsg("VA012_Charge")+"<\/option>");w.prop("selectedIndex",0)},loadCharge:function(){function t(t){if(tr.html(""),tr.append("<option value=0 ><\/option>"),t!=null)for(var i=0;i<t.tables[0].rows.length;i++)tr.append("<option value="+VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_charge_id)+">"+VIS.Utility.encodeText(t.tables[0].rows[i].cells.name)+"<\/option>");t.dispose();t=null;n=null;tr.prop("selectedIndex",0)}var n="SELECT NAME,C_CHARGE_ID FROM C_Charge WHERE ISACTIVE='Y' AND AD_CLIENT_ID="+VIS.Env.getCtx().getAD_Client_ID()+" AND AD_ORG_ID="+VIS.Env.getCtx().getAD_Org_ID(),i=VIS.DB.executeDataSet(n.toString(),null,t)},loadTaxRate:function(){function n(n){if(it.html(""),it.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)it.append("<option value="+n[t].C_Tax_ID+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");it.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/LoadTaxRate",null,n)},loadPayment:function(){lr!=undefined&&lr!=null&&lr.empty();var n=a.val()!=null?"DocStatus IN ('CO','CL') AND C_BankAccount_ID = "+a.val():"DocStatus IN ('CO','CL')";ie=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,5043,VIS.DisplayType.Search,"C_Payment_ID",0,!1,n);d=new VIS.Controls.VTextBoxButton("C_Payment_ID",!1,!1,!0,VIS.DisplayType.Search,ie);d.getControl().addClass("va012-input-size-2");d.getControl().attr("tabindex","10");lr.append(d.getControl());lr.append(d.getBtn(0));lr.append(d.getBtn(1));d.fireValueChanged=function(){if(VIS.Utility.Util.getValueOfInt(d.value)!=0&&VIS.Utility.Util.getValueOfInt(dt)!=0){VIS.Utility.Util.getValueOfInt(dt)==d.value?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(d.setValue(dt,!1,!0),VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"",""));return}if(dt=0,dt=d.value,ei||ki||d.value&&(c.checkPaymentCondition(dt,0,r(i.getControl().val()))?c.setInvoiceAndBPartner(dt,"PY"):d.setValue()),ki=!1,!d.value&&dt==null&&d.value==null){var n=h[0].attributes["data-uid"].value;h[0].attributes["data-uid"].value!=0||dt!=null||d.value||u.refreshForm();n>0&&dt==null&&d.value==null&&tt.statementListRecordEdit(n,0)}};ki=!1},loadOrder:function(){ce=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,5043,VIS.DisplayType.Search,"C_Order_ID",0,!1,"C_ORDER_ID IN (SELECT ORD.C_ORDER_ID  FROM C_Order ORD  LEFT JOIN C_DocType DT  ON (ORD.C_DOCTYPETARGET_ID=DT.C_DOCTYPE_ID)  INNER JOIN VA009_PaymentMethod PM  ON (PM.VA009_PAYMENTMETHOD_ID =ORD.VA009_PAYMENTMETHOD_ID )  WHERE DT.DOCSUBTYPESO         ='PR'   AND ORD.DOCSTATUS             ='WP'   AND ORD.ISACTIVE              ='Y'   AND PM.VA009_PAYMENTBASETYPE! ='B')");ft=new VIS.Controls.VTextBoxButton("C_Order_ID",!1,!1,!0,VIS.DisplayType.Search,ce);ft.getControl().addClass("va012-input-size-2");ft.getControl().attr("tabindex","13");ou.append(ft.getControl());ou.append(ft.getBtn(0));ou.append(ft.getBtn(1));ft.fireValueChanged=function(){if(VIS.Utility.Util.getValueOfInt(ft.value)!=0&&VIS.Utility.Util.getValueOfInt(ti)!=0){VIS.Utility.Util.getValueOfInt(ti)==ft.value?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(ft.setValue(ti,!1,!0),VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"",""));return}ti=0;ti=ft.value;ft.value||u.refreshForm();ft.value&&(ei||(c.checkPrepayCondition(ft.value,0,null,r(i.getControl().val()))?(c.setInvoiceAndBPartner(ti,"PO"),i.getControl().attr("disabled",!0)):(ti=0,ft.setValue())))}},loadCashLine:function(){var n=" C_CASHLINE_ID IN (SELECT CSL.C_CASHLINE_ID  FROM C_Cash CS  INNER JOIN C_CashLine CSL  ON (CS.C_CASH_ID=CSL.C_CASH_ID)  INNER JOIN C_Charge chrg  ON (chrg.c_charge_id =csl.c_charge_id)  WHERE CS.ISACTIVE          ='Y'  AND CSL.CashType           ='C'  AND chrg.dtd001_chargetype ='CON'  AND CS.DOCSTATUS          IN ('CO','CL')  AND CSL.VA012_ISRECONCILED ='N'  AND CSL.C_BankAccount_ID ="+(a.val()==null?0:a.val())+" )";nu.html("");te=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,1008317,VIS.DisplayType.Search,"C_CashLine_ID",0,!1,n);et=new VIS.Controls.VTextBoxButton("C_CashLine_ID",!1,!1,!0,VIS.DisplayType.Search,te);et.getControl().addClass("va012-input-size-2");et.getControl().attr("tabindex","10");nu.append(et.getControl());nu.append(et.getBtn(0));nu.append(et.getBtn(1));et.fireValueChanged=function(){if(VIS.Utility.Util.getValueOfInt(et.value)!=0&&VIS.Utility.Util.getValueOfInt(ii)!=0){VIS.Utility.Util.getValueOfInt(ii)==et.value?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(et.setValue(ii,!1,!0),VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"",""));return}if(ii=0,ii=et.value,et.value&&(ei||ki||c.checkContraCondition(et.value,0,r(i.getControl().val()))||(ii=0,et.setValue()),ki=!1),ki=!1,ii==null&&et.value==null){var n=h[0].attributes["data-uid"].value;h[0].attributes["data-uid"].value!=0||ii!=null||et.value||u.refreshForm();n>0&&ii==null&&et.value==null&&tt.statementListRecordEdit(n,0)}}},loadBusinessPartner:function(){ef=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,2893,VIS.DisplayType.Search,"C_BPartner_ID",0,!1,null);rt=new VIS.Controls.VTextBoxButton("C_BPartner_ID",!1,!1,!0,VIS.DisplayType.Search,ef);rt.getControl().addClass("va012-input-size-2");rt.getControl().attr("tabindex","12");hu.append(rt.getControl());hu.append(rt.getBtn(0));hu.append(rt.getBtn(1));rt.fireValueChanged=function(){uu=0;uu=rt.value}},loadInvoice:function(){re=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,3484,VIS.DisplayType.MultiKey,"C_Invoice_ID",0,!1,"DocStatus IN ('CO','CL')");pt=new VIS.Controls.VTextBoxButton("C_Invoice_ID",!1,!1,!0,VIS.DisplayType.MultiKey,re);pt.isMultiKeyTextBox=!0;pt.getControl().addClass("va012-input-size-2");pt.getControl().attr("tabindex","11");su.append(pt.getControl());su.append(pt.getBtn(0));su.append(pt.getBtn(1));pt.fireValueChanged=function(){yr=null;yr=pt.value;pt.value&&(c.checkInvoiceCondition(yr,r(i.getControl().val()))?c.setBPartner(yr):pt.setValue())}},getFormData:function(){var n={},t=[];return n._bankStatementLineID=h.attr("data-uid"),n._txtStatementNo=kt.val(),n._txtStatementPage=ci.val(),n._txtStatementLine=ir.val(),n._dtStatementDate=nt.val(),n._cmbPaymentMethod=gi.val(),n._cmbCurrency=st,n._cmbVoucherMatch=k.val(),n._txtDescription=VIS.Utility.encodeText(gr.val()),n._txtVoucherNo=VIS.Utility.encodeText(rr.val()),n._cmbCharge=g.attr("chargeid"),n._cmbTaxRate=it.val(),n._txtTaxAmount=r(lt.getControl().val()),n._ctrlPayment=dt,n._ctrlOrder=ti,n._ctrlCashLine=ii,n._ctrlInvoice=yr,n._ctrlBusinessPartner=uu,n._chkUseNextTime=tu.is(":checked"),n._cmbBank=vi.val(),n._cmbBankAccount=a.val(),n._cmbBankAccountClasses=pu.val(),n._cmbTransactionType=ot.val(),n._scheduleList=b.toString(),n._cmbContraType=ut.val(),n._cmbCashBook=di.val(),n._cmbTransferType=nr.val(),n._txtCheckNo=br.val(),n._cmbDifferenceType=w.val(),w.val()=="CH"&&k.val()!="C"?(n._txtAmount=r(s.getControl().val()),n._txtTrxAmt=r(i.getControl().val())):(n._txtAmount=r(i.getControl().val()),n._txtTrxAmt=r(s.getControl().val())),n._txtDifference=r(p.getControl().val()),n._txtConversionType=v.val(),n._txtCurrency=o.val(),t.push(n),t},insertNewRecord:function(n,i){t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/InsertData",contentType:"application/json; charset=utf-8",data:JSON.stringify({_formData:n}),success:function(n){i(n)},error:function(n){VIS.ADialog.info(n,null,"","")}})},afterInsertion:function(n){if(n!=null&&n!=""){var i=t.parseJSON(n);i=="Success"?(wt(l,!1,"absolute"),VIS.ADialog.info("VA012_RecordSaved",null,"",""),bt=[],ct.html(""),hi=1,tt.loadStatement(fi),ui.html(""),u.scheduleRefresh(),u.prepayRefresh(),pi=1,storepaymentdata=[],c.loadPayments(a.val(),yt.val(),ot.val(),vt.val()),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),o.addClass("va012-mandatory"),v.addClass("va012-mandatory")):(wt(l,!1,"absolute"),VIS.ADialog.info(i,null,"",""))}},refreshForm:function(){h.attr("data-uid",0);(event==undefined||event.currentTarget.id!=tf[0].id)&&c.getMaxStatement("LO");nt.attr("readonly",!1);var n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetStatementDate",{bankAcct:a.val()});n!=""&&n!=null?nt.val(Globalize.format(new Date(n),"yyyy-MM-dd")):nt.val(ue);gi.prop("selectedIndex",0);k.prop("selectedIndex",0);k.trigger("change");i.getControl().attr("disabled",!1);i.setValue(0);s.setValue(0);p.setValue(0);p.getControl().trigger("blur");p.getControl().attr("vchangable","Y");w.prop("selectedIndex",0);w.removeClass("va012-mandatory");gr.val("");rr.val("");tr.prop("selectedIndex",0);g.attr("chargeid",0);g.val("");it.prop("selectedIndex",0);lt.setValue(0);tu.attr("checked",!1);d.setValue();ft.setValue();et.setValue();rt.setValue();pt.setValue();uu=0;dt=0;ti=0;ii=0;yr=null;f.trigger("click");u.loadCurrency();ut.prop("selectedIndex",0);di.prop("selectedIndex",0);nr.prop("selectedIndex",0);br.val("");this.loadNewFormCurrency();v.addClass("va012-mandatory");this.loadConversionTypes();o.addClass("va012-mandatory");v.prop("selectedIndex",0);v.attr("disabled",!1);o.attr("disabled",!1);lu=!1},scheduleRefresh:function(){b=[];li=[];ht=[];wi.val("")},prepayRefresh:function(){pr=[];wr=[];rf.val("")},refreshSelectedValues:function(){h.attr("data-uid",0);c.getMaxStatement("LO");nt.attr("readonly",!1);var n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetStatementDate",{bankAcct:a.val()});n!=""&&n!=null?nt.val(Globalize.format(new Date(n),"yyyy-MM-dd")):nt.val(ue);gi.prop("selectedIndex",0);i.getControl().attr("disabled",!1);i.setValue(0);s.setValue(0);p.setValue(0);p.getControl().trigger("blur");p.getControl().attr("vchangable","Y");w.prop("selectedIndex",0);w.removeClass("va012-mandatory");gr.val("");rr.val("");tr.prop("selectedIndex",0);g.attr("chargeid",0);g.val("");it.prop("selectedIndex",0);lt.setValue(0);tu.attr("checked",!1);d.setValue();ft.setValue();et.setValue();rt.setValue();pt.setValue();uu=0;dt=0;ti=0;ii=0;yr=null;u.scheduleRefresh();f.trigger("click");ut.prop("selectedIndex",0);di.prop("selectedIndex",0);nr.prop("selectedIndex",0);br.val("");this.loadNewFormCurrency();v.addClass("va012-mandatory");this.loadConversionTypes();o.addClass("va012-mandatory");v.prop("selectedIndex",0);v.attr("disabled",!1);o.attr("disabled",!1);lu=!1},newRecordDispose:function(){h=null;nf=null;kt=null;tf=null;ci=null;ir=null;nt=null;gi=null;ut=null;di=null;nr=null;br=null;st=null;k=null;i=null;p=null;w=null;uf=null;f=null;e=null;gr=null;rr=null;tr=null;g=null;it=null;lt=null;nu=null;ou=null;lr=null;su=null;hu=null;tu=null;cu=null;iu=null;wf=null;wi=null;rf=null;at=null;bf=null;kf=null;ai=null;he=null;ie=null;ft=null;ti=null;d=null;we=null;dt=null;et=null;te=null;ii=null;ef=null;rt=null;uu=null;re=null;pt=null;yr=null;ue=null;of=null;o=null;v=null;lu=null},loadNewFormCurrency:function(){var n=null,r,i;if(t(o[0]).empty(),r=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,457,VIS.DisplayType.TableDir,"C_Currency_ID",0,!1,"IsMyCurrency='Y'"),n=r.getData(!0,!0,!1,!1),o.append('<option value="0" ><\/option>'),n!=null&&n!=undefined&&n.length>0){for(i=0;i<n.length;i++)o.append("<option value="+n[i].Key+">"+n[i].Name+"<\/option>");o.val(0);o.addClass("va012-mandatory")}},loadConversionTypes:function(){var n=null,r,i;if(t(v[0]).empty(),r=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,10269,VIS.DisplayType.TableDir,"C_ConversionType_ID",0,!1,"IsActive='Y'"),n=r.getData(!0,!0,!1,!1),v.append('<option value="0" ><\/option>'),n!=null&&n!=undefined&&n.length>0){for(i=0;i<n.length;i++)v.append("<option value="+n[i].Key+">"+n[i].Name+"<\/option>");v.val(0);v.addClass("va012-mandatory")}}};t(window).resize(function(){c.setPaymentListHeight();tt.setStatementListHeight();ku.height(t("#VA012_mainContainer_"+$self.windowNo).height())});this.getRoot=function(){return l};this.setSize=function(){var n=t("#VA012_mainContainer_"+$self.windowNo).height();n==0&&(n=window.innerHeight-107);ku.height(n)};this.disposeComponents=function(){$self=null;l=null;vi=null;a=null;pu=null;vt=null;oe=null;yt=null;ot=null;cf=null;lf=null;ct=null;ui=null;fi="";kr=null;dr=null;ye=null;pe=null;ur=null;ar=null;_divCtrlCashLine=null;fr=null;vr=null;oi=null;se=null;divRow4Col1TrxAmt=null;ru=null;yi=null;gt=null;df=null;ni=null;si=null;er=null;or=null;sr=null;hr=null;cr=null;ri=null;gf=null;af=null;vf=null;yf=null;bu=null;ku=null;eu=null;fe=null;bt=[];b=[];li=[];pr=[];wr=[];u.newRecordDispose()}}i.prototype.sizeChanged=function(n){_table.height(n)};i.prototype.dispose=function(){this.disposeComponents();this.frame&&this.frame.dispose();this.frame=null};i.prototype.init=function(n,t){this.windowNo=n;this.frame=t;this.Initialize();this.frame.getContentGrid().append(this.getRoot());this.setSize()};n.AForms=n.AForms||{};n.AForms.bankStatement=i}(VA012,jQuery);VA012=window.VA012||{},function(n,t){n.UploadExcel=function(i,r,u){function ut(n){for(u.children().remove(),j=0;j<n.ExcelCol.length;j++)j==1?u.append("<li index="+j+" style='border:none;float:none' >"+n.ExcelCol[j]+"<\/li>"):u.append("<li index="+j+" >"+n.ExcelCol[j]+"<\/li>")}var k=null,f=[],l=[],a=0,o=0,c=Date.now().toString(),s=1048576,v=0,h=0,p=[],e=null,nt=i,ft=t(window).width(),et=t(window).height(),c=Date.now().toString(),ot=r;savedFileName="";var d=t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:40%;width: 40%;left: 32%;position:absolute;z-index:99999;'>"),w=null,b=null;this.isWait=!1;self=this;var tt=function(){var n=null,i=0,t;for(t in f)i=parseInt(f[t].size/s),e.size%s>0&&i++,v+=i,n={},n.Name=f[t].name,n.Size=f[t].size,p.push(n);g()},g=function(){var t;if(f==null||f.length==0){y(!1);return}if(!(o>=f.length)){var n=new XMLHttpRequest,i=new FormData,r=f[o].name.substring(0,f[o].name.lastIndexOf("."))+c+f[o].name.substring(f[o].name.lastIndexOf("."));savedFileName=r;i.append("file",f[o].slice(h*s,h*s+Number(s)));n.open("POST",VIS.Application.contextUrl+"VA012/UploadExcel/SaveFileinTemp?fileName="+r+"&folderKey="+c+"&orgFileName="+f[o].name,!1);n.send(i);k=n.responseText;a++;h++;t=parseInt(f[o].size/s);f[o].size%s>0&&t++;h==t&&(o++,h=0);a<=v&&rt(parseInt(a/v*80));window.setTimeout(function(){g()},2)}},it=function(n){for(var t=[],i,w,r,b,u=0;u<n.files.length;u++){if(e=n.files[u],e==undefined)return;if(e.size<=0)return f=[],l=[],a=0,o=0,c=null,s=null,v=0,h=0,p=[],e=null,VIS.ADialog.info("VADMS_FileSizeShouldGreaterThan0KB"),y(!1),!1;if(e.name.indexOf("&")>-1||e.name.indexOf("?")>-1||e.name.indexOf("#")>-1||e.name.indexOf("/")>-1||e.name.indexOf("\\")>-1){t.push(e.name);continue}for(i in f)if(e.name==f[i].name){window.setTimeout(function(){y(!1);VIS.ADialog.info("fileAlreadyAttached")},20);return}if(l!=null)for(i in l)if(e.name==l[i].Name&&!l[i].IsDeleted){window.setTimeout(function(){y(!1);VIS.ADialog.info("fileAlreadyAttached")},20);return}w={};w.Name=e.name;w.Size=e.size;f.push(e)}if(t.length>0){r="";for(b in t)r+=t[b].toString()+"\n";r+=t.length==1?"File has":"Files have";r+=" invalid name. Please change the file name and try again.";y(!1);VIS.ADialog.info("",!0,r)}},y=function(n){if(t("body").find("#progressbar").remove(),n){w=t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute;height: 35px;'>");b=t("<span class='vis-ui-label'  style='position:absolute;left: 60%;top: 4px;'>").append("0%");w.append(b);d.append(w);var i=t("<div id='progressbar' style='z-index: 999999;' class='vadms-Busy-Progress'><\/div>");i.append(d);i.appendTo("<body>")}else t("body").find("progressbar").remove()},rt=function(n){w.css("width",n+"%");b.empty();b.append(n+"%")};return this.getFolderKey=c,this.getSavedFileName=savedFileName,this.GetUploadedExcelColumns=function(){var t,u,i;if(o>=f.length)return t=[],u=VIS.Application.contextUrl+"VA012/UploadExcel/SaveAttachmentEntries",t.push({Files:JSON.stringify(p)}),t.push({FolderKey:c}),t.push({FileName:savedFileName}),t.push({Mapping:r}),i=n.ControllerRequestAjaxParameter1(u,t,!1),r.ExcelCol=i.ExcelCol,r.FileName=i.FileName,ut(i),i},y(!0),it(i),tt(),k}}(VA012,jQuery);VA012=window.VA012||{},function(n){function t(){VIS.CalloutEngine.call(this,"VA012.VA012_Contra")}var r=VIS.Logging.Level,i=VIS.Utility.Util;VIS.Utility.inheritPrototype(t,VIS.CalloutEngine);t.prototype.SetContra=function(n,t,r,u,f){if(this.isCalloutActive())return"";if(this.setCalloutActive(!0),f==null)r.setValue("VA012_IsContra",!1);else{var e=i.getValueOfString(VIS.DB.executeScalar("SELECT DTD001_ChargeType FROM C_Charge WHERE  C_Charge_ID="+f.toString()));e=="CON"?r.setValue("VA012_IsContra",!0):r.setValue("VA012_IsContra",!1)}return this.setCalloutActive(!1),""};t.prototype.SetConversionType=function(n,t,i,r,u,f){var o,h,e;if(this.isCalloutActive()||u==null||u.toString()=="")return i.setValue("StmtAmt",0),i.setValue("TrxAmt",0),i.setValue("ChargeAmt",0),i.setValue("C_ConversionType_ID",0),"";if(this.setCalloutActive(!0),VIS.Utility.Util.getValueOfInt(i.getValue("C_CashLine_ID"))>0){if(o=i.getValue("DateAcct"),o==null)return i.setValue("C_CashLine_ID",0),this.setCalloutActive(!1),"PlzSelectStmtDate";if(h=i.getValue("C_CashLine_ID").toString()+","+i.getValue("C_Currency_ID").toString()+","+o.toString()+","+i.getValue("AD_Org_ID").toString(),e=VIS.dataContext.getJSONRecord("VA012/Statement/GetCashDetails",h),e!=null){e.Amount!=0?(i.setValue("StmtAmt",e.Amount),i.setValue("TrxAmt",e.Amount),i.setValue("C_ConversionType_ID",e.C_ConversionType_ID)):(i.setValue("StmtAmt",0),i.setValue("TrxAmt",0),i.setValue("C_ConversionType_ID",0),i.setValue("C_CashLine_ID",0),VIS.ADialog.info("VA012_ConversionRateNotFound"));var c=VIS.Utility.Util.getValueOfDecimal(i.getValue("StmtAmt")),l=VIS.Utility.Util.getValueOfDecimal(i.getValue("TrxAmt")),s=c-l,a=VIS.Utility.Util.getValueOfDecimal(i.getValue("InterestAmt"));s=s-a;i.setValue("ChargeAmt",s)}}else i.getValue("C_Payment_ID")<=0&&i.setValue("C_ConversionType_ID",0);return this.setCalloutActive(!1),n=t=i=r=u=f=null,""};n.Model=n.Model||{};n.Model.VA012_Contra=t}(VA012,jQuery)
