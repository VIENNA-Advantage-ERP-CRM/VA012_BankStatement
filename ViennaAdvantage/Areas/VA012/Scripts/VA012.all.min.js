/*Version 2.2.5.0*/
VA012=window.VA012||{},function(n,t){function i(){function os(n){n!=null&&n!=""&&(s=t(n),v.getControls(),v.setBankAndAccount(),u.newRecord(),v.getBaseCurrency(),v.loadPayments("0","0","PY",vt.val()),ss(),v.dragPayments(),v.dropPayments(),ho=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetAD_Column_IDForPayMethod",null))}function ss(){he=kf("VAS_BankStatement,Bank Statement");be.on(VIS.Events.onTouchStartOrClick,function(n){n.stopPropagation();var i=ie.width();i>50&&t(".va012-left-content").hide();ie.animate({width:i>50?40:200},300,"swing",function(){i<50&&t(".va012-left-content").show()})});ir.on("change",function(){h.val("0");ei=[];v.loadBankAccount()});h.on("change",function(){VIS.Env.getCtx().setContext($self.windowNo,"BankAccount_ID",h.val());ei=[];ii=0;u.loadPayment();u.loadCashLine();oi.html("");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();bi=1;storepaymentdata=[];v.loadPayments(h.val()==null?0:h.val(),wt.val(),ct.val(),vt.val());ti=[];yt.html("");vi=1;tt.loadStatement(li);v.SetBankAccountOrganizationInContext(VIS.Utility.Util.getValueOfInt(t("option:selected",h).attr("orgid")))});wt.on("change",function(){oi.html("");bi=1;storepaymentdata=[];v.loadPayments(h.val()==null?0:h.val(),wt.val(),ct.val(),vt.val())});ct.on("change",function(){ct.val()=="CO"?(wt.prop("selectedIndex",0),wt.prop("disabled",!0)):(wt.prop("selectedIndex",0),wt.prop("disabled",!1));oi.html("");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();bi=1;pf=0;de=50;vo=1;storepaymentdata=[];v.loadPayments(h.val()==null?0:h.val(),wt.val(),ct.val(),vt.val())});ve.on(VIS.Events.onTouchStartOrClick,function(){vt.val()==""?VIS.ADialog.info("VA012_PleaseEnterStatementDate",null,"",""):tt.statementDialog()});ye.on(VIS.Events.onTouchStartOrClick,function(){tt.matchStatementDialog()});kr.on(VIS.Events.onTouchStartOrClick,function(){tt.paymentScheduleDialog()});no.on(VIS.Events.onTouchStartOrClick,function(){tt.prepayOrderDialog()});uo.on(VIS.Events.onTouchStartOrClick,function(){ai.val()!=null&&ai.val()!=""?(lr=!0,ti=[],ei=[],yt.html(""),vi=1,tt.loadStatement(li),setTimeout(function(){ii!=0&&s.find('span.glyphicon-edit[data-uid="'+ii+'"]').parents(".va012-right-data-wrap").addClass("VA012-EditRecordBackColor")},500)):(ti=[],yt.html(""),ei=[],vi=1,tt.loadStatement(li),setTimeout(function(){ii!=0&&s.find('span.glyphicon-edit[data-uid="'+ii+'"]').parents(".va012-right-data-wrap").addClass("VA012-EditRecordBackColor")},500))});ai.keypress(function(n){n.which==13&&(ai.val()!=null&&ai.val()!=""?(lr=!0,ti=[],ei=[],yt.html(""),vi=1,tt.loadStatement(li),setTimeout(function(){ii!=0&&s.find('span.glyphicon-edit[data-uid="'+ii+'"]').parents(".va012-right-data-wrap").addClass("VA012-EditRecordBackColor")},500)):(ti=[],yt.html(""),ei=[],vi=1,tt.loadStatement(li),setTimeout(function(){ii!=0&&s.find('span.glyphicon-edit[data-uid="'+ii+'"]').parents(".va012-right-data-wrap").addClass("VA012-EditRecordBackColor")},500)))});pe.on(VIS.Events.onTouchStartOrClick,function(){ti.length>0?(lt(s,!0,"absolute"),t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/UnmatchStatement",contentType:"application/json; charset=utf-8",data:JSON.stringify({_statementLinesList:ti.toString()}),success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n[0]._status=="Success"&&n[0]._statementOk!=null&&VIS.ADialog.info("VA012_StatementsUnmatched",null," "+n[0]._statementOk,""),n[0]._error!=null&&VIS.ADialog.info(n[0]._error,null,"",""),n[0]._statementNo!=null&&VIS.ADialog.info("VA012_CompletedRecord",null," "+n[0]._statementNo,""),n[0]._statementNoNotUpdate!=null&&VIS.ADialog.info("VA012_ErrorSaving",null," "+n[0]._statementNoNotUpdate,""),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),ti=[],storepaymentdata=[],ei=[],ii=0,yt.html(""),vi=1,tt.loadStatement(li),oi.html(""),u.scheduleRefresh(),u.prepayRefresh(),bi=1,v.loadPayments(h.val(),wt.val(),ct.val(),vt.val()),lu(!1),lt(s,!1,"absolute"))},error:function(n){lt(s,!1,"absolute");VIS.ADialog.info(n,null,"","")}})):VIS.ADialog.info("VA012_NoRecordSelected",null,"","")});we.on(VIS.Events.onTouchStartOrClick,function(){if(h.val()==null||h.val()==""||h.val()=="0"){VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"","");return}lt(s,!0,"absolute");t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/ProcessStatement",contentType:"application/json; charset=utf-8",data:JSON.stringify({_statementLinesList:ti.toString(),_accountID:h.val()}),success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n[0]._error!=null?VIS.ADialog.info("",null,n[0]._error,""):n[0]._statementProcessed!=null?VIS.ADialog.info("",null,n[0]._statementProcessed+" "+VIS.Msg.getMsg("VA012_StatementsProcessed"),""):n[0]._statementNotProcessed!=null?VIS.ADialog.info("",null,n[0]._statementNotProcessed+" "+VIS.Msg.getMsg("VA012_StatementsNotProcessed"),""):n[0]._statementUnmatchedLines!=null&&VIS.ADialog.info("",null,n[0]._statementUnmatchedLines+" "+VIS.Msg.getMsg("VA012_ExistsUnmatched"),""),ei=[],ii=0,u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),storepaymentdata=[],ti=[],yt.html(""),vi=1,tt.loadStatement(li),oi.html(""),u.scheduleRefresh(),u.prepayRefresh(),bi=1,v.loadPayments(h.val(),wt.val(),ct.val(),vt.val()),lt(s,!1,"absolute"))},error:function(n){lt(s,!1,"absolute");VIS.ADialog.info(n,null,"","")}})});ce.on("change",function(){ti=[];yt.html("");ei=[];vi=1;of=ce.val();tt.loadStatement(li);setTimeout(function(){ii!=0&&s.find('span.glyphicon-edit[data-uid="'+ii+'"]').parents(".va012-right-data-wrap").addClass("VA012-EditRecordBackColor")},500)});io.on(VIS.Events.onTouchStartOrClick,function(){ti.length>0||parseInt(f.attr("data-uid"))>0?VIS.ADialog.confirm("VA012_WantToDelete",!0,"","Confirm",function(n){if(n)lt(s,!0,"absolute"),t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/DeleteStatement",contentType:"application/json; charset=utf-8",data:JSON.stringify({_statementLinesList:ti.toString(),_statementLineID:f.attr("data-uid")}),success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n[0]._status=="Success"&&n[0]._statementProcessed!=null&&VIS.ADialog.info(n[0]._statementProcessed+" "+VIS.Msg.getMsg("VA012_StatementsDeleted"),null,"",""),n[0]._statementNotProcessed!=null&&VIS.ADialog.info(n[0]._statementNotProcessed+" "+VIS.Msg.getMsg("VA012_StatementsNotDeleted"),null,"",""),n[0]._error!=null&&VIS.ADialog.info(n[0]._error,null,"",""),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),ti=[],storepaymentdata=[],ei=[],yt.html(""),vi=1,tt.loadStatement(li),oi.html(""),u.scheduleRefresh(),u.prepayRefresh(),bi=1,v.loadPayments(h.val(),wt.val(),ct.val(),vt.val()),lt(s,!1,"absolute"))},error:function(n){lt(s,!1,"absolute");VIS.ADialog.info(n,null,"","")}});else return}):VIS.ADialog.info("VA012_NoRecordSelected",null,"","")});oi.on("scroll",v.paymentScroll);yt.on("scroll",v.statementScroll);yt.on(VIS.Events.onTouchStartOrClick,tt.statementListEdit);yt.on(VIS.Events.onTouchStartOrClick,tt.openStatement);yt.on(VIS.Events.onTouchStartOrClick,tt.selectedStatementLinesList);oi.on(VIS.Events.onTouchStartOrClick,tt.selectedScheduleList);oi.on(VIS.Events.onTouchStartOrClick,function(n){n.target.type!="checkbox"&&(t(n.target).closest(".row").find(":checkbox").is(":checked")?t(n.target).closest(".row").find(":checkbox").prop("checked",!1):t(n.target).closest(".row").find(":checkbox").prop("checked",!0));i.getControl().trigger("blur",[r(i.getControl().val()),r(l.getControl().val())])});vt.addClass("va012-mandatory");vt.on("change",function(){if(vt.val()=="")vt.addClass("va012-mandatory");else{if(Globalize.format(new Date(vt.val()),"yyyy-MM-dd")>Globalize.format(new Date,"yyyy-MM-dd"))return VIS.ADialog.info("VA012_StatementDateToday",null,"",""),vt.val(""),!1;vt.removeClass("va012-mandatory")}storepaymentdata=[];v.loadPayments(h.val()==null?0:h.val(),wt.val(),ct.val(),vt.val())});pu.fireValueChanged=v.loadDataOnBPChanged;_btnSearchPayment.on(VIS.Events.onTouchStartOrClick,function(){v.loadAndResetPaymentData()});_txtSearchPayment.keypress(function(n){n.which==13&&v.loadAndResetPaymentData()})}function hs(){var t=us.isDecimalSeparatorDot(window.navigator.language),n=_txtSearchPayment.val();return n==""||t||n.contains("=")||n.contains(",")&&(n=n.replace(",",".")),n}function cs(n){t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/getMatchRecData",contentType:"application/json; charset=utf-8",success:function(t){if(n.html(""),n.append("<option value=0 >-<\/option>"),t=JSON.parse(t),t!=null&&t.length>0)for(var i=0;i<t.length;i++)n.append("<option value="+t[i].Value+">"+t[i].Name+"<\/option>")},error:function(n){VIS.ADialog.info(n,null,"","")}})}function ns(n,t){w2ui["VA012_gridPayment_"+$self.windowNo]!=null&&w2ui["VA012_gridPayment_"+$self.windowNo].destroy();var i=null;i=n.w2grid({name:"VA012_gridPayment_"+$self.windowNo,recordHeight:25,show:{toolbar:!1,selectColumn:!1,toolbarReload:!1,toolbarColumns:!1,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1},records:[],columns:[{field:"_trxDate",caption:"Tran. Date",sortable:!1,size:"80px",display:!1},{field:"_trxNo",caption:"Auth Code/ Trx no.",sortable:!1,size:"30%",hidden:!1},{field:"_salesAmt",caption:"Trx Amount",sortable:!1,size:"15%",hidden:!1,style:"text-align: right",render:function(n){return parseFloat(n._salesAmt).toLocaleString(window.navigator.language,{minimumFractionDigits:n._StdPrecision,maximumFractionDigits:n._StdPrecision})}},{field:"_netAmt",caption:"Statement Amount",sortable:!1,size:"15%",hidden:!1,style:"text-align: right",render:function(n){return parseFloat(n._netAmt).toLocaleString(window.navigator.language,{minimumFractionDigits:n._StdPrecision,maximumFractionDigits:n._StdPrecision})}},{field:"_difference",caption:"Difference",sortable:!1,size:"15%",hidden:!1,style:"text-align: right"},{field:"_chargeType",caption:"Charge Type",sortable:!1,size:"80px",display:!0},{field:"_taxRate",caption:"Tax Rate",sortable:!1,size:"80px",display:!0},{field:"_taxAmt",caption:"Tax Amt",sortable:!1,size:"15%",hidden:!1,style:"text-align: right",render:function(n){return parseFloat(n._taxAmt).toLocaleString(window.navigator.language,{minimumFractionDigits:n._StdPrecision,maximumFractionDigits:n._StdPrecision})}},],onChange:function(){},onClick:function(){},onDelete:function(){},onSubmit:function(){}});i.add(t)}function df(n){if(n!=null&&d.length>0){t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetCurrencyandConversionType",dataType:"json",data:{_invoiceSchedules:n},success:function(n){var t=JSON.parse(n);(t!=null||t!="")&&i(t)}});function i(n){if(n.currencyId!=0&&d!=null){c.val(at).prop("selected",!0);for(var i=0;c[0].length>i;i++)VIS.Utility.Util.getValueOfInt(c[0][i].value)==at?t(c[0][i]).show():t(c[0][i]).hide();c.removeClass("va012-mandatory");c.attr("disabled",!1);p.val(n.conversionTypeId).prop("selected",!0)}else c.val(at).prop("selected",!0),c.attr("disabled",!0),c.removeClass("va012-mandatory"),p.val(n.conversionTypeId).prop("selected",!0);p.trigger("change")}}else c.prop("selectedIndex",0),c.addClass("va012-mandatory"),c.attr("disabled",!1),p.prop("selectedIndex",0),p.addClass("va012-mandatory")}function r(n){var t=0;return dotFormatter=$self.dotFormatter,typeof dotFormatter=="undefined"&&(dotFormatter=VIS.Env.isDecimalPoint()),typeof n=="string"?n:n=n.toString(),dotFormatter?(n=n.contains("−")?(-1*uf.GetConvertedNumber(n,dotFormatter)).toString():uf.GetConvertedNumber(n,dotFormatter).toString(),t=n!=""?n:t):(n=n.contains("−")&&!n.contains(".")?(-1*uf.GetConvertedNumber(n,dotFormatter)).toString():n.contains("−")&&n.contains(".")?(-1*uf.GetConvertedNumber(n,dotFormatter)).toString():uf.GetConvertedNumber(n,dotFormatter).toString(),t=n!=""?n:t),parseFloat(t).toFixed(b)}function le(n,i,r,u){var f=VIS.Utility.Util.getValueOfInt(n),e,o;if(f==0){u(n);return}e=VIS.Utility.Util.getValueOfDecimal(i);o=VIS.Utility.Util.getValueOfInt(r);t.ajax({url:VIS.Application.contextUrl+"VA012/BankStatement/CalculateSurcharge",type:"GET",contentType:"application/json; charset=utf-8",data:{_tax_ID:f,_chargeAmt:e,_stdPrecision:o},success:function(n){u(n)},error:function(n){VIS.ADialog.info(n,null,"","")}})}function lu(n){n&&(y.val()!="V"||y.val()=="V"&&st.getValue()!=0)?(i.getControl().attr("disabled",!0),c.attr("disabled",!0),ou.attr("disabled",!0),it.attr("disabled",!0),wr.attr("disabled",!0),ui.find("*").prop("disabled",!0),y.attr("disabled",!0),pi.find("*").prop("disabled",!0),et.attr("disabled",!0),et.attr("disabled",!0),nt.attr("disabled",!0),dt.attr("disabled",!0),si.attr("disabled",!0),ur.attr("disabled",!0),fr.find("*").prop("disabled",!0),er.find("*").prop("disabled",!0),yr.find("*").prop("disabled",!0),or.find("*").prop("disabled",!0),nu.find("*").prop("disabled",!0),rr.prop("disabled",!0),kr.prop("disabled",!0),sr.find("*").prop("disabled",!0),kr.css("pointer-events","none"),_divCtrlCashLine.find("*").prop("disabled",!0),dr.find("*").prop("disabled",!0),ru.find("*").prop("disabled",!0),gr.find("*").prop("disabled",!0),uu.find("*").prop("disabled",!0),o.css("pointer-events","none"),e.css("pointer-events","none")):n||(i.getControl().attr("disabled",!1),c.attr("disabled",!1),ou.attr("disabled",!1),nt.attr("disabled",!1),dt.attr("disabled",!1),si.attr("disabled",!1),ur.attr("disabled",!1),yr.find("*").prop("disabled",!1),y.val()=="V"&&VIS.Utility.Util.getValueOfInt(it.attr("chargeid"))!=0?(fr.find("*").prop("disabled",!0),er.find("*").prop("disabled",!0),or.find("*").prop("disabled",!0),kr.css("pointer-events","none"),y.trigger("change")):(fr.find("*").prop("disabled",!1),er.find("*").prop("disabled",!1),or.find("*").prop("disabled",!1),kr.css("pointer-events","auto")),y.attr("disabled",!1),sr.find("*").prop("disabled",!1),o.css("pointer-events","auto"),e.css("pointer-events","auto"))}function ae(n,t){return t.indexOf(n)>-1}function lt(n,i,r){if(gf=t("<div class='vis-apanel-busy va012-busy-bank-statement'>"),gf.css({position:r,width:"95%",height:"95%","text-align":"center",visibility:"hidden"}),i)gf.css({visibility:"visible"});else{n.find(".va012-busy-bank-statement").remove();return}n.append(gf)}var s,uf,kf,v,tt,u;this.windowNo;$self=this;s=t("<div/>");this.frame;this.FormInfo;var gf=null,ir=null,h=null,ne=null,vt=null,ve=null,ye=null,wt=null,ct=null,yt=null,oi=null,te=null,li="",du=null,gu=null,sf=null,ao=null,lr=!1,ti=[],d=[],di=[],pt=[],au=[],vu=[],pe=null,we=null,be=null,ie=null,re=null,at=0,b=2,ri=!1,ar=!1,bi=1,vo=1,vi=1,ke=50,de=50,hf=0,cf=0,ge=!1,yo=null,f=null,ue=null,dt=null,fe=null,si=null,ur=null,nt=null,et=null,vr=null,pr=null,yu=null,y=null,i=null,l=null,w=null,k=null,ou=null,wr=null,br=null,it=null,ut=null,bt=null,nf=null,lf=null,su=null,af=null,vf=null,tf=null,yf=null,kr=null,no=null,rr=null,ee=null,kt=null,to=null,io=null,ts=null,is=null,dr=null,ru=null,gr=null,uu=null,yi=null,po=null,rf=null,pi=null,hi=null,ro=null,ui=null,wi=null,fr=null,er=null,yr=null,or=null,nu=null,tu=null,sr=null,ai=null,uo=null,gi=null,wo=null,oe=null,e=null,o=null,fo=0,pf=0,bo=null,ht=null,gt=null,eo=null,ot=null,ci=null,oo=null,rt=null,fi=null,rs=null,se=null,st=null,hu=null,he=0,so=null,ni=null,cu=null,c=null,p=null,a=null,g=null,ft=null,hr=!1;storepaymentdata=[];uf=VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount);this.dotFormatter=VIS.Env.isDecimalPoint();var us=new VIS.CultureSeparator,cr=new Date,wf=cr.getFullYear()+"-"+("0"+(cr.getMonth()+1)).slice(-2)+"-"+("0"+cr.getDate()).slice(-2),bf,fs,ko,es,ho=null,pu=_txtSearchPayment=_btnSearchPayment=null,co=0,lo=null,wu=null,fu=null,ff=null,nr=null,ef=null,iu=!1,ki=null,bu=null,tr=null,eu=0,ku=null,ei=[],ii=0,ce=null,of=null,go=null;this.Initialize=function(){co=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA012/BankStatement/GetModulePrefix",{prefix:"VA034_"});os(v.loadFormDesign());l.addVetoableChangeListener(this);bt.addVetoableChangeListener(this);i.addVetoableChangeListener(this);w.addVetoableChangeListener(this)};kf=function(n){return VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA012/BankStatement/GetWindowforzoom",{WindowName:n},null)};v={loadDataOnBPChanged:function(){oi.html("");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();v.loadAndResetPaymentData()},loadFormDesign:function(){_formDesign=t('<div class="va012-assign-content">');divContainer=t('  <div id="VA012_mainContainer_'+$self.windowNo+'" class="va012-main-container">');divTable=t('<table id="VA012_table_'+$self.windowNo+'" style="width: 100%;">');tableTr=t("<tr>");tableTd=t('<td id="VA012_tdLeft_'+$self.windowNo+'" style="width: 200px;position: relative;">   <div class="va012-left-part">              <div class="va012-left-title">                  <h4>    <i id="VA012_btnHide_'+$self.windowNo+'" class="fa fa-bars" alt="lines" style="cursor: pointer;background: rgba(var(--v-c-primary),1);"><\/i> <\/h4>              <\/div>              <div class="va012-left-content">                  <div class="va012-left-data">                      <label  id="VA012_lblBank_'+$self.windowNo+'" >'+VIS.Msg.getMsg("VA012_Bank")+'<sup style="color: red;">*<\/sup><\/label>                      <select id="VA012_cmbBank_'+$self.windowNo+'" ><\/select>                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <label  id="VA012_lblBankAccount_'+$self.windowNo+'" >'+VIS.Msg.getMsg("VA012_BankAccount")+'<sup style="color: red;">*<\/sup><\/label>                      <select id="VA012_cmbBankAccount_'+$self.windowNo+'"   ><\/select>                  <\/div>                  <!-- end of left-data -->                  <div class="va012-left-data">                      <label  id="VA012_lblStatementDate_'+$self.windowNo+'" >'+VIS.Msg.getMsg("VA012_StatementDate")+'<sup style="color: red;">*<\/sup><\/label>                      <input type="date" max="9999-12-31" id="VA012_statementDate_'+$self.windowNo+'"   >                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <a id="VA012_btnLoadStatement_'+$self.windowNo+'">'+VIS.Msg.getMsg("VA012_LoadStatement")+'<\/a>                      <a id="VA012_btnMatchStatement_'+$self.windowNo+'">'+VIS.Msg.getMsg("VA012_MatchStatement")+"<\/a>                  <\/div>                  <!-- end of left-data -->              <\/div>              <!-- end of left-content -->          <\/div>          <!-- end of left-part --> <\/td>");tableTd1=t('<td style="position: relative;">');contentDiv=t('<div id="VA012_contentArea_'+$self.windowNo+'" class="va012-content-area" style="position: absolute;" >');divMidWrap=t('<div id="VA012_middleWrap_'+$self.windowNo+'" class="va012-middle-wrap">');divtopWrap=t('<div class="va012-mid-top-wrap" id="VA012_formBtnNewRecord_'+$self.windowNo+'">                      <div class="va012-icons-wrap">                          <span>                              <i class="va012-undo vis vis-ignore" alt="undo" title="Undo" id="VA012_btnUndo_'+$self.windowNo+'"><\/i><\/span>                          <span>                              <i class="va012-hide-show-newform vis vis-plus" activestatus="0" alt="add" title = "Expand" id="VA012_btnNewRecord_'+$self.windowNo+'"><\/i><\/span>                      <\/div>                      <!-- end of icons-wrap -->                  <\/div>');divformWrap=t('<div class="va012-form-wrap va012-newform" id="VA012_formNewRecord_'+$self.windowNo+'" data-uid="0" style="height:55%;overflow-y:auto;width:101%;">');divRow1=t('<div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementNumber")+' <sup style="color: red;">*<\/sup><\/label>                                  <input  tabindex="1" id="VA012_txtStatementNo_'+$self.windowNo+'" type="text" class="va012-input-size">                                  <i  id="VA012_btnStatementNo_'+$self.windowNo+'" class="fa fa-plus va012-add-icon"><\/i>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementPage")+'<\/label>                                  <input tabindex="2" value="1" id="VA012_txtStatementPage_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementLine")+'<\/label>                                  <input tabindex="3" value="10" id="VA012_txtStatementLine_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  ');divRow2=t('<div class="row va012-fl-padd" style="width:102%">');row2Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementDate")+'<sup style="color: red;">*<\/sup><\/label>                                  <input tabindex="4" id="VA012_dtStatementDate_'+$self.windowNo+'" type="date" max="9999-12-31">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->');row2Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">');row2Col2divAmt=t('<div class="va012-form-group va012-form-data" >');row2Col2Lble=t("<label>"+VIS.Msg.getMsg("VA012_Amount")+'<sup style="color: red;">*<\/sup><\/label>');row2Col2btnIn=t('<a tabindex="5" id="VA012_btnIn_'+$self.windowNo+'" v_active="1" class="va012-inout-icon va012-active">In<\/a>');row2Col2btnOut=t('<a tabindex="6" id="VA012_btnOut_'+$self.windowNo+'" v_active="0" class="va012-inout-icon va012-inactive">Out<\/a>');i=new VIS.Controls.VAmountTextBox("VA012_txtAmount_"+$self.windowNo+"",!1,!1,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));i.setValue(0);i.getControl().addClass("va012-input-size-amt va012-right-align va012-txtamount");row2Col2btnIcon=t('<a id="VA012_btnAmount_'+$self.windowNo+'" class="va012-info-icon"><\/a>');row2Col3=t('<div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_VoucherMatch")+'<sup style="color: red;">*<\/sup><\/label>                                  <select tabindex="8" id="VA012_cmbVoucherMatch_'+$self.windowNo+'">                                  <\/select>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  ');divRow3=t('                      <div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-8 col-sm-8 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_Description")+'<\/label>                                  <input tabindex="9" id="VA012_txtDescription_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlBusinessPartner_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_BusinessPartner")+'<\/label>                                      <div id="VA012_ctrlBusinessPartner_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  ');divRow4=t('<div class="row va012-fl-padd" style="width:102%">');divRow4Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">');divRow4Col1TrxAmt=t('<div id="VA012_divTrxAmt_'+$self.windowNo+'" class="va012-form-group va012-form-data">');divRow4Col1Lbl=t("<label>"+VIS.Msg.getMsg("VA012_TrxAmt")+'<sup style="color: red;">*<\/sup><\/label>');l=new VIS.Controls.VAmountTextBox("VA012_txtTrxAmt_"+$self.windowNo+"",!1,!0,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));l.getControl().addClass("va012-right-align");l.setValue(0..toFixed(b));divRow4Col1TrxAmt.append(divRow4Col1Lbl).append(l.getControl());divRow4Col1.append(divRow4Col1TrxAmt);divRow4Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">');divRow4Col2Diff=t('<div id="VA012_divDifference_'+$self.windowNo+'" class="va012-form-group va012-form-data">');divRow4Col2DiffLbl=t("<label>"+VIS.Msg.getMsg("VA012_Difference")+'<sup id="Ast_Difference_'+$self.windowNo+'" style="color: red;">*<\/sup><\/label>');w=new VIS.Controls.VAmountTextBox("VA012_txtDifference_"+$self.windowNo+"",!1,!0,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));w.getControl().addClass("va012-right-align");w.setValue(0);w.getControl().trigger("blur");divRow4Col2Diff.append(divRow4Col2DiffLbl).append(w.getControl());divRow4Col2.append(divRow4Col2Diff);divRow4Col3=t('<div class="col-md-4 col-sm-4 va012-padd-0">');divRow4Col3DiffType=t('<div id="VA012_divDifferenceType_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_DifferenceType")+'<sup id="Ast_DifferenceType_'+$self.windowNo+'" style="color: red;">*<\/sup><\/label>                                  <select tabindex="9" id="VA012_cmbDifferenceType_'+$self.windowNo+'">                                  <\/select>                              <\/div>                              <!-- end of form-group -->');divRow4Col3.append(divRow4Col3DiffType);divRow4.append(divRow4Col1).append(divRow4Col2).append(divRow4Col3);divRow5=t('<div class="row va012-fl-padd" style="width:102%">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divContraType_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_ContraType")+'<sup id="Ast_ContraType_'+$self.windowNo+'" style="color: red;">*<\/sup><\/label><\/label>                                      <select tabindex="10" id="VA012_cmbContraType_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCashBook_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CashBook")+'<\/label>                                      <select tabindex="10" id="VA012_cmbCashBook_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <div id="VA012_divCtrlCashLine_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CashJournalLine")+'<sup id="Ast_CashJournalLine_'+$self.windowNo+'" style="color: red;">*<\/sup><\/label>                                      <div id="VA012_ctrlCashLine_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCheckNo_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CheckNo")+'<\/label>                                      <input  disabled tabindex="12" id="VA012_txtCheckNo_'+$self.windowNo+'" type="text">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->  ');divRow6=t('<div class="row va012-fl-padd" style="width:102%">');divRow6Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCharge_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Charge")+'<sup class="astric_'+$self.windowNo+'" style="color: red;">*<\/sup><\/label>                                      <div style=" position: relative; float: left; width: 100%; ">                                      <input tabindex="10" chargeid="" type="text" id="VA012_txtCharge_'+$self.windowNo+'" style=" width: 100%; ">                                      <img id="VA012_btnCharge_'+$self.windowNo+'" class="VA012-img-combo" alt="">                                     <\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow6Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divTaxRate_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_TaxRate")+'<sup class="astric_'+$self.windowNo+'" style="color: red;">*<\/sup><\/label>                                      <select tabindex="11" id="VA012_cmbTaxRate_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow6Col3=t('<div class="col-md-4 col-sm-4 va012-padd-0">');divRow6Col3divTax=t('<div id="VA012_divTaxAmount_'+$self.windowNo+'" class="va012-form-group va012-form-data">');divRow6Col3divTaxLbl=t("<label>"+VIS.Msg.getMsg("VA012_TaxAmount")+"<\/label>");bt=new VIS.Controls.VAmountTextBox("VA012_txtTaxAmount_"+$self.windowNo+"",!1,!0,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));bt.setValue(0);bt.getControl().addClass("va012-right-align");divRow6Col3divTax.append(divRow6Col3divTaxLbl).append(bt.getControl());divRow6Col3.append(divRow6Col3divTax);divRow6.append(divRow6Col1).append(divRow6Col2).append(divRow6Col3);divRow7=t('<div class="row va012-fl-padd" style="width:102%">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlPayment_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Payment")+'<\/label>                                      <div id="VA012_ctrlPayment_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlInvoice_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Invoice")+'<\/label>                                      <div id="VA012_ctrlInvoice_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divVoucherNo_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_VoucherNo")+'<\/label>                                  <input tabindex="9" id="VA012_txtVoucherNo_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->  ');divRow8=t('<div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPaymentSchedule_'+$self.windowNo+'" class="va012-form-data" >                              <label>'+VIS.Msg.getMsg("VA012_PaymentSchedules")+'<\/label>                              <input disabled id="VA012_txtPaymentSchedule_'+$self.windowNo+'" type="text" class="va012-input-size">                              <a tabindex="13"  id="VA012_btnPaymentSchedule_'+$self.windowNo+'" class="va012-edit-icon"><\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPrepayOrder_'+$self.windowNo+'" class="va012-form-data" >                              <label>'+VIS.Msg.getMsg("VA012_PrepayOrders")+'<\/label>                              <div id="VA012_ctrlOrder_'+$self.windowNo+'"><\/div>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divTrxOrg_'+$self.windowNo+'" class="va012-form-data" >                              <label>'+VIS.Msg.getMsg("VA012_TrxOrg")+'<\/label>                              <div id="VA012_ctrlTrxOrg_'+$self.windowNo+'"><\/div>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  ');divRow9=t('<div class="row va012-fl-padd" style="width:102%">                       <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-check">                                  <input tabindex="13" id="VA012_chkUseNextTime_'+$self.windowNo+'" type="checkbox" class="va012-payment-chkBox">                                  <label style="position: absolute;">'+VIS.Msg.getMsg("VA012_UseNextTime")+'<\/label>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-2 col-sm-2 va012-padd-0" >                              <div class="va012-form-data" id="VA012_divMore_'+$self.windowNo+'">                                  <a tabindex="14" visiblestatus="0" class="va012-more" id="VA012_btnMore_'+$self.windowNo+'" href="#">'+VIS.Msg.getMsg("VA012_More")+'<\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-6 col-sm-6 va012-padd-0" >                          <div class="va012-saveNew-div">                              <a tabindex="15" title="Save Record" id="VA012_btnSave_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue" style=" float: left;">'+VIS.Msg.getMsg("VA012_SaveandNew")+"<\/a>                          <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->");divRow10=t('<div class="row va012-fl-padd" style="width:102%">');divRow10Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCurrency_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Currency")+'<sup style="color: red;">*<\/sup><\/label>                                      <select tabindex="10" id="VA012_txtCurrency_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow10Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divConversionType_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_ConversionType")+'<sup style="color: red;">*<\/sup><\/label>                                      <select tabindex="11" id="VA012_txtConversionType_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow10Col3=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divPaymentMethod_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_PaymentMethod")+'<sup style="color: red;">*<\/sup><\/label>                                      <select tabindex="16" id="VA012_txtPaymentMethod_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow10.append(divRow10Col1).append(divRow10Col2).append(divRow10Col3);divRow11=t('<div class="row va012-fl-padd" style="width:102%">');divRow11Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCheckNum_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CheckNo")+'<sup style="color: red;">*<\/sup><\/label>                                      <input tabindex="17" id="VA012_txtCheckNum_'+$self.windowNo+'" type="text">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow11Col2=t('<div class="col-md-4 col-sm-4 va012-padd-1">                                  <div id="VA012_divCheckDate_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CheckDate")+'<sup style="color: red;">*<\/sup><\/label>                                      <input tabindex="18" id="VA012_txtCheckDate_'+$self.windowNo+'" type="date" max="9999-12-31">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow11.append(divRow11Col1).append(divRow11Col2);payHeaderWrap=t('<div id="VA012_paymentHeaderWrap_'+$self.windowNo+'" class="va012-payment-header-wrap">                      <div class="va012-headersearchfilter">                           <div class="va012-searchfilter">                              <select id="VA012_cmbTransactionType_'+$self.windowNo+'">                             <option value="PY">'+VIS.Msg.getMsg("VA012_Payments")+'<\/option>                             <option value="PO">'+VIS.Msg.getMsg("VA012_PrepayOrders")+'<\/option>                              <option value="IS">'+VIS.Msg.getMsg("VA012_InvoiceSchedule")+'<\/option>                              <option value="CO">'+VIS.Msg.getMsg("VA012_Contra")+'<\/option>                              <\/select>                          <\/div>                          <div class="va012-searchfilter">                              <select id="VA012_cmbSearchPaymentMethod_'+$self.windowNo+'">                              <\/select>                          <\/div>                       <div id=VA012_DivBusinessPartner_'+$self.windowNo+' class="va012-searchfilter">                       <\/div>                       <div class="VA012-search-wrap va012-searchfilter">                        <input value = "" placeholder="'+VIS.Msg.getMsg("VA012_Search")+'..." type = "text" id = VA012_txtSearch_Payment_'+$self.windowNo+'>                        <a class= "va012-search-icon va012-search-icon-right" id = VA012_btnSearch_Payment_'+$self.windowNo+' title="'+VIS.Msg.getMsg("VA012_SearchTitle")+'"> <span class="glyphicon glyphicon-search"><\/span><\/a >                       <\/div>                          <\/div>                      <\/div>                      <!-- end of payment-header-wrap -->                  <div id="VA012_paymentList_'+$self.windowNo+'" class="va012-payment-list">                                           <div class="va012-payment-content" id="VA012_lstPayments_'+$self.windowNo+'">                   <\/div>                  <\/div>                  <!-- end of payment-list -->                <\/div>');rightWrap=t('<div id="VA012_rightWrap_'+$self.windowNo+'" class="va012-right-wrap">                  <div id="VA012_rightTop_'+$self.windowNo+'" class="va012-right-top">                      <div class="row">                          <div class="col-md-3 col-sm-3 va012-recunrecdiv">                              <div class="va012-pay-text" id="VA012_secReconciled_'+$self.windowNo+'" >                                <p>'+VIS.Msg.getMsg("VA012_Reconciled")+'<\/p>                                <p style="margin-top: 4px;">'+VIS.Msg.getMsg("VA012_Unreconciled")+'<\/p>                              <\/div>                          <\/div>                          <!-- end of col -->                          <div class="col-md-9 col-sm-9" style=" padding-left: 5px; ">                              <div class="va012-pay-text" id="VA012_secUnreconciled_'+$self.windowNo+'">                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-green"><span class="va012-base-curr"><\/span> 0<\/span>                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-red"><span class="va012-base-curr"><\/span> 0<\/span>                              <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                      <div class="row">                          <div class="col-md-12 col-sm-12" style=" padding-left: 5px; ">                      <div style=" /* float: right; */ padding-left: 10px;">                               <a id="VA012_btnUnmatch_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue va012-btn-rtlUnMatch" title="Show Unmatched Record">'+VIS.Msg.getMsg("VA012_Unmatch")+'<\/a>                              <a id="VA012_btnProcess_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue va012-btn-rtl" title="Clear Matched Record">'+VIS.Msg.getMsg("VA012_Process")+'<\/a>                             <a id="VA012_btnDelete_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue va012-btn-rtl" title="Delete Selected Record">'+VIS.Msg.getMsg("VA012_Delete")+'<\/a>                       <\/div>                           <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <div class="row">                          <div class="col-md-12 col-sm-12 va012-searchdiv">                           <div class="va012-right-search" style="flex-direction: row-reverse;display: flex;">                        <div class="VA012-StatementDropDown">                       <select id="VA012_DropDown_'+$self.windowNo+'" class="VA012-DropDownForStatement" style="width: calc(100% - 20px);">                           <option value="0">'+VIS.Msg.getMsg("VA012_Both")+'<\/option>                          <option value="1">'+VIS.Msg.getMsg("VA012_Reconciled")+'<\/option>                          <option value="2">'+VIS.Msg.getMsg("VA012_UnReconciled")+'<\/option>                        <\/select>                       <label id="VA012_lblDropDown_'+$self.windowNo+'" class="VA012-lblDropDownClass">'+VIS.Msg.getMsg("VA012_StatementType")+'<\/label>                        <\/div>                            <div class="va012-search-wrap va012-right-panel-search" >                               <input id="VA012_txtSearch_'+$self.windowNo+'" value="" placeholder="'+VIS.Msg.getMsg("VA012_Search")+'..." type="text" style="width: 100%;">                               <a id="VA012_btnSearch_'+$self.windowNo+'" class="va012-search-icon"><span class="glyphicon glyphicon-search"><\/span><\/a>                          <\/div>                      <!-- end of search-wrap -->                         <\/div>                  <!-- end of right-search -->                        <\/div>                       <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <\/div>                  <!-- end of right-top -->                    <div class="va012-right-content" id="VA012_lstStatement_'+$self.windowNo+'">                  <\/div>                  <!-- end of right-content -->              <\/div>');row2Col2divAmt.append(row2Col2Lble).append(row2Col2btnIn).append(row2Col2btnOut).append(i.getControl()).append(row2Col2btnIcon);row2Col2.append(row2Col2divAmt);divRow2.append(row2Col1).append(row2Col2).append(row2Col3);divformWrap.append(divRow1).append(divRow2).append(divRow10).append(divRow11).append(divRow3).append(divRow4).append(divRow5).append(divRow6).append(divRow7).append(divRow8).append(divRow9);var n="C_BPartner.IsActive='Y' AND C_BPartner.IsSummary ='N' AND C_BPartner.AD_Org_ID IN(0,@BankAccount_Org_ID@) AND C_BPartner.AD_Client_ID = "+VIS.context.getAD_Client_ID(),r=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,3499,VIS.DisplayType.Search,"C_BPartner_ID",0,!1,n);return pu=new VIS.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,VIS.DisplayType.Search,r),divMidWrap.append(divtopWrap).append(divformWrap).append(payHeaderWrap),t(payHeaderWrap).find("#VA012_DivBusinessPartner_"+$self.windowNo).append(pu.getControl().attr("id","C_BPartner_ID_"+$self.windowNo).addClass("BPSearchText").attr("placeholder",VIS.Msg.getMsg("VA012_BusinessPartner"))).append(pu.getBtn(0).addClass("btnBPSearch")),contentDiv.append(divMidWrap).append(rightWrap),tableTd1.append(contentDiv),tableTr.append(tableTd).append(tableTd1),bf=t('<div  id="VA012_gridMatchStatePopUp_'+$self.windowNo+'"" style="display:block;width:auto;height:auto"><div  style="    width: 50%;float: left;" ><label>'+VIS.Msg.getMsg("VA012_ChargeType")+'<\/label><div  id="VA012_ChargeSrch_'+$self.windowNo+'"><\/div><\/div><div ><label>'+VIS.Msg.getMsg("VA012_Taxrate")+'<\/label><select  id="VA012_cmbTaxRate_'+$self.windowNo+'"><\/select><\/div><div style="width:auto;height:270px" id="VA012_gridMatchState_'+$self.windowNo+'""><\/div><\/div>'),fs=bf.find("#VA012_gridMatchState_"+$self.windowNo),ko=bf.find("#VA012_ChargeSrch_"+$self.windowNo),es=bf.find("#VA012_cmbTaxRate_"+$self.windowNo),_ChargeLookUp=VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(),$self.windowNo,3787,VIS.DisplayType.Search),$ChargeControl=new VIS.Controls.VTextBoxButton("C_Charge_ID",!0,!1,!0,VIS.DisplayType.Search,_ChargeLookUp),ko.append($ChargeControl.getControl().css("width","93%")).append($ChargeControl.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")),divTable.append(tableTr),_formDesign.append(divContainer).append(divTable),_formDesign},setBankAndAccount:function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/SetBankAndAccount",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n!=null&&($self.FormInfo!=undefined&&$self.FormInfo!=null?(cf=parseInt($self.FormInfo[0]),hf=parseInt($self.FormInfo[1])):(cf=n.Table[0].C_BANK_ID,hf=n.Table[0].C_BANKACCOUNT_ID)));v.loadBank()}})},addEffect:function(n,t,i){var r={to:t,className:"wsp-ui-effects-transfer"};n.effect("transfer",r,600,i)},setInvoiceAndBPartner:function(n,i){t.ajax({url:VIS.Application.contextUrl+"BankStatement/SetInvoiceAndBPartner",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_paymentID:n,_cmbTransactionType:i},success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),i=="PY"?(n._invoiceID>0?ni.setValue(n._invoiceID,!1,!0):ni.setValue(),n._bPartnerID>0?st.setValue(n._bPartnerID,!1,!0):st.setValue(),n.count==1&&n.VA034_DepositSlipNo!=""&&wr.val(n.VA034_DepositSlipNo)):i=="PO"?st.value||st.setValue(n._bPartnerID,!1,!0):i=="IS"&&(st.value||st.setValue(n._bPartnerID,!1,!0)))}})},setBPartner:function(n){t.ajax({url:VIS.Application.contextUrl+"BankStatement/SetBPartner",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_invoiceID:n},success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n>0?st.setValue(n,!1,!0):st.setValue())}})},getMaxStatement:function(n){h.val()>0?t.ajax({url:VIS.Application.contextUrl+"BankStatement/MaxStatement",type:"GET",datatype:"json",data:{_bankAccount:h.val()==null?0:h.val(),_origin:n,_pageNo:0},contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),dt.val(n.statementNo),si.val(n.pageno),ur.val(n.lineno))}}):(dt.val("0"),si.val("0"),ur.val("0"))},getOverUnderPayment:function(n){t.ajax({url:VIS.Application.contextUrl+"BankStatement/getOverUnderPayment",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_paymentID:n},success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),n._difference!=0&&(w.setValue(VIS.Utility.Util.getValueOfDecimal(Math.abs(n._difference))),pi.find("*").prop("disabled",!1),k.val(n._differenceType).prop("selected",!0),w.getControl().attr("vchangable","N"),y.val()=="M"&&l.setValue(VIS.Utility.Util.getValueOfDecimal(n._payamt.toFixed(b)))))}})},getControls:function(){ir=s.find("#VA012_cmbBank_"+$self.windowNo);h=s.find("#VA012_cmbBankAccount_"+$self.windowNo);ne=s.find("#VA012_STAT_cmbBankAccountClassName_"+$self.windowNo);vt=s.find("#VA012_statementDate_"+$self.windowNo);yo=s.find("#VA012_BankChargeDiv"+$self.windowNo);wt=s.find("#VA012_cmbSearchPaymentMethod_"+$self.windowNo);ct=s.find("#VA012_cmbTransactionType_"+$self.windowNo);ve=s.find("#VA012_btnLoadStatement_"+$self.windowNo);ye=s.find("#VA012_btnMatchStatement_"+$self.windowNo);yt=s.find("#VA012_lstStatement_"+$self.windowNo);oi=s.find("#VA012_lstPayments_"+$self.windowNo);te=s.find("#VA012_paymentList_"+$self.windowNo);du=s.find("#VA012_secReconciled_"+$self.windowNo);gu=s.find("#VA012_secUnreconciled_"+$self.windowNo);ai=s.find("#VA012_txtSearch_"+$self.windowNo);uo=s.find("#VA012_btnSearch_"+$self.windowNo);pe=s.find("#VA012_btnUnmatch_"+$self.windowNo);ce=s.find("#VA012_DropDown_"+$self.windowNo);of=ce.val();we=s.find("#VA012_btnProcess_"+$self.windowNo);be=s.find("#VA012_btnHide_"+$self.windowNo);ie=s.find("#VA012_tdLeft_"+$self.windowNo);re=s.find("#VA012_table_"+$self.windowNo);gi=s.find("#VA012_btnMore_"+$self.windowNo);wo=s.find("#VA012_divMore_"+$self.windowNo);dr=s.find("#VA012_divContraType_"+$self.windowNo);ru=s.find("#VA012_divCashBook_"+$self.windowNo);_divCtrlCashLine=s.find("#VA012_divCtrlCashLine_"+$self.windowNo);gr=s.find("#VA012_divTransferType_"+$self.windowNo);uu=s.find("#VA012_divCheckNo_"+$self.windowNo);yi=s.find("#VA012_divVoucherNo_"+$self.windowNo);po=s.find("#VA012_divTrxAmt_"+$self.windowNo);rf=s.find("#VA012_divDifference_"+$self.windowNo);pi=s.find("#VA012_divDifferenceType_"+$self.windowNo);hi=s.find("#VA012_divCharge_"+$self.windowNo);ro=s.find("#VA012_btnCharge_"+$self.windowNo);ui=s.find("#VA012_divTaxRate_"+$self.windowNo);wi=s.find("#VA012_divTaxAmount_"+$self.windowNo);fr=s.find("#VA012_divCtrlPayment_"+$self.windowNo);er=s.find("#VA012_divCtrlInvoice_"+$self.windowNo);yr=s.find("#VA012_divCtrlBusinessPartner_"+$self.windowNo);or=s.find("#VA012_divPrepayOrder_"+$self.windowNo);nu=s.find("#VA012_divPaymentSchedule_"+$self.windowNo);_divPaymentMethod=s.find("#VA012_divPaymentMethod_"+$self.windowNo);tu=s.find("#VA012_divCheckNum_"+$self.windowNo);sr=s.find("#VA012_divCheckDate_"+$self.windowNo);_txtSearchPayment=s.find("#VA012_txtSearch_Payment_"+$self.windowNo);_btnSearchPayment=s.find("#VA012_btnSearch_Payment_"+$self.windowNo);fu=s.find("#VA012_divTrxOrg_"+$self.windowNo)},getBaseCurrency:function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetBaseCurrency",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),sf=n._code,ao=n._id,t(".va012-base-curr").text(sf))}})},loadBank:function(){function n(n){if(ir.html(""),ir.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)ir.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].Value)+">"+n[t].Name+"<\/option>");ir.prop("selectedIndex",0);cf>0&&(ir.val(cf).prop("selected",!0),cf=0);v.loadBankAccount()}t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetBank",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",success:function(i){i!=null&&i!=""&&(_ds=t.parseJSON(i),n(_ds))}})},loadBankAccount:function(){function n(n){if(h.html(""),h.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)h.append("<option orgid="+VIS.Utility.Util.getValueOfInt(n[t].OrgId)+" stdprecision="+VIS.Utility.Util.getValueOfInt(n[t].StdPrecision)+" currencyid="+VIS.Utility.Util.getValueOfInt(n[t].CurrencyId)+" value="+VIS.Utility.Util.getValueOfInt(n[t].BankAccountId)+" accounttype="+VIS.Utility.Util.getValueOfString(n[t].AccountType)+">"+VIS.Utility.encodeText(n[t].AccountNo)+"<\/option>");h.prop("selectedIndex",0);hf>0&&(h.val(hf).prop("selected",!0),hf=0);$self.FormInfo!=undefined&&$self.FormInfo!=null&&(vt.val($self.FormInfo[2]),vt.trigger("change"),$self.FormInfo=null);v.getMaxStatement("LO");v.loadSearchPaymentMethod()}t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetBankAccount",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{bankId:ir.val()},success:function(i){i!=null&&i!=""&&(i=t.parseJSON(i),n(i))}})},SetBankAccountOrganizationInContext:function(n){VIS.Env.getCtx().setContext($self.windowNo,"BankAccount_Org_ID",n)},LoadPaymentsPages:function(n,i,r){lr=ai.val()!=null&&ai.val()!=""?!0:!1;t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadPaymentsPages",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_accountID:n,_paymentPageNo:bi,_PAGESIZE:de,_paymentMethodID:i,_transactionType:r,businessPartnerId:pu.value,txtSearch:_txtSearchPayment.val()},success:function(n){n!=null&&n!=""&&(pf=JSON.parse(n))}})},loadPayments:function(n,i,r,u){function e(n){var u,i,f,e;if(n=t.parseJSON(n),n.length>0&&(storepaymentdata=storepaymentdata.concat(n)),n=storepaymentdata,u="",oi.html(""),n!=null&&n.length>0)for(i=0;i<n.length;i++)f=new Date(n[i].DateAcct).toLocaleDateString(),e="va012-red-color",e=n[i].c_bankstatementline_id==null||n[i].c_bankstatementline_id=="0"||n[i].c_bankstatementline_id==0?"va012-red-color":"va012-green-color",u="",u='<div class="drag-no-drag"><div draggable="true" class="va012-mid-data-wrap ',(r=="PY"||r=="CO")&&(u+=e),u+=' " paymentdata="'+VIS.Utility.encodeText(new Date(n[i].DueDate).toLocaleDateString())+"_"+VIS.Utility.encodeText(n[i].DueAmt)+'" data-uid="'+n[i].c_payment_id,u+=' " paymentamount = " '+VIS.Utility.Util.getValueOfDecimal(n[i].convertedamount,"N")+'" paymentmethodid="'+VIS.Utility.Util.getValueOfInt(n[i].PaymentMethodId)+'" paymentbasetype="'+VIS.Utility.Util.getValueOfString(n[i].PaymentBaseType)+'"><div class="va012-payment-wrap" ><div class="row"> <div class="col-md-3 col-sm-3">    <div class="va012-form-check">        <input type="checkbox" data-uid="'+n[i].c_payment_id+'" class="va012-payment-chkBox">    <div title="'+VIS.Msg.getMsg("VA012_PaymentAmount")+'" class="va012-inside-form-check" style=" float: left; width: 85%; ">      <span style=" width: 100%;" class="va012-statementamount"><span class="va012-currency ">'+n[i].currency+"<\/span> "+parseFloat(n[i].paymentamount).toLocaleString(navigator.language,{minimumFractionDigits:b,maximumFractionDigits:b})+"<\/span>",n[i].isconverted=="Y"&&(u+="      <span>"+n[i].basecurrency+" "+parseFloat(n[i].convertedamount).toLocaleString(navigator.language,{minimumFractionDigits:b,maximumFractionDigits:b})+"<\/span>"),u+='   <\/div><\/div>    <!-- end of form-group -->  <\/div>  <!-- end of col -->  <div class="col-md-4 col-sm-4">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Business Partner">'+VIS.Utility.encodeText(n[i].businesspartner)+'<\/p>         <span title="'+VIS.Msg.getMsg("VA012_InvReference")+'">'+VIS.Utility.encodeText(n[i].bpgroup)+'<\/span>       <span title="Document No.">'+VIS.Utility.encodeText(n[i].paymentno)+'<\/span>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col --> <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text"><p title="Payment Type">'+VIS.Utility.encodeText(n[i].paymenttype)+"<\/p><\/div><\/div><!-- end of form-group --><\/div><!-- end of col -->",u+=r=="PY"&&co>0?'  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Deposit Slip No">'+VIS.Utility.encodeText(n[i].depositslipno)+'<\/p>           <p title="Authentication Code">'+VIS.Utility.encodeText(n[i].authcode)+'<\/p>           <p title="Account Date">'+f+'<\/p>           <p title="Payment Method">'+n[i].PaymentMethod+"<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->":'  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Authentication Code">'+VIS.Utility.encodeText(n[i].authcode)+'<\/p>           <p title="Account Date">'+f+'<\/p>           <p title="Payment Method">'+n[i].PaymentMethod+"<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->",u+="<\/div><!-- end of row --><\/div> <!-- end of payment-wrap --><\/div> <!-- end of mid-data-wrap -->",oi.append(u);_sql=null;v.setPaymentListHeight();v.dragPayments()}if(n>0){lt(t(te),!0,"inherit");var f=hs();window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadPayments",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_accountID:n,_paymentPageNo:bi,_PAGESIZE:ke,_paymentMethodID:i,_transactionType:r,statementDate:u==null||u==""?new Date:u,businessPartnerId:pu.value,txtSearch:f},success:function(n){n!=null&&n!=""&&(e(n),lt(t(te),!1,"inherit"))},error:function(){lt(t(te),!1,"inherit")}})},2)}},setPaymentListHeight:function(){var n;clearTimeout(n);n=setTimeout(function(){t("#VA012-content-area"+$self.windowNo).height(t("#VA012_mainContainer_"+$self.windowNo).height()-20);kt.attr("activestatus")=="1"?t("#VA012_paymentList_"+$self.windowNo).height(t("#VA012_middleWrap_"+$self.windowNo).height()-t("#VA012_formBtnNewRecord_"+$self.windowNo).height()-t("#VA012_formNewRecord_"+$self.windowNo).height()-t("#VA012_paymentHeaderWrap_"+$self.windowNo).height()-42):t("#VA012_paymentList_"+$self.windowNo).height(t("#VA012_middleWrap_"+$self.windowNo).height()-t("#VA012_formBtnNewRecord_"+$self.windowNo).height()-t("#VA012_paymentHeaderWrap_"+$self.windowNo).height()-27)},2)},loadSearchPaymentMethod:function(){function n(n){if(wu=n,wt.html(""),wt.append("<option value=0 >"+VIS.Msg.getMsg("VA012_SelectPaymentMethod")+"<\/option>"),n!=null)for(var t=0;t<n.length;t++)wt.append("<option value="+n[t].chargeID+">"+VIS.Utility.encodeText(n[t].name)+"<\/option>");wt.prop("selectedIndex",0);h.trigger("change")}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetPaymentMethods",{BankOrgId:VIS.Utility.Util.getValueOfInt(t("option:selected",h).attr("orgid"))},n)},paymentScroll:function(){pf=0;t(this).scrollTop()+t(this).innerHeight()+2>=this.scrollHeight&&(v.LoadPaymentsPages(h.val(),wt.val(),ct.val()),bi<pf&&(ge&&bi!=1?(bi=1,ge=!1):bi++,v.loadPayments(h.val(),wt.val(),ct.val(),vt.val())))},statementScroll:function(){fo=0;t(this).scrollTop()>0&&t(this).scrollTop()+t(this).innerHeight()+1>=this.scrollHeight&&(tt.LoadStatementsPages(),vi<fo&&(vi++,tt.loadStatement(li)))},dragPayments:function(){oi.find(".va012-mid-data-wrap").draggable({start:function(n,t){t.helper.addClass("va012-dragging")},drag:function(){},stop:function(n,t){t.helper.removeClass("va012-dragging")},cursor:"move",cursorAt:{left:5},revert:"invalid",helper:"clone"})},dropPayments:function(){yt.find(".va012-right-data-wrap").droppable({hoverClass:"va012-dropping",drop:function(n,s){var a,g,h,c,w,k,y;if(t(s.draggable).data("uid")>0&&t(this).data("uid")>0){if(ct.val()=="PY"){if(a=t(s.draggable).data("uid"),t(s.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_PaymentAlreadyMatchedOthrStatement",null,"","");return}tr=VIS.Utility.Util.getValueOfString(t(s.draggable).attr("paymentbasetype"));eu=VIS.Utility.Util.getValueOfInt(t(s.draggable).attr("paymentmethodid"));y=t(this).data("uid");v.checkPaymentCondition(t(s.draggable).data("uid"),t(this).data("uid"),r(i.getControl().val()))&&(tt.statementOpenEdit(t(this).data("uid"),a),window.setTimeout(function(){if(r(l.getControl().val())==0){var n=nt.val();u.refreshForm();nt.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}nt.attr("readonly",!0);ri=!0;rt.setValue(a,!1,!0);p.val()>0?p.attr("disabled",!0):p.attr("disabled",!1);v.setInvoiceAndBPartner(t(s.draggable).data("uid"),"PY");ri=!1},500))}else if(ct.val()=="IS"){if(g=t(s.draggable).data("uid"),parseInt(f.attr("data-uid"))!=t(this).data("uid")&&u.scheduleRefresh(),tr=VIS.Utility.Util.getValueOfString(t(s.draggable).attr("paymentbasetype")),eu=VIS.Utility.Util.getValueOfInt(t(s.draggable).attr("paymentmethodid")),v.checkScheduleCondition(t(s.draggable).data("uid"),t(this).data("uid"),d.toString(),r(i.getControl().val()))){if(ae(parseInt(t(s.draggable).data("uid")),d))VIS.ADialog.info("VA012_AlreadySelected",null,"","");else if(d.push(parseInt(t(s.draggable).data("uid"))),di.push(t(s.draggable).attr("paymentdata")),pt.push(t(s.draggable).attr("paymentamount")),Number(pt[0])=="0"){for(h=0,c=0;c<pt.length;c++)h+=VIS.Utility.Util.getValueOfDecimal(pt[c]);h<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"));i.setValue(VIS.Utility.Util.getValueOfDecimal(h.toFixed(b)))}ri=!0;tt.statementOpenEdit(t(this).data("uid"),g);rr.val(di.toString());window.setTimeout(function(){if(r(l.getControl().val())==0){var n=nt.val();u.refreshForm();u.scheduleRefresh();nt.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}v.setInvoiceAndBPartner(t(s.draggable).data("uid"),"IS");nt.attr("readonly",!0);pt.length==1&&(pt[0]=VIS.Utility.Util.getValueOfString(r(l.getControl().val())));l.getControl().trigger("blur",[r(i.getControl().val()),r(l.getControl().val())])},500)}}else ct.val()=="PO"&&(w=t(s.draggable).data("uid"),parseInt(f.attr("data-uid"))!=t(this).data("uid")&&u.prepayRefresh(),tr=VIS.Utility.Util.getValueOfString(t(s.draggable).attr("paymentbasetype")),eu=VIS.Utility.Util.getValueOfInt(t(s.draggable).attr("paymentmethodid")),v.checkPrepayCondition(t(s.draggable).data("uid"),t(this).data("uid"),au.toString(),r(i.getControl().val()))&&(tt.statementOpenEdit(t(this).data("uid"),w),window.setTimeout(function(){if(r(l.getControl().val())==0){var n=nt.val();u.refreshForm();u.prepayRefresh();nt.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}nt.attr("readonly",!0);ri=!0;ht.setValue(w,!1,!0);ri=!1;v.setInvoiceAndBPartner(t(s.draggable).data("uid"),"PO")},500)));if(ct.val()=="CO"){if(k=t(s.draggable).data("uid"),t(s.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_CashLineAlreadyMatchedOthrStmt",null,"","");return}tr=VIS.Utility.Util.getValueOfString(t(s.draggable).attr("paymentbasetype"));eu=VIS.Utility.Util.getValueOfInt(t(s.draggable).attr("paymentmethodid"));y=t(this).data("uid");v.checkContraCondition(t(s.draggable).data("uid"),t(this).data("uid"),r(i.getControl().val()))&&(tt.statementOpenEdit(y,k),window.setTimeout(function(){if(r(l.getControl().val())==0){var n=nt.val();u.refreshForm();nt.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}nt.attr("readonly",!0);ri=!0;ot.setValue(k,!1,!0);ri=!1},500))}}}});f.droppable({hoverClass:"va012-dropping",drop:function(n,u){var f,w,s,c,k,p,g;if(t(u.draggable).data("uid")>0){if(tr=VIS.Utility.Util.getValueOfString(t(u.draggable).attr("paymentbasetype")),eu=VIS.Utility.Util.getValueOfInt(t(u.draggable).attr("paymentmethodid")),ct.val()=="CO")if(y.val()=="C"){if(et.val()!="CB"){VIS.ADialog.info("VA012_ContraSelectCashToBank",null,"","");return}}else{VIS.ADialog.info("VA012_SelectVoucherContra",null,"","");return}else if(y.val()!="M"){VIS.ADialog.info("VA012_SelectVoucherPayment",null,"","");return}if(ct.val()=="PY"){if(t(u.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_PaymentAlreadyMatchedOthrStatement",null,"","");return}if(t(u.draggable).data("uid")>0)if(VIS.Utility.Util.getValueOfInt(fi)==0)rt.setValue(t(u.draggable).data("uid"),!1,!0);else{VIS.Utility.Util.getValueOfInt(fi)==VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid"))?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"","");return}}if(ct.val()=="IS"&&v.checkScheduleCondition(t(u.draggable).data("uid"),t(this).attr("data-uid"),"",r(i.getControl().val()))){if(s=0,ae(parseInt(t(u.draggable).data("uid")),d)){VIS.ADialog.info("VA012_AlreadySelected",null,"","");return}if(f=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetConvtAmount",{recordID:parseInt(t(u.draggable).data("uid")),bnkAct_Id:h.val(),transcType:ct.val(),stmtDate:nt.val()}),f.length==0||f[0].DueAmount==0){VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}if(w=t(this).attr("data-uid"),d.push(parseInt(t(u.draggable).data("uid"))),di.push(t(u.draggable).attr("paymentdata")),pt.push(f[0].DueAmount),s=0,Number(pt.length)>0)for(c=0;c<pt.length;c++)s+=VIS.Utility.Util.getValueOfDecimal(pt[c]);s<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),s>0&&i.getControl().removeClass("va012-mandatory"));w==0?i.setValue(VIS.Utility.Util.getValueOfDecimal(s.toFixed(b))):nt.attr("readonly",!0);v.setInvoiceAndBPartner(t(u.draggable).data("uid"),"IS");!hr&&ki?(t(a[0]).children("option").each(function(){t(this).attr("paymentbasetype")=="S"?t(this).show():t(this).hide()}),k=a.val(),k=="0"?tr=="S"&&(a.val(f[0]._paymentMethod_Id).prop("selected",!0),a.removeClass("va012-mandatory")):(p=VIS.Utility.Util.getValueOfString(t("option:selected",a).attr("paymentbasetype")),p=="S"?tr==p&&(a.val(f[0]._paymentMethod_Id).prop("selected",!0),a.removeClass("va012-mandatory")):(a.val(0).prop("selected",!0),a.attr("disabled",!1),a.addClass("va012-mandatory")))):f[0]._paymentMethod_Id?a.val(f[0]._paymentMethod_Id).prop("selected",!0):a.val(0).prop("selected",!0);ki||a.trigger("change");rr.val(di.toString());l.setValue(VIS.Utility.Util.getValueOfDecimal(s.toFixed(b)));l.getControl().trigger("blur",[r(i.getControl().val()),r(l.getControl().val())]);g=d!=null?d.toString():null;df(g)}if(ct.val()=="PO"){if(VIS.Utility.Util.getValueOfInt(gt)!=0){VIS.Utility.Util.getValueOfInt(gt)==VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid"))?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"","");return}ht.setValue(t(u.draggable).data("uid"),!1,!0)}if(ct.val()=="CO"&&t(u.draggable).data("uid")>0){if(t(u.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_CashLineAlreadyMatchedOthrStmt",null,"","");return}if(VIS.Utility.Util.getValueOfInt(ci)!=0){VIS.Utility.Util.getValueOfInt(ci)==VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid"))?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"","");return}if(v.checkContraCondition(t(u.draggable).data("uid"),t(this).attr("data-uid"),r(i.getControl().val()))){if(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))==0){VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}l.setValue(r(i.getControl().val()));i.getControl().trigger("blur",[r(i.getControl().val()),r(l.getControl().val())]);ot.setValue(t(u.draggable).data("uid"),!1,!0)}}}ri=!1}})},checkFormPaymentCondition:function(n,u){var f=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckFormPaymentCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_paymentID:n,_amount:u},success:function(n){n=t.parseJSON(n);n._status=="Success"?(f=!0,n._amount!=null&&n._amount!=0&&(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(b))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0")))):(VIS.ADialog.info(n._status,null,"",""),f=!1)},error:function(){VIS.ADialog.info("error",null,"","");f=!1}}),f},checkFormPrepayCondition:function(n,u){var s=0,f;return st.value&&(s=st.value),f=!1,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckFormPrepayCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_orderID:n,_amount:u,_currencyId:at,_formBPartnerID:s},success:function(n){n=t.parseJSON(n);n._status=="Success"?(f=!0,n._amount>0&&(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(b))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0")))):(VIS.ADialog.info(n._status,null,"",""),f=!1)},error:function(){VIS.ADialog.info("error",null,"","");f=!1}}),f},checkInvoiceCondition:function(n,i){var r=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckInvoiceCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_invoiceID:n,_amount:i},success:function(n){n=t.parseJSON(n);n=="Success"?r=!0:(VIS.ADialog.info(n,null,"",""),r=!1)},error:function(){VIS.ADialog.info("error",null,"","");r=!1}}),r},checkPaymentCondition:function(n,s,v){var y=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckPaymentCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:s,_amount:v,statmtDate:nt.val(),accountID:h.val()},success:function(n){if(n=t.parseJSON(n),n._status=="Success")if(y=!0,n._amount!=null&&n._amount!=0){if(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(b))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"),i.getControl().addClass("va012-mandatory"),l.getControl().addClass("va012-mandatory")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),i.getControl().removeClass("va012-mandatory"),l.getControl().removeClass("va012-mandatory")),l.setValue(VIS.Utility.Util.getValueOfDecimal(n._trxamount.toFixed(b))),n._currency_Id!=0&&VIS.Utility.Util.getValueOfString(rt.value)!=null){c.val(at).prop("selected",!0);for(var h=0;c[0].length>h;h++)VIS.Utility.Util.getValueOfInt(c[0][h].value)==at?t(c[0][h]).show():t(c[0][h]).hide();c.removeClass("va012-mandatory");c.attr("disabled",!1);t(p[0][0]).hide();p.val(n._conversionType_Id).prop("selected",!0);p.attr("disabled",!0)}else c.val(at).prop("selected",!0),c.attr("disabled",!0),c.removeClass("va012-mandatory"),p.val(n._conversionType_Id).prop("selected",!0);p.trigger("change");n._paymentMethod_Id?(a.val(n._paymentMethod_Id).prop("selected",!0),a.attr("disabled",!0),a.removeClass("va012-mandatory")):a.addClass("va012-mandatory");n._checkNo&&(tu.show(),g.val(n._checkNo),g.attr("disabled",!0),g.removeClass("va012-mandatory"));n._checkDate&&(sr.show(),ft.val(Globalize.format(new Date(n._checkDate),"yyyy-MM-dd")),ft.attr("disabled",!0),ft.removeClass("va012-mandatory"))}else if(n._checkNo&&VIS.Utility.Util.getValueOfString(g.val()).equals("")&&(tu.show(),g.val(n._checkNo),g.attr("disabled",!1),g.removeClass("va012-mandatory")),s==0&&v!=0){if(f[0].attributes["data-uid"].value>0&&(s=f[0].attributes["data-uid"].value),rt!=null&&rt.value>0&&s>0)return tt.statementListRecordEdit(s,rt.value,!0),nt.attr("readonly",!0),y=!0}else s==0&&(u.refreshForm(),VIS.ADialog.info("VA012_ConversionRateNotFound",null,"",""),y=!1);else VIS.ADialog.info(n._status,null,"",""),y=!1},error:function(){VIS.ADialog.info("error",null,"","");y=!1}}),y},checkScheduleCondition:function(n,i,r,u){var e,f;if(at==null||at==0){VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"","");return}return e=0,st.value&&(e=st.value),f=!1,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckScheduleCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:i,_listToCheck:r,_amount:u,_currencyId:at,_formBPartnerID:e},success:function(n){n=t.parseJSON(n);n=="Success"?f=!0:(VIS.ADialog.info(n,null,"",""),f=!1)},error:function(){VIS.ADialog.info("error",null,"","");f=!1}}),f},checkScheduleTotal:function(n,i,r){var u=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckScheduleTotal",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_listToCheck:n,_amount:i,_currencyId:at,_destinationID:r},success:function(n){n=t.parseJSON(n);n=="Success"?u=!0:(VIS.ADialog.info(n,null,"",""),u=!1)},error:function(){VIS.ADialog.info("error",null,"","");u=!1}}),u},checkPrepayCondition:function(n,u,s,h){var v=0,l,y;return st.value&&(v=st.value),l=!1,y=u,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckPrepayCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:u,_listToCheck:s,_amount:h,_currencyId:at,_formBPartnerID:v,stateDate:nt.val()},success:function(s){if(s=t.parseJSON(s),s._status=="Success")if(l=!0,s._amount!=0){if(i.setValue(VIS.Utility.Util.getValueOfDecimal(s._amount.toFixed(b))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),r(i.getControl().val())>0&&i.getControl().removeClass("va012-mandatory")),s._currency_Id!=0&&VIS.Utility.Util.getValueOfString(ht.value)!=null){c.val(at).prop("selected",!0);for(var v=0;c[0].length>v;v++)VIS.Utility.Util.getValueOfInt(c[0][v].value)==at?t(c[0][v]).show():t(c[0][v]).hide();c.removeClass("va012-mandatory");c.attr("disabled",!1);t(p[0][0]).hide();p.val(s._conversionType_Id).prop("selected",!0);p.attr("disabled",!1)}else c.val(at).prop("selected",!0),c.attr("disabled",!0),c.removeClass("va012-mandatory"),p.val(s._conversionType_Id).prop("selected",!0);p.trigger("change");s._paymentMethod_Id?(a.val(s._paymentMethod_Id).prop("selected",!0),a.attr("disabled",!1)):(a.val(0).prop("selected",!0),a.attr("disabled",!1));a.trigger("change")}else{if(u==0&&h!=0&&(f[0].attributes["data-uid"].value>0&&(u=f[0].attributes["data-uid"].value),n>0&&u>0))return tt.statementListRecordEdit(u,n,!0),nt.attr("readonly",!0),l=!0;l=y>0?!0:!1}else VIS.ADialog.info(s._status,null,"",""),l=!1},error:function(){VIS.ADialog.info("error",null,"","");l=!1}}),l},checkContraCondition:function(n,u,s){var l=0,h;return st.value&&(l=st.value),h=!1,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckContraCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:u,_amount:s,_currencyId:at,_formBPartnerID:l,stateDate:nt.val()},success:function(l){if(l=t.parseJSON(l),l._status=="Success")if(h=!0,i.setValue(VIS.Utility.Util.getValueOfDecimal(l._amount.toFixed(b))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),r(i.getControl().val())>0&&i.getControl().removeClass("va012-mandatory")),l._amount!=0&&VIS.Utility.Util.getValueOfString(ot.value)!=null){c.val(at).prop("selected",!0);for(var a=0;c[0].length>a;a++)VIS.Utility.Util.getValueOfInt(c[0][a].value)==at?t(c[0][a]).show():t(c[0][a]).hide();if(c.removeClass("va012-mandatory"),c.attr("disabled",!1),t(p[0][0]).hide(),p.val(l._conversionType_Id).prop("selected",!0),p.removeClass("va012-mandatory"),p.attr("disabled",!0),u==0&&s!=0&&(f[0].attributes["data-uid"].value>0&&(u=f[0].attributes["data-uid"].value),n>0&&u>0))return tt.statementOpenEdit(u,n),nt.attr("readonly",!0),h=!0}else VIS.Utility.Util.getValueOfInt(u)>0?h=!0:(VIS.ADialog.info("VA012_ConversionRateNotFound",null,"",""),h=!1);else VIS.ADialog.info(l._status,null,"",""),h=!1},error:function(){VIS.ADialog.info("error",null,"","");h=!1}}),h},matchByDrag:function(n,u){var f=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/MatchByDrag",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragPaymentID:n,_dragStatementID:u},success:function(n){n=t.parseJSON(n);n._status=="Success"?(f=!0,n._amount!=null&&n._amount!=0&&(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(b))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0")),it.trigger("focus"))):(VIS.ADialog.info(n._status,null,"",""),f=!1)},error:function(){VIS.ADialog.info("error",null,"","");f=!1}}),f},loadAndResetPaymentData:function(){oi.html("");bi=1;pf=0;de=50;vo=1;storepaymentdata=[];v.loadPayments(h.val()==null?0:h.val(),wt.val(),ct.val(),vt.val())}};this.vetoablechange=function(n){if(n.propertyName=="VA012_txtDifference_"+$self.windowNo+"")w.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(b)));else if(n.propertyName=="VA012_txtTaxAmount_"+$self.windowNo+"")bt.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(b)));else if(n.propertyName=="VA012_txtTrxAmt_"+$self.windowNo+"")l.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(b)));else if(n.propertyName=="VA012_txtAmount_"+$self.windowNo+""){var t=r(i.getControl().val());i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(t).toFixed(b)))}};tt={statementDialog:function(){function b(){c=$statement.find("#VA012_STAT_cmbBank_"+$self.windowNo);r=$statement.find("#VA012_STAT_cmbBankAccount_"+$self.windowNo);e=$statement.find("#VA012_STAT_cmbBankAccountClassName_"+$self.windowNo);v=$statement.find("#VA012_STAT_statementDate_"+$self.windowNo);y=$statement.find("#VA012_CheckBox_"+$self.windowNo);l=$statement.find("#VA012_STAT_txtStatementNo_"+$self.windowNo);o=$statement.find("#VA012_ctrlLoadFile_"+$self.windowNo);STAT_ctrlLoadFileTxt=$statement.find("#VA012_ctrlLoadFileTxt_"+$self.windowNo);_tabFile=$statement.find("#VA012_STAT_tabFile_"+$self.windowNo);_tabSchedule=$statement.find("#VA012_STAT_tabSchedule_"+$self.windowNo);ne=$statement.find("#VA012_STAT_cmbBankAccountClassName_"+$self.windowNo)}function k(){c.html("");c.append("<option value="+ir.val()+">"+ir.children()[ir[0].selectedIndex].text+"<\/option>");c.prop("selectedIndex",0)}function d(){r.html("");r.append("<option value="+h.val()+">"+h.children()[h[0].selectedIndex].text+"<\/option>");r.prop("selectedIndex",0)}function g(){function n(n){if(e.html(""),e.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)e.append("<option value="+n[t].Value+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");e.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetBankAccountClasses",{_cmbBankAccount:h.val()},n)}function nt(){function n(n){n!=null&&(p=VIS.Utility.Util.getValueOfInt(n[0].chargeID))}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetBankCharge",null,n)}function it(){a=null;$statement=null;c=null;r=null;l=null;o=null;STAT_ctrlLoadFileTxt=null;_tabSchedule=null;_tabFile=null;i=null}var c=null,r=null,e=null,v=null,y=null,p=null,w=h.children()[h[0].selectedIndex].getAttribute("accounttype"),l=null,o=null,i=null,a,f;$statement=t("<div class='va012-popform-content'>");a="";a="<div><div class='va012-left-btn'><a id='VA012_STAT_tabFile_"+$self.windowNo+"' class='btn va012-blueBtn' activestatus='1'>"+VIS.Msg.getMsg("VA012_File")+"<\/a><\/div><\/div><div style='border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left;'><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_Bank")+"<\/label><select id='VA012_STAT_cmbBank_"+$self.windowNo+"' class='vis-ev-col-readonly' disabled><\/select><\/div> <div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_BankAccount")+"<\/label><select id='VA012_STAT_cmbBankAccount_"+$self.windowNo+"' class='vis-ev-col-readonly' disabled><\/select><\/div><div class=va012-popform-data><label id=VA012_STAT_lblStatementDate_"+$self.windowNo+">"+VIS.Msg.getMsg("VA012_StatementDate")+'<\/label><input type=date max="9999-12-31" class=vis-ev-col-readonly disabled id=VA012_STAT_statementDate_'+$self.windowNo+"><\/div><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_ClassName")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_STAT_cmbBankAccountClassName_'+$self.windowNo+"'><\/select><\/div><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_StatementNumber")+"<sup style=\"color: red;\">*<\/sup><\/label><input type='text' id='VA012_STAT_txtStatementNo_"+$self.windowNo+"' /> <\/div><div class='va012-popform-data va012-pop-file'><label>"+VIS.Msg.getMsg("VA012_SelectFile")+"<sup style=\"color: red;\">*<\/sup><\/label><input type='text' id='VA012_ctrlLoadFileTxt_"+$self.windowNo+"' disabled><div class='va012-file-upload'><label for='file-input' class='va012-file-label'>"+VIS.Msg.getMsg("VA012_Browse")+"<\/label><input id='VA012_ctrlLoadFile_"+$self.windowNo+"' type='file' accept='.csv,text/plain,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel'/><\/div><\/div><div class='VA012-checkbox-div "+w+"'> <input type='checkbox' value='checked' id='VA012_CheckBox_"+$self.windowNo+"'><label class='VA012-StatementDateAsAccountDate'>"+VIS.Msg.getMsg("VA012_StatementDateAsAccountDate")+"<\/label><\/div><\/div>";$statement.append(a);b();k();d();g();v.val(Globalize.format(vt.val(),"yyyy-MM-dd"));nt();f=new VIS.ChildDialog;f.setContent($statement);f.setTitle(VIS.Msg.getMsg("VA012_LoadStatement"));f.setWidth("500px");f.setEnableResize(!1);f.setModal(!0);f.show();o.on("change",function(){var u=this;r.val()!=null&&r.val()>0?(i=t.parseJSON(n.UploadExcel(u,null,null)),STAT_ctrlLoadFileTxt.val(i._orgfilename)):(o=null,VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"",""))});f.onOkClick=function(){if(ai.val(""),_tabFile.attr("activestatus")=="1"){if(r.val()==null||r.val()==""||r.val()=="0")return VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"",""),!1;if(e.val()==null||e.val()==""||e.val()=="0")return VIS.ADialog.info("VA012_PleaseSelectClassFirst",null,"",""),!1;if(l.val()==null||l.val()=="")return VIS.ADialog.info("VA012_PleaseEnterStatementNo",null,"",""),!1;if(o.val()==""==null||o.val()=="")return VIS.ADialog.info("VA012_SelectFileFirst",null,"",""),!1;if(i!=null){if(i._filename==null||i._filename==""||i._path==null||i._path==""){VIS.ADialog.info("VA012_ErrorInGettingFile",null,"","");return}if(i._error!=null&&i._error!=""){VIS.ADialog.info(i._error,null,"","");return}var n=i._path,f=i._filename,h=r.val(),c=l.val(),k=$statement,a=y.is(":checked"),w=e.val(),b=p;lt(s,!0,"absolute");window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/ImportStatement",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_path:n,_filename:f,_bankaccount:h,_bankAccountCurrency:at,_statementno:c,_statementClassName:w,_statementCharges:b,statementDate:v.val(),IsStatementDateAsAccountDate:a},success:function(n){li=n._statementID;li!=null&&li!=""?(ti=[],yt.html(""),vi=1,lt(s,!1,"absolute"),ei=[],tt.loadStatement(li),u.refreshForm(),lu(!1)):n._error!=null&&n._error!=""&&(lt(s,!1,"absolute"),VIS.ADialog.info(n._error,null,"",""))},error:function(){lt(s,!1,"absolute");VIS.ADialog.info("error",null,"","")}})},2)}}if(_tabSchedule.attr("activestatus")=="1")return alert("Schedule"),!1};f.onCancelClick=function(){};f.onClose=function(){it()};_tabFile.on(VIS.Events.onTouchStartOrClick,function(){_tabFile.removeClass("va012-grayBtn");_tabFile.addClass("va012-blueBtn");_tabFile.attr("activestatus","1");_tabSchedule.removeClass("va012-blueBtn");_tabSchedule.addClass("va012-grayBtn");_tabSchedule.attr("activestatus","0")});_tabSchedule.on(VIS.Events.onTouchStartOrClick,function(){_tabSchedule.removeClass("va012-grayBtn");_tabSchedule.addClass("va012-blueBtn");_tabSchedule.attr("activestatus","1");_tabFile.removeClass("va012-blueBtn");_tabFile.addClass("va012-grayBtn");_tabFile.attr("activestatus","0")})},LoadStatementsPages:function(){lr=ai.val()!=null&&ai.val()!=""?!0:!1;t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadStatementsPages",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_cmbBankAccount:h.val(),_txtSearch:ai.val(),_statementPageNo:vi,_PAGESIZE:ke,_SEARCHREQUEST:lr},success:function(n){n!=null&&n!=""&&(fo=JSON.parse(n))}})},loadStatement:function(){if(lr=ai.val()!=null&&ai.val()!=""?!0:!1,h.val()>0){lt(t(yt),!0,"inherit");window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadConciledOrUnConciledStatements",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_cmbBankAccount:h.val(),_txtSearch:ai.val(),_currencyID:at!=null?at:0,_searchRequest:lr},success:function(n){var r=t.parseJSON(n);i(r);lt(t(yt),!1,"inherit")},error:function(){lt(t(yt),!1,"inherit")}})},2);function i(n){n!=null&&n.length>0?(gu.html(""),du.html(""),du.append("<p>"+VIS.Msg.getMsg("VA012_Reconciled")+"<\/p><p style='margin-top: 4px;'>"+VIS.Msg.getMsg("VA012_Unreconciled")+"<\/p>"),gu.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>"+n[0].basecurrency+"<\/span> "+parseFloat(n[0].reconciled).toLocaleString(navigator.language,{minimumFractionDigits:b,maximumFractionDigits:b})+"<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'> <span class='va012-base-curr'>"+n[0].basecurrency+"<\/span> "+parseFloat(n[0].unreconciled).toLocaleString(navigator.language,{minimumFractionDigits:b,maximumFractionDigits:b})+"<\/span>")):(gu.html(""),du.html(""),du.append("<p>"+VIS.Msg.getMsg("VA012_Reconciled")+"<\/p><p style='margin-top: 4px;'>"+VIS.Msg.getMsg("VA012_Unreconciled")+"<\/p>"),gu.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>"+sf+"<\/span> 0<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'><span class='va012-base-curr'>"+sf+"<\/span> 0<\/span>"));tt.setStatementListHeight()}var n="va012-red-color";window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadStatements",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_cmbBankAccount:h.val(),_txtSearch:ai.val(),_statementPageNo:vi,_PAGESIZE:ke,_SEARCHREQUEST:lr,RecOrUnRecComboVal:of},success:function(n){n!=null&&n!=""&&(r(n),lt(t(yt),!1,"inherit"))},error:function(){lt(t(yt),!1,"inherit")}})},2);function r(i){var u,r;if(i=t.parseJSON(i),u="",i!=null&&i.length>0)for(r=0;r<i.length;r++)n="",u="",n=i[r].docstatus=="CO"||i[r].docstatus=="CL"||i[r].docstatus=="RE"?"va012-gray-color":i[r].c_payment_id==null||i[r].c_payment_id=="0"||i[r].c_payment_id==0?i[r].c_cashline_id!=null&&i[r].c_cashline_id!="0"&&i[r].c_cashline_id!=0?"va012-green-color":i[r].c_charge_id!=null&&i[r].c_charge_id!="0"&&i[r].c_charge_id!=0?(i[r].VA009_PayMethod_ID!=0&&i[r].c_bpartner_id==0&&i[r].c_payment_id==0||i[r].c_bpartner_id!=0&&i[r].c_payment_id>0)&&i[r].STMTAMT==i[r].trxamount?"va012-green-color":"va012-red-color":(i[r].c_charge_id==null||i[r].c_charge_id=="")&&(i[r].trxno==null||i[r].trxno=="")?"va012-red-color":"va012-red-color":"va012-green-color",(n!=""&&VIS.Utility.Util.getValueOfInt(of)==0||n=="va012-green-color"&&VIS.Utility.Util.getValueOfInt(of)==1||n=="va012-red-color"&&VIS.Utility.Util.getValueOfInt(of)==2)&&(ei.push(i[r].c_bankstatementline_id),u='<div  data-uid="'+i[r].c_bankstatementline_id+'" class="va012-right-data-wrap '+n+'"><div class="va012-statement-wrap"><div class="va012-fl-padd"><div class="col-md-4 col-sm-4 va012-padd-0"><div class="va012-form-check"> <input type="checkbox" data-uid="'+i[r].c_bankstatementline_id+'" class="va012-payment-chkBox"> <div class="va012-form-text"> <span style="background: rgba(var(--v-c-on-secondary), .4);color: rgba(var(--v-c-on-primary), 1); padding: 3px;margin-left: 2px;word-break: break-word">'+i[r].statementno+"/"+i[r].page+"/"+i[r].line+"<\/span><label>"+new Date(i[r].stmtLineDate).toLocaleDateString()+'<\/label><span style="word-break: break-word" class="va012-statementamount"><span class="va012-currency">'+i[r].currency+"<\/span> "+parseFloat(i[r].trxamount).toLocaleString(navigator.language,{minimumFractionDigits:b,maximumFractionDigits:b})+"<\/span>",u+=i[r].trxno==""||i[r].trxno==null?'<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p style="word-break: break-word">'+VIS.Utility.encodeText(i[r].description)+'<\/p> <span title="'+VIS.Msg.getMsg("VA012_CheckNo")+'" style="word-break: break-word">'+VIS.Utility.encodeText(i[r].EftCheckNo)+'<\/span><span title="'+VIS.Msg.getMsg("DocumentNo")+'" style="word-break: break-word">'+VIS.Utility.encodeText(i[r].invoiceno)+'<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0 va012-zoomeditIcon" style="margin-left: 35px"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="'+i[r].c_bankstatementline_id+'" class="glyphicon glyphicon-edit" title='+VIS.Msg.getMsg("EditRecord")+'><\/span> <span data-uid="'+i[r].c_bankstatementline_id+'" class="glyphicon glyphicon-zoom-in" title='+VIS.Msg.getMsg("ZoomToRecord")+"><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col -->":'<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p style="word-break: break-word">'+VIS.Utility.encodeText(i[r].description)+'<\/p> <span style="word-break: break-word">'+VIS.Utility.encodeText(i[r].bpgroup)+'<\/span><span style="word-break: break-word">'+VIS.Utility.encodeText(i[r].invoiceno)+'<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p style="word-break: break-word">'+VIS.Utility.encodeText(i[r].trxno)+'<\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0" style="margin-left: 35px"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="'+i[r].c_bankstatementline_id+'" class="glyphicon glyphicon-edit"><\/span> <span data-uid="'+i[r].c_bankstatementline_id+'" class="glyphicon glyphicon-zoom-in"><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col -->',u+=" <\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <\/div> <!-- end of row --><\/div><!-- end of payment-wrap --><\/div><!-- end of right-data-wrap -->"),yt.append(u);_sql=null;tt.setStatementListHeight();v.dropPayments()}}},setStatementListHeight:function(){var n=t("#VA012_mainContainer_"+$self.windowNo).height();n==0&&(n=window.innerHeight-107);t("#VA012_contentArea_"+$self.windowNo).height(n-20);t("#VA012_lstStatement_"+$self.windowNo).height(t("#VA012_rightWrap_"+$self.windowNo).height()-t("#VA012_rightTop_"+$self.windowNo).height()-18)},statementOpenEdit:function(n,t){return kt.attr("activestatus","1"),kt.attr("src","Areas/VA012/Images/hide.png"),kt.attr("title","Collapse"),kt.removeClass("vis vis-plus"),kt.addClass("fa fa-minus"),f.show(),v.setPaymentListHeight(),tt.statementListRecordEdit(n,t,!0),n=0,!0},statementListEdit:function(n){var i=t(n.target),r=0;i.hasClass("glyphicon-edit")&&(i.parents().find(".va012-right-data-wrap").removeClass("VA012-EditRecordBackColor"),i.parents(".va012-right-data-wrap").addClass("VA012-EditRecordBackColor"),ku=i.parents(".va012-right-data-wrap"),ii=VIS.Utility.Util.getValueOfInt(i.data("uid")),r=i.data("uid"),kt.attr("activestatus","1"),kt.attr("src","Areas/VA012/Images/hide.png"),kt.attr("title","Collapse"),f.show(),kt.removeClass("vis vis-plus"),kt.addClass("fa fa-minus"),v.setPaymentListHeight(),u.scheduleRefresh(),u.prepayRefresh(),ar=!0,tt.statementListRecordEdit(r,0,!0),r=0,v.addEffect(i,f))},openStatement:function(n){var u=t(n.target),r=0,i;if(u.hasClass("glyphicon glyphicon-zoom-in")){r=u.data("uid");try{he>0&&(i=new VIS.Query,i.addRestriction("C_BankStatementLine_ID",VIS.Query.prototype.EQUAL,r),i.setRecordCount(1),VIS.viewManager.startWindow(he,i))}catch(n){console.log(n)}r=0}},selectedStatementLinesList:function(n){var i=t(n.target);n.target.type=="checkbox"&&(i.is(":checked")&&(_bankStatementLineID=parseInt(i.data("uid")),ti.push(_bankStatementLineID),_bankStatementLineID=0),i.is(":checked")||(_bankStatementLineID=parseInt(i.data("uid")),ti.splice(ti.indexOf(_bankStatementLineID),1),_bankStatementLineID=0))},statementListRecordEdit:function(n,t,i){VIS.Utility.Util.getValueOfInt(t)==0&&u.refreshForm(i);tt.getStatementLineForEdit(n,t,tt.afterRecordGet,i)},selectedScheduleList:function(n){var i=t(n.target);n.target.type=="checkbox"&&(i.is(":checked"),!i.is(":checked"))},getStatementLineForEdit:function(n,i,r,u){t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/GetStatementLine",contentType:"application/json; charset=utf-8",data:JSON.stringify({_bankStatementLineID:n,trxType:ct.val(),payment_ID:i!=null?i:0}),success:function(n){r(n,u)},error:function(n){VIS.ADialog.info(n,null,"","")}})},afterRecordGet:function(n,u){var s,tt,lt,h,vt,v;if(n!=null&&n!=""){if(s=t.parseJSON(n),f.attr("data-uid",s._bankStatementLineID),dt.val(s._txtStatementNo),si.val(s._txtStatementPage),ur.val(s._txtStatementLine),nt.val(Globalize.format(new Date(s._dtStatementDate),"yyyy-MM-dd")),s._cmbVoucherMatch!=null&&s._cmbVoucherMatch!=""?y.val(s._cmbVoucherMatch).prop("selected",!0):y.prop("selectedIndex",0),s._reconciled||y.val()=="V"||ct.val()!="CO"||y.val("C").prop("selected",!0),y.trigger("change"),s._cmbContraType!=null&&s._cmbContraType!=""?et.val(s._cmbContraType).prop("selected",!0):et.prop("selectedIndex",0),y.val()!=null&&y.val()!=""&&et.val()!=null&&et.val()!=""&&(et.val("CB").prop("selected",!0),et.trigger("change")),vr.val(s._cmbCashBook).prop("selected",!0),yu.val(s._txtCheckNo),i.setValue(VIS.Utility.Util.getValueOfDecimal(s._txtAmount.toFixed(b))),l.setValue(VIS.Utility.Util.getValueOfDecimal(s._txtTrxAmt.toFixed(b))),r(i.getControl().val())<=0?i.getControl().addClass("va012-mandatory"):i.getControl().removeClass("va012-mandatory"),s._reconciled&&(i.getControl().attr("disabled",!0),hr=s._reconciled),r(l.getControl().val())<=0?l.getControl().addClass("va012-mandatory"):l.getControl().removeClass("va012-mandatory"),(y.val()=="M"||y.val()=="C")&&r(l.getControl().val())!=0&&(tt=VIS.Utility.Util.getValueOfDecimal(s._txtDifference.toFixed(b)),w.setValue(tt),w.getControl().trigger("blur"),s._txtDifference<0?(w.getControl().addClass("va012-mandatory"),t("#Ast_Difference_"+$self.windowNo).show()):(w.getControl().removeClass("va012-mandatory"),t("#Ast_Difference_"+$self.windowNo).hide()),y.val()=="C"&&y.trigger("change")),s._cmbDifferenceType!=null&&s._cmbDifferenceType!=""?(pi.find("*").prop("disabled",!1),k.val(s._cmbDifferenceType).prop("selected",!0)):k.prop("selectedIndex",0),k.trigger("change"),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0")),wr.val(s._txtVoucherNo),ou.val(s._txtDescription),br.val(s._cmbCharge).prop("selected",!0),it.val(s._txtCharge),it.attr("chargeid",s._cmbCharge),VIS.Utility.Util.getValueOfInt(s._cmbCharge)==0&&s._cmbDifferenceType!=""&&s._cmbDifferenceType!=null?it.addClass("va012-mandatory"):it.removeClass("va012-mandatory"),ut.val(s._cmbTaxRate).prop("selected",!0),VIS.Utility.Util.getValueOfInt(s._cmbTaxRate)==0&&s._cmbDifferenceType!=""&&s._cmbDifferenceType!=null?ut.addClass("va012-mandatory"):ut.removeClass("va012-mandatory"),bt.setValue(VIS.Utility.Util.getValueOfDecimal(s._txtTaxAmount.toFixed(b))),tf.prop("checked",s._chkUseNextTime),s._ctrlCashLine>0?(ot.setValue(s._ctrlCashLine,!1,!0),ar=!1):ri||(ot.setValue(),s._ctrlPayment<=0&&(ar=!1)),rt&&rt.value>0&&s._ctrlPayment==0&&(s._ctrlPayment=rt.value),s._ctrlPayment>0?(rt.setValue(s._ctrlPayment,!1,!0),wr.val()==""&&(lt=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetTrxNoforVoucher",{_ctrlPayment:s._ctrlPayment}),wr.val(lt)),ar=!1):ri||(rt.setValue(),ar=!1),s._ctrlOrder>0?(ri=!0,ht.setValue(s._ctrlOrder,!1,!0),ri=!1):ri||ht.setValue(),s._ctrlBusinessPartner>0?st.setValue(s._ctrlBusinessPartner,!1,!0):ri||st.setValue(),s._ctrlTrxOrg>0?nr.setValue(s._ctrlTrxOrg,!1,!0):ri||nr.setValue(),s._ctrlInvoice>0?ni.setValue(s._ctrlInvoice,!1,!0):!ri&&u&&ni.setValue(),s._txtCurrency!=0){for(c.val(at).prop("selected",!0),h=0;c[0].length>h;h++)VIS.Utility.Util.getValueOfInt(c[0][h].value)==at?t(c[0][h]).show():t(c[0][h]).hide();c.removeClass("va012-mandatory");c.attr("disabled",!1)}s._txtConversionType==0?p.attr("disabled",!1):(p.val(s._txtConversionType).prop("selected",!0),p.removeClass("va012-mandatory"),s._ctrlPayment>0?p.attr("disabled",!0):s._ctrlCashLine>0?p.attr("disabled",!0):(p.attr("disabled",!1),t(p[0][0]).hide()));VIS.Utility.Util.getValueOfDecimal(s._txtDifference.toFixed(b))!=0&&(d.length==0||d.length>0&&f.attr("data-uid")!=0&&Math.abs(r(l.getControl().val()))<Math.abs(r(i.getControl().val())))&&(VIS.Utility.Util.getValueOfInt(ht.value)==0&&f.attr("data-uid")==0||f.attr("data-uid")!=0)&&(k.find("option[value=0]").prop("disabled",!0),k.find("option[value=OU]").prop("disabled",!0),k.find("option[value=DA]").prop("disabled",!0),k.find("option[value=WO]").prop("disabled",!0));it.trigger("focus");s._txtPaymentMethod?hr||s._autoCheckControlled||!s._txtCheckNum?(t(a[0]).find("option").show(),a.val(s._txtPaymentMethod).prop("selected",!0),a.removeClass("va012-mandatory"),s._ctrlPayment?a.attr("disabled",!0):a.attr("disabled",!1)):(t(a[0]).children("option").each(function(){t(this).attr("paymentbasetype")=="S"?t(this).show():t(this).hide()}),vt=a.val(),vt=="0"?(tr=="S"||tr==null)&&(a.val(s._txtPaymentMethod).prop("selected",!0),a.removeClass("va012-mandatory"),s._ctrlPayment?a.attr("disabled",!0):a.attr("disabled",!1)):(v=VIS.Utility.Util.getValueOfString(t("option:selected",a).attr("paymentbasetype")),v=="S"?tr==v&&(a.val(s._txtPaymentMethod).prop("selected",!0),a.removeClass("va012-mandatory"),s._ctrlPayment?a.attr("disabled",!0):a.attr("disabled",!1)):(a.val(0).prop("selected",!0),a.attr("disabled",!1),a.addClass("va012-mandatory")))):(t(a[0]).find("option").show(),a.val(0).prop("selected",!0),a.attr("disabled",!1),a.addClass("va012-mandatory"));s._txtCheckDate?(ft.val(Globalize.format(new Date(s._txtCheckDate),"yyyy-MM-dd")),ft.removeClass("va012-mandatory"),hr||s._autoCheckControlled?(bu=null,ft.attr("disabled",!1)):(bu=ft.val(),ft.attr("disabled",!0))):(bu=null,ft.val(s._txtCheckDate),ft.addClass("va012-mandatory"),ft.attr("disabled",!1));g.val(s._txtCheckNum);s._txtCheckNum?(tu.show(),hr?g.attr("disabled",!0):g.attr("disabled",!1),g.removeClass("va012-mandatory"),sr.show(),lo=s._txtCheckNum,hr||s._autoCheckControlled?(iu=!1,ki=null):(iu=!0,ki=s._txtCheckNum)):(iu=!1,ki=null,a.trigger("change"));hr?lu(!0):lu(!1)}},matchStatementDialog:function(){function p(){function n(n){if(e.html(""),e.append("<option value=0 >-<\/option>"),n!=null)for(var t=0;t<n.length;t++)e.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].Value)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>")}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/LoadStatementNo",{_cmbBankAccount:h.val()},n)}function w(){function n(n){if(o.html(""),o.append("<option value=0 >-<\/option>"),n!=null)for(var t=0;t<n.length;t++)o.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_Tax_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>")}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/LoadTaxRate",null,n)}function b(){n=$match.find("#VA012_cmbMatchingBase_"+$self.windowNo);i=$match.find("#VA012_divMatchingBase_"+$self.windowNo);s=$match.find("#VA012_cmbMatchingCriteria_"+$self.windowNo);e=$match.find("#VA012_cmbStatementNo_"+$self.windowNo);a=$match.find("#VA012_ChargeSrch_"+$self.windowNo);o=$match.find("#VA012_cmbTaxRate_"+$self.windowNo);y=$match.find("#VA012_accept_"+$self.windowNo);_ChargeLookUp=VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(),$self.windowNo,3787,VIS.DisplayType.Search);c=new VIS.Controls.VTextBoxButton("C_Charge_ID",!0,!1,!0,VIS.DisplayType.Search,_ChargeLookUp);a.append(c.getControl().css("width","93%")).append(c.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"))}function k(n){var i=t(n.target);i.hasClass("glyphicon-remove")&&(r.splice(r.indexOf(i.data("uid")),1),i.parent().parent().remove())}function d(){n=null;i=null;r=[];s=null;w2ui["VA012_gridPayment_"+$self.windowNo]!=null&&w2ui["VA012_gridPayment_"+$self.windowNo].destroy()}var n=null,i=null,r=[],s=null,e=null,a=null,c=null,o=null,y=null,l,f;$match=t("<div class='va012-popform-content'>");l="";l="<div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_StatementNo")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbStatementNo_'+$self.windowNo+"'><\/select><\/div> <div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_MatchingBase")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbMatchingBase_'+$self.windowNo+"'><\/select><\/div> <div id='VA012_divMatchingBase_"+$self.windowNo+"' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_MatchingCriteria")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbMatchingCriteria_'+$self.windowNo+"'><option value='0'><\/option><option value='AT'>"+VIS.Msg.getMsg("VA012_MatchAnyTwo")+"<\/option><option value='AR'>"+VIS.Msg.getMsg("VA012_MatchAnyThree")+"<\/option><option value='AL'>"+VIS.Msg.getMsg("VA012_MatchAll")+"<\/option><\/select><\/div> <div class='va012-popform-data'><label title = '"+VIS.Msg.getMsg("VA012_SetChargeType")+"' > "+VIS.Msg.getMsg("VA012_Charge")+'<sup style="color: red;">*<\/sup><\/label><div id=\'VA012_ChargeSrch_'+$self.windowNo+"'><\/div><\/div> <div class='va012-popform-data'><label title =' "+VIS.Msg.getMsg("VA012_SetTaxRate")+"' >"+VIS.Msg.getMsg("VA012_TaxRate")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbTaxRate_'+$self.windowNo+"'><\/select><\/div> <div class='va012-frm-btn va012-btn-blue va012-acceptbtn'><label style='font-weight: normal;' id ='VA012_accept_"+$self.windowNo+"'>"+VIS.Msg.getMsg("VA012_Accept")+"<\/label><\/div> <\/div>";$match.append(l);b();cs(n);p();w();f=new VIS.ChildDialog;f.setContent($match);f.setTitle(VIS.Msg.getMsg("VA012_MatchStatement"));f.setWidth(700);f.setHeight(650);f.setEnableResize(!1);f.setModal(!0);f.show();f.hideButtons();y.click(function(){if(r.length>0){if(e.val()==null||e.val()==""||e.val()=="0")return VIS.ADialog.info("VA012_NoLinesFoundToMatch",null,"",""),!1;if(h.val()==null||h.val()==""||h.val()=="0")return VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"",""),!1;if(s.val()==null||s.val()==""||s.val()=="0")return VIS.ADialog.info("VA012_SelectMatchingCriteria",null,"",""),!1;if(s.val()=="AT"&&r.length<2)return VIS.ADialog.info("VA012_SelectMin2MatchingBase",null,"",""),!1;if(s.val()=="AR"&&r.length<3)return VIS.ADialog.info("VA012_SelectMin3MatchingBase",null,"",""),!1;if(c.value==null||VIS.Utility.Util.getValueOfInt(c.value)==0)return VIS.ADialog.info("VA012_NoChargeSelected",null,"",""),!1;if(o.val()==null||o.val()==""||o.val()=="0")return VIS.ADialog.info("VA012_NoTaxRateSelected",null,"",""),!1;lt($match,!0,"absolute");window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/MatchStatementGridData",type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_matchingBaseItemList:r.toString(),_cmbMatchingCriteria:s.val(),_BankAccount:h.val(),_StatementNo:e.val(),_BankCharges:VIS.Utility.Util.getValueOfInt(c.value),_TaxRate:o.val()},success:function(f){if(f!=null&&f!=""){f=t.parseJSON(f);n.prop("selectedIndex",0);e.prop("selectedIndex",0);c.value=null;c.setValue(null);o.prop("selectedIndex",0);r=[];var s="";i.html("");f.length>0?(ns(i,f),_statementlineslist=[],storepaymentdata=[],yt.html(""),vi=1,ei=[],tt.loadStatement(li),oi.html(""),u.scheduleRefresh(),u.prepayRefresh(),bi=1,v.loadPayments(h.val(),wt.val(),ct.val(),vt.val())):(s="<div> <p> <b>"+VIS.Msg.getMsg("va012_norecordmatched")+"<\/b> <\/div>",i.append(s));lt($match,!1,"absolute")}else lt($match,!1,"absolute"),VIS.ADialog.info(f.toString(),null,"","")},error:function(){lt($match,!1,"absolute");VIS.ADialog.info("error",null,"","")}})},2)}else return VIS.ADialog.info("VA012_NoMatchingBaseSelected",null,"",""),!1;return!1});f.onCancelClick=function(){w2ui["VA012_gridPayment_"+$self.windowNo]!=null&&w2ui["VA012_gridPayment_"+$self.windowNo].destroy()};f.onClose=function(){d()};n.on("change",function(){if(r.length<=0&&i.html(""),!ae(n.val(),r)&&n.val()!="0"&&n.val()!=""){r.push(n.val());var u="<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='"+n.val()+"'class='glyphicon glyphicon-remove'><\/span><\/a> <span>"+n.children()[n[0].selectedIndex].text;t(i)[0]!=undefined&&t(i)[0].classList.contains("w2ui-reset","w2ui-grid")&&i.removeClass("w2ui-reset w2ui-grid");i.append(u)}});i.on(VIS.Events.onTouchStartOrClick,k)},matchStatementGridDialog:function(){var n=new VIS.ChildDialog;n.setContent(bf);n.setTitle(VIS.Msg.getMsg("VA012_MatchStatementGrid"));n.setWidth("780px");n.setHeight(450);n.setEnableResize(!0);n.setModal(!0);n.show();ns()},paymentScheduleDialog:function(){function ot(){var u="",t=0,n;for($_divPaymentSchedules.html(""),n=0;n<d.length;n++)u="<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='"+d[n]+"'  data-udata='"+di[n]+"' class='glyphicon glyphicon-remove'><\/span><\/a> <span>"+di[n]+"<\/span> <\/div>",$_divPaymentSchedules.append(u),pt.length>0&&(t+=VIS.Utility.Util.getValueOfDecimal(pt[n]));f[0].attributes["data-uid"].value==0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(t.toFixed(b)));l.setValue(VIS.Utility.Util.getValueOfDecimal(t.toFixed(b)));r(i.getControl().val())<0&&e.attr("v_active","0");i.getControl().trigger("blur",[r(i.getControl().val()),r(l.getControl().val())]);d!=null&&d.length>0?df(d.toString()):df(null)}function ct(){if(d.length>0&&!ki){var n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetAutoCheckNo",{bnkAct_Id:h.val(),_PayMethod:0,_InvSchdleList:d,voucherMatch:y.val()});n&&(a.val(n._paymentMethod_Id).prop("selected",!0),n._checkNo?g.val(n._checkNo):g.val(""),a.trigger("change"))}}function lt(n){var c=t(n.target),u,s,v;if(c.hasClass("glyphicon-remove")){if(pt!=null&&pt.length>0){if(pt.length>d.length?pt.splice(d.indexOf(c.data("uid"))+1,1):pt.length==d.length&&pt.splice(d.indexOf(c.data("uid")),1),u=0,Number(pt.length)>0)for(s=0;s<pt.length;s++)u+=VIS.Utility.Util.getValueOfDecimal(pt[s]);u<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"));f[0].attributes["data-uid"].value==0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(b)))}for(d.splice(d.indexOf(c.data("uid")),1),di.splice(di.indexOf(c.data("udata")),1),d.length==0&&f[0].attributes["data-uid"].value>0&&tt.statementListRecordEdit(f[0].attributes["data-uid"].value,0,!1),c.parent().parent().remove(),rr.val(di.toString()),u=0,s=0;s<pt.length;s++)u+=VIS.Utility.Util.getValueOfDecimal(pt[s]);f[0].attributes["data-uid"].value==0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(b)));l.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(b)));i.getControl().trigger("blur",[r(i.getControl().val()),r(l.getControl().val())]);u==0&&st.setValue();d!=null&&d.length>0?df(d.toString()):df(null);d.length>0?(v=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetAutoCheckNo",{bnkAct_Id:h.val(),_PayMethod:0,_InvSchdleList:d,voucherMatch:y.val()}),v&&(a.val(v._paymentMethod_Id).prop("selected",!0),v._checkNo?g.val(v._checkNo):g.val(""))):a.val(0).prop("selected",!0);a.trigger("change")}}function at(){$_divPaymentSchedules=$paymentSchedule.find("#VA012_divPaymentSchedules_"+$self.windowNo);w=$paymentSchedule.find("#VA012_ctrlPSInvoice_"+$self.windowNo);k=$paymentSchedule.find("#VA012_ctrlPSBP_"+$self.windowNo);n=$paymentSchedule.find("#VA012_cmbPaymentSchedule_"+$self.windowNo)}function ht(){ut=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,3484,VIS.DisplayType.MultiKey,"C_Invoice_ID",0,!1,"DocStatus IN ('CO','CL') AND C_Invoice.C_BPartner_ID="+ft);s=new VIS.Controls.VTextBoxButton("C_Invoice_ID",!1,!1,!0,VIS.DisplayType.MultiKey,ut);s.isMultiKeyTextBox=!0;s.getControl().addClass("va012-input-size-2");w.append(s.getControl());w.append(s.getBtn(0));w.append(s.getBtn(1));s.fireValueChanged=function(){rt=null;rt=s.value;n.html("");yt()}}function vt(){et=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,2893,VIS.DisplayType.Search,"C_BPartner_ID",0,!1,null);c=new VIS.Controls.VTextBoxButton("C_BPartner_ID",!1,!1,!0,VIS.DisplayType.Search,se);c.getControl().addClass("va012-input-size-2");k.append(c.getControl());k.append(c.getBtn(0));k.append(c.getBtn(1));c.fireValueChanged=function(){ft=0;ft=c.value;ut=null;s=null;w.html("");rt=null;ht()}}function yt(){function i(t){if(n.html(""),n.append("<option value=0 ><\/option>"),t!=null)for(var i=0;i<t.length;i++){if(t[i].DueAmount==0){VIS.ADialog.info("VA012_ConversionRateNotFound",null," "+VIS.Msg.getMsg("VA012_InvoiceSchedule")+": "+VIS.Utility.Util.getValueOfString(t[i].c_invoicepayschedule_id),"");return}n.append("<option paymentamount="+t[i].DueAmount+" paymentdata='"+VIS.Utility.encodeText(new Date(t[i].DueDate).toLocaleDateString())+"_"+VIS.Utility.encodeText(t[i].DueAmt)+"' value="+VIS.Utility.Util.getValueOfInt(t[i].c_invoicepayschedule_id)+">"+VIS.Utility.encodeText(new Date(t[i].DueDate).toLocaleDateString()+"_"+t[i].DueAmt)+"<\/option>")}n.prop("selectedIndex",0)}t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetInvPaySchedule",dataType:"json",data:{seltdInvoice:rt,accountID:h.val(),statemtDate:nt.val()},success:function(n){var t=JSON.parse(n);(t!=null||t!="")&&i(t)}})}function wt(){ut=null;s=null;rt=null;w=null;et=null;c=null;ft=null;k=null;n=null}var it,p;if(d.length==0&&di.length==0)var ut=null,s=null,rt=null,w=null,et=null,c=null,ft=null,k=null,n=null;$paymentSchedule=t("<div class='va012-popform-content'>");it="";it="<div> <label>"+VIS.Msg.getMsg("VA012_BusinessPartner")+"<\/label> <div id='VA012_ctrlPSBP_"+$self.windowNo+"' ><\/div> <\/div>";it+="<div> <label>"+VIS.Msg.getMsg("VA012_Invoice")+"<\/label> <div id='VA012_ctrlPSInvoice_"+$self.windowNo+"' ><\/div> <\/div>";it+="<div> <label>"+VIS.Msg.getMsg("VA012_PaymentSchedules")+"<\/label> <select id='VA012_cmbPaymentSchedule_"+$self.windowNo+"'  style=' width: 100%; ' ><\/select> <\/div>";it+="<div id='VA012_divPaymentSchedules_"+$self.windowNo+"' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px;margin-top: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>";$paymentSchedule.append(it);at();p=new VIS.ChildDialog;p.setContent($paymentSchedule);p.setTitle(VIS.Msg.getMsg("VA012_PaymentSchedules"));p.setWidth("500px");ot();p.setEnableResize(!1);p.setModal(!0);p.show();vt();ht();st.value&&(c.setValue(st.value,!1,!0),k.find("*").prop("disabled",!0));ni.value&&(s.setValue(ni.value,!1,!0),w.find("*").prop("disabled",!0));n.on("change",function(){n.val()>0&&v.checkScheduleCondition(n.val(),parseInt(f.attr("data-uid")),"",r(i.getControl().val()))&&(ae(parseInt(n.val()),d)?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(d.push(parseInt(n.val())),di.push(this.options[this.selectedIndex].getAttribute("paymentdata")),pt.push(this.options[this.selectedIndex].getAttribute("paymentamount")),ot(),ct(),v.setInvoiceAndBPartner(n.val(),"IS")),rr.val(di.toString()))});$_divPaymentSchedules.on(VIS.Events.onTouchStartOrClick,lt);p.onOkClick=function(){};p.onCancelClick=function(){u.scheduleRefresh();wt();f[0].attributes["data-uid"].value>0?tt.statementListRecordEdit(f[0].attributes["data-uid"].value,0,!1):u.refreshForm(!1)}},prepayOrderDialog:function(){function r(){var t="",n;for($_divPrepayOrders.html(""),n=0;n<au.length;n++)t="<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='"+au[n]+"'  data-udata='"+vu[n]+"' class='glyphicon glyphicon-remove'><\/span><\/a> <span>"+vu[n]+"<\/span> <\/div>",$_divPrepayOrders.append(t)}function u(n){var i=t(n.target);i.hasClass("glyphicon-remove")&&(au.splice(au.indexOf(i.data("uid")),1),vu.splice(vu.indexOf(i.data("udata")),1),i.parent().parent().remove(),ee.val(vu.toString()))}function f(){$_divPrepayOrders=$prepayOrder.find("#VA012_divPrepayOrders_"+$self.windowNo)}var i,n;$prepayOrder=t("<div class='va012-popform-content'>");i="";i="<div id='VA012_divPrepayOrders_"+$self.windowNo+"' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>";$prepayOrder.append(i);f();n=new VIS.ChildDialog;n.setContent($prepayOrder);n.setTitle(VIS.Msg.getMsg("VA012_PrepayOrders"));n.setWidth("500px");r();n.setEnableResize(!1);n.setModal(!0);n.show();$_divPrepayOrders.on(VIS.Events.onTouchStartOrClick,u)}};u={newRecord:function(){function tt(n){datasource=[];for(var t=0;t<n.length;t++)datasource.push({label:n[t].name,value:n[t].name,ids:n[t].chargeID});it.autocomplete("option","source",datasource);it.autocomplete("search","");it.trigger("focus")}function ct(n,i){it.attr("chargeid",0);t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetCharge",dataType:"json",data:{searchText:n,voucherType:y.val()!=null?y.val():"",bankAcct:h.val()!=null?h.val():0},success:function(n){var r=JSON.parse(n);datasource=[];i(t.map(r,function(n){return{label:n.name,value:n.name,ids:n.chargeID}}));t(self.div).autocomplete("search","");t(self.div).trigger("focus")}})}function n(){y.val()=="V"?(c.val(at).prop("selected",!0),c.removeClass("va012-mandatory"),c.attr("disabled",!0)):(t(c[0]).siblings().show(),c.val(0).prop("selected",!0),c.addClass("va012-mandatory"),c.attr("disabled",!1))}f=s.find("#VA012_formNewRecord_"+$self.windowNo);ue=s.find("#VA012_formBtnNewRecord_"+$self.windowNo);u.getNewRecordDesign();u.getNewRecordControls();u.loadCurrency();u.loadVoucherMatch();u.loadContraType();u.loadCashBook();u.loadDifferenceType();u.loadTransferType();u.loadNewFormCurrency();u.loadConversionTypes();u.loadPaymentMethods();u.loadCharge();u.loadTaxRate();u.loadPayment();u.loadOrder();u.loadBusinessPartner();u.loadTrxOrg();u.loadInvoice();u.loadCashLine();r(i.getControl().val())<=0&&i.getControl().addClass("va012-mandatory");dt.val()!=""&&dt.removeClass("va012-mandatory");nt.val()!=""&&nt.removeClass("va012-mandatory");it.on("blur",function(){(it.val()==""||it.val()==null)&&it.attr("chargeid",0)});ro.on(VIS.Events.onTouchStartOrClick,function(){VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetCharge",{searchText:"",voucherType:y.val()!=null?y.val():"",bankAcct:h.val()!=null?h.val():0},tt)});it.autocomplete({minLength:0,scroll:!0,source:function(n,t){n.term.trim().length!=0&&ct(n.term,t)},select:function(n,i){t(this).val(i.item.ids);t(this).attr("chargeid",i.item.ids);parseInt(t(this).val())&&it.removeClass("va012-mandatory")}});kt.on(VIS.Events.onTouchStartOrClick,function(){kt.attr("activestatus")=="0"?(f.show(),kt.attr("activestatus","1"),kt.removeClass("vis vis-plus"),kt.addClass("fa fa-minus"),kt.attr("title","Collapse")):(f.hide(),kt.attr("activestatus","0"),ii=0,ku!=null&&ku!=""&&ku.removeClass("VA012-EditRecordBackColor"),kt.addClass("vis vis-plus"),kt.removeClass("fa fa-minus"),kt.attr("title","Expand"));r(i.getControl().val())<=0&&i.getControl().addClass("va012-mandatory");dt.val()!=""&&dt.removeClass("va012-mandatory");nt.val()!=""&&nt.removeClass("va012-mandatory");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();lu(!1);c.trigger("change");v.setPaymentListHeight()});to.on(VIS.Events.onTouchStartOrClick,function(){ii=0;ku!=null&&ku!=""&&ku.removeClass("VA012-EditRecordBackColor");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();lu(!1);c.trigger("change")});f.hide();y.on("change",function(){y.val()=="M"?(VIS.Utility.Util.getValueOfInt(ci)!=0&&event!=null&&event.currentTarget.className!=gi[0].className&&(u.refreshSelectedValues(),n()),_divCtrlCashLine.find("*").prop("disabled",!0),_divCtrlCashLine.hide(),dr.find("*").prop("disabled",!0),ru.find("*").prop("disabled",!0),gr.find("*").prop("disabled",!0),uu.find("*").prop("disabled",!0),dr.hide(),ru.hide(),gr.hide(),uu.hide(),_divPaymentMethod.show(),co>0?(yi.show(),yi.find("*").prop("disabled",!1)):(yi.find("*").prop("disabled",!0),yi.hide()),k.val()=="CH"?(u.loadCharge(),hi.find("*").prop("disabled",!1),ui.find("*").prop("disabled",!1),wi.find("*").prop("disabled",!1)):(hi.hide(),ui.hide(),wi.hide(),hi.find("*").prop("disabled",!0),ui.find("*").prop("disabled",!0),wi.find("*").prop("disabled",!0)),divRow4Col1TrxAmt.show(),rf.show(),pi.show(),fr.show(),er.show(),yr.show(),or.show(),nu.show(),fr.find("*").prop("disabled",!1),er.find("*").prop("disabled",!1),yr.find("*").prop("disabled",!1),or.find("*").prop("disabled",!1),nu.find("*").prop("disabled",!1),rr.prop("disabled",!0),kr.css("pointer-events","auto"),ut.removeClass("va012-mandatory"),it.removeClass("va012-mandatory"),k.val()!="CH"&&(et.prop("selectedIndex",0),it.attr("chargeid",0),it.val(""),ut.prop("selectedIndex",0),bt.setValue(0)),et.removeClass("va012-mandatory"),t(".astric_"+$self.windowNo).hide(),t("#Ast_ContraType_"+$self.windowNo).hide(),t("#Ast_DifferenceType_"+$self.windowNo).hide(),t("#Ast_Difference_"+$self.windowNo).hide()):y.val()=="V"?((ci!=0||fi!=0||d.length>0||gt!=0)&&event!=null&&event.currentTarget.className!=gi[0].className&&(u.refreshSelectedValues(),n()),u.loadCharge(),_divCtrlCashLine.find("*").prop("disabled",!0),_divCtrlCashLine.hide(),dr.find("*").prop("disabled",!0),ru.find("*").prop("disabled",!0),gr.find("*").prop("disabled",!0),uu.find("*").prop("disabled",!0),dr.hide(),et.prop("selectedIndex",0),ru.hide(),gr.hide(),uu.hide(),yi.hide(),hi.show(),ui.show(),wi.show(),yi.find("*").prop("disabled",!1),hi.find("*").prop("disabled",!1),ui.find("*").prop("disabled",!1),_divPaymentMethod.show(),VIS.Utility.Util.getValueOfInt(it.attr("chargeid"))==0&&it.addClass("va012-mandatory"),VIS.Utility.Util.getValueOfInt(ut.val())==0&&ut.addClass("va012-mandatory"),fr.find("*").prop("disabled",!0),er.find("*").prop("disabled",!0),yr.find("*").prop("disabled",!1),or.find("*").prop("disabled",!0),nu.find("*").prop("disabled",!0),kr.css("pointer-events","none"),divRow4Col1TrxAmt.hide(),l.setValue(0),rf.hide(),w.setValue(0),w.getControl().removeClass("va012-mandatory"),pi.hide(),pi.find("*").prop("disabled",!0),k.removeClass("va012-mandatory"),fr.hide(),er.hide(),yr.show(),or.hide(),nu.hide(),et.removeClass("va012-mandatory"),t(".astric_"+$self.windowNo).show(),t("#Ast_ContraType_"+$self.windowNo).hide(),ot.getControl().removeClass("va012-mandatory"),t("#Ast_CashJournalLine_"+$self.windowNo).hide()):y.val()=="C"&&((fi!=0||d.length>0||gt!=0&&event!=null&&event.currentTarget.className!=gi[0].className)&&(u.refreshSelectedValues(),n()),u.loadCharge(),dr.show(),gr.show(),dr.find("*").prop("disabled",!1),gr.find("*").prop("disabled",!1),divRow4Col1TrxAmt.show(),rf.show(),pi.show(),_divPaymentMethod.hide(),r(w.getControl().val())==0&&(yi.find("*").prop("disabled",!0),hi.find("*").prop("disabled",!0),ui.find("*").prop("disabled",!0),wi.find("*").prop("disabled",!0),yi.hide(),hi.hide(),ui.hide(),wi.hide()),fr.find("*").prop("disabled",!0),er.find("*").prop("disabled",!0),yr.find("*").prop("disabled",!0),or.find("*").prop("disabled",!0),nu.find("*").prop("disabled",!0),kr.css("pointer-events","none"),fr.hide(),er.hide(),yr.hide(),or.hide(),nu.hide(),(et.val()==null||et.val()==""||et.val()==0)&&et.addClass("va012-mandatory"),ut.removeClass("va012-mandatory"),it.removeClass("va012-mandatory"),t(".astric_"+$self.windowNo).hide(),t("#Ast_ContraType_"+$self.windowNo).show());fu.hide();fu.find("*").prop("disabled",!0);gi.text(VIS.Msg.getMsg("VA012_More"));v.setPaymentListHeight()});k.on("change",function(){k.val()=="CH"?(yi.show(),hi.show(),ui.show(),wi.show(),yi.find("*").prop("disabled",!1),hi.find("*").prop("disabled",!1),ui.find("*").prop("disabled",!1),(it.val()==null||it.val()=="")&&it.addClass("va012-mandatory"),ut.val()==0&&ut.addClass("va012-mandatory"),t(".astric_"+$self.windowNo).show()):(y.val()=="M"||y.val()=="C")&&(hi.find("*").prop("disabled",!0),ui.find("*").prop("disabled",!0),wi.find("*").prop("disabled",!0),hi.hide(),ui.hide(),wi.hide(),br.prop("selectedIndex",0),it.attr("chargeid",0),it.val(""),ut.prop("selectedIndex",0),bt.setValue(0),it.removeClass("va012-mandatory"),ut.removeClass("va012-mandatory"));k.val()<=0&&r(w.getControl().val())!=0?(k.addClass("va012-mandatory"),t("#Ast_DifferenceType_"+$self.windowNo).show()):k.removeClass("va012-mandatory");v.setPaymentListHeight()});et.on("change",function(){et.val()!=null&&et.val()!=""&&et.val()!=0?et.removeClass("va012-mandatory"):et.addClass("va012-mandatory");et.val()=="CB"?(ru.find("*").prop("disabled",!1),uu.find("*").prop("disabled",!1),t(".astric_"+$self.windowNo).hide(),ot.getControl().addClass("va012-mandatory"),t("#Ast_CashJournalLine_"+$self.windowNo).show()):(vr.prop("selectedIndex",0),yu.val(""),ru.find("*").prop("disabled",!0),uu.find("*").prop("disabled",!0),t(".astric_"+$self.windowNo).hide(),ot.getControl().removeClass("va012-mandatory"),t("#Ast_CashJournalLine_"+$self.windowNo).hide());et.val()=="BB"?(_divCtrlCashLine.find("*").prop("disabled",!0),_divCtrlCashLine.hide(),t(".astric_"+$self.windowNo).show(),yi.show(),hi.show(),ui.show(),wi.show(),yi.find("*").prop("disabled",!1),hi.find("*").prop("disabled",!1),ui.find("*").prop("disabled",!1),it.addClass("va012-mandatory"),ut.addClass("va012-mandatory"),ot.getControl().removeClass("va012-mandatory"),t("#Ast_CashJournalLine_"+$self.windowNo).hide()):y.val()=="C"&&(_divCtrlCashLine.show(),_divCtrlCashLine.find("*").prop("disabled",!1),yi.find("*").prop("disabled",!0),r(w.getControl().val())==0&&(hi.find("*").prop("disabled",!0),ui.find("*").prop("disabled",!0),wi.find("*").prop("disabled",!0),hi.hide(),ui.hide(),wi.hide(),it.removeClass("va012-mandatory"),ut.removeClass("va012-mandatory")),wi.hide());v.setPaymentListHeight()});c.on("change",function(){VIS.Utility.Util.getValueOfInt(c.val())>0?c.removeClass("va012-mandatory"):c.addClass("va012-mandatory")});a.on("change",function(){if(VIS.Utility.Util.getValueOfInt(a.val())>0){var n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetAutoCheckNo",{bnkAct_Id:h.val(),_PayMethod:a.val(),_InvSchdleList:d,voucherMatch:y.val()});if(n._paymentBaseType=="S"){if(tu.show(),ki){g.val()||(g.val(ki),g.attr("disabled",!0),g.removeClass("va012-mandatory"),sr.show(),ft.val(bu),ft.removeClass("va012-mandatory"),a.removeClass("va012-mandatory"));return}(d.length>0||y.val()=="V")&&n&&(n._checkNo?(g.val(n._checkNo),g.attr("disabled",!0),g.removeClass("va012-mandatory")):(g.val(""),g.attr("disabled",!1),g.addClass("va012-mandatory")),n._status&&(g.val(""),VIS.ADialog.info("",null,n._status,"")));g.val()?(g.attr("disabled",!0),g.removeClass("va012-mandatory"),iu=!1,ki=null):(g.attr("disabled",!1),g.addClass("va012-mandatory"),iu=!0,ki=null);sr.show();ft.val()?(ft.attr("disabled",!0),ft.removeClass("va012-mandatory"),bu=null):(ft.attr("disabled",!1),ft.addClass("va012-mandatory"),bu=null)}else tu.hide(),g.val(""),g.removeClass("va012-mandatory"),sr.hide(),ft.val(""),ft.removeClass("va012-mandatory");a.removeClass("va012-mandatory")}else a.attr("disabled",!1),a.addClass("va012-mandatory"),g.val(""),tu.hide(),g.removeClass("va012-mandatory"),ft.val(""),sr.hide(),ft.removeClass("va012-mandatory")});g.on("change",function(){g.val()?(g.removeClass("va012-mandatory"),iu=!0,ki=g.val()):(g.addClass("va012-mandatory"),iu=!1,ki=null)});ft.on("change",function(){ft.val()?(rt.value||ft.val()>nt.val()&&(ft.val(""),VIS.ADialog.info("VA012_ChkDateCantbeGratrStmtDate",null,"","")),ft.removeClass("va012-mandatory")):ft.addClass("va012-mandatory")});p.on("change",function(){if(VIS.Utility.Util.getValueOfInt(p.val())>0){var n=null;d!=null&&d.length>0&&(n=d.toString());n!=null||VIS.Utility.Util.getValueOfInt(ht.value)!=0||VIS.Utility.Util.getValueOfInt(rt.value)!=0||VIS.Utility.Util.getValueOfInt(ot.value)!=0?t.ajax({type:"POST",url:VIS.Application.contextUrl+"BankStatement/GetConvertedAmount",contentType:"application/json; charset=utf-8",data:JSON.stringify({currency:at,conversionType:p.val(),stmtDate:nt.val(),_schedules:n,_accountId:h.val(),orderId:gt,paymentId:fi,cashLineId:ci}),success:function(n){n=JSON.parse(n);n!=null&&(n._convertedAmt==0?n.schedule_Ids!=null&&n.schedule_Ids.length>0&&(VIS.Utility.Util.getValueOfInt(f.attr("data-uid"))==0&&i.setValue(),l.setValue(),i.getControl().addClass("va012-mandatory"),l.getControl().addClass("va012-mandatory"),VIS.ADialog.info("VA012_ConversionRateNotFound",null," - DocNo: "+n.schedule_Ids.toString(),"")):(VIS.Utility.Util.getValueOfInt(f.attr("data-uid"))==0?(i.setValue(n._convertedAmt),n._convertedAmt>0?i.getControl().removeClass("va012-mandatory"):i.getControl().addClass("va012-mandatory")):(l.setValue(n._convertedAmt),i.getControl().trigger("blur",[r(i.getControl().val()),r(l.getControl().val())])),gt==0&&VIS.Utility.Util.getValueOfInt(f.attr("data-uid"))==0&&(l.setValue(n._convertedAmt),i.getControl().trigger("blur",[r(i.getControl().val()),r(l.getControl().val())]))));t(p[0][0]).hide();p.removeClass("va012-mandatory")},error:function(n){VIS.ADialog.info(n,null,"","")}}):p.removeClass("va012-mandatory")}else p.addClass("va012-mandatory")});ut.on("change",function(){if(bt.setValue(0),ut.val()>0){var n=0;if(n=r(w.getControl().val())!=0&&y.val()!="V"?r(w.getControl().val()):r(i.getControl().val()),n!=0){le(ut.val(),n,b,t);function t(n){n=JSON.parse(n);n!=null&&(bt.setValue(VIS.Utility.Util.getValueOfDecimal(n.TaxAmt)),ut.removeClass("va012-mandatory"))}}}else ut.addClass("va012-mandatory")});gi.on(VIS.Events.onTouchStartOrClick,function(){gi.text()==VIS.Msg.getMsg("VA012_More")?(gi.attr("visiblestatus","1"),gi.text(VIS.Msg.getMsg("VA012_Hide")),dr.show(),gr.show(),_divCtrlCashLine.show(),yi.show(),hi.show(),ui.show(),wi.show(),divRow4Col1TrxAmt.show(),rf.show(),pi.show(),fr.show(),er.show(),yr.show(),or.show(),nu.show(),y.val()=="V"&&(fu.show(),hu>0?fu.find("*").prop("disabled",!0):fu.find("*").prop("disabled",!1))):(gi.attr("visiblestatus","0"),gi.text(VIS.Msg.getMsg("VA012_More")),y.trigger("change"));hr&&lu(!0);v.setPaymentListHeight()});f.on("keyup",function(n){n.which==32&&(e.is(":focus")&&e.trigger("click"),o.is(":focus")&&o.trigger("click"),gi.is(":focus")&&gi.trigger("click"));n.which==13&&yf.is(":focus")&&yf.trigger("click")});yf.on(VIS.Events.onTouchStartOrClick,function(){var n=u.getFormData(),f,t;if(hr){VIS.ADialog.info("VA012_BSLAlreadyReconciled",null,"","");return}if(n[0]._cmbBankAccount==null||n[0]._cmbBankAccount==""||n[0]._cmbBankAccount=="0"){VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"","");return}if(n[0]._txtStatementNo==null||n[0]._txtStatementNo==""||n[0]._txtStatementNo=="0"){VIS.ADialog.info("VA012_PleaseEnterStatementNo",null,"","");return}if(n[0]._dtStatementDate==null||n[0]._dtStatementDate==""||n[0]._dtStatementDate=="0"){VIS.ADialog.info("VA012_PleaseEnterStatementDate",null,"","");return}if(VIS.Utility.Util.getValueOfInt(n[0]._txtCurrency)==0){VIS.ADialog.info("VA012_PleaseSelectCurrency",null,"","");return}if(VIS.Utility.Util.getValueOfInt(n[0]._txtConversionType)==0){VIS.ADialog.info("VA012_PleaseSelectConversionType",null,"","");return}if(VIS.Utility.Util.getValueOfInt(n[0]._txtPaymentMethod)<=0&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlCashLine)<=0&&n[0]._cmbVoucherMatch!="C"){VIS.ADialog.info("VA012_PleaseSelectPayMethod",null,"","");return}if(!n[0]._ctrlPayment&&g.hasClass("va012-mandatory")&&(n[0]._txtCheckNum==null||n[0]._txtCheckNum=="")){VIS.ADialog.info("VA012_PleaseEnterCheckNo",null,"","");return}if(!n[0]._ctrlPayment&&ft.hasClass("va012-mandatory")&&!n[0]._txtCheckDate){VIS.ADialog.info("VA012_PleaseSelectCheckDate",null,"","");return}if(!(n[0]._ctrlInvoice==null||n[0]._ctrlInvoice==""||n[0]._ctrlInvoice=="0")&&!(n[0]._ctrlBusinessPartner==null||n[0]._ctrlBusinessPartner==""||n[0]._ctrlBusinessPartner=="0")&&(n[0]._ctrlPayment==null||n[0]._ctrlPayment==""||n[0]._ctrlPayment=="0")&&(n[0]._scheduleList==null||n[0]._scheduleList=="")){VIS.ADialog.info("VA012_PleaseSelectPaySchedule",null,"","");return}if(!(n[0]._ctrlBusinessPartner==null||n[0]._ctrlBusinessPartner==""||n[0]._ctrlBusinessPartner=="0")&&(n[0]._ctrlInvoice==null||n[0]._ctrlInvoice==""||n[0]._ctrlInvoice=="0")&&(n[0]._ctrlPayment==null||n[0]._ctrlPayment==""||n[0]._ctrlPayment=="0")&&(n[0]._scheduleList==null||n[0]._scheduleList=="")&&(n[0]._ctrlOrder==null||n[0]._ctrlOrder==""||n[0]._ctrlOrder=="0")&&(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0")){VIS.ADialog.info("VA012_PleaseSelectAnyOne",null,"","");return}if(n[0]._cmbVoucherMatch=="M"&&(n[0]._ctrlInvoice==null||n[0]._ctrlInvoice==""||n[0]._ctrlInvoice=="0")&&(n[0]._ctrlPayment==null||n[0]._ctrlPayment==""||n[0]._ctrlPayment=="0")&&(n[0]._scheduleList==null||n[0]._scheduleList=="")&&(n[0]._ctrlOrder==null||n[0]._ctrlOrder==""||n[0]._ctrlOrder=="0")&&(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0")){VIS.ADialog.info("VA012_PleaseSelectAnyOne",null,"","");return}if(n[0]._cmbVoucherMatch=="V"&&VIS.Utility.Util.getValueOfInt(n._ctrlBusinessPartner)==0&&(n[0]._txtDifference=n[0]._txtAmount),n[0]._txtAmount==null||n[0]._txtAmount==""||n[0]._txtAmount=="0"||n[0]._txtAmount=="0.00"){VIS.ADialog.info("VA012_PleaseEnterAmount",null,"","");return}if(n[0]._cmbVoucherMatch=="C")if(n[0]._cmbContraType=="BB"){if(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0"){VIS.ADialog.info("VA012_PleaseSelectCharge",null,"","");it.addClass("va012-mandatory");return}if(n[0]._cmbTaxRate==null||n[0]._cmbTaxRate==""||n[0]._cmbTaxRate=="0"){VIS.ADialog.info("VA012_PleaseSelectTaxRate",null,"","");ut.addClass("va012-mandatory");return}}else if(n[0]._cmbContraType=="CB"){if(n[0]._ctrlCashLine==null||n[0]._ctrlCashLine==""||n[0]._ctrlCashLine=="0"){VIS.ADialog.info("VA012_PleaseSelectCashJournalLine",null,"","");return}}else{VIS.ADialog.info("VA012_PleaseSelectContraType",null,"","");return}if(n[0]._cmbVoucherMatch=="V"){if(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0"){VIS.ADialog.info("VA012_PleaseSelectCharge",null,"","");it.addClass("va012-mandatory");return}if(n[0]._cmbTaxRate==null||n[0]._cmbTaxRate==""||n[0]._cmbTaxRate=="0"){VIS.ADialog.info("VA012_PleaseSelectTaxRate",null,"","");ut.addClass("va012-mandatory");return}}if(parseFloat(n[0]._txtDifference)!=0&&n[0]._cmbVoucherMatch=="M"&&(n[0]._cmbDifferenceType==null||n[0]._cmbDifferenceType==""||n[0]._cmbDifferenceType=="0")){VIS.ADialog.info("VA012_PleaseSelectDifferenceType",null,"","");return}if(parseFloat(n[0]._txtDifference)!=0&&n[0]._cmbDifferenceType=="CH"){if(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0"){VIS.ADialog.info("VA012_PleaseSelectCharge",null,"","");it.addClass("va012-mandatory");return}if(n[0]._cmbTaxRate==null||n[0]._cmbTaxRate==""||n[0]._cmbTaxRate=="0"){VIS.ADialog.info("VA012_PleaseSelectTaxRate",null,"","");ut.addClass("va012-mandatory");return}}if(parseFloat(n[0]._txtDifference)!=0&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlPayment)!=0&&n[0]._cmbDifferenceType!="CH"){VIS.ADialog.info("VA012_PlsSelectDiffTypeCharge",null,"","");return}if(i==undefined&&(i=go),VIS.Utility.Util.getValueOfDecimal(n[0]._txtDifference)!=0&&VIS.Utility.Util.getValueOfInt(n[0]._scheduleList.length)>0&&Math.abs(r(i.getControl().val()))>Math.abs(r(l.getControl().val()))&&n[0]._cmbDifferenceType!="CH"){VIS.ADialog.info("MoreScheduleAmount",null,"","");return}if(VIS.Utility.Util.getValueOfString(n[0]._scheduleList)==""&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlPayment)==0&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlOrder)==0&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlCashLine)==0&&VIS.Utility.Util.getValueOfInt(n[0]._cmbCharge)==0){VIS.ADialog.info("VA012_PleaseSelectAnyOne",null,"","");return}if(VIS.Utility.Util.getValueOfString(n[0]._cmbDifferenceType)=="CH"||VIS.Utility.Util.getValueOfString(n[0]._cmbVoucherMatch)=="V"){if(f=VIS.Utility.Util.getValueOfInt(n[0]._cmbTaxRate),t=0,t=VIS.Utility.Util.getValueOfString(n[0]._cmbDifferenceType)=="CH"?VIS.Utility.Util.getValueOfDecimal(n[0]._txtDifference):VIS.Utility.Util.getValueOfDecimal(n[0]._txtAmount),n[0]._cmbVoucherMatch=="V"&&(n[0]._txtDifference=0),f>0&&t!=0){le(n[0]._cmbTaxRate,t,b,i);function i(t){t=JSON.parse(t);t!=null&&(n[0]._surChargeAmt=t.SurchargeAmt,n[0]._txtTaxAmount=t.TaxAmt,lt(s,!0,"absolute"),u.insertNewRecord(n,u.afterInsertion))}}}else lt(s,!0,"absolute"),u.insertNewRecord(n,u.afterInsertion)});dt.on("keypress",function(){si.val("1");ur.val("10")});dt.on("change",function(){dt.val()==""?dt.addClass("va012-mandatory"):dt.removeClass("va012-mandatory")});ur.on("keypress",function(n){if(n.which!=8&&n.which!=0&&(n.which<48||n.which>57))return!1});si.on("keypress",function(n){if(n.which!=8&&n.which!=0&&(n.which<48||n.which>57))return!1});si.on("change",function(){_origin="LO";t.ajax({url:VIS.Application.contextUrl+"BankStatement/MaxStatement",type:"GET",datatype:"json",data:{_bankAccount:h.val()==null?0:h.val(),_origin:_origin,_pageNo:si.val()<=0?0:si.val()},contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),si.val()<=0&&dt.val()==n.statementNo?(ur.val(n.lineno),si.val(n.pageno),VIS.ADialog.info("VA012_NotAcceptZero",null,"","")):si.val()>0&&dt.val()==n.statementNo?ur.val(n.lineno):si.val()<=0&&(si.val("1"),VIS.ADialog.info("VA012_NotAcceptZero",null,"","")))}})});fe.on(VIS.Events.onTouchStartOrClick,function(){u.scheduleRefresh();u.prepayRefresh();u.refreshForm();(dt.val()==""||dt.val()==null)&&dt.val("0");v.getMaxStatement("BT");f.attr("data-uid",0);lu(!1)});bt.getControl().on("change",function(){r(bt.getControl().val())==0||r(bt.getControl().val())==null?bt.setValue(0):bt.setValue(VIS.Utility.Util.getValueOfDecimal(r(bt.getControl().val())))});l.getControl().on("blur",function(n,u,e){if(y.val()!="V")if(VIS.Utility.Util.getValueOfDecimal(u)!=0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(u).toFixed(b)))),VIS.Utility.Util.getValueOfDecimal(e)!=0&&(l.setValue(),l.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(e).toFixed(b)))),VIS.Utility.Util.getValueOfDecimal(r(l.getControl().val()))==0?(l.setValue(0),l.getControl().addClass("va012-mandatory")):VIS.Utility.Util.getValueOfDecimal(r(l.getControl().val()))<0?l.getControl().addClass("va012-mandatory"):(l.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(r(l.getControl().val())).toFixed(b))),l.getControl().removeClass("va012-mandatory")),w.getControl().attr("vchangable")=="Y"&&(w.setValue(0),pi.find("*").prop("disabled",!0)),y.val()=="M"||y.val()=="C"){if(w.getControl().attr("vchangable")=="Y"&&(w.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(r(l.getControl().val())-r(i.getControl().val())).toFixed(b))),VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0?(VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))<0?(w.getControl().addClass("va012-mandatory"),t("#Ast_Difference_"+$self.windowNo).show()):w.getControl().removeClass("va012-mandatory"),r(l.getControl().val())==0?(pi.find("*").prop("disabled",!0),k.val("0")):pi.find("*").prop("disabled",!1),(d.length==0||d.length>0&&f.attr("data-uid")!=0&&Math.abs(r(l.getControl().val()))<Math.abs(r(i.getControl().val())))&&(VIS.Utility.Util.getValueOfInt(ht.value)==0&&f.attr("data-uid")==0||f.attr("data-uid")!=0)&&(k.find("option[value=0]").prop("disabled",!0),k.find("option[value=OU]").prop("disabled",!0),k.find("option[value=DA]").prop("disabled",!0),k.find("option[value=WO]").prop("disabled",!0),k.val()!="CH"&&k.val("0").prop("selected",!0)),k.val()<=0&&r(l.getControl().val())!=0?(k.addClass("va012-mandatory"),t("#Ast_DifferenceType_"+$self.windowNo).show()):k.removeClass("va012-mandatory")):(pi.find("*").prop("disabled",!0),k.val("0").prop("selected",!0),k.trigger("change"),k.removeClass("va012-mandatory"),t("#Ast_DifferenceType_"+$self.windowNo).hide())),VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0&&ut.val()>0){le(ut.val(),r(w.getControl().val()),b,n);function n(n){n=JSON.parse(n);n!=null&&n!=0&&bt.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(n.TaxAmt).toFixed(b)));ut.val()>0&&VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0&&(VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))<0?w.getControl().addClass("va012-mandatory"):w.getControl().removeClass("va012-mandatory"));VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0&&(VIS.Utility.Util.getValueOfInt(rt.getValue())!=0||VIS.Utility.Util.getValueOfInt(ot.getValue())!=0)?(k.val("CH").prop("selected",!0),k.trigger("change")):VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0&&d.toString()!=""||(k.val("0").prop("selected",!0),k.trigger("change"))}}}else VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0&&VIS.Utility.Util.getValueOfInt(rt.getValue())!=0&&(k.val("CH").prop("selected",!0),k.trigger("change"))});w.getControl().on("blur",function(){r(w.getControl().val())==0||r(w.getControl().val())==null?pi.find("*").prop("disabled",!0):pi.find("*").prop("disabled",!1)});i.getControl().on("blur",function(n,t){VIS.Utility.Util.getValueOfDecimal(t)!=0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(t).toFixed(b))));VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))==0&&(i.setValue(0),i.getControl().addClass("va012-mandatory"));var u=VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()));if(o.attr("v_active")=="1"&&u>0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(-1*u).toFixed(b)))),e.attr("v_active")=="1"&&u<0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(-1*u).toFixed(b)))),VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"),i.getControl().addClass("va012-mandatory")):VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))>0&&(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),i.getControl().removeClass("va012-mandatory")),VIS.Utility.Util.getValueOfInt(ut.val())>0&&r(i.getControl().val())!=0&&y.val()=="V"){le(ut.val(),r(i.getControl().val()),b,n);function n(n){n=JSON.parse(n);n!=null&&n!=0&&(bt.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(n.TaxAmt).toFixed(b))),ut.removeClass("va012-mandatory"));l.getControl().trigger("blur",[r(i.getControl().val()),r(l.getControl().val())])}}else l.getControl().trigger("blur",[r(i.getControl().val()),r(l.getControl().val())])});oe.hover(function(){$tooltip=t('<div  class="va012-div-tooltip"><h4>'+VIS.Msg.getMsg("VA012_Information")+"<\/h4><p>"+VIS.Msg.getMsg("VA012_InformationText")+"<\/p><\/div>");s.append($tooltip);t(".va012-div-tooltip").show()},function(){s.find(".va012-div-tooltip").remove()});nt.on("blur",function(){if(nt.val()=="")nt.addClass("va012-mandatory");else if(!(f[0].attributes["data-uid"].value>0)||!(rt.getValue()>0||ot.getValue()>0||ni.getValue()>0||ht.getValue()>0||d.length>0)){nt.removeClass("va012-mandatory");var u=0,n=null,t=null;if(y.val()=="M"?rr.val()!=0&&(rt.getValue()==null||rt.getValue()==0)?d.length!=0&&(n="IS",t=d.join()):(rr.val()==null||rr.val()==0)&&rt.getValue()!=null&&rt.getValue()!=0?(n="PY",t=rt.getValue()):VIS.Utility.Util.getValueOfInt(ht.value)!=0&&VIS.Utility.Util.getValueOfInt(st.value)!=0&&(n="PO",t=ht.value,i.getControl().attr("disabled",!0)):y.val()=="C"&&VIS.Utility.Util.getValueOfInt(ot.value)!=0&&VIS.Utility.Util.getValueOfInt(rt.getValue())==0&&VIS.Utility.Util.getValueOfInt(rr.val())==0&&(n="CO",t=ot.value),n!=null&&t!=null){VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetConvtAmount",{recordID:t,bnkAct_Id:h.val(),transcType:n,stmtDate:nt.val()},f);function f(t){for(var f=0;f<t.length;f++){if(t.length==0||t[f].DueAmount==0){i.setValue();l.setValue();w.setValue();w.getControl().trigger("blur");i.getControl().trigger("blur",[r(i.getControl().val()),r(l.getControl().val())]);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}u+=t[f].DueAmount}if(u!=0)i.setValue(u),n!="PO"?(l.setValue(u),i.getControl().trigger("blur",[r(i.getControl().val()),r(l.getControl().val())])):(i.getControl().removeClass("va012-mandatory"),i.getControl().attr("disabled",!0),e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"));else{i.setValue();l.setValue();w.setValue();w.getControl().trigger("blur");VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}}}}});oe.mousemove(function(n){t(".va012-div-tooltip").css("top",n.pageY-50).css("left",n.pageX)});e.on(VIS.Events.onTouchStartOrClick,function(){r(l.getControl().val())==0&&VIS.Utility.Util.getValueOfInt(ht.value)>0||y.val()!="M"&&(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))<0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))*-1),e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),i.getControl().trigger("blur",[r(i.getControl().val()),r(l.getControl().val())]))});o.on(VIS.Events.onTouchStartOrClick,function(){r(l.getControl().val())==0&&VIS.Utility.Util.getValueOfInt(ht.value)>0||y.val()!="M"&&(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))>0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))*-1),o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"),i.getControl().trigger("blur",[r(i.getControl().val()),r(l.getControl().val())]))})},getNewRecordDesign:function(){},getNewRecordControls:function(){dt=f.find("#VA012_txtStatementNo_"+$self.windowNo);fe=f.find("#VA012_btnStatementNo_"+$self.windowNo);si=f.find("#VA012_txtStatementPage_"+$self.windowNo);ur=f.find("#VA012_txtStatementLine_"+$self.windowNo);nt=f.find("#VA012_dtStatementDate_"+$self.windowNo);et=f.find("#VA012_cmbContraType_"+$self.windowNo);vr=f.find("#VA012_cmbCashBook_"+$self.windowNo);pr=f.find("#VA012_cmbTransferType_"+$self.windowNo);yu=f.find("#VA012_txtCheckNo_"+$self.windowNo);y=f.find("#VA012_cmbVoucherMatch_"+$self.windowNo);i.getControl().addClass("va012-mandatory");l.getControl().addClass("va012-mandatory");k=f.find("#VA012_cmbDifferenceType_"+$self.windowNo);wr=f.find("#VA012_txtVoucherNo_"+$self.windowNo);ou=f.find("#VA012_txtDescription_"+$self.windowNo);br=f.find("#VA012_cmbCharge_"+$self.windowNo);it=f.find("#VA012_txtCharge_"+$self.windowNo);ut=f.find("#VA012_cmbTaxRate_"+$self.windowNo);nf=f.find("#VA012_ctrlCashLine_"+$self.windowNo);su=f.find("#VA012_ctrlPayment_"+$self.windowNo);lf=f.find("#VA012_ctrlOrder_"+$self.windowNo);af=f.find("#VA012_ctrlInvoice_"+$self.windowNo);vf=f.find("#VA012_ctrlBusinessPartner_"+$self.windowNo);tf=f.find("#VA012_chkUseNextTime_"+$self.windowNo);yf=f.find("#VA012_btnSave_"+$self.windowNo);kr=f.find("#VA012_btnPaymentSchedule_"+$self.windowNo);no=f.find("#VA012_btnPrepay_"+$self.windowNo);rr=f.find("#VA012_txtPaymentSchedule_"+$self.windowNo);ee=f.find("#VA012_txtPrepayOrder_"+$self.windowNo);kt=ue.find("#VA012_btnNewRecord_"+$self.windowNo);to=ue.find("#VA012_btnUndo_"+$self.windowNo);io=s.find("#VA012_btnDelete_"+$self.windowNo);oe=f.find("#VA012_btnAmount_"+$self.windowNo);e=f.find("#VA012_btnIn_"+$self.windowNo);o=f.find("#VA012_btnOut_"+$self.windowNo);c=f.find("#VA012_txtCurrency_"+$self.windowNo);p=f.find("#VA012_txtConversionType_"+$self.windowNo);a=f.find("#VA012_txtPaymentMethod_"+$self.windowNo);g=f.find("#VA012_txtCheckNum_"+$self.windowNo);ft=f.find("#VA012_txtCheckDate_"+$self.windowNo);ff=f.find("#VA012_ctrlTrxOrg_"+$self.windowNo)},loadPaymentMethod:function(){function n(n){if(_cmbPaymentMethod.html(""),_cmbPaymentMethod.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)_cmbPaymentMethod.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].Value)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");_cmbPaymentMethod.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/LoadPaymentMethod",{AD_Client:VIS.Env.getCtx().getAD_Client_ID(),AD_Org:VIS.Env.getCtx().getAD_Org_ID()},n)},loadCurrency:function(){var n=VIS.Utility.Util.getValueOfInt(t("option:selected",h).attr("currencyid")),i=VIS.Utility.Util.getValueOfInt(t("option:selected",h).attr("stdprecision"));n>0?at=n:n=null;b=i>0?i:null},loadCashBook:function(){function n(n){if(vr.html(""),vr.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)vr.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].Value)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");vr.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/LoadCashbook",null,n)},loadContraType:function(){et.html("");et.append("<option value=0 ><\/option>");et.append("<option value='BB' >"+VIS.Msg.getMsg("VA012_BankToBank")+"<\/option>");et.append("<option value='CB' >"+VIS.Msg.getMsg("VA012_CashToBank")+"<\/option>");et.prop("selectedIndex",0)},loadTransferType:function(){pr.html("");pr.append("<option value=0 ><\/option>");pr.append("<option value='CH' >"+VIS.Msg.getMsg("VA012_Cash")+"<\/option>");pr.append("<option value='CK' >"+VIS.Msg.getMsg("VA012_Check")+"<\/option>");pr.prop("selectedIndex",0)},loadVoucherMatch:function(){y.html("");y.append("<option value='M' >"+VIS.Msg.getMsg("VA012_Payment")+"<\/option>");y.append("<option value='V' >"+VIS.Msg.getMsg("VA012_Voucher")+"<\/option>");y.append("<option value='C' >"+VIS.Msg.getMsg("VA012_Contra")+"<\/option>");y.prop("selectedIndex",0)},loadDifferenceType:function(){k.html("");k.append("<option value=0 ><\/option>");k.append("<option value='OU' >"+VIS.Msg.getMsg("VA012_OverUnderPayment")+"<\/option>");k.append("<option value='DA' >"+VIS.Msg.getMsg("VA012_DiscountAmount")+"<\/option>");k.append("<option value='WO' >"+VIS.Msg.getMsg("VA012_WriteoffAmount")+"<\/option>");k.append("<option value='CH' >"+VIS.Msg.getMsg("VA012_Charge")+"<\/option>");k.prop("selectedIndex",0)},loadCharge:function(){function n(n){if(br.html(""),br.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)br.append("<option value="+n[t].chargeID+">"+VIS.Utility.encodeText(n[t].name)+"<\/option>");br.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetChargeData",{voucherType:y.val()!=null?y.val():"",bankAcct:h.val()!=null?h.val():0},n)},loadTaxRate:function(){function n(n){if(ut.html(""),ut.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)ut.append("<option value="+n[t].C_Tax_ID+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");ut.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/LoadTaxRate",null,n)},loadPayment:function(){su!=undefined&&su!=null&&su.empty();var n=VIS.Utility.Util.getValueOfInt(h.val())!=0?"C_Payment.DocStatus IN ('CO','CL') AND C_Payment.IsReconciled = 'N' AND C_Payment.C_BankAccount_ID = @BankAccount_ID@":"C_Payment.DocStatus IN ('CO','CL') AND C_Payment.IsReconciled = 'N' ";oo=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,0,VIS.DisplayType.Search,"C_Payment_ID",0,!1,n);rt=new VIS.Controls.VTextBoxButton("C_Payment_ID",!1,!1,!0,VIS.DisplayType.Search,oo);rt.getControl().addClass("va012-input-size-2");rt.getControl().attr("tabindex","10");su.append(rt.getControl());su.append(rt.getBtn(0));su.append(rt.getBtn(1));rt.fireValueChanged=function(){if(VIS.Utility.Util.getValueOfInt(rt.value)!=0&&VIS.Utility.Util.getValueOfInt(fi)!=0){VIS.Utility.Util.getValueOfInt(fi)==rt.value?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(rt.setValue(fi,!1,!0),VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"",""));return}if(fi=0,fi=rt.value,ri||ar||rt.value&&(v.checkPaymentCondition(fi,0,r(i.getControl().val()))?v.setInvoiceAndBPartner(fi,"PY"):rt.setValue()),ar=!1,!rt.value&&fi==null&&rt.value==null){var n=f[0].attributes["data-uid"].value;f[0].attributes["data-uid"].value!=0||fi!=null||rt.value||u.refreshForm();n>0&&fi==null&&rt.value==null&&tt.statementListRecordEdit(n,0,!0)}};ar=!1},loadOrder:function(){bo=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,5043,VIS.DisplayType.Search,"C_Order_ID",0,!1,"C_ORDER.C_ORDER_ID IN (SELECT ORD.C_ORDER_ID  FROM C_Order ORD  LEFT JOIN C_DocType DT  ON (ORD.C_DOCTYPETARGET_ID=DT.C_DOCTYPE_ID)  INNER JOIN VA009_PaymentMethod PM  ON (PM.VA009_PAYMENTMETHOD_ID =ORD.VA009_PAYMENTMETHOD_ID )  WHERE DT.DOCSUBTYPESO         ='PR'   AND ORD.DOCSTATUS             ='WP'   AND ORD.ISACTIVE              ='Y'   AND PM.VA009_PAYMENTBASETYPE !='B')");ht=new VIS.Controls.VTextBoxButton("C_Order_ID",!1,!1,!0,VIS.DisplayType.Search,bo,kf("VAS_SalesOrder,Sales Order"));ht.getControl().addClass("va012-input-size-2");ht.getControl().attr("tabindex","13");lf.append(ht.getControl());lf.append(ht.getBtn(0));lf.append(ht.getBtn(1));ht.fireValueChanged=function(){if(VIS.Utility.Util.getValueOfInt(ht.value)!=0&&VIS.Utility.Util.getValueOfInt(gt)!=0){VIS.Utility.Util.getValueOfInt(gt)==ht.value?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(ht.setValue(gt,!1,!0),VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"",""));return}if(gt=0,gt=ht.value,ht.value&&(ri||(v.checkPrepayCondition(ht.value,0,null,r(i.getControl().val()))?(v.setInvoiceAndBPartner(gt,"PO"),(f[0].attributes["data-uid"].value>0&&!gt||f[0].attributes["data-uid"].value==0&&gt)&&i.getControl().attr("disabled",!0)):(gt=0,ht.setValue()))),!gt&&!ht.value){var n=f[0].attributes["data-uid"].value;f[0].attributes["data-uid"].value!=0||gt!=null||ht.value||u.refreshForm();n>0&&gt==null&&!ht.value&&tt.statementListRecordEdit(n,0,!0)}}},loadCashLine:function(){var n=" C_CASHLINE_ID IN (SELECT CSL.C_CASHLINE_ID  FROM C_Cash CS  INNER JOIN C_CashLine CSL  ON (CS.C_CASH_ID=CSL.C_CASH_ID)  INNER JOIN C_Charge chrg  ON (chrg.c_charge_id =csl.c_charge_id)  WHERE CS.ISACTIVE          ='Y'  AND CSL.CashType           ='C'  AND chrg.dtd001_chargetype ='CON'  AND CS.DOCSTATUS          IN ('CO','CL')  AND CSL.VA012_ISRECONCILED ='N'  AND CSL.C_BankAccount_ID ="+(h.val()==null?0:h.val())+" )";nf.html("");eo=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,1008317,VIS.DisplayType.Search,"C_CashLine_ID",0,!1,n);ot=new VIS.Controls.VTextBoxButton("C_CashLine_ID",!1,!1,!0,VIS.DisplayType.Search,eo);ot.getControl().addClass("va012-input-size-2");ot.getControl().attr("tabindex","10");nf.append(ot.getControl());nf.append(ot.getBtn(0));nf.append(ot.getBtn(1));ot.fireValueChanged=function(){if(VIS.Utility.Util.getValueOfInt(ot.value)!=0&&VIS.Utility.Util.getValueOfInt(ci)!=0){VIS.Utility.Util.getValueOfInt(ci)==ot.value?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(ot.setValue(ci,!1,!0),VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"",""));return}if(ci=0,ci=ot.value,ot.value&&(ri||ar||v.checkContraCondition(ot.value,0,r(i.getControl().val()))||(ci=0,ot.setValue()),ar=!1),ar=!1,ci==null&&ot.value==null){var n=f[0].attributes["data-uid"].value;f[0].attributes["data-uid"].value!=0||ci!=null||ot.value||u.refreshForm();n>0&&ci==null&&ot.value==null&&tt.statementListRecordEdit(n,0,!0)}}},loadBusinessPartner:function(){se=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,2893,VIS.DisplayType.Search,"C_BPartner_ID",0,!1,null);st=new VIS.Controls.VTextBoxButton("C_BPartner_ID",!1,!1,!0,VIS.DisplayType.Search,se,kf("VAS_BusinessPartner,Business Partner"));st.getControl().addClass("va012-input-size-2");st.getControl().attr("tabindex","12");vf.append(st.getControl());vf.append(st.getBtn(0));vf.append(st.getBtn(1));st.fireValueChanged=function(){hu=0;hu=st.value;hu>0?(fu.find("*").prop("disabled",!0),ef=0,nr.setValue()):(fu.find("*").prop("disabled",!1),ef=0)}},loadTrxOrg:function(){var n="AD_Org.IsActive='Y' AND AD_Org.IsSummary ='N' AND (AD_Org.IsCostCenter='Y' OR AD_Org.IsProfitCenter='Y') AND CAST(AD_Org.LegalEntityOrg AS int) IN(0,@BankAccount_Org_ID@) AND AD_Org.AD_Client_ID = "+VIS.context.getAD_Client_ID(),t=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,0,VIS.DisplayType.Search,"AD_Org_ID",0,!1,n);nr=new VIS.Controls.VTextBoxButton("AD_Org_ID",!1,!1,!0,VIS.DisplayType.Search,t,kf("Organization Units"));nr.getControl().addClass("va012-input-size-2");nr.getControl().attr("tabindex","13");ff.append(nr.getControl());ff.append(nr.getBtn(0));ff.append(nr.getBtn(1));nr.fireValueChanged=function(){ef=0;ef=nr.value}},loadInvoice:function(){so=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,3484,VIS.DisplayType.MultiKey,"C_Invoice_ID",0,!1,"DocStatus IN ('CO','CL')");ni=new VIS.Controls.VTextBoxButton("C_Invoice_ID",!1,!1,!0,VIS.DisplayType.MultiKey,so);ni.isMultiKeyTextBox=!0;ni.getControl().addClass("va012-input-size-2");ni.getControl().attr("tabindex","11");af.append(ni.getControl());af.append(ni.getBtn(0));af.append(ni.getBtn(1));ni.fireValueChanged=function(){cu=null;cu=ni.value;ni.value&&(v.checkInvoiceCondition(cu,r(i.getControl().val()))?v.setBPartner(cu):ni.setValue())}},getFormData:function(){var n={},t=[];return n._bankStatementLineID=f.attr("data-uid"),n._txtStatementNo=dt.val(),n._txtStatementPage=si.val(),n._txtStatementLine=ur.val(),n._dtStatementDate=nt.val(),n._cmbCurrency=at,n._cmbVoucherMatch=y.val(),n._txtDescription=VIS.Utility.encodeText(ou.val()),n._txtVoucherNo=VIS.Utility.encodeText(wr.val()),n._cmbCharge=it.attr("chargeid"),n._cmbTaxRate=ut.val(),n._txtTaxAmount=r(bt.getControl().val()),n._ctrlPayment=fi,n._ctrlOrder=gt,n._ctrlCashLine=ci,n._ctrlInvoice=cu,n._ctrlBusinessPartner=hu,n._chkUseNextTime=tf.is(":checked"),n._cmbBank=ir.val(),n._cmbBankAccount=h.val(),n._cmbBankAccountClasses=ne.val(),n._cmbTransactionType=ct.val(),n._scheduleList=d.toString(),n._cmbContraType=et.val(),n._cmbCashBook=vr.val(),n._cmbTransferType=pr.val(),n._txtCheckNo=yu.val(),n._cmbDifferenceType=k.val(),go=i,k.val()=="CH"&&y.val()!="C"?(n._txtAmount=r(i.getControl().val()),n._txtTrxAmt=r(l.getControl().val())):(n._txtAmount=r(i.getControl().val()),n._txtTrxAmt=r(l.getControl().val())),n._txtDifference=r(w.getControl().val()),n._txtConversionType=p.val(),n._txtCurrency=c.val(),n._txtPaymentMethod=a.val(),n._txtCheckNum=g.val(),n._txtCheckDate=ft.val(),n._ctrlTrxOrg=ef,n._EftOrManualCheckNo=ki,n._OverrideAutoCheck=iu,t.push(n),t},insertNewRecord:function(n,i){var r=h.children()[h[0].selectedIndex].getAttribute("stdprecision");ii=VIS.Utility.Util.getValueOfInt(n[0]._bankStatementLineID)!=0?VIS.Utility.Util.getValueOfInt(n[0]._bankStatementLineID):0;t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/InsertData",contentType:"application/json; charset=utf-8",data:JSON.stringify({_formData:n,stdprecision:r}),success:function(n){i(n)},error:function(n){VIS.ADialog.info(n,null,"","")}})},afterInsertion:function(n){if(n!=null&&n!=""){var i=t.parseJSON(n);i=="Success"?(lt(s,!1,"absolute"),VIS.ADialog.info("VA012_RecordSaved",null,"",""),ti=[],yt.html(""),vi=1,ei=[],tt.loadStatement(li),oi.html(""),u.scheduleRefresh(),u.prepayRefresh(),ge=!0,bi=1,storepaymentdata=[],v.loadPayments(h.val(),wt.val(),ct.val(),vt.val()),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),c.addClass("va012-mandatory"),p.addClass("va012-mandatory"),setTimeout(function(){var n=ei.indexOf(ii);ei.length>n+1&&ei[n+1]!=0&&(ii=ei[n+1],s.find('span.glyphicon-edit[data-uid="'+ei[n+1]+'"]').trigger("click"))},1e3)):(lt(s,!1,"absolute"),i.contains(" ")?VIS.ADialog.info("",null,i,""):VIS.ADialog.info(i,null,"",""))}},refreshForm:function(n){f.attr("data-uid",0);(event==undefined||event.currentTarget.id!=fe[0].id)&&v.getMaxStatement("LO");nt.attr("readonly",!1);var r=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetStatementDate",{bankAcct:h.val()});r!=""&&r!=null?nt.val(Globalize.format(new Date(r),"yyyy-MM-dd")):(cr=new Date,wf=cr.getFullYear()+"-"+("0"+(cr.getMonth()+1)).slice(-2)+"-"+("0"+cr.getDate()).slice(-2),nt.val(wf));y.prop("selectedIndex",0);y.trigger("change");i.getControl().attr("disabled",!1);i.setValue(0);l.setValue(0);w.setValue(0);w.getControl().trigger("blur");w.getControl().attr("vchangable","Y");k.prop("selectedIndex",0);k.removeClass("va012-mandatory");w.getControl().removeClass("va012-mandatory");t("#Ast_DifferenceType_"+$self.windowNo).hide();t("#Ast_Difference_"+$self.windowNo).hide();t("#Ast_CashJournalLine_"+$self.windowNo).hide();ot.getControl().removeClass("va012-mandatory");ou.val("");wr.val("");br.prop("selectedIndex",0);it.attr("chargeid",0);it.val("");ut.prop("selectedIndex",0);bt.setValue(0);tf.attr("checked",!1);rt.setValue();ht.setValue();ot.setValue();st.setValue();n==undefined&&ni.setValue();hu=0;fi=0;gt=0;ci=0;cu=null;e.trigger("click");u.loadCurrency();et.prop("selectedIndex",0);vr.prop("selectedIndex",0);pr.prop("selectedIndex",0);yu.val("");this.setNewFormDefaultCurrency();t(c[0]).find("option").show();this.setNewFormDefaultConversionType();a.attr("disabled",!1);t(".astric_"+$self.windowNo).hide();a.addClass("va012-mandatory");this.loadPaymentMethods();p.attr("disabled",!1);c.attr("disabled",!1);hr=!1;g.val("");tu.hide();g.removeClass("va012-mandatory");ft.val("");sr.hide();ft.removeClass("va012-mandatory");lo=null;iu=!1;ki=null;tr=null;eu=0;nr.setValue()},scheduleRefresh:function(){d=[];di=[];pt=[];rr.val("");tr=null;eu=0},prepayRefresh:function(){au=[];vu=[];ee.val("");tr=null;eu=0},refreshSelectedValues:function(){f.attr("data-uid",0);v.getMaxStatement("LO");nt.attr("readonly",!1);var n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetStatementDate",{bankAcct:h.val()});n!=""&&n!=null?nt.val(Globalize.format(new Date(n),"yyyy-MM-dd")):(cr=new Date,wf=cr.getFullYear()+"-"+("0"+(cr.getMonth()+1)).slice(-2)+"-"+("0"+cr.getDate()).slice(-2),nt.val(wf));i.getControl().attr("disabled",!1);i.setValue(0);l.setValue(0);w.setValue(0);w.getControl().trigger("blur");w.getControl().attr("vchangable","Y");k.prop("selectedIndex",0);k.removeClass("va012-mandatory");t("#Ast_DifferenceType_"+$self.windowNo).hide();ou.val("");wr.val("");br.prop("selectedIndex",0);it.attr("chargeid",0);it.val("");ut.prop("selectedIndex",0);bt.setValue(0);tf.attr("checked",!1);rt.setValue();ht.setValue();ot.setValue();st.setValue();ni.setValue();hu=0;fi=0;gt=0;ci=0;cu=null;u.scheduleRefresh();e.trigger("click");et.prop("selectedIndex",0);vr.prop("selectedIndex",0);pr.prop("selectedIndex",0);yu.val("");this.loadNewFormCurrency();p.addClass("va012-mandatory");this.loadConversionTypes();this.loadPaymentMethods();a.attr("disabled",!1);a.addClass("va012-mandatory");c.addClass("va012-mandatory");p.prop("selectedIndex",0);p.attr("disabled",!1);c.attr("disabled",!1);hr=!1;g.val("");tu.hide();g.removeClass("va012-mandatory");ft.val("");sr.hide();ft.removeClass("va012-mandatory")},newRecordDispose:function(){f=null;ue=null;dt=null;fe=null;si=null;ur=null;nt=null;et=null;vr=null;pr=null;yu=null;at=null;y=null;i=null;w=null;k=null;oe=null;e=null;o=null;ou=null;wr=null;br=null;it=null;ut=null;bt=null;nf=null;lf=null;su=null;af=null;vf=null;tf=null;yf=null;kr=null;no=null;rr=null;ee=null;kt=null;to=null;io=null;gi=null;wo=null;oo=null;ht=null;gt=null;rt=null;rs=null;fi=null;ot=null;eo=null;ci=null;se=null;st=null;hu=null;so=null;ni=null;cu=null;wf=null;cr=null;c=null;p=null;hr=null;a=null;ft=null;g=null;ff=null;nr=null;ef=null},loadNewFormCurrency:function(){var n=null,u,i,r;if(t(c[0]).empty(),u=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,457,VIS.DisplayType.TableDir,"C_Currency_ID",0,!1,"IsMyCurrency='Y'"),n=u.getData(!0,!0,!1,!1),c.append('<option value="0" ><\/option>'),n!=null&&n!=undefined&&n.length>0){for(i=0;i<n.length;i++)c.append("<option value="+n[i].Key+">"+n[i].Name+"<\/option>");r=VIS.Utility.Util.getValueOfInt(t("option:selected",h).attr("currencyid"));c.val(r);r<=0?c.addClass("va012-mandatory"):c.removeClass("va012-mandatory")}},loadConversionTypes:function(){var n=null,u,i,r;if(t(p[0]).empty(),u=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,10269,VIS.DisplayType.TableDir,"C_ConversionType_ID",0,!1,"IsActive='Y'"),n=u.getData(!0,!0,!1,!1),p.append('<option value="0" ><\/option>'),n!=null&&n!=undefined&&n.length>0){for(i=0;i<n.length;i++)p.append("<option value="+n[i].Key+">"+n[i].Name+"<\/option>");r=VIS.Env.getCtx().getContextAsInt("#C_ConversionType_ID");r!=0?(p.val(r),p.removeClass("va012-mandatory")):(p.val(0),p.addClass("va012-mandatory"))}},loadPaymentMethods:function(){if(t(a[0]).empty(),ho&&(a.append('<option value="0" ><\/option>'),wu!=null&&wu.length>0)){for(var n=0;n<wu.length;n++)a.append("<option paymentbasetype="+wu[n].PaymentBaseType+" value="+wu[n].chargeID+">"+VIS.Utility.encodeText(wu[n].name)+"<\/option>");a.val(0);a.addClass("va012-mandatory");tu.hide();g.removeClass("va012-mandatory");sr.hide();ft.removeClass("va012-mandatory")}},setNewFormDefaultCurrency:function(){var n=VIS.Utility.Util.getValueOfInt(t("option:selected",h).attr("currencyid"));c.val(n);n<=0?c.addClass("va012-mandatory"):c.removeClass("va012-mandatory")},setNewFormDefaultConversionType:function(){var n=VIS.Env.getCtx().getContextAsInt("#C_ConversionType_ID");n!=0?(p.val(n),p.removeClass("va012-mandatory")):(p.val(0),p.addClass("va012-mandatory"))}};t(window).resize(function(){v.setPaymentListHeight();tt.setStatementListHeight();re.height(t("#VA012_mainContainer_"+$self.windowNo).height())});this.getRoot=function(){return s};this.setSize=function(){var n=t("#VA012_mainContainer_"+$self.windowNo).height();n==0&&(n=window.innerHeight-107);re.height(n);v.setPaymentListHeight();tt.setStatementListHeight()};this.disposeComponents=function(){$self=null;s=null;ir=null;h=null;ne=null;vt=null;yo=null;wt=null;ct=null;ve=null;ye=null;yt=null;oi=null;li="";du=null;gu=null;ts=null;is=null;dr=null;ru=null;_divCtrlCashLine=null;gr=null;uu=null;yi=null;po=null;divRow4Col1TrxAmt=null;rf=null;pi=null;hi=null;ro=null;ui=null;wi=null;fr=null;er=null;yr=null;or=null;nu=null;ai=null;uo=null;pe=null;we=null;be=null;ie=null;re=null;sf=null;ao=null;ti=[];d=[];di=[];au=[];vu=[];u.newRecordDispose();ho=null;pu=_txtSearchPayment=_btnSearchPayment=null;lo=null;fu=null;ff=null;nr=null;iu=!1;ki=null;bu=null;tr=null;eu=0;he=0}}i.prototype.sizeChanged=function(n){_table.height(n)};i.prototype.refresh=function(){this.setSize()};i.prototype.dispose=function(){this.disposeComponents();this.frame&&this.frame.dispose();this.frame=null};i.prototype.init=function(n,t,i){this.windowNo=n;this.frame=t;this.FormInfo=i;this.Initialize();this.frame.getContentGrid().append(this.getRoot());this.setSize()};n.AForms=n.AForms||{};n.AForms.bankStatement=i}(VA012,jQuery);VA012=window.VA012||{},function(n,t){n.VA012_BankConnectWidget=function(){function y(){o=r.find("#VA012-bnkcnt-Create_"+widgetID);s=r.find("#VA012-bnkcnt-Connect_"+widgetID)}function p(){o.on("click",function(){u.widgetFirevalueChanged({TabLayout:"Y",IsTabInNewMode:!0,TabIndex:"0"})});s.on("click",function(){i.css("visibility","visible");window.setTimeout(function(){w()},200)})}function w(){var u,r;n=t("<div class='va012-popform-content'>");u='<div class="VA012_bankCnt-container"><div class="VA012-bankCnt-selection" id="VA012-bnkcnt-Selection_'+widgetID+'"><div class="input-group vis-input-wrap" id="VA012-bnkcnt-Country_'+widgetID+'"><\/div><div class="input-group vis-input-wrap" id="VA012-bnkcnt-ConnectVia_'+widgetID+'"><\/div><\/div><div class="VA012_bankCnt-header"><h2>'+VIS.Msg.getMsg("VA012_BankFeed")+"<\/h2><button>"+VIS.Msg.getMsg("VA012_ConnectNow")+"<\/button><\/div><p>"+VIS.Msg.getMsg("VA012_BankConnectDesc")+'<\/p><div class="VA012_bankCnt-banks-grid"><div class="VA012_bankCnt-bank-card" id="VA012-bnkcnt-iciciSelected_'+widgetID+'"><img src="Areas/VA012/Images/icici.jpg" alt="ICICI Bank"><span>'+VIS.Msg.getMsg("VA012_ICICIBank")+'<\/span><\/div><div class="VA012_bankCnt-bank-card" id="VA012-bnkcnt-hdfcSelected_'+widgetID+'"><img src="Areas/VA012/Images/hdfc.jpg" alt="HDFC Bank"><span>'+VIS.Msg.getMsg("VA012_HDFCBank")+'<\/span><\/div><div class="VA012_bankCnt-bank-card" id="VA012-bnkcnt-sbiSelected_'+widgetID+'"><img src="Areas/VA012/Images/sbi.jpg" alt="State Bank of India"><span>'+VIS.Msg.getMsg("VA012_SBIBank")+'<\/span><\/div><div class="VA012_bankCnt-bank-card" id="VA012-bnkcnt-kotakSelected_'+widgetID+'"><img src="Areas/VA012/Images/kotak.png" alt="Kotak Mahindra Bank"><span>'+VIS.Msg.getMsg("VA012_KotakBank")+'<\/span><\/div><div class="VA012_bankCnt-bank-card" id="VA012-bnkcnt-axisSelected_'+widgetID+'"><img src="Areas/VA012/Images/axis.jpg" alt="Axis Bank"><span>'+VIS.Msg.getMsg("VA012_AxisBank")+'<\/span><\/div><div class="VA012_bankCnt-bank-card" id="VA012-bnkcnt-hsbcSelected_'+widgetID+'"><img src="Areas/VA012/Images/hsbc.jpg" alt="HDFC Bank Credit"><span>'+VIS.Msg.getMsg("VA012_HSBC-CreditBank")+'<\/span><\/div><div class="VA012_bankCnt-bank-card" id="VA012-bnkcnt-otherSelected_'+widgetID+'"><img src="Areas/VA012/Images/OtherBank.png" alt="Other Bank"><span>'+VIS.Msg.getMsg("VA012_OtherBank")+"<\/span><\/div><\/div><\/div>";n.append(u);b();k();d();r=new VIS.ChildDialog;r.setContent(n);r.setTitle(VIS.Msg.getMsg("VA012_ConnectBank"));r.setWidth("780px");r.setEnableResize(!1);r.setModal(!0);r.show();r.hidebuttons();i.css("visibility","hidden")}function b(){v=n.find("#VA012-bnkcnt-Selection_"+widgetID);h=n.find("#VA012-bnkcnt-Country_"+widgetID);c=n.find("#VA012-bnkcnt-ConnectVia_"+widgetID)}function k(){var s=new VIS.Controls.VLabel(VIS.Msg.getMsg("VA012_Country_ID"),"C_Country_ID",!1,!0),v=t('<div class="input-group vis-input-wrap">'),n=t('<div class="vis-control-wrap">'),r=t('<div class="input-group-append">');l=VIS.MLookupFactory.get(VIS.Env.getCtx(),u.windowNo,866,VIS.DisplayType.Table,"C_Country_ID",0,!1,"");f=new VIS.Controls.VComboBox("C_Country_ID",!0,!1,!0,l);f.setMandatory(!0);n.append(f.getControl()).append(s.getControl());r.append(f.getBtn(0));v.append(n);h.append(n).append(r);var y=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"Widget/GetReference"),p=new VIS.Controls.VLabel(VIS.Msg.getMsg("VA012_ConnectVia"),"VA012_ConnectVia",!1,!0),w=t('<div class="input-group vis-input-wrap">'),i=t('<div class="vis-control-wrap">'),o=t('<div class="input-group-append">');a=VIS.MLookupFactory.get(VIS.Env.getCtx(),u.windowNo,0,VIS.DisplayType.List,"VA012_ConnectVia",VIS.Utility.Util.getValueOfInt(y.BankConnectVia_Reference_ID),!1,"");e=new VIS.Controls.VComboBox("VA012_ConnectVia",!0,!1,!0,a,50);e.setValue("01");i.append(e.getControl()).append(p.getControl());o.append(e.getBtn(0));w.append(i);c.append(i).append(o)}function d(){n.on("click","#VA012-bnkcnt-iciciSelected_"+widgetID,function(){n.find(".VA012_bankCnt-banks-grid div").removeClass("VA012-bankCnt-bnkselected");t(this).addClass("VA012-bankCnt-bnkselected")});n.on("click","#VA012-bnkcnt-hdfcSelected_"+widgetID,function(){n.find(".VA012_bankCnt-banks-grid div").removeClass("VA012-bankCnt-bnkselected");t(this).addClass("VA012-bankCnt-bnkselected")});n.on("click","#VA012-bnkcnt-sbiSelected_"+widgetID,function(){n.find(".VA012_bankCnt-banks-grid div").removeClass("VA012-bankCnt-bnkselected");t(this).addClass("VA012-bankCnt-bnkselected")});n.on("click","#VA012-bnkcnt-kotakSelected_"+widgetID,function(){n.find(".VA012_bankCnt-banks-grid div").removeClass("VA012-bankCnt-bnkselected");t(this).addClass("VA012-bankCnt-bnkselected")});n.on("click","#VA012-bnkcnt-axisSelected_"+widgetID,function(){n.find(".VA012_bankCnt-banks-grid div").removeClass("VA012-bankCnt-bnkselected");t(this).addClass("VA012-bankCnt-bnkselected")});n.on("click","#VA012-bnkcnt-hsbcSelected_"+widgetID,function(){n.find(".VA012_bankCnt-banks-grid div").removeClass("VA012-bankCnt-bnkselected");t(this).addClass("VA012-bankCnt-bnkselected")});n.on("click","#VA012-bnkcnt-otherSelected_"+widgetID,function(){n.find(".VA012_bankCnt-banks-grid div").removeClass("VA012-bankCnt-bnkselected");t(this).addClass("VA012-bankCnt-bnkselected")})}function g(){i=t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis_widgetloader"><\/i><\/div><\/div>');r.append(i)}this.frame;this.windowNo;this.widgetInfo;var i,u=this,r=t('<div class="h-100 w-100">'),o=null,s=null,n=null,v=null,h=null,c=null,l=null,f=null,a=null,e=null;this.initalize=function(){widgetID=this.widgetInfo.AD_UserHomeWidgetID;var n='<div class="vis-dynamicWidget-main" style="background-color: #e1f0fa; padding-top: 25px;"><div class="vis-add-row"><button id="VA012-bnkcnt-Create_'+widgetID+'" class="vis-widget-field VA012_bankCnt-NewBtn" index="0">'+VIS.Msg.getMsg("VA012_CreateBank")+'<\/button><\/div> <div class="vis-add-row"><button id="VA012-bnkcnt-Connect_'+widgetID+'" class="vis-widget-field VA012_bankCnt-NewBtn" index="1">'+VIS.Msg.getMsg("VA012_ConnectBank")+"<\/button><\/div><\/div> ";g();r.append(n)};this.intialLoad=function(){i.css("visibility","visible");y();p();i.css("visibility","hidden")};this.getRoot=function(){return r};this.refreshWidget=function(){u.intialLoad()}};n.VA012_BankConnectWidget.prototype.init=function(n,t){this.frame=t;this.widgetInfo=t.widgetInfo;this.windowNo=n;this.initalize();this.frame.getContentGrid().append(this.getRoot());var i=this;window.setTimeout(function(){i.intialLoad()},50)};n.VA012_BankConnectWidget.prototype.widgetFirevalueChanged=function(n){this.listener&&this.listener.widgetFirevalueChanged(n)};n.VA012_BankConnectWidget.prototype.addChangeListener=function(n){this.listener=n};n.VA012_BankConnectWidget.prototype.widgetSizeChange=function(n){this.widgetInfo=n};n.VA012_BankConnectWidget.prototype.refreshWidget=function(){this.refreshWidget()};n.VA012_BankConnectWidget.prototype.dispose=function(){this.frame=null;this.windowNo=null;$bsyDiv=null;$self=null;$root=null;createBank=null;connectBank=null}}(VA012,jQuery);VA012=window.VA012||{},function(n,t){n.VA012_BankingJournal=function(){function si(){r=t('<div id="busyDivId_'+i+'" class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class= "vis_widgetloader"><\/i><\/div><\/div>').css({width:"calc(100% - 40px)"}).hide();p.append(r)}function ii(n){t.ajax({type:"GET",data:{formName:n},contentType:"application/json; charset=utf-8",url:VIS.Application.contextUrl+"VA012_BankJournalWidget/GetBankStatementFormID",success:function(n){wt=JSON.parse(n)},error:function(n){console.log(n)}})}function hi(){u=t('<div class="VA012-bank-panel VA012-WidgetContainer"><div class="VA012-panel-heading"><h6 class="VA012-headerPanelLbl">'+VIS.Msg.getMsg("VA012_BankingJournal")+'<\/h6><\/div><div class="VA012-fader-div VA012-folderFader d-none" id="VA012-folderFader_'+i+'"><div class="p-2 VA012-folderContainer VA012-folderContainer_'+i+'"><h6>'+VIS.Msg.getMsg("VA012_SelectFolder")+'<\/h6><div class="VA012-folTreeArea" id="VA012-folTreeArea_'+i+'"><\/div><div class="VA012-folTreeFooter"><input type="submit" value="'+VIS.Msg.getMsg("VA012_Back")+'" class="btn ui-button ui-corner-all ui-widget VA012-treeCancelBtn" id="VA012-treeCancelBtn_'+i+'"><input type="submit" value="'+VIS.Msg.getMsg("VA012_Next")+'" disabled class="btn ui-button ui-corner-all ui-widget VA012-treeUploadBtn" id="VA012-treeUploadBtn_'+i+'"><\/div > <\/div><\/div><div class="VA012-widgetContentArea"><div class="VA012-shadow bg-white"><div class="VA012-upload-col"><input id="VA012-uploadFile_'+i+'" class="VA012-input-file-field VA012-uploadFileWidget_'+i+'" type="file" accept=".csv, .xls, .xlsx"><label for="VA012-uploadFile_'+i+'" class="VA012-files-label"><i class="fa fa-cloud-upload VA012-uploadImg" id="VA012-uploadImg_'+i+'" style="" aria-hidden="true"><\/i><div class="VA012-labelTxt">'+VIS.Msg.getMsg("VA012_DragFiles")+'<span class="VA012-browse-link">'+VIS.Msg.getMsg("VA012_Browse")+'<\/span><span class="VA012-FileNamelbl VA012-fileSize" id="VA012-FileNamelbl_'+i+'"><\/span><\/div><\/label><\/div><\/div><div class="VA012-links"><div class="VA012-DMS-folder"><div class="VA012-folder-link text-center"><i id="VA012-OpenDMSIcon_'+i+'" class="fa fa-folder-open VA012-OpenDMS" aria-hidden="true"><\/i><a class="VA012-OpenDMS_'+i+'" href="javascript:void(0)">'+VIS.Msg.getMsg("VA012_OpenDMS")+'<\/a><\/div><div class="VA012-folder-link text-center"><input type="submit" value="'+VIS.Msg.getMsg("VA012_Next")+'" id="VA012_NextBtn_'+i+'" class="btn ui-button ui-corner-all ui-widget VA012-NextBtn"><\/div><\/div><\/div><\/div><\/div>');p.append(u);v=p.find(".VA012-widgetContentArea");ti=u.find("#VA012-uploadFile_"+i);oi=u.find("#VA012-uploadImg_"+i);c=u.find("#VA012_NextBtn_"+i);selectedFileName=u.find("#VA012-selectedFileName_"+i);b=u.find("#VA012-FileNamelbl_"+i);et=u.find("#VA012-OpenDMSIcon_"+i);k=u.find("#VA012-folTreeArea_"+i);g=u.find("#VA012-folderFader_"+i);it=u.find("#VA012-treeUploadBtn_"+i);vt=u.find("#VA012-treeCancelBtn_"+i);at==null?c.attr("disabled",!0):(c.attr("disabled",!1),c.css("opacity",1));var n=VIS.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix","VADMS_");n==null?et.css("display","none"):et.css("display","block");ci()}function ci(){u.on("dragover",function(n){n.preventDefault();n.stopPropagation()});u.on("drop",function(n){n.stopPropagation();n.preventDefault();y=!1;files=n.originalEvent.dataTransfer.files;var r=t(u.find(".VA012-uploadFileWidget_"+i)[0]);const f=files[0],e=new FileReader;e.onload=function(n){const i=n.target.result,u=new Blob([i],{type:f.type}),o=n.target.result,e=new File([u],files[0].name,{type:files[0].type,lastModified:files[0].lastModified}),t=new DataTransfer;t.items.add(e);r[0].files=t.files;at=files;files.length>0&&ri(files,r[0])};e.readAsArrayBuffer(f)});u.find(".VA012-uploadFileWidget_"+i).on("click",function(){this.value=null});u.find(".VA012-uploadFileWidget_"+i).on("change",function(n){n.stopPropagation();n.preventDefault();y=!1;var t=n.target.files;at=t;t.length>0&&ri(t,this)});c.on("click",function(){s==null?gt():(s.show(),w.show());v.hide()});et.on("click",function(){r.show();y=!0;var n=wi();r.hide()});vt.on("click",function(){g.addClass("d-none");nt="";v.show();r.hide();y=!1;it.attr("disabled",!0)});it.on("click",function(n){n.stopPropagation();b.text("");c.attr("disabled",!0);r.show();t.ajax({url:VIS.Application.contextUrl+"VA012_BankJournalWidget/GetMetaData",type:"GET",async:!0,dataType:"json",contentType:"application/json; charset=utf-8",data:{documentID:p.find(".VA012-selDoc").attr("data-documentid")},success:function(n){n!=null&&n!=""&&(o=JSON.parse(n),g.addClass("d-none"),y=!0,s==null?(v.hide(),gt()):(v.hide(),s.show(),w.show()));r.hide()},error:function(n){return r.hide(),VIS.ADialog.error(n.statusText),!1}})})}function ri(i,r){for(var c,h,a,y,g,p,f=".xlsx,.xls,.csv",l=!1,e=[],k=null,d=null,u=0;u<i.length;u++){if(i[u].size>209715200&&(k=!0,d+=i[u].name+","),c=i[u].name.substr(0,i[u].name.lastIndexOf(".")),h=i[u].name.substr(i[u].name.lastIndexOf(".")).toLowerCase(),f!=null&&f.length>0&&(Array.isArray(f)||(f=f.split(",")),t.each(f,function(n,t){f[n]=t.toLowerCase().replace(/\s+/g,"")}),f.indexOf(h)==-1&&(l=!0,e.push(i[u].name))),l&&e.length>0){a="";for(y in e)a+=e[y].toString()+", ";g=""+(e.length==1?"FileInvalidExtension":"FilesInvalidExtension");return}i.length>0&&(b.text(c+""+h),b.val(c+""+h),p=r,o=t.parseJSON(n.UploadExcel(p,null,null)),s==null?gt():(s.show(),w.show()),v.hide())}}function gt(){a=t('<div class="VA012_paramMainDiv" id="VA012_paramMainDiv_'+i+'"><div class= "VA012-form-data"><div class="input-group vis-input-wrap VA012-paramdiv"><div class="vis-control-wrap VA012-controls"><select class="VA012-select" id="VA012_STAT_cmbBank_'+i+'"><\/select><label class="VA012-labels">'+VIS.Msg.getMsg("VA012_Bank")+'<sup style="color: red;">*<\/sup><\/label><\/div><\/div><\/div><div class= "VA012-form-data"><div class="input-group vis-input-wrap VA012-paramdiv"><div class="vis-control-wrap VA012-controls"><select class="VA012-select" id="VA012_STAT_cmbBankAccount_'+i+'"><\/select><label class="VA012-labels">'+VIS.Msg.getMsg("VA012_BankAccount")+'<sup style="color: red;">*<\/sup><\/label><\/div><\/div><\/div > <div class=VA012-form-data><div class="input-group vis-input-wrap VA012-paramdiv VA012-margin-B0"><div class="vis-control-wrap VA012-controls"><input class="VA012-select VA012-Date" type="date" max="9999-12-31" id="VA012_STAT_statementDate_'+i+'"><label class="VA012-labels" id="VA012_STAT_lblStatementDate_'+i+'">'+VIS.Msg.getMsg("VA012_StatementDate")+'<sup style="color: red;">*<\/sup><\/label><\/div><\/div><\/div><div class="VA012-form-data"><div class="input-group vis-input-wrap VA012-paramdiv"><div class="vis-control-wrap VA012-controls"><select class="VA012-select" id="VA012_STAT_cmbBankAccountClassName_'+i+'"><\/select><label class="VA012-labels">'+VIS.Msg.getMsg("VA012_ClassName")+'<sup style="color: red;">*<\/sup><\/label><\/div><\/div><\/div><div class="VA012-form-data"><div class="input-group vis-input-wrap VA012-paramdiv"><div class="vis-control-wrap VA012-controls"><input class="VA012-select" type="text" id="VA012_STAT_txtStatementNo_'+i+'" placeholder=" " data-placeholder=""><label class="VA012-nameLbl">'+VIS.Msg.getMsg("VA012_StatementNumber")+'<sup style="color: red;">*<\/sup><\/label><\/div><\/div><\/div><div class="VA012-form-data"><div class="input-group vis-input-wrap VA012-paramdiv"><div class="vis-control-wrap VA012-controls"><input type="checkbox" value="checked" id="VA012_CheckBox_'+i+'"><label class="VA012-StatementDateAsAccountDate">'+VIS.Msg.getMsg("VA012_StatementDateAsAccountDate")+'<\/label><\/div><\/div><\/div><\/div><div class="VA012-paramFooterDiv" id="VA012-paramFooterDiv_'+i+'"><input type="submit" value="'+VIS.Msg.getMsg("VA012_Back")+'" class="btn ui-button ui-corner-all VA012-CancelBtn"><input type="submit" value="'+VIS.Msg.getMsg("VA012_Upload")+'" class="btn ui-button ui-corner-all VA012-UploadBtn"><\/div><\/div>');u.append(a);vi();ft.loadBank();ft.loadBankAccountCharges();l=s.find("#VA012_STAT_statementDate_"+i);l.on("change",function(){if(Globalize.format(new Date(l.val()),"yyyy-MM-dd")>Globalize.format(new Date,"yyyy-MM-dd"))return VIS.ADialog.info("VA012_StatementDateToday",null,"",""),l.val(""),!1});e.on("click",function(){if(e.val()!="null")ft.loadBankAccount();else return"VA012_NoBankSelected"});f.on("click",function(){if(f.val()!="null")yt=0,ft.loadCurrency(),yi(),pi();else return"VA012_NoBankAccountSelected"});ot.on("click",function(){s.hide();w.hide();nt="";y?g.removeClass("d-none"):(v.show(),c.attr("disabled",!1))});st.on("click",function(){if(r.show(),e.val()==null||e.val()==""||e.val()=="0")return r.hide(),VIS.ADialog.info("VA012_SelectBankFirst",null,"",""),!1;if(f.val()==null||f.val()==""||f.val()=="0")return r.hide(),VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"",""),!1;if(h.val()==null||h.val()==""||h.val()=="0")return r.hide(),VIS.ADialog.info("VA012_PleaseSelectClassFirst",null,"",""),!1;if(tt.val()==null||tt.val()=="")return r.hide(),VIS.ADialog.info("VA012_PleaseEnterStatementNo",null,"",""),!1;if(l.val()==null||l.val()=="")return r.hide(),VIS.ADialog.info("VA012_PleaseEnterStatementDate",null,"",""),!1;if(o!=null){if(o._filename==null||o._filename==""||o._path==null||o._path==""){r.hide();VIS.ADialog.info("VA012_ErrorInGettingFile",null,"","");return}if(o._error!=null&&o._error!=""){r.hide();VIS.ADialog.info(o._error,null,"","");return}yt>0?VIS.ADialog.confirm("VA012_BankStatementExist",!0,"","Confirm",function(n){if(n)ui();else{r.hide();return}}):ui()}else{r.hide();VIS.ADialog.info("VA012_ErrorInGettingFile",null,"","");return}})}function ui(){var n=o._path,e=o._filename,a=f.val(),p=tt.val(),k=lt.is(":checked"),g=h.val(),it=kt;t.ajax({url:VIS.Application.contextUrl+"BankStatement/ImportStatement",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:{_path:n,_filename:e,_bankaccount:a,_bankAccountCurrency:bt,_statementno:p,_statementClassName:g,_statementCharges:it,statementDate:l.val(),IsStatementDateAsAccountDate:k},success:function(n){return(_statementID=n._statementID,_statementID!=null&&_statementID!="")?(ai(),r.hide(),fi(),s.hide(),w.hide(),v.show(),u.find(".VA012-uploadFileWidget_"+i).val(null),b.text(""),c.attr("disabled",!0),y=!1,nt="",d=new VIS.ChildDialog,d.setContent(li()),pt.text(VIS.Msg.getMsg("VA012_StatementUploadDone")),pt.css("visibility","visible"),d.setTitle(VIS.Msg.getMsg("VA012_LoadStatementRes")),d.setWidth("24%"),d.show(),d.hidebuttons(),!0):n._error!=null&&n._error!=""?(r.hide(),VIS.ADialog.info(n._error,null,"",""),!1):void 0},error:function(){return r.hide(),VIS.ADialog.info("error",null,"","")}})}function li(){rt=t("<div><label class='mb-3' id='VA012_SuccessMsg_"+i+"'><\/label><\/div>");$resltbtns=t("<div class=''><div class='d-flex align-items-center justify-content-end'><input type=submit value="+VIS.Msg.getMsg("VA012_ViewStatement")+" class='btn ui-button ui-corner-all ui-widget VA012-bs-ViewBtn mr-3' id='VA012_OpenBankStatementForm_"+i+"'/><\/div><\/div>");rt.append($resltbtns);pt=rt.find("#VA012_SuccessMsg_"+i);dt=rt.find("#VA012_OpenBankStatementForm_"+i);dt.on("click",function(){r.show();wt==0&&ii("VA012_BankStatement");VIS.viewManager.startForm(wt,ut);d.close();r.hide()});return rt}function ai(){ut=[];ut.push(e.val());ut.push(f.val());ut.push(l.val())}function fi(){e.prop("selectedIndex",0);f.prop("selectedIndex",0);h.prop("selectedIndex",0);l.val("");tt.val("");lt.prop("checked",!1)}function vi(){e=a.find("#VA012_STAT_cmbBank_"+i);f=a.find("#VA012_STAT_cmbBankAccount_"+i);h=a.find("#VA012_STAT_cmbBankAccountClassName_"+i);s=u.find("#VA012_paramMainDiv_"+i);ot=a.find(".VA012-CancelBtn");st=a.find(".VA012-UploadBtn");w=u.find("#VA012-paramFooterDiv_"+i);l=a.find("#VA012_STAT_statementDate_"+i);tt=a.find("#VA012_STAT_txtStatementNo_"+i);lt=a.find("#VA012_CheckBox_"+i)}function yi(){function n(n){if(h.html(""),h.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)h.append("<option value="+n[t].Value+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");h.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetBankAccountClasses",{_cmbBankAccount:f.val()},n)}function pi(){function n(n){yt=JSON.parse(n)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA012_BankJournalWidget/CheckStatementExist",{C_BankAccount_ID:f.val()},n)}function wi(){var u=null;t.ajax({url:VIS.Application.contextUrl+"VA012_BankJournalWidget/GetFolders",type:"GET",async:!0,dataType:"json",contentType:"application/json; charset=utf-8",data:{UserID:VIS.context.getAD_User_ID(),roleID:VIS.context.getAD_Role_ID(),clientID:VIS.context.getAD_Client_ID(),orgID:VIS.context.getAD_Org_ID(),orderBy:"NA"},success:function(f){var o,e,s;if(f!=null&&f!=""){if(u=JSON.parse(f),g.removeClass("d-none"),u.length>0){o=t('<ul id="folderUL_'+i+'" class="list-unstyled w-100"><\/ul>');a="";var h=[],v="",c="",l="",a="";for(e=0;e<u.length;e++)(h=[],l="",c=u[e].FolderName,u[e].FolderName.length>25&&(c=u[e].FolderName.substring(0,25)+"..."),a.contains(u[e].FolderID))||(s=null,u[e].ParentFolderID==0&&(u[e].FolderType==1||u[e].FolderType==2||u[e].FolderType==5||u[e].FolderType==6||u[e].FolderType==7||u[e].FolderType==8||(v=u[e].PublicAccess>10?"<i class='vis vis-folder-globe'><\/i>":u[e].Sharecount>2||u[e].RoleSharecount>0?"<i class='vis vis-folder-share'><\/i>":"<i class='fa fa-folder-o'><\/i>",s=t('<li id="'+u[e].FolderID+'" folderName="'+VIS.Utility.encodeText(u[e].FolderName)+'" parentID="'+u[e].ParentFolderID+'" useraccess="'+u[e].UserAccessOnFolder+'" roleaccess="'+u[e].RoleAccessOnFolder+'" createdBy="'+u[e].CreateUser+'" inputType="'+u[e].InputType+'" folType="'+u[e].FolderType+'" IsSubscribe="'+u[e].IsSubscribedFolder+'" InitialCharacter="'+"".toUpperCase()+'"><div class="VA012-leftTreeNode" title="'+u[e].FolderName+'"><a id="a_'+u[e].FolderID+'" href="javascript:void(0);" val="'+VIS.Utility.encodeText(u[e].FolderPath)+'">'+v+"<span>"+VIS.Utility.encodeText(c)+"<\/span><\/a><\/div><\/li>")),h.push({row:u[e],root:s}),a+=u[e].FolderID+",",l=u[e].FolderName,ei(h,u,20,l),o.append(s)));o.on("click","li a",function(u){r.show();u.stopPropagation();var f=t(this).closest("li"),e=t(u.currentTarget);t.ajax({url:VIS.Application.contextUrl+"VA012_BankJournalWidget/CheckFolderAccess",type:"GET",async:!0,dataType:"json",contentType:"application/json; charset=utf-8",data:{folderID:f.attr("id")},success:function(u){var e,o;u!=null&&u!=""&&(u==n.Common.Full_Access||u==n.Common.RWD_Access||u==n.Common.RW_Access?(t("#folderUL_"+i).find(".VA012-selected").removeClass("VA012-selected"),t("#folderUL_"+i).find(".VA012-selectedTreeNode").css("background-color","inherit"),f.find("div").eq(0).find("a span").addClass("VA012-selected"),f.find("div").eq(0).hasClass("VA012-selectedTreeNode")?f.find("div").eq(0).hasClass("VA012-selectedTreeNode")?f.find("div").eq(0).addClass("VA012-selectedTreeNode").css("background-color","rgba(var(--v-c-primary), .1)"):f.children("ul").length>0&&f.find("div").eq(0).removeClass("VA012-selectedTreeNode"):f.find("div").eq(0).addClass("VA012-selectedTreeNode").css("background-color","rgba(var(--v-c-primary), .1)"),e=[],e.push("Updated"),_scrollpage=1,_searchDocName="",r.hide(),o=bi(e,n.Common.UpdatedDesc,_scrollpage,!1,f.attr("id"),k.find("#"+f.attr("id"))),r.hide()):(r.hide(),VIS.ADialog.info("VA012_ReqWPermOnFol")))},error:function(n){return r.hide(),VIS.ADialog.error(n.statusText),!1}})});return k.html("").append(o),o}return VIS.ADialog.info("VA012_NoFolderFound"),VIS.Msg.getMsg("VA012_NoFolderFound")}return VIS.ADialog.info("VA012_NoFolderFound"),VIS.Msg.getMsg("VA012_NoFolderFound")},error:function(n){return r.hide(),VIS.ADialog.error(n.statusText),!1}})}function ei(n,i,r,u){for(var h,f,o=null,s=[],c="",l="",a="",e=0;e<n.length;e++){for(o=null,h=t('<ul class="list-unstyled VA012-leftSideSubTreeUl {"><\/ul>'),f=0;f<i.length;f++)if(l=i[f].FolderName.length>25?i[f].FolderName.substring(0,25)+"...":i[f].FolderName,a=l.substring(0,1).trim(),i[f].ParentFolderID==n[e].row.FolderID){if(nt.contains(i[f].FolderID))continue;c=i[f].PublicAccess>10?"<i class='vis vis-folder-globe'><\/i>":i[f].Sharecount>2||i[f].RoleSharecount>0?"<i class='vis vis-folder-share'><\/i>":"<i class='fa fa-folder-o'><\/i>";o=t('<li id="'+i[f].FolderID+'" folderName="'+VIS.Utility.encodeText(i[f].FolderName)+'" parentID="'+i[f].ParentFolderID+'" useraccess="'+i[f].UserAccessOnFolder+'" roleaccess="'+i[f].RoleAccessOnFolder+'" createdBy="'+i[f].CreateUser+'" inputType="'+i[f].InputType+'" folType="'+i[f].FolderType+'" IsSubscribe="'+i[f].IsSubscribedFolder+'" InitialCharacter="'+VIS.Utility.encodeText(a.toUpperCase())+'"><div class="VA012-leftTreeNode" title="'+VIS.Utility.encodeText(i[f].FolderPath)+'"><a id=a_"'+i[f].FolderID+'" href="javascript:void(0);">'+c+"<span>"+VIS.Utility.encodeText(i[f].FolderName)+"<\/span><\/a><\/div><\/li>");s.push({row:i[f],root:o});nt+=i[f].FolderID+",";u+="\\"+i[f].FolderName;h.append(o)}o!=null?(n[e].root.append(h),n[e].root.find("a span i").length<=0&&t(n[e].root.find("a span")[0]).append('<i class="vis vis-arrow-right VA012-arrow-right"><\/i>')):n[e].row.HasChild>0&&n[e].root.find("a span").append('<i class="vis vis-arrow-right VA012-arrow-right"><\/i>')}s.length>0&&ei(s,i,r+10,u)}function bi(u,f,e,o,s,h){var a,l,v,c;r.show();a=k.find("[data-parentfolderid= '"+s+"']");l=null;a.length>0&&a.remove();v=50;c=[];c.push(s);c.push(1);c.push("");c.push(0);c.push(0);c.push(!1);c.push(!1);c.push(!1);c.push("0");c.push(v);c.push(0);c.push("UD");t.ajax({url:VIS.Application.contextUrl+"VA012_BankJournalWidget/GetDocument",type:"POST",async:!0,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(u){var f,v;if(u!==null&&(u=JSON.parse(u),u=u[0].LstDocument,u!=null&&u.length>0)){for(f=0;f<u.length;f++){var e=u[f].DocumentID,w=u[f].DocumentName,o=u[f].FileType,b=u[f].FolderID,y=u[f].VersionNo,c="vis-doc-blank",a="rgba(var(--v-c-primary), 1)";(o==n.Common.XLS||o==n.Common.XLSX||o==n.Common.CSV)&&(c="vis-doc-excel",a="#39b54a",v=t('<li class="VA012-docTreeNode VA012-folderDocs" data-documentid="'+e+'" data-versionNo="'+y+'" data-parentfolderid="'+s+'" id="VA012-doclistingpanel_'+e+'"><div class="VA012-leftTreeNode"><a id="a_'+u[f].FolderID+'" href="javascript:void(0);" val="'+VIS.Utility.encodeText(u[f].DocumentName)+'"><i class="vis '+c+'" aria-hidden="true" style="color:'+a+'"><\/i><span class="VA012-documentName" id="VA012_documentName_'+e+'">'+VIS.Utility.encodeText(u[f].DocumentName)+""+VIS.Utility.encodeText(u[f].FileType)+"<\/span><\/a><\/div><\/li>"),v.insertAfter(h))}r.hide();k.find(".VA012-docTreeNode").on("click",function(n){n.stopPropagation();it.removeAttr("disabled");l=t(this).closest("li");t("#folderUL_"+i).find(".VA012-selected").removeClass("VA012-selected");t("#folderUL_"+i).find(".VA012-selectedTreeNode").css("background-color","inherit");k.find("#VA012-doclistingpanel_"+l.data("documentid")).find(".VA012-selected").removeClass("VA012-selected");k.find("#VA012-doclistingpanel_"+l.data("documentid")).find(".VA012-selectedTreeNode").css("background-color","inherit");l.find("div").eq(0).find("a i span").addClass("VA012-selected");l.find("div").eq(0).hasClass("VA012-selectedTreeNode")?l.find("div").eq(0).hasClass("VA012-selectedTreeNode")?l.find("div").eq(0).addClass("VA012-selectedTreeNode").css("background-color","rgba(var(--v-c-primary), .1)"):l.children("ul").length>0&&l.find("div").eq(0).removeClass("VA012-selectedTreeNode"):l.find("div").eq(0).addClass("VA012-selectedTreeNode").css("background-color","rgba(var(--v-c-primary), .1)");p.find(".VA012-folderDocs").removeClass("VA012-selDoc");t(l[0]).addClass("VA012-selDoc")})}},error:function(n){return r.hide(),VIS.ADialog.error(n.statusText),!1}})}var ft;this.frame=null;this.windowNo=0;this.widgetInfo=null;var ni=this,p=null,i=null,u=null,ti=null,oi=null,ot=null,st=null,c=null,v=null,s=null,w=null,b=null,et=null,r=null,e=null,f=null,h=null,ht=0,ct=0,l=null,tt=null,lt=null,a=null,bt=null,at=null,o=null,kt=null,k=null,it=null,vt=null,g=null,nt="",y=!1,yt=0,d=null,rt="",pt="",dt="",ut=[],wt=0;n.Common={IPadWidth:1024,MimWidth:1e3,None_Access:10,R_Access:20,RW_Access:30,RWD_Access:40,Full_Access:99,XLS:".xls",XLSX:".xlsx",CSV:".csv",UpdatedAsc:"UA",UpdatedDesc:"UD"};this.log=VIS.Logging.VLogger.getVLogger("BankJournalWidget");this.getRoot=function(){return si(),p};this.setBusy=function(n){n?r.show():r.hide()};this.initialize=function(){i=this.widgetInfo.AD_UserHomeWidgetID;i=i+"_"+VIS.Env.getWindowNo();i==0&&(i=ni.windowNo);p=t("<div id='WidMainRoot_"+i+"' class='VA012_root'><\/div>");hi();ii("VA012_BankStatement")};ft={loadBank:function(){function n(n){if(e.html(""),e.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)e.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].Value)+">"+n[t].Name+"<\/option>");e.prop("selectedIndex",0);ht>0&&(e.val(ht).prop("selected",!0),ht=0);ft.loadBankAccount()}t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetBank",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",success:function(i){i!=null&&i!=""&&(_ds=t.parseJSON(i),n(_ds))},error:function(n){console.log(n)}})},loadBankAccount:function(){function n(n){if(f.html(""),f.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)f.append("<option orgid="+VIS.Utility.Util.getValueOfInt(n[t].OrgId)+" stdprecision="+VIS.Utility.Util.getValueOfInt(n[t].StdPrecision)+" currencyid="+VIS.Utility.Util.getValueOfInt(n[t].CurrencyId)+" value="+VIS.Utility.Util.getValueOfInt(n[t].BankAccountId)+" accounttype="+VIS.Utility.Util.getValueOfString(n[t].AccountType)+">"+VIS.Utility.encodeText(n[t].AccountNo)+"<\/option>");f.prop("selectedIndex",0);ct>0&&(f.val(ct).prop("selected",!0),ct=0)}t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetBankAccount",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{bankId:e.val()},success:function(i){i!=null&&i!=""&&(i=t.parseJSON(i),n(i))},error:function(n){console.log(n)}})},loadCurrency:function(){var n=VIS.Utility.Util.getValueOfInt(t("option:selected",f).attr("currencyid")),i=VIS.Utility.Util.getValueOfInt(t("option:selected",f).attr("stdprecision"));n>0?bt=n:n=null;_stdPrecision=i>0?i:null},loadBankAccountCharges:function(){function n(n){n!=null&&(kt=VIS.Utility.Util.getValueOfInt(n[0].chargeID))}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetBankCharge",null,n)}};this.refreshWidget=function(){r.hide();y?g.addClass("d-none"):fi();s.hide();w.hide();v.show();u.find(".VA012-uploadFileWidget_"+i).val(null);b.text("");b.val("");c.attr("disabled",!0);nt=""};this.disposeComponents=function(){ni=null;p=null;this.frame=null;this.windowNo=0;this.widgetInfo=null;u=null;ti=null;ot=null;st=null;c=null;v=null;s=null;w=null;selectedFileName=null;e=null;f=null;h=null;ht=0;ct=0;l=null;tt=null;lt=null;a=null;_file=null;lstLatestFiles=[];oldFiles=[];currentchunk=0;currentFile=0;folder=Date.now().toString();chunkSize=1048576;totalChunks=0;currentFileChunkNo=0;filesInfo=[];at=null;bt=null;o=null;kt=null;b.text("");k=null;it=null;vt=null;g=null;nt="";y=!1;e.off("click");f.off("click");h.off("click");u.off("click");ot.off("click");st.off("click");c.off("click");et.off("click");vt.off("click");it.off("click");yt=0;d=null;rt="";pt="";dt="";ut=[];wt=0}};n.VA012_BankingJournal.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.widgetInfo=t.widgetInfo;this.initialize();this.frame.getContentGrid().append(this.getRoot)};n.VA012_BankingJournal.prototype.widgetSizeChange=function(n){var t=n};n.VA012_BankingJournal.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.VA012_BankingJournal.prototype.refreshWidget=function(){this.refreshWidget()};n.VA012_BankingJournal.prototype.addChangeListener=function(n){this.listener=n};n.VA012_BankingJournal.prototype.widgetFirevalueChanged=function(n){this.listener&&this.listener.widgetFirevalueChanged(n)}}(VA012,jQuery);VA012=window.VA012||{},function(n,t){n.UploadExcel=function(i,r,u){function ut(n){for(u.children().remove(),j=0;j<n.ExcelCol.length;j++)j==1?u.append("<li index="+j+" style='border:none;float:none' >"+n.ExcelCol[j]+"<\/li>"):u.append("<li index="+j+" >"+n.ExcelCol[j]+"<\/li>")}var k=null,f=[],c=[],l=0,o=0,a=Date.now().toString(),s=1048576,v=0,h=0,p=[],e=null,nt=i,ft=t(window).width(),et=t(window).height(),a=Date.now().toString(),ot=r;savedFileName="";var d=t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:40%;width: 40%;left: 32%;position:absolute;z-index:99999;'>"),w=null,b=null;this.isWait=!1;self=this;var tt=function(){var n=null,t=0;for(var i in f)t=parseInt(f[i].size/s),e.size%s>0&&t++,v+=t,n={},n.Name=f[i].name,n.Size=f[i].size,p.push(n);g()},g=function(){var t;if(f==null||f.length==0){y(!1);return}if(!(o>=f.length)){var n=new XMLHttpRequest,i=new FormData,r=f[o].name.substring(0,f[o].name.lastIndexOf("."))+a+f[o].name.substring(f[o].name.lastIndexOf("."));savedFileName=r;i.append("file",f[o].slice(h*s,h*s+Number(s)));n.open("POST",VIS.Application.contextUrl+"VA012/UploadExcel/SaveFileinTemp?fileName="+r+"&folderKey="+a+"&orgFileName="+f[o].name,!1);n.send(i);k=n.responseText;l++;h++;t=parseInt(f[o].size/s);f[o].size%s>0&&t++;h==t&&(o++,h=0);l<=v&&rt(parseInt(l/v*80));window.setTimeout(function(){g()},2)}},it=function(n){for(var i,w,r,b,t=[],u=0;u<n.files.length;u++){if(e=n.files[u],e==undefined)return;if(e.size<=0)return f=[],c=[],l=0,o=0,a=null,s=null,v=0,h=0,p=[],e=null,VIS.ADialog.info("VADMS_FileSizeShouldGreaterThan0KB"),y(!1),!1;if(e.name.indexOf("&")>-1||e.name.indexOf("?")>-1||e.name.indexOf("#")>-1||e.name.indexOf("/")>-1||e.name.indexOf("\\")>-1){t.push(e.name);continue}for(i in f)if(e.name==f[i].name){window.setTimeout(function(){y(!1);VIS.ADialog.info("fileAlreadyAttached")},20);return}if(c!=null)for(i in c)if(e.name==c[i].Name&&!c[i].IsDeleted){window.setTimeout(function(){y(!1);VIS.ADialog.info("fileAlreadyAttached")},20);return}w={};w.Name=e.name;w.Size=e.size;f.push(e)}if(t.length>0){r="";for(b in t)r+=t[b].toString()+"\n";r+=t.length==1?"File has":"Files have";r+=" invalid name. Please change the file name and try again.";y(!1);VIS.ADialog.info("",!0,r)}},y=function(n){if(t("body").find("#progressbar").remove(),n){w=t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute;height: 35px;'>");b=t("<span class='vis-ui-label'  style='position:absolute;left: 60%;top: 4px;'>").append("0%");w.append(b);d.append(w);var i=t("<div id='progressbar' style='z-index: 999999;' class='vadms-Busy-Progress'><\/div>");i.append(d);i.appendTo("<body>")}else t("body").find("progressbar").remove()},rt=function(n){w.css("width",n+"%");b.empty();b.append(n+"%")};return this.getFolderKey=a,this.getSavedFileName=savedFileName,this.GetUploadedExcelColumns=function(){var t,u,i;if(o>=f.length)return t=[],u=VIS.Application.contextUrl+"VA012/UploadExcel/SaveAttachmentEntries",t.push({Files:JSON.stringify(p)}),t.push({FolderKey:a}),t.push({FileName:savedFileName}),t.push({Mapping:r}),i=n.ControllerRequestAjaxParameter1(u,t,!1),r.ExcelCol=i.ExcelCol,r.FileName=i.FileName,ut(i),i},y(!0),it(i),tt(),k}}(VA012,jQuery);VA012=window.VA012||{},function(n){function t(){VIS.CalloutEngine.call(this,"VA012.VA012_Contra")}var r=VIS.Logging.Level,i=VIS.Utility.Util;VIS.Utility.inheritPrototype(t,VIS.CalloutEngine);t.prototype.SetContra=function(n,t,r,u,f){if(this.isCalloutActive())return"";if(this.setCalloutActive(!0),f==null)r.setValue("VA012_IsContra",!1);else{var e=VIS.dataContext.getJSONRecord("VA012/Statement/GetChargeType",i.getValueOfInt(f));e=="CON"?r.setValue("VA012_IsContra",!0):(r.setValue("CheckNo",null),r.setValue("C_BankAccount_ID",null),r.setValue("VA012_IsContra",!1))}return this.setCalloutActive(!1),""};t.prototype.SetConversionType=function(n,t,i,r,u,f){var o,h,e;if(this.isCalloutActive()||u==null||u.toString()=="")return i.setValue("StmtAmt",0),i.setValue("TrxAmt",0),i.setValue("ChargeAmt",0),i.setValue("C_ConversionType_ID",0),"";if(this.setCalloutActive(!0),VIS.Utility.Util.getValueOfInt(i.getValue("C_CashLine_ID"))>0){if(o=i.getValue("DateAcct"),o==null)return i.setValue("C_CashLine_ID",0),this.setCalloutActive(!1),"PlzSelectStmtDate";if(h=i.getValue("C_CashLine_ID").toString()+","+i.getValue("C_Currency_ID").toString()+","+o.toString()+","+i.getValue("AD_Org_ID").toString(),e=VIS.dataContext.getJSONRecord("VA012/Statement/GetCashDetails",h),e!=null){e.Amount!=0?(i.setValue("StmtAmt",e.Amount),i.setValue("TrxAmt",e.Amount),i.setValue("C_ConversionType_ID",e.C_ConversionType_ID)):(i.setValue("StmtAmt",0),i.setValue("TrxAmt",0),i.setValue("C_ConversionType_ID",0),i.setValue("C_CashLine_ID",0),VIS.ADialog.info("VA012_ConversionRateNotFound"));var c=VIS.Utility.Util.getValueOfDecimal(i.getValue("StmtAmt")),l=VIS.Utility.Util.getValueOfDecimal(i.getValue("TrxAmt")),s=c-l,a=VIS.Utility.Util.getValueOfDecimal(i.getValue("InterestAmt"));s=s-a;i.setValue("ChargeAmt",s)}}else i.getValue("C_Payment_ID")<=0&&i.setValue("C_ConversionType_ID",0);return this.setCalloutActive(!1),n=t=i=r=u=f=null,""};t.prototype.SetTenderType=function(n,t,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);var o=VIS.dataContext.getJSONRecord("VA012/Statement/GetPaymentRule",i.getValueOfInt(f));return o!=null&&o!=""&&(o=="D"?r.setValue("TenderType","D"):o=="K"?r.setValue("TenderType","C"):o=="S"?r.setValue("TenderType","K"):o=="T"?r.setValue("TenderType","A"):o=="L"?r.setValue("TenderType","L"):r.setValue("TenderType","A")),this.setCalloutActive(!1),n=t=r=u=f=e=null,""};t.prototype.SetPaymentMethod=function(n,t,r,u,f,e){var s,o;return this.isCalloutActive()||f==null||f.toString()==""?"":(this.setCalloutActive(!0),s="1",u.getColumnName()=="C_Invoice_ID"&&(s="1"),u.getColumnName()=="C_Order_ID"&&(s="2"),o=VIS.dataContext.getJSONRecord("VA012/Statement/GetPaymentMethod",i.getValueOfInt(f)+","+s),this.setCalloutActive(!1),o!=null&&o!=""&&(r.setValue("VA009_PaymentMethod_ID",o.VA009_PaymentMethod_ID),r.setValue("C_ConversionType_ID",o.C_ConversionType_ID)),n=t=r=u=f=e=null,"")};n.Model=n.Model||{};n.Model.VA012_Contra=t}(VA012,jQuery);VA012=window.VA012||{},function(n,t){n.VA012_BankChargeSummary=function(){function y(){r=t('<div id="busyDivId_'+widgetID+'" class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class= "vis_widgetloader"><\/i><\/div><\/div>').css({width:"calc(100% - 40px)"}).hide();i.append(r)}function a(n){var n="TO_DATE('"+new Date(n).getDate()+"/"+(new Date(n).getMonth()+1)+"/"+new Date(n).getFullYear()+"','dd/mm/yyyy')";return n}function v(){var e,c,k;i.find("#VA012-BankChargeContainer_"+widgetID).remove();var y=a(o),w=a(s),v="C_BankAccount.ISACTIVE='Y' AND C_BankAccount.C_BankAccount_ID IN(SELECT bs.C_BankAccount_ID FROM C_BankStatement bs INNER JOIN C_BankStatementLine bsl ON (bs.C_BankStatement_ID = bsl.C_BankStatement_ID) WHERE TRUNC(bsl.STATEMENTLINEDATE) BETWEEN "+y+" AND "+w+") ",b=VIS.MLookupFactory.get(VIS.context,f.windowNo,0,VIS.DisplayType.TableDir,"C_BankAccount_ID",0,!1,v);if(n=new VIS.Controls.VComboBox("C_BankAccount_ID",!0,!1,!0,b,50),e=b.getData(!0,!0,!1,!1),e!=null&&e!=undefined&&e.length>0){for(c=0;c<e.length;c++)n.getControl().append("<option value="+e[c].Key+">"+e[c].Name+"<\/option>");n.getControl().prop("selectedIndex",0)}l.setContext(f.windowNo,"VA012_BankAccount_ID",VIS.Utility.Util.getValueOfInt(n.getValue()));v="";v="C_Charge.ISACTIVE='Y' AND C_Charge.C_Charge_ID IN (SELECT bsl.C_Charge_ID FROM C_BankStatement bs INNER JOIN C_BankStatementLine bsl ON (bs.C_BankStatement_ID = bsl.C_BankStatement_ID) WHERE bs.C_BankAccount_ID=@VA012_BankAccount_ID@ AND TRUNC(bsl.STATEMENTLINEDATE) BETWEEN "+y+" AND "+w+")";k=VIS.MLookupFactory.get(VIS.context,f.windowNo,0,VIS.DisplayType.TableDir,"C_Charge_ID",0,!1,v);u=new VIS.Controls.VComboBox("C_Charge_ID",!1,!1,!0,k,50);dropContainer=t('<div class="VA012-bankcharge-panel VA012-BankChargeContainer" id="VA012-BankChargeContainer_'+widgetID+'"><div class="VA012-bankcharge-heading"><h6 class= "VA012-bankchargePanelLbl" id="VA012_HeadingDiv_'+widgetID+'">'+VIS.Msg.getMsg("VA012_BankChargeSummary")+'<\/h6><\/div><div class="VA012-paramtersDiv" id="VA012-paramtersDiv_'+widgetID+'"><div class="input-group vis-input-wrap VA012-input-wrap"><div class="vis-control-wrap"><div class="VA012-cmbBankAcct" id="VA012_cmbBankAcct_'+widgetID+'"><\/div><\/div><\/div><div class="input-group vis-input-wrap VA012-input-wrap"><div class="vis-control-wrap"><div class="VA012-cmbCharge" id="VA012_cmbCharge_'+widgetID+'"><\/div><\/div><\/div><\/div><div id="VA012-columnChart_'+widgetID+'" class="VA012-columnChart"><\/div><\/div><\/div>');i.append(dropContainer);i.find("#VA012_cmbBankAcct_"+widgetID).append(n.getControl()).append('<label class="VA012-ctrlLbl">'+VIS.Msg.getMsg("VA012_BankAccount")+'<sup style="color: red;">*<\/sup><\/label>');i.find("#VA012_cmbCharge_"+widgetID).append(u.getControl()).append('<label class="VA012-ctrlLbl">'+VIS.Msg.getMsg("Charge")+"<\/label>");i.find("select").addClass("VA012-selectCtrls");i.find(".VA012-cmbCharge select").addClass("VA012-chargeCtrl");p();n.getValue()&&(r.show(),n.setValue(n.getValue()),h())}function p(){n.fireValueChanged=function(){if(n.getValue())r.show(),n.setValue(n.getValue()),u.getValue()!=null&&(u.setValue(null),e=0),l.setContext(f.windowNo,"VA012_BankAccount_ID",VIS.Utility.Util.getValueOfInt(n.getValue())),h();else return i.find("canvas").remove(),n.setValue(n.getValue()),u.setValue(""),VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"",""),!1};u.fireValueChanged=function(){if(u.getValue())if(n.getValue())e=u.getValue(),u.setValue(u.getValue()),r.show(),h();else return u.setValue(u.getValue()),VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"",""),!1;else e=0,r.show(),h()}}function h(){t.ajax({url:VIS.Application.contextUrl+"VA012_BankChargeSummary/GetBankChargeData",type:"GET",async:!0,dataType:"json",contentType:"application/json; charset=utf-8",data:{C_BankAccount_ID:VIS.Utility.Util.getValueOfInt(n.getValue()),C_Charge_ID:e,yrStartDate:o,yrEndDate:s,Year_ID:c},success:function(n){if(n!=null&&n!="")if(n=JSON.parse(n),i.find("canvas").remove(),n!=null&&n.errorMessage!=null)i.find("#VA012-columnChart_"+widgetID).append('<div class="VA012-notfounddiv" id="VA012_norecordcont_'+widgetID+'">'+VIS.Msg.getMsg("VA012_RecordNotFound")+"<\/div>");else{let r=n.Precision;const e=n.labels,o=n.currency,s={labels:e,datasets:[{data:n.bankChargeData,borderColor:"rgba(0,0,0,0)",borderWidth:0,backgroundColor:"rgba(249, 179, 29, 1)",order:1}]},h={id:"zeroLine",beforeDraw:function(n){const t=n.ctx,u=n.scales.y,i=n.scales.x,r=u.getPixelForValue(0);t.save();t.beginPath();t.moveTo(i.left,r);t.lineTo(i.right,r);t.lineWidth=1;t.strokeStyle="rgb(211,211,211)";t.stroke();t.restore()}},c={beforeInit:function(n){const t=n.legend.fit;n.legend.fit=function(){t.bind(n.legend)();this.height+=-10}}},l={type:"bar",data:s,options:{responsive:!0,layout:{padding:0},scales:{x:{grid:{display:!0}},y:{grid:{display:!1,beginAtZero:!0}}},plugins:{legend:{display:!1,position:"bottom",padding:{top:0,bottom:0}},tooltip:{callbacks:{label:function(n){const t=n.dataIndex,i=n.datasetIndex,u=n.chart.data.datasets[i],f=u.data[t];return o[t]+": "+f.toLocaleString(window.navigator.language,{minimumFractionDigits:r,maximumFractionDigits:r})}}}}},plugins:[c],plugins:[h]},f=t('<canvas class="VA012-columnChart-canvas"><\/canvas>');var u=i.find("#VA012-columnChart_"+widgetID);u.append(f);const a=f[0].getContext("2d");new Chart(a,l)}r.hide()},error:function(n){return r.hide(),VIS.ADialog.error(n.statusText),!1}})}this.frame=null;this.windowNo=0;this.widgetInfo=null;var f=this,i=null,r=null,n=null,l=VIS.Env.getCtx(),u=null,o=null,s=null,c=null,e=0;this.log=VIS.Logging.VLogger.getVLogger("BankChargeSummaryMonthWidget");this.getRoot=function(){return i};this.setBusy=function(n){n?r.show():r.hide()};this.initialize=function(){widgetID=this.widgetInfo.AD_UserHomeWidgetID;widgetID==0&&(widgetID=f.windowNo);i=t("<div id='VA012_rootBankCharge_"+widgetID+"' class='VA012_rootBankCharge'><\/div>");y();r.show();t.ajax({url:VIS.Application.contextUrl+"VA012_BankChargeSummary/GetFinancialYearDetail",type:"GET",async:!0,dataType:"json",contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=JSON.parse(n),o=n.StartDate,s=n.EndDate,c=n.C_Year_ID,v());r.hide()},error:function(n){return r.hide(),VIS.ADialog.error(n.statusText),!1}})};this.refreshWidget=function(){e=0;v()};this.disposeComponents=function(){f=null;i=null;this.frame=null;this.windowNo=0;this.widgetInfo=null;r=null;n=null;u=null;o=null;s=null;c=null;e=0}};n.VA012_BankChargeSummary.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.widgetInfo=t.widgetInfo;this.initialize();this.frame.getContentGrid().append(this.getRoot)};n.VA012_BankChargeSummary.prototype.widgetSizeChange=function(n){var t=n};n.VA012_BankChargeSummary.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.VA012_BankChargeSummary.prototype.refreshWidget=function(){this.refreshWidget()};n.VA012_BankChargeSummary.prototype.addChangeListener=function(n){this.listener=n};n.VA012_BankChargeSummary.prototype.widgetFirevalueChanged=function(n){this.listener&&this.listener.widgetFirevalueChanged(n)}}(VA012,jQuery)
