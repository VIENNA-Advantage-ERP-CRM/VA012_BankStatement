/*Version 1.0.21.1*/
VA012 = window.VA012 || {}, function (n, t) { function i() { function he(n) { n != null && n != "" && (o = t(n), e.getControls(), e.setBankAndAccount(), f.newRecord(), e.getBaseCurrency(), e.loadPayments("0", "0", "PY", w.val()), ce(), e.dragPayments(), e.dropPayments()) } function ce() { ef.on(VIS.Events.onTouchStartOrClick, function (n) { n.stopPropagation(); var i = cu.width(); i > 50 && t(".va012-left-content").hide(); cu.animate({ width: i > 50 ? 40 : 200 }, 300, "swing", function () { i < 50 && t(".va012-left-content").show() }) }); ii.on("change", function () { h.val("0"); e.loadBankAccount() }); h.on("change", function () { f.loadCurrency(); f.loadCashLine(); it.html(""); f.scheduleRefresh(); f.prepayRefresh(); f.refreshForm(); ei = 1; e.loadPayments(h.val() == null ? 0 : h.val(), b.val(), y.val(), w.val()); rt = []; k.html(""); ti = 1; c.loadStatement(bt) }); b.on("change", function () { it.html(""); ei = 1; e.loadPayments(h.val() == null ? 0 : h.val(), b.val(), y.val(), w.val()) }); y.on("change", function () { y.val() == "CO" ? (b.prop("selectedIndex", 0), b.prop("disabled", !0)) : (b.prop("selectedIndex", 0), b.prop("disabled", !1)); it.html(""); f.scheduleRefresh(); f.prepayRefresh(); f.refreshForm(); ei = 1; e.loadPayments(h.val() == null ? 0 : h.val(), b.val(), y.val(), w.val()) }); tf.on(VIS.Events.onTouchStartOrClick, function () { w.val() == "" ? VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseEnterStatementDate"), null, "", "") : c.statementDialog() }); rf.on(VIS.Events.onTouchStartOrClick, function () { c.matchStatementDialog() }); pr.on(VIS.Events.onTouchStartOrClick, function () { c.paymentScheduleDialog() }); sf.on(VIS.Events.onTouchStartOrClick, function () { c.prepayOrderDialog() }); af.on(VIS.Events.onTouchStartOrClick, function () { d.val() != null && d.val() != "" ? (oi = !0, rt = [], k.html(""), ti = 1, c.loadStatement(bt)) : (rt = [], k.html(""), ti = 1, c.loadStatement(bt)) }); d.keypress(function (n) { n.which == 13 && (d.val() != null && d.val() != "" ? (oi = !0, rt = [], k.html(""), ti = 1, c.loadStatement(bt)) : (rt = [], k.html(""), ti = 1, c.loadStatement(bt))) }); uf.on(VIS.Events.onTouchStartOrClick, function () { rt.length > 0 ? t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/UnmatchStatement", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _statementLinesList: rt.toString() }), success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n[0]._status == "Success" && n[0]._statementOk != null && VIS.ADialog.info(n[0]._statementOk + " " + VIS.Msg.getMsg("VA012_StatementsUnmatched"), null, "", ""), n[0]._error != null && VIS.ADialog.info(n[0]._error, null, "", ""), n[0]._statementNo != null && VIS.ADialog.info(n[0]._statementNo + " " + VIS.Msg.getMsg("VA012_CompletedRecord"), null, "", ""), n[0]._statementNoNotUpdate != null && VIS.ADialog.info(n[0]._statementNoNotUpdate + " " + VIS.Msg.getMsg("VA012_ErrorSaving"), null, "", ""), f.scheduleRefresh(), f.prepayRefresh(), f.refreshForm(), rt = [], k.html(""), ti = 1, c.loadStatement(bt), it.html(""), f.scheduleRefresh(), f.prepayRefresh(), ei = 1, e.loadPayments(h.val(), b.val(), y.val(), w.val())) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) : VIS.ADialog.info(VIS.Msg.getMsg("VA012_NoRecordSelected"), null, "", "") }); ff.on(VIS.Events.onTouchStartOrClick, function () { if (h.val() == null || h.val() == "" || h.val() == "0") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectBankAccountFirst"), null, "", ""); return } t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/ProcessStatement", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _statementLinesList: rt.toString(), _accountID: h.val() }), success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n[0]._statementProcessed != null && VIS.ADialog.info(n[0]._statementProcessed + " " + VIS.Msg.getMsg("VA012_StatementsProcessed"), null, "", ""), n[0]._error != null && VIS.ADialog.info(n[0]._error, null, "", ""), n[0]._statementNotProcessed != null && VIS.ADialog.info(n[0]._statementNotProcessed + " " + VIS.Msg.getMsg("VA012_StatementsNotProcessed"), null, "", ""), n[0]._statementUnmatchedLines != null && VIS.ADialog.info(n[0]._statementUnmatchedLines + " " + VIS.Msg.getMsg("VA012_ExistsUnmatched"), null, "", ""), f.scheduleRefresh(), f.prepayRefresh(), f.refreshForm(), rt = [], k.html(""), ti = 1, c.loadStatement(bt), it.html(""), f.scheduleRefresh(), f.prepayRefresh(), ei = 1, e.loadPayments(h.val(), b.val(), y.val(), w.val())) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) }); cf.on(VIS.Events.onTouchStartOrClick, function () { rt.length > 0 || parseInt(s.attr("data-uid")) > 0 ? VIS.ADialog.ask(VIS.Msg.getMsg("VA012_WantToDelete")) && t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/DeleteStatement", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _statementLinesList: rt.toString(), _statementLineID: s.attr("data-uid") }), success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n[0]._status == "Success" && n[0]._statementProcessed != null && VIS.ADialog.info(n[0]._statementProcessed + " " + VIS.Msg.getMsg("VA012_StatementsDeleted"), null, "", ""), n[0]._statementNotProcessed != null && VIS.ADialog.info(n[0]._statementNotProcessed + " " + VIS.Msg.getMsg("VA012_StatementsNotDeleted"), null, "", ""), n[0]._error != null && VIS.ADialog.info(n[0]._error, null, "", ""), f.scheduleRefresh(), f.prepayRefresh(), f.refreshForm(), rt = [], k.html(""), ti = 1, c.loadStatement(bt), it.html(""), f.scheduleRefresh(), f.prepayRefresh(), ei = 1, e.loadPayments(h.val(), b.val(), y.val(), w.val())) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) : VIS.ADialog.info(VIS.Msg.getMsg("VA012_NoRecordSelected"), null, "", "") }); it.on("scroll", e.paymentScroll); k.on("scroll", e.statementScroll); k.on(VIS.Events.onTouchStartOrClick, c.statementListEdit); k.on(VIS.Events.onTouchStartOrClick, c.openStatement); k.on(VIS.Events.onTouchStartOrClick, c.selectedStatementLinesList); it.on(VIS.Events.onTouchStartOrClick, c.selectedScheduleList); it.on(VIS.Events.onTouchStartOrClick, function () { u.trigger("blur") }); w.addClass("va012-mandatory"); w.on("change", function () { if (w.val() == "") w.addClass("va012-mandatory"); else { if (new Date(w.val()) > new Date) return VIS.ADialog.info(VIS.Msg.getMsg("VA012_StatementDateToday"), null, "", ""), w.val(""), !1; w.removeClass("va012-mandatory") } e.loadPayments(h.val() == null ? 0 : h.val(), b.val(), y.val(), w.val()) }) } function le(n) { t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/getMatchRecData", contentType: "application/json; charset=utf-8", success: function (t) { if (n.html(""), n.append("<option value=0 >-<\/option>"), t = JSON.parse(t), t != null && t.length > 0) for (var i = 0; i < t.length; i++)n.append("<option value=" + t[i].Value + ">" + t[i].Name + "<\/option>") }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) } function re(n, t) { w2ui["VA012_gridPayment_" + $self.windowNo] != null && w2ui["VA012_gridPayment_" + $self.windowNo].destroy(); var i = null; i = n.w2grid({ name: "VA012_gridPayment_" + $self.windowNo, recordHeight: 25, show: { toolbar: !1, selectColumn: !1, toolbarReload: !1, toolbarColumns: !1, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1 }, records: [], columns: [{ field: "_trxDate", caption: "Tran. Date", sortable: !1, size: "80px", display: !1 }, { field: "_trxNo", caption: "Auth Code/ Trx no.", sortable: !1, size: "30%", hidden: !1 }, { field: "_salesAmt", caption: "Trx Amount", sortable: !1, size: "15%", hidden: !1, style: "text-align: right" }, { field: "_netAmt", caption: "Statement Amount", sortable: !1, size: "15%", hidden: !1, style: "text-align: right" }, { field: "_difference", caption: "Difference", sortable: !1, size: "15%", hidden: !1, style: "text-align: right" }, { field: "_chargeType", caption: "Charge Type", sortable: !1, size: "80px", display: !0 }, { field: "_taxRate", caption: "Tax Rate", sortable: !1, size: "80px", display: !0 }, { field: "_taxAmt", caption: "Tax Amt", sortable: !1, size: "15%", hidden: !1, style: "text-align: right" },], onChange: function () { }, onClick: function () { }, onDelete: function () { }, onSubmit: function () { } }); i.add(t) } function nf(n, t) { return t.indexOf(n) > -1 } function wt(n, i, r) { if (su = t("<div class='vis-apanel-busy va012-busy-bank-statement'>"), su.css({ position: r, width: "95%", height: "95%", "text-align": "center", visibility: "hidden" }), i) su.css({ visibility: "visible" }); else { n.find(".va012-busy-bank-statement").remove(); return } n.append(su) } var o, e, c, f; this.windowNo; $self = this; o = t("<div/>"); this.frame; var su = null, ii = null, h = null, hu = null, w = null, tf = null, rf = null, b = null, y = null, k = null, it = null, bt = "", lr = null, ar = null, dr = null, kf = null, oi = !1, rt = [], g = [], ri = [], v = [], tr = [], sr = [], uf = null, ff = null, ef = null, cu = null, lu = null, ni = 0, l = 2, kt = !1, fi = !1, ei = 1, ti = 1, au = 50, vu = 0, yu = 0, df = null, s = null, pu = null, ht = null, of = null, ir = null, si = null, ui = null, ai = null, dt = null, ci = null, vi = null, vr = null, p = null, u = null, nt = null, ft = null, et = null, gr = null, rr = null, ur = null, ot = null, gt = null, yi = null, yr = null, nu = null, tu = null, iu = null, ru = null, uu = null, fu = null, pr = null, sf = null, fr = null, wu = null, ut = null, hf = null, cf = null, ue = null, fe = null, pi = null, er = null, wi = null, or = null, ct = null, wr = null, br = null, li = null, lt = null, lf = null, at = null, vt = null, bi = null, ki = null, di = null, gi = null, nr = null, d = null, af = null, hi = null, gf = null, bu = null, i = null, r = null, vf = 0, yf = 0, ne = null, yt = null, kr = null, pf = null, pt = null, ku = null, wf = null, tt = null, hr = null, ee = null, du = null, a = null, eu = null, bf = null, st = null, cr = null, gu = new Date, te = gu.getFullYear() + "-" + ("0" + (gu.getMonth() + 1)).slice(-2) + "-" + ("0" + gu.getDate()).slice(-2), ou, oe, ie, se; this.Initialize = function () { he(e.loadFormDesign()) }; e = { loadFormDesign: function () { var n = '  <div class="va012-assign-content">  <div id="VA012_mainContainer_' + $self.windowNo + '" class="va012-main-container">  <table id="VA012_table_' + $self.windowNo + '" style="width: 100%;"><tr><td id="VA012_tdLeft_' + $self.windowNo + '" style="width: 200px;position: relative;">   <div class="va012-left-part">              <div class="va012-left-title">                  <h4>    <i id="VA012_btnHide_' + $self.windowNo + '" class="fa fa-bars" alt="lines" style="cursor: pointer;background: rgba(var(--v-c-primary),1);"><\/i> <\/h4>              <\/div>              <div class="va012-left-content">                  <div class="va012-left-data">                      <label  id="VA012_lblBank_' + $self.windowNo + '" >' + VIS.Msg.getMsg("VA012_Bank") + '<sup style="color: red;">*<\/sup><\/label>                      <select id="VA012_cmbBank_' + $self.windowNo + '" ><\/select>                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <label  id="VA012_lblBankAccount_' + $self.windowNo + '" >' + VIS.Msg.getMsg("VA012_BankAccount") + '<sup style="color: red;">*<\/sup><\/label>                      <select id="VA012_cmbBankAccount_' + $self.windowNo + '"   ><\/select>                  <\/div>                  <!-- end of left-data -->                  <div class="va012-left-data">                      <label  id="VA012_lblStatementDate_' + $self.windowNo + '" >' + VIS.Msg.getMsg("VA012_StatementDate") + '<sup style="color: red;">*<\/sup><\/label>                      <input type="date" max="9999-12-31" id="VA012_statementDate_' + $self.windowNo + '"   >                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <a id="VA012_btnLoadStatement_' + $self.windowNo + '">' + VIS.Msg.getMsg("VA012_LoadStatement") + '<\/a>                      <a id="VA012_btnMatchStatement_' + $self.windowNo + '">' + VIS.Msg.getMsg("VA012_MatchStatement") + '<\/a>                  <\/div>                  <!-- end of left-data -->              <\/div>              <!-- end of left-content -->          <\/div>          <!-- end of left-part --> <\/td> <td style="position: relative;">          <div id="VA012_contentArea_' + $self.windowNo + '" class="va012-content-area" style="position: absolute;" >              <div id="VA012_middleWrap_' + $self.windowNo + '" class="va012-middle-wrap">                  <div class="va012-mid-top-wrap" id="VA012_formBtnNewRecord_' + $self.windowNo + '">                      <div class="va012-icons-wrap">                          <span>                              <i class="va012-undo vis vis-ignore" alt="undo" title="Undo" id="VA012_btnUndo_' + $self.windowNo + '"><\/i><\/span>                          <span>                              <i class="va012-hide-show-newform vis vis-plus" activestatus="0" alt="add" title = "Expand" id="VA012_btnNewRecord_' + $self.windowNo + '"><\/i><\/span>                      <\/div>                      <!-- end of icons-wrap -->                  <\/div>                  <!-- end of mid-top-wrap -->                    <div class="va012-form-wrap va012-newform" id="VA012_formNewRecord_' + $self.windowNo + '" data-uid="0">                      <div class="row va012-fl-padd">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementNumber") + ' <sup style="color: red;">*<\/sup><\/label>                                  <input  tabindex="1" id="VA012_txtStatementNo_' + $self.windowNo + '" type="text" class="va012-input-size">                                  <i  id="VA012_btnStatementNo_' + $self.windowNo + '" class="fa fa-plus va012-add-icon"><\/i>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementPage") + '<\/label>                                  <input tabindex="2" value="1" id="VA012_txtStatementPage_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementLine") + '<\/label>                                  <input tabindex="3" value="10" id="VA012_txtStatementLine_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementDate") + '<sup style="color: red;">*<\/sup><\/label>                                  <input tabindex="4" id="VA012_dtStatementDate_' + $self.windowNo + '" type="date">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data" >                                  <label>' + VIS.Msg.getMsg("VA012_Amount") + '<sup style="color: red;">*<\/sup><\/label>                                  <a tabindex="5" id="VA012_btnIn_' + $self.windowNo + '" v_active="1" class="va012-inout-icon va012-active">In<\/a>                                  <a tabindex="6" id="VA012_btnOut_' + $self.windowNo + '" v_active="0" class="va012-inout-icon va012-inactive">Out<\/a>                                  <input tabindex="7" autofocus  value="0.00" id="VA012_txtAmount_' + $self.windowNo + '" type="number" class="va012-input-size-amt va012-right-align va012-txtamount">                                <a id="VA012_btnAmount_' + $self.windowNo + '" class="va012-info-icon"><\/a>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_VoucherMatch") + '<sup style="color: red;">*<\/sup><\/label>                                  <select tabindex="8" id="VA012_cmbVoucherMatch_' + $self.windowNo + '">                                  <\/select>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                          <div class="col-md-8 col-sm-8 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_Description") + '<\/label>                                  <input tabindex="9" id="VA012_txtDescription_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divVoucherNo_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_VoucherNo") + '<\/label>                                  <input tabindex="9" id="VA012_txtVoucherNo_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                 <div id="VA012_divTrxAmt_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                   <label>' + VIS.Msg.getMsg("VA012_TrxAmt") + '<\/label>                                   <input disabled tabindex="9" id="VA012_txtTrxAmt_' + $self.windowNo + '" type="number" class="va012-right-align">                                 <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                 <div id="VA012_divDifference_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                   <label>' + VIS.Msg.getMsg("VA012_Difference") + '<\/label>                                   <input disabled tabindex="9" vchangable="Y" id="VA012_txtDifference_' + $self.windowNo + '" type="number" class="va012-right-align">                                 <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divDifferenceType_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_DifferenceType") + '<\/label>                                  <select tabindex="9" id="VA012_cmbDifferenceType_' + $self.windowNo + '">                                  <\/select>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divContraType_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_ContraType") + '<\/label>                                      <select tabindex="10" id="VA012_cmbContraType_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCashBook_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_CashBook") + '<\/label>                                      <select tabindex="10" id="VA012_cmbCashBook_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <div id="VA012_divCtrlCashLine_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_CashJournalLine") + '<\/label>                                      <div id="VA012_ctrlCashLine_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCheckNo_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_CheckNo") + '<\/label>                                      <input  disabled tabindex="12" id="VA012_txtCheckNo_' + $self.windowNo + '" type="text">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCharge_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_Charge") + '<\/label>                                      <div style=" position: relative; float: left; width: 100%; ">                                      <input tabindex="10" chargeid="" type="text" id="VA012_txtCharge_' + $self.windowNo + '" style=" width: 100%; ">                                      <img id="VA012_btnCharge_' + $self.windowNo + '" class="VA012-img-combo" alt="">                                     <\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divTaxRate_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_TaxRate") + '<\/label>                                      <select tabindex="11" id="VA012_cmbTaxRate_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divTaxAmount_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_TaxAmount") + '<\/label>                                      <input tabindex="12" class="va012-right-align"  value="0.00" id="VA012_txtTaxAmount_' + $self.windowNo + '" type="number">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlPayment_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_Payment") + '<\/label>                                      <div id="VA012_ctrlPayment_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlInvoice_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_Invoice") + '<\/label>                                      <div id="VA012_ctrlInvoice_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlBusinessPartner_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_BusinessPartner") + '<\/label>                                      <div id="VA012_ctrlBusinessPartner_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPaymentSchedule_' + $self.windowNo + '" class="va012-form-data" >                              <label>' + VIS.Msg.getMsg("VA012_PaymentSchedules") + '<\/label>                              <input disabled id="VA012_txtPaymentSchedule_' + $self.windowNo + '" type="text" class="va012-input-size">                              <a tabindex="13"  id="VA012_btnPaymentSchedule_' + $self.windowNo + '" class="va012-edit-icon"><\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPrepayOrder_' + $self.windowNo + '" class="va012-form-data" >                              <label>' + VIS.Msg.getMsg("VA012_PrepayOrders") + '<\/label>                              <div id="VA012_ctrlOrder_' + $self.windowNo + '" ><\/div>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                       <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-check">                                  <input tabindex="13" id="VA012_chkUseNextTime_' + $self.windowNo + '" type="checkbox">                                  <label style="position: absolute;">' + VIS.Msg.getMsg("VA012_UseNextTime") + '<\/label>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-2 col-sm-2 va012-padd-0" >                              <div class="va012-form-data" id="VA012_divMore_' + $self.windowNo + '">                                  <a tabindex="14" visiblestatus="0" class="va012-more" id="VA012_btnMore_' + $self.windowNo + '" href="#">' + VIS.Msg.getMsg("VA012_More") + '<\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-6 col-sm-6 va012-padd-0" >                          <div style="float:right;">                              <a tabindex="15" title="Save Record" id="VA012_btnSave_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" style=" float: left;">' + VIS.Msg.getMsg("VA012_SaveandNew") + '<\/a>                          <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                  <\/div>                  <!-- end of form-wrap -->                  <div id="VA012_paymentHeaderWrap_' + $self.windowNo + '" class="va012-payment-header-wrap">                          <div class="pull-left">                              <a class="va012-frm-btn va012-btn-gray" style="cursor: default;">' + VIS.Msg.getMsg("VA012_UpcomingTransactions") + '<\/a>                          <\/div>                      <div style=" float: right; width: 60%; ">                           <div class="va012-width-30" style=" float: left; width: 49%; ">                              <select id="VA012_cmbTransactionType_' + $self.windowNo + '">                             <option value="PY">' + VIS.Msg.getMsg("VA012_Payments") + '<\/option>                             <option value="PO">' + VIS.Msg.getMsg("VA012_PrepayOrders") + '<\/option>                              <option value="IS">' + VIS.Msg.getMsg("VA012_InvoiceSchedule") + '<\/option>                              <option value="CO">' + VIS.Msg.getMsg("VA012_Contra") + '<\/option>                              <\/select>                          <\/div>                          <div class="va012-width-30" style=" float: right; width: 49%; ">                              <select id="VA012_cmbSearchPaymentMethod_' + $self.windowNo + '">                              <\/select>                          <\/div>                          <\/div>                      <\/div>                      <!-- end of payment-header-wrap -->                  <div id="VA012_paymentList_' + $self.windowNo + '" class="va012-payment-list">                                           <div class="va012-payment-content" id="VA012_lstPayments_' + $self.windowNo + '">                   <\/div>                  <\/div>                  <!-- end of payment-list -->                <\/div>              <!-- end of middle-wrap -->              <div id="VA012_rightWrap_' + $self.windowNo + '" class="va012-right-wrap">                  <div id="VA012_rightTop_' + $self.windowNo + '" class="va012-right-top">                      <div class="row">                          <div class="col-md-3 col-sm-3" style=" padding-right: 5px; ">                              <div class="va012-pay-text" id="VA012_secReconciled_' + $self.windowNo + '" >                                <p>' + VIS.Msg.getMsg("VA012_Reconciled") + '<\/p>                                <p style="margin-top: 4px;">' + VIS.Msg.getMsg("VA012_Unreconciled") + '<\/p>                              <\/div>                          <\/div>                          <!-- end of col -->                          <div class="col-md-9 col-sm-9" style=" padding-left: 5px; ">                              <div class="va012-pay-text" id="VA012_secUnreconciled_' + $self.windowNo + '">                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-green"><span class="va012-base-curr"><\/span> 0<\/span>                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-red"><span class="va012-base-curr"><\/span> 0<\/span>                              <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                      <div class="row">                          <div class="col-md-12 col-sm-12" style=" padding-left: 5px; ">                      <div style=" /* float: right; */ padding-left: 10px;">                               <a id="VA012_btnUnmatch_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" title="Show Unmatched Record" style=" float: left; ">' + VIS.Msg.getMsg("VA012_Unmatch") + '<\/a>                              <a id="VA012_btnProcess_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" title="Clear Matched Record" style=" float: left; margin-left: 5px; ">' + VIS.Msg.getMsg("VA012_Process") + '<\/a>                             <a id="VA012_btnDelete_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" title="Delete Selected Record" style=" float: left; margin-left: 5px; ">' + VIS.Msg.getMsg("VA012_Delete") + '<\/a>                       <\/div>                           <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <div class="row">                          <div class="col-md-12 col-sm-12" style=" padding-right: 5px; ">                           <div class="va012-right-search">                            <div class="va012-search-wrap">                               <input id="VA012_txtSearch_' + $self.windowNo + '" value="" placeholder="' + VIS.Msg.getMsg("VA012_Search") + '..." type="text">                               <a id="VA012_btnSearch_' + $self.windowNo + '" class="va012-search-icon"><span class="glyphicon glyphicon-search"><\/span><\/a>                          <\/div>                      <!-- end of search-wrap -->                         <\/div>                  <!-- end of right-search -->                        <\/div>                       <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <\/div>                  <!-- end of right-top -->                    <div class="va012-right-content" id="VA012_lstStatement_' + $self.windowNo + '">                  <\/div>                  <!-- end of right-content -->              <\/div>              <!-- end of right-wrap -->          <\/div>          <!-- end of content-area -->  <\/td><\/tr><\/table>      <\/div>      <!-- end of main-container -->    <\/div>  <!-- end of assign-content -->  '; return ou = t('<div  id="VA012_gridMatchStatePopUp_' + $self.windowNo + '"" style="display:block;width:auto;height:auto"><div  style="    width: 50%;float: left;" ><label>' + VIS.Msg.getMsg("VA012_ChargeType") + '<\/label><div  id="VA012_ChargeSrch_' + $self.windowNo + '"><\/div><\/div><div ><label>' + VIS.Msg.getMsg("VA012_Taxrate") + '<\/label><select  id="VA012_cmbTaxRate_' + $self.windowNo + '"><\/select><\/div><div style="width:auto;height:270px" id="VA012_gridMatchState_' + $self.windowNo + '""><\/div><\/div>'), oe = ou.find("#VA012_gridMatchState_" + $self.windowNo), ie = ou.find("#VA012_ChargeSrch_" + $self.windowNo), se = ou.find("#VA012_cmbTaxRate_" + $self.windowNo), _ChargeLookUp = VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(), $self.windowNo, 3787, VIS.DisplayType.Search), $ChargeControl = new VIS.Controls.VTextBoxButton("C_Charge_ID", !0, !1, !0, VIS.DisplayType.Search, _ChargeLookUp), ie.append($ChargeControl.getControl().css("width", "93%")).append($ChargeControl.getBtn(0).css("width", "30px").css("height", "30px").css("padding", "0px").css("border-color", "#BBBBBB")), n }, setBankAndAccount: function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/SetBankAndAccount", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n != null && (yu = n.Table[0].C_BANK_ID, vu = n.Table[0].C_BANKACCOUNT_ID)); e.loadBank() } }) }, addEffect: function (n, t, i) { var r = { to: t, className: "wsp-ui-effects-transfer" }; n.effect("transfer", r, 600, i) }, setInvoiceAndBPartner: function (n, i) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/SetInvoiceAndBPartner", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _paymentID: n, _cmbTransactionType: i }, success: function (n) { if (n != null && n != "") if (n = t.parseJSON(t.parseJSON(n)), i == "PY") { n._invoiceID > 0 ? st.setValue(n._invoiceID, !1, !0) : st.setValue(); n._bPartnerID > 0 ? a.setValue(n._bPartnerID, !1, !0) : a.setValue(); var r = VIS.DB.executeScalar("SELECT COUNT(*) FROM AD_ModuleInfo WHERE Prefix='VA034_' AND IsActive='Y'"); r == 1 && n.VA034_DepositSlipNo != "" && rr.val(n.VA034_DepositSlipNo) } else i == "PO" ? a.value || a.setValue(n._bPartnerID, !1, !0) : i == "IS" && (a.value || a.setValue(n._bPartnerID, !1, !0)) } }) }, setBPartner: function (n) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/SetBPartner", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _invoiceID: n }, success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n > 0 ? a.setValue(n, !1, !0) : a.setValue()) } }) }, getMaxStatement: function (n) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/MaxStatement", type: "GET", datatype: "json", data: { _bankAccount: h.val() == null ? 0 : h.val(), _origin: n }, contentType: "application/json; charset=utf-8", success: function (n) { n != null && n != "" && (n = t.parseJSON(t.parseJSON(n)), ht.val(n.statementNo), ir.val(n.pageno), si.val(n.lineno)) } }) }, getOverUnderPayment: function (n) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/getOverUnderPayment", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _paymentID: n }, success: function (n) { n != null && n != "" && (n = t.parseJSON(t.parseJSON(n)), n._difference != 0 && (ft.val(Math.abs(n._difference).toFixed(l)), li.find("*").prop("disabled", !1), et.val(n._differenceType).prop("selected", !0), ft.attr("vchangable", "N"), p.val() == "M" && nt.val(parseFloat(n._payamt).toFixed(l)))) } }) }, getControls: function () { ii = o.find("#VA012_cmbBank_" + $self.windowNo); h = o.find("#VA012_cmbBankAccount_" + $self.windowNo); hu = o.find("#VA012_STAT_cmbBankAccountClassName_" + $self.windowNo); w = o.find("#VA012_statementDate_" + $self.windowNo); df = o.find("#VA012_BankChargeDiv" + $self.windowNo); b = o.find("#VA012_cmbSearchPaymentMethod_" + $self.windowNo); y = o.find("#VA012_cmbTransactionType_" + $self.windowNo); tf = o.find("#VA012_btnLoadStatement_" + $self.windowNo); rf = o.find("#VA012_btnMatchStatement_" + $self.windowNo); k = o.find("#VA012_lstStatement_" + $self.windowNo); it = o.find("#VA012_lstPayments_" + $self.windowNo); lr = o.find("#VA012_secReconciled_" + $self.windowNo); ar = o.find("#VA012_secUnreconciled_" + $self.windowNo); d = o.find("#VA012_txtSearch_" + $self.windowNo); af = o.find("#VA012_btnSearch_" + $self.windowNo); uf = o.find("#VA012_btnUnmatch_" + $self.windowNo); ff = o.find("#VA012_btnProcess_" + $self.windowNo); ef = o.find("#VA012_btnHide_" + $self.windowNo); cu = o.find("#VA012_tdLeft_" + $self.windowNo); lu = o.find("#VA012_table_" + $self.windowNo); hi = o.find("#VA012_btnMore_" + $self.windowNo); gf = o.find("#VA012_divMore_" + $self.windowNo); pi = o.find("#VA012_divContraType_" + $self.windowNo); er = o.find("#VA012_divCashBook_" + $self.windowNo); _divCtrlCashLine = o.find("#VA012_divCtrlCashLine_" + $self.windowNo); wi = o.find("#VA012_divTransferType_" + $self.windowNo); or = o.find("#VA012_divCheckNo_" + $self.windowNo); ct = o.find("#VA012_divVoucherNo_" + $self.windowNo); wr = o.find("#VA012_divTrxAmt_" + $self.windowNo); br = o.find("#VA012_divDifference_" + $self.windowNo); li = o.find("#VA012_divDifferenceType_" + $self.windowNo); lt = o.find("#VA012_divCharge_" + $self.windowNo); lf = o.find("#VA012_btnCharge_" + $self.windowNo); at = o.find("#VA012_divTaxRate_" + $self.windowNo); vt = o.find("#VA012_divTaxAmount_" + $self.windowNo); bi = o.find("#VA012_divCtrlPayment_" + $self.windowNo); ki = o.find("#VA012_divCtrlInvoice_" + $self.windowNo); di = o.find("#VA012_divCtrlBusinessPartner_" + $self.windowNo); gi = o.find("#VA012_divPrepayOrder_" + $self.windowNo); nr = o.find("#VA012_divPaymentSchedule_" + $self.windowNo) }, getBaseCurrency: function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetBaseCurrency", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", success: function (n) { n != null && n != "" && (n = t.parseJSON(t.parseJSON(n)), dr = n._code, kf = n._id, t(".va012-base-curr").text(dr)) } }) }, loadBank: function () { function i(t) { if (ii.html(""), ii.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)ii.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_bank_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null; ii.prop("selectedIndex", 0); yu > 0 && (ii.val(yu).prop("selected", !0), yu = 0); e.loadBankAccount() } var n = "SELECT NAME,C_BANK_ID FROM C_Bank WHERE ISACTIVE='Y'", t; n = VIS.MRole.getDefault().addAccessSQL(n, "C_Bank", !0, !1); t = VIS.DB.executeDataSet(n.toString(), null, i) }, loadBankAccount: function () { function t(t) { if (h.html(""), h.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)h.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_bankaccount_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.accountno) + "<\/option>"); t.dispose(); t = null; n = null; h.prop("selectedIndex", 0); vu > 0 && (h.val(vu).prop("selected", !0), vu = 0); e.getMaxStatement("LO"); e.loadSearchPaymentMethod() } var n = "SELECT ACCOUNTNO,C_BANKACCOUNT_ID FROM C_BANKACCOUNT WHERE ISACTIVE='Y' AND C_BANK_ID=" + ii.val(), i = VIS.DB.executeDataSet(n.toString(), null, t) }, LoadPaymentsPages: function (n, i, r) { oi = d.val() != null && d.val() != "" ? !0 : !1; t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadPaymentsPages", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _accountID: n, _paymentPageNo: ei, _PAGESIZE: au, _paymentMethodID: i, _transactionType: r }, success: function (n) { n != null && n != "" && (yf = JSON.parse(n)) } }) }, loadPayments: function (n, i, r, u) { function f(n) { var u, i, f, o; if (n = t.parseJSON(n), u = "", it.html(""), n != null && n.length > 0) for (i = 0; i < n.length; i++)f = "va012-red-color", f = n[i].c_bankstatementline_id == null || n[i].c_bankstatementline_id == "0" || n[i].c_bankstatementline_id == 0 ? "va012-red-color" : "va012-green-color", u = "", u = '<div class="drag-no-drag"><div draggable="true" class="va012-mid-data-wrap ', (r == "PY" || r == "CO") && (u += f), u += ' " paymentdata="' + VIS.Utility.encodeText(n[i].paymentno) + "/" + VIS.Utility.encodeText(n[i].businesspartner) + '" data-uid="' + n[i].c_payment_id, u += ' " paymentamount = " ' + VIS.Utility.Util.getValueOfDecimal(n[i].convertedamount, "N") + '"><div class="va012-payment-wrap" ><div class="row"> <div class="col-md-3 col-sm-3">    <div class="va012-form-check">        <input type="checkbox" data-uid="' + n[i].c_payment_id + '"  >    <div title="' + VIS.Msg.getMsg("VA012_PaymentAmount") + '" class="va012-inside-form-check" style=" float: left; width: 85%; ">      <label style=" width: 100%; ">' + n[i].currency + " " + Globalize.format(n[i].paymentamount, "N") + "<\/label>", n[i].isconverted == "Y" && (u += "      <span>" + n[i].basecurrency + " " + Globalize.format(n[i].convertedamount, "N") + "<\/span>"), u += '   <\/div><\/div>    <!-- end of form-group -->  <\/div>  <!-- end of col -->  <div class="col-md-4 col-sm-4">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Business Partner">' + VIS.Utility.encodeText(n[i].businesspartner) + "<\/p>         <span>" + VIS.Utility.encodeText(n[i].bpgroup) + '<\/span>       <span title="Document No.">' + VIS.Utility.encodeText(n[i].paymentno) + '<\/span>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col --> <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text"><p title="Payment Type">' + VIS.Utility.encodeText(n[i].paymenttype) + "<\/p><\/div><\/div><!-- end of form-group --><\/div><!-- end of col -->", o = VIS.Utility.Util.getValueOfInt(VIS.DB.executeScalar("SELECT Count(AD_ModuleInfo_ID) FROM AD_ModuleInfo WHERE PREFIX='VA034_' AND IsActive = 'Y'")), u += r == "PY" && o > 0 ? '  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Deposit Slip No">' + VIS.Utility.encodeText(n[i].depositslipno) + '<\/p>           <p title="Authentication Code">' + VIS.Utility.encodeText(n[i].authcode) + '<\/p>           <p title="Account Date">' + n[i].DateAcct + '<\/p>           <p title="Payment Method">' + n[i].PaymentMethod + "<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->" : '  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Authentication Code">' + VIS.Utility.encodeText(n[i].authcode) + '<\/p>           <p title="Account Date">' + n[i].DateAcct + '<\/p>           <p title="Payment Method">' + n[i].PaymentMethod + "<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->", u += "<\/div><!-- end of row --><\/div> <!-- end of payment-wrap --><\/div> <!-- end of mid-data-wrap -->", it.append(u); _sql = null; e.setPaymentListHeight(); e.dragPayments() } wt(t(it), !0, "inherit"); window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadPayments", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _accountID: n, _paymentPageNo: ei, _PAGESIZE: au, _paymentMethodID: i, _transactionType: r, statementDate: u == null || u == "" ? new Date : u }, success: function (n) { n != null && n != "" && (f(n), wt(t(it), !1, "inherit")) }, error: function () { wt(t(it), !1, "inherit") } }) }, 2) }, setPaymentListHeight: function () { var n; clearTimeout(n); n = setTimeout(function () { t("#VA012-content-area" + $self.windowNo).height(t("#VA012_mainContainer_" + $self.windowNo).height() - 20); ut.attr("activestatus") == "1" ? t("#VA012_paymentList_" + $self.windowNo).height(t("#VA012_middleWrap_" + $self.windowNo).height() - t("#VA012_formBtnNewRecord_" + $self.windowNo).height() - t("#VA012_formNewRecord_" + $self.windowNo).height() - t("#VA012_paymentHeaderWrap_" + $self.windowNo).height() - 42) : t("#VA012_paymentList_" + $self.windowNo).height(t("#VA012_middleWrap_" + $self.windowNo).height() - t("#VA012_formBtnNewRecord_" + $self.windowNo).height() - t("#VA012_paymentHeaderWrap_" + $self.windowNo).height() - 27) }, 2) }, loadSearchPaymentMethod: function () { function i(t) { if (b.html(""), b.append("<option value=0 >" + VIS.Msg.getMsg("VA012_SelectPaymentMethod") + "<\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)b.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.va009_paymentmethod_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.va009_name) + "<\/option>"); t.dispose(); t = null; n = null; b.prop("selectedIndex", 0); h.trigger("change") } var n = "SELECT VA009_NAME,VA009_PAYMENTMETHOD_ID FROM VA009_PAYMENTMETHOD WHERE ISACTIVE='Y' AND VA009_PAYMENTBASETYPE!='B' AND AD_CLIENT_ID=" + VIS.Env.getCtx().getAD_Client_ID(), t; VIS.Env.getCtx().getAD_Org_ID() != 0 && (n += " AND AD_ORG_ID IN( " + VIS.Env.getCtx().getAD_Org_ID() + ",0)"); t = VIS.DB.executeDataSet(n.toString(), null, i) }, paymentScroll: function () { yf = 0; t(this).scrollTop() > 0 && t(this).scrollTop() + t(this).innerHeight() + 2 >= this.scrollHeight && (e.LoadPaymentsPages(h.val(), b.val(), y.val()), ei < yf && (ei++ , e.loadPayments(h.val(), b.val(), y.val(), w.val()))) }, statementScroll: function () { vf = 0; t(this).scrollTop() > 0 && t(this).scrollTop() + t(this).innerHeight() + 1 >= this.scrollHeight && (c.LoadStatementsPages(), ti < vf && (ti++ , c.loadStatement(bt))) }, dragPayments: function () { it.find(".va012-mid-data-wrap").draggable({ start: function (n, t) { t.helper.addClass("va012-dragging") }, drag: function () { }, stop: function (n, t) { t.helper.removeClass("va012-dragging") }, cursor: "move", cursorAt: { left: 5 }, revert: "invalid", helper: "clone" }) }, dropPayments: function () { k.find(".va012-right-data-wrap").droppable({ hoverClass: "va012-dropping", drop: function (n, o) { var a, p, h, w; if (t(o.draggable).data("uid") > 0 && t(this).data("uid") > 0) { if (y.val() == "PY") { if (h = t(o.draggable).data("uid"), t(o.draggable).hasClass("va012-green-color")) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PaymentAlreadyMatchedOthrStatement"), null, "", ""); return } w = t(this).data("uid"); e.checkPaymentCondition(t(o.draggable).data("uid"), t(this).data("uid"), u.val()) && (c.statementOpenEdit(t(this).data("uid")), window.setTimeout(function () { kt = !0; tt.setValue(h, !1, !0); e.setInvoiceAndBPartner(t(o.draggable).data("uid"), "PY"); kt = !1 }, 200)) } else if (y.val() == "IS") { if (parseInt(s.attr("data-uid")) != t(this).data("uid") && f.scheduleRefresh(), e.checkScheduleCondition(t(o.draggable).data("uid"), t(this).data("uid"), g.toString(), u.val())) { if (nf(parseInt(t(o.draggable).data("uid")), g)) VIS.ADialog.info(VIS.Msg.getMsg("VA012_AlreadySelected"), null, "", ""); else if (g.push(parseInt(t(o.draggable).data("uid"))), ri.push(t(o.draggable).attr("paymentdata")), v.push(t(o.draggable).attr("paymentamount")), Number(v[0]) == "0") { for (a = 0, p = 0; p < v.length; p++)a += VIS.Utility.Util.getValueOfDecimal(v[p]); a < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")); u.val(a.toFixed(l)) } kt = !0; c.statementOpenEdit(t(this).data("uid")); e.setInvoiceAndBPartner(t(o.draggable).data("uid"), "IS"); fr.val(ri.toString()); window.setTimeout(function () { for (var t = 0, n = 0; n < v.length; n++)t += VIS.Utility.Util.getValueOfDecimal(v[n]); nt.val(t.toFixed(l)); nt.trigger("change") }, 200) } } else y.val() == "PO" && (parseInt(s.attr("data-uid")) != t(this).data("uid") && f.prepayRefresh(), e.checkPrepayCondition(t(o.draggable).data("uid"), t(this).data("uid"), tr.toString(), u.val()) && (c.statementOpenEdit(t(this).data("uid")), window.setTimeout(function () { kt = !0; yt.setValue(t(o.draggable).data("uid"), !1, !0); e.setInvoiceAndBPartner(t(o.draggable).data("uid"), "PO"); kt = !1 }, 200))); if (y.val() == "CO") { if (h = t(o.draggable).data("uid"), t(o.draggable).hasClass("va012-green-color")) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_CashLineAlreadyMatchedOthrStmt"), null, "", ""); return } w = t(this).data("uid"); e.checkContraCondition(t(o.draggable).data("uid"), t(this).data("uid"), u.val()) && (c.statementOpenEdit(t(this).data("uid")), window.setTimeout(function () { kt = !0; pt.setValue(h, !1, !0); kt = !1 }, 200)) } } } }); s.droppable({ hoverClass: "va012-dropping", drop: function (n, f) { var s, o; if (t(f.draggable).data("uid") > 0) { if (y.val() == "CO") if (p.val() == "C") { if (dt.val() != "CB") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_ContraSelectCashToBank"), null, "", ""); return } } else { VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectVoucherContra"), null, "", ""); return } else if (p.val() != "M") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectVoucherPayment"), null, "", ""); return } if (y.val() == "PY") { if (t(f.draggable).hasClass("va012-green-color")) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PaymentAlreadyMatchedOthrStatement"), null, "", ""); return } t(f.draggable).data("uid") > 0 && e.checkPaymentCondition(t(f.draggable).data("uid"), t(this).attr("data-uid"), u.val()) && tt.setValue(t(f.draggable).data("uid"), !1, !0) } if (y.val() == "IS" && e.checkScheduleCondition(t(f.draggable).data("uid"), t(this).attr("data-uid"), g.toString(), u.val())) { if (nf(parseInt(t(f.draggable).data("uid")), g)) VIS.ADialog.info(VIS.Msg.getMsg("VA012_AlreadySelected"), null, "", ""); else { if (g.push(parseInt(t(f.draggable).data("uid"))), ri.push(t(f.draggable).attr("paymentdata")), u.val() == "0.00" && v.push("0"), v.push(t(f.draggable).attr("paymentamount")), Number(v[0]) == "0") { for (s = 0, o = 0; o < v.length; o++)s += VIS.Utility.Util.getValueOfDecimal(v[o]); s < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")); u.val(s.toFixed(l)) } e.setInvoiceAndBPartner(t(f.draggable).data("uid"), "IS") } for (fr.val(ri.toString()), s = 0, o = 0; o < v.length; o++)s += VIS.Utility.Util.getValueOfDecimal(v[o]); nt.val(s.toFixed(l)); nt.trigger("change") } if (y.val() == "PO" && e.checkPrepayCondition(t(f.draggable).data("uid"), t(this).attr("data-uid"), tr.toString(), u.val()) && (yt.setValue(t(f.draggable).data("uid"), !1, !0), e.setInvoiceAndBPartner(t(f.draggable).data("uid"), "PO")), y.val() == "CO" && t(f.draggable).data("uid") > 0) { if (t(f.draggable).hasClass("va012-green-color")) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_CashLineAlreadyMatchedOthrStmt"), null, "", ""); return } e.checkContraCondition(t(f.draggable).data("uid"), t(this).attr("data-uid"), u.val()) && pt.setValue(t(f.draggable).data("uid"), !1, !0) } } kt = !1 } }) }, checkFormPaymentCondition: function (n, f) { var e = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckFormPaymentCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _paymentID: n, _amount: f }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (e = !0, n._amount != null && n._amount != 0 && (u.val(n._amount.toFixed(l)), u.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")))) : (VIS.ADialog.info(VIS.Msg.getMsg(n._status), null, "", ""), e = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); e = !1 } }), e }, checkFormPrepayCondition: function (n, f) { var o = 0, e; return a.value && (o = a.value), e = !1, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckFormPrepayCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _orderID: n, _amount: f, _currencyId: ni, _formBPartnerID: o }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (e = !0, n._amount > 0 && (u.val(n._amount.toFixed(l)), u.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")))) : (VIS.ADialog.info(VIS.Msg.getMsg(n._status), null, "", ""), e = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); e = !1 } }), e }, checkInvoiceCondition: function (n, i) { var r = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckInvoiceCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _invoiceID: n, _amount: i }, success: function (n) { n = t.parseJSON(n); n == "Success" ? r = !0 : (VIS.ADialog.info(VIS.Msg.getMsg(n), null, "", ""), r = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); r = !1 } }), r }, checkPaymentCondition: function (n, f, e) { var o = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckPaymentCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: f, _amount: e }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (o = !0, n._amount != null && n._amount != 0 && (u.val(n._amount.toFixed(l)), u.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")), nt.val(n._trxamount.toFixed(l)))) : (VIS.ADialog.info(VIS.Msg.getMsg(n._status), null, "", ""), o = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); o = !1 } }), o }, checkScheduleCondition: function (n, i, r, u) { var e, f; if (ni == null || ni == 0) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectBankAccountFirst"), null, "", ""); return } return e = 0, a.value && (e = a.value), f = !1, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckScheduleCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: i, _listToCheck: r, _amount: u, _currencyId: ni, _formBPartnerID: e }, success: function (n) { n = t.parseJSON(n); n == "Success" ? f = !0 : (VIS.ADialog.info(VIS.Msg.getMsg(n), null, "", ""), f = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); f = !1 } }), f }, checkScheduleTotal: function (n, i, r) { var u = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckScheduleTotal", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _listToCheck: n, _amount: i, _currencyId: ni, _destinationID: r }, success: function (n) { n = t.parseJSON(n); n == "Success" ? u = !0 : (VIS.ADialog.info(VIS.Msg.getMsg(n), null, "", ""), u = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); u = !1 } }), u }, checkPrepayCondition: function (n, f, e, o) { var h = 0, s; return a.value && (h = a.value), s = !1, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckPrepayCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: f, _listToCheck: e, _amount: o, _currencyId: ni, _formBPartnerID: h }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (s = !0, n._amount > 0 && (u.val(n._amount.toFixed(l)), u.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")))) : (VIS.ADialog.info(VIS.Msg.getMsg(n._status), null, "", ""), s = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); s = !1 } }), s }, checkContraCondition: function (n, f, e) { var s = 0, o; return a.value && (s = a.value), o = !1, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckContraCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: f, _amount: e, _currencyId: ni, _formBPartnerID: s }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (o = !0, u.val(n._amount.toFixed(l)), u.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0"))) : (VIS.ADialog.info(VIS.Msg.getMsg(n._status), null, "", ""), o = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); o = !1 } }), o }, matchByDrag: function (n, f) { var e = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/MatchByDrag", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragPaymentID: n, _dragStatementID: f }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (e = !0, n._amount != null && n._amount != 0 && (u.val(n._amount.toFixed(l)), u.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")), ot.trigger("focus"))) : (VIS.ADialog.info(VIS.Msg.getMsg(n._status), null, "", ""), e = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); e = !1 } }), e } }; c = { statementDialog: function () { function b() { l = $statement.find("#VA012_STAT_cmbBank_" + $self.windowNo); r = $statement.find("#VA012_STAT_cmbBankAccount_" + $self.windowNo); e = $statement.find("#VA012_STAT_cmbBankAccountClassName_" + $self.windowNo); y = $statement.find("#VA012_STAT_statementDate_" + $self.windowNo); a = $statement.find("#VA012_STAT_txtStatementNo_" + $self.windowNo); s = $statement.find("#VA012_ctrlLoadFile_" + $self.windowNo); STAT_ctrlLoadFileTxt = $statement.find("#VA012_ctrlLoadFileTxt_" + $self.windowNo); _tabFile = $statement.find("#VA012_STAT_tabFile_" + $self.windowNo); _tabSchedule = $statement.find("#VA012_STAT_tabSchedule_" + $self.windowNo); hu = $statement.find("#VA012_STAT_cmbBankAccountClassName_" + $self.windowNo) } function g() { l.html(""); l.append("<option value=" + ii.val() + ">" + ii.children()[ii[0].selectedIndex].text + "<\/option>"); l.prop("selectedIndex", 0) } function nt() { r.html(""); r.append("<option value=" + h.val() + ">" + h.children()[h[0].selectedIndex].text + "<\/option>"); r.prop("selectedIndex", 0) } function tt() { function t(t) { var i, r; if (e.html(""), e.append("<option value=0 ><\/option>"), t != null) for (i = 0; i < t.tables[0].rows.length; i++)r = t.tables[0].rows[i].cells.va012_bankstatementclass_id, e.append("<option value=" + r + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null; e.prop("selectedIndex", 0) } var n = " SELECT BSC.VA012_BANKSTATEMENTCLASSNAME AS NAME, CONCAT(CONCAT(SC.NAME,'_'),VA012_BANKSTATEMENTCLASS_ID) AS VA012_BANKSTATEMENTCLASS_ID FROM VA012_BANKSTATEMENTCLASS BSC INNER JOIN VA012_STATEMENTCLASS SC ON BSC.VA012_STATEMENTCLASS_ID=SC.VA012_STATEMENTCLASS_ID WHERE C_BANKACCOUNT_ID = " + h.val(), i = VIS.DB.executeDataSet(n.toString(), null, t) } function it() { function t(t) { if (t != null) for (var i = 0; i < t.tables[0].rows.length; i++)p = VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_charge_id); t.dispose(); t = null; n = null } var n = "SELECT C_CHARGE_ID, NAME FROM C_CHARGE WHERE ISACTIVE = 'Y' AND AD_CLIENT_ID = " + VIS.Env.getCtx().getAD_Client_ID() + " AND ROWNUM = 1 ORDER BY NAME  ", i = VIS.DB.executeDataSet(n.toString(), null, t) } function ut() { v = null; $statement = null; l = null; r = null; a = null; s = null; STAT_ctrlLoadFileTxt = null; _tabSchedule = null; _tabFile = null; i = null } var l = null, r = null, e = null, y = null, p = null, a = null, s = null, i = null, v, u; $statement = t("<div class='va012-popform-content'>"); v = ""; v = "<div><div class='va012-left-btn'><a id='VA012_STAT_tabFile_" + $self.windowNo + "' class='btn va012-blueBtn' activestatus='1'>" + VIS.Msg.getMsg("VA012_File") + "<\/a><\/div><\/div><div style='border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left;'><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_Bank") + "<\/label><select id='VA012_STAT_cmbBank_" + $self.windowNo + "' class='vis-ev-col-readonly' disabled><\/select><\/div> <div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_BankAccount") + "<\/label><select id='VA012_STAT_cmbBankAccount_" + $self.windowNo + "' class='vis-ev-col-readonly' disabled><\/select><\/div><div class=va012-popform-data><label id=VA012_STAT_lblStatementDate_" + $self.windowNo + ">" + VIS.Msg.getMsg("VA012_StatementDate") + '<\/label><input type=date max="9999-12-31" class=vis-ev-col-readonly disabled id=VA012_STAT_statementDate_' + $self.windowNo + "><\/div><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_ClassName") + '<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_STAT_cmbBankAccountClassName_' + $self.windowNo + "'><\/select><\/div><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_StatementNumber") + "<sup style=\"color: red;\">*<\/sup><\/label><input type='text' id='VA012_STAT_txtStatementNo_" + $self.windowNo + "' /> <\/div><div class='va012-popform-data va012-pop-file'><label>" + VIS.Msg.getMsg("VA012_SelectFile") + "<sup style=\"color: red;\">*<\/sup><\/label><input type='text' id='VA012_ctrlLoadFileTxt_" + $self.windowNo + "' disabled><div class='va012-file-upload'><label for='file-input' class='va012-file-label'>" + VIS.Msg.getMsg("VA012_Browse") + "<\/label><input id='VA012_ctrlLoadFile_" + $self.windowNo + "' type='file' accept='.csv,text/plain,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel'/><\/div><\/div><\/div>"; $statement.append(v); b(); g(); nt(); tt(); y.val(Globalize.format(new Date(w.val()), "yyyy-MM-dd")); it(); u = new VIS.ChildDialog; u.setContent($statement); u.setTitle(VIS.Msg.getMsg("VA012_LoadStatement")); u.setWidth("500px"); u.setEnableResize(!1); u.setModal(!0); u.show(); s.on("change", function () { var u = this; r.val() != null && r.val() > 0 ? (i = t.parseJSON(n.UploadExcel(u, null, null)), STAT_ctrlLoadFileTxt.val(i._orgfilename)) : (s = null, VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectBankAccountFirst"), null, "", "")) }); u.onOkClick = function () { if (d.val(""), _tabFile.attr("activestatus") == "1") { if (r.val() == null || r.val() == "" || r.val() == "0") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectBankAccountFirst"), null, "", ""), !1; if (e.val() == null || e.val() == "" || e.val() == "0") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectClassFirst"), null, "", ""), !1; if (a.val() == null || a.val() == "") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseEnterStatementNo"), null, "", ""), !1; if (s.val() == "" == null || s.val() == "") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectFileFirst"), null, "", ""), !1; if (i != null) { if (i._filename == null || i._filename == "" || i._path == null || i._path == "") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_ErrorInGettingFile"), null, "", ""); return } if (i._error != null && i._error != "") { VIS.ADialog.info(i._error, null, "", ""); return } var n = i._path, u = i._filename, h = r.val(), l = a.val(), b = $statement, v = e.val(), w = p; wt(o, !0, "absolute"); window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/ImportStatement", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _path: n, _filename: u, _bankaccount: h, _bankAccountCurrency: ni, _statementno: l, _statementClassName: v, _statementCharges: w, statementDate: y.val() }, success: function (n) { bt = n._statementID; bt != null && bt != "" ? (rt = [], k.html(""), ti = 1, wt(o, !1, "absolute"), c.loadStatement(bt), f.refreshForm()) : n._error != null && n._error != "" && (wt(o, !1, "absolute"), VIS.ADialog.info(VIS.Msg.getMsg(n._error), null, "", "")) }, error: function () { wt(o, !1, "absolute"); VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", "") } }) }, 2) } } if (_tabSchedule.attr("activestatus") == "1") return alert("Schedule"), !1 }; u.onCancelClick = function () { }; u.onClose = function () { ut() }; _tabFile.on(VIS.Events.onTouchStartOrClick, function () { _tabFile.removeClass("va012-grayBtn"); _tabFile.addClass("va012-blueBtn"); _tabFile.attr("activestatus", "1"); _tabSchedule.removeClass("va012-blueBtn"); _tabSchedule.addClass("va012-grayBtn"); _tabSchedule.attr("activestatus", "0") }); _tabSchedule.on(VIS.Events.onTouchStartOrClick, function () { _tabSchedule.removeClass("va012-grayBtn"); _tabSchedule.addClass("va012-blueBtn"); _tabSchedule.attr("activestatus", "1"); _tabFile.removeClass("va012-blueBtn"); _tabFile.addClass("va012-grayBtn"); _tabFile.attr("activestatus", "0") }) }, LoadStatementsPages: function () { oi = d.val() != null && d.val() != "" ? !0 : !1; t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadStatementsPages", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _cmbBankAccount: h.val(), _txtSearch: d.val(), _statementPageNo: ti, _PAGESIZE: au, _SEARCHREQUEST: oi }, success: function (n) { n != null && n != "" && (vf = JSON.parse(n)) } }) }, loadStatement: function () { function r(i) { var u, r; if (i = t.parseJSON(i), u = "", i != null && i.length > 0) for (r = 0; r < i.length; r++)u = "", n = i[r].docstatus == "CO" || i[r].docstatus == "CL" || i[r].docstatus == "RE" ? "va012-gray-color" : i[r].c_payment_id == null || i[r].c_payment_id == "0" || i[r].c_payment_id == 0 ? (i[r].c_charge_id == null || i[r].c_charge_id == "") && (i[r].trxno == null || i[r].trxno == "") ? "va012-red-color" : i[r].c_charge_id != null && i[r].c_charge_id != "0" && i[r].c_charge_id != 0 ? i[r].STMTAMT == i[r].trxamount ? "va012-green-color" : "va012-red-color" : i[r].c_cashline_id != null && i[r].c_cashline_id != "0" && i[r].c_cashline_id != 0 ? "va012-green-color" : "va012-red-color" : "va012-green-color", u = '<div  data-uid="' + i[r].c_bankstatementline_id + '" class="va012-right-data-wrap ' + n + '"><div class="va012-statement-wrap"><div class="va012-fl-padd"><div class="col-md-4 col-sm-4 va012-padd-0"><div class="va012-form-check"> <input type="checkbox" data-uid="' + i[r].c_bankstatementline_id + '" > <div class="va012-form-text"> <span style="background: rgba(var(--v-c-on-secondary), .4);color: rgba(var(--v-c-on-primary), 1); padding: 3px;margin-left: 2px;">' + i[r].statementno + "/" + i[r].page + "/" + i[r].line + "<\/span><label>" + i[r].currency + " " + Globalize.format(i[r].trxamount, "N") + "<\/label>", u += i[r].trxno == "" || i[r].trxno == null ? '<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p>' + VIS.Utility.encodeText(i[r].description) + "<\/p> <span>" + VIS.Utility.encodeText(i[r].bpgroup) + "<\/span><span>" + VIS.Utility.encodeText(i[r].invoiceno) + '<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="' + i[r].c_bankstatementline_id + '" class="glyphicon glyphicon-edit" title=' + VIS.Msg.getMsg("EditRecord") + '><\/span> <span data-uid="' + i[r].c_bankstatement_id + '" class="glyphicon glyphicon-zoom-in" title=' + VIS.Msg.getMsg("ZoomToRecord") + '><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0 va012-width-xs"><div class="va012-form-data">' : '<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p>' + VIS.Utility.encodeText(i[r].description) + "<\/p> <span>" + VIS.Utility.encodeText(i[r].bpgroup) + "<\/span><span>" + VIS.Utility.encodeText(i[r].invoiceno) + '<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p>' + VIS.Utility.encodeText(i[r].trxno) + '<\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="' + i[r].c_bankstatementline_id + '" class="glyphicon glyphicon-edit"><\/span> <span data-uid="' + i[r].c_bankstatement_id + '" class="glyphicon glyphicon-zoom-in"><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0 va012-width-xs"><div class="va012-form-data">', u += " <\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <\/div> <!-- end of row --><\/div><!-- end of payment-wrap --><\/div><!-- end of right-data-wrap -->", k.append(u); _sql = null; c.setStatementListHeight(); e.dropPayments() } var i, n; oi = d.val() != null && d.val() != "" ? !0 : !1; wt(t(k), !0, "inherit"); i = "SELECT NVL(ROUND(SUM(  CASE  WHEN (BSL.C_PAYMENT_ID IS NOT NULL OR BSL.C_CHARGE_ID IS NOT NULL OR BSL.C_CASHLINE_ID IS NOT NULL)  THEN (  CASE  WHEN ( BSL.C_CURRENCY_ID! =BCURR.C_CURRENCY_ID)  THEN BSL.StmtAmt*(   CASE  WHEN CCR.MULTIPLYRATE IS NOT NULL  THEN CCR.MULTIPLYRATE   ELSE CCR1.DIVIDERATE   END)  ELSE BSL.StmtAmt  END)  END),NVL(CURR.StdPrecision,2)),0) AS RECONCILED,  NVL(ROUND(SUM(  CASE  WHEN (BSL.C_PAYMENT_ID IS NULL AND BSL.C_CHARGE_ID IS NULL AND  BSL.C_CASHLINE_ID IS NULL)  THEN (  CASE  WHEN ( BSL.C_CURRENCY_ID! = BCURR.C_CURRENCY_ID)  THEN BSL.StmtAmt*(  CASE    WHEN CCR.MULTIPLYRATE IS NOT NULL  THEN CCR.MULTIPLYRATE   ELSE CCR1.DIVIDERATE   END)  ELSE BSL.StmtAmt  END)  END),NVL(CURR.StdPrecision,2)),0) AS UNRECONCILED,BCURR.ISO_CODE AS BASECURRENCY   FROM C_BANKSTATEMENT BS   INNER JOIN C_BANKSTATEMENTLINE BSL  ON BS.C_BANKSTATEMENT_ID=BSL.C_BANKSTATEMENT_ID  LEFT JOIN C_BPARTNER BP  ON BSL.C_BPARTNER_ID     =BP.C_BPARTNER_ID  LEFT JOIN C_CURRENCY CURR   ON BSL.C_CURRENCY_ID=CURR.C_CURRENCY_ID  INNER JOIN AD_CLIENTINFO CINFO   ON CINFO.AD_CLIENT_ID =BSL.AD_CLIENT_ID   INNER JOIN C_ACCTSCHEMA AC   ON AC.C_ACCTSCHEMA_ID =CINFO.C_ACCTSCHEMA1_ID   LEFT JOIN C_CURRENCY BCURR   ON " + ni + " =BCURR.C_CURRENCY_ID   LEFT JOIN C_CONVERSION_RATE CCR   ON (CCR.C_CURRENCY_ID   =BSL.C_CURRENCY_ID   AND CCR.ISACTIVE        ='Y'   AND CCR.C_CURRENCY_TO_ID=" + ni + " AND CCR.AD_CLIENT_ID    =BSL.AD_CLIENT_ID  AND CCR.AD_ORG_ID      IN (BSL.AD_ORG_ID,0)  AND SYSDATE BETWEEN CCR.VALIDFROM AND CCR.VALIDTO)   LEFT JOIN C_CONVERSION_RATE CCR1  ON (CCR1.C_CURRENCY_ID   =" + ni + " AND CCR1.C_CURRENCY_TO_ID=BSL.C_CURRENCY_ID  AND CCR1.ISACTIVE        ='Y'  AND CCR1.AD_CLIENT_ID    =BSL.AD_CLIENT_ID  AND CCR1.AD_ORG_ID      IN (BSL.AD_ORG_ID,0)  AND SYSDATE BETWEEN CCR1.VALIDFROM AND CCR1.VALIDTO)  WHERE BS.ISACTIVE='Y' AND BS.C_BANKACCOUNT_ID= " + h.val() + " AND BS.DOCSTATUS !='VO' AND BS.AD_CLIENT_ID=" + VIS.Env.getCtx().getAD_Client_ID(); VIS.Env.getCtx().getAD_Org_ID() != 0 && (i += " AND BS.AD_ORG_ID=" + VIS.Env.getCtx().getAD_Org_ID()); oi && (i += " AND (UPPER(BP.NAME) LIKE UPPER('%" + d.val() + "%') OR UPPER(BSL.DESCRIPTION) LIKE UPPER('%" + d.val() + "%') OR UPPER(BS.NAME) LIKE UPPER('%" + d.val() + "%') OR UPPER(BSL.StmtAmt) LIKE UPPER('%" + d.val() + "%') OR UPPER(BSL.TRXNO) LIKE UPPER('%" + d.val() + "%') OR UPPER(BSL.TrxAmt) LIKE UPPER('%" + d.val() + "%'))"); i += " GROUP BY BCURR.ISO_CODE ,NVL(CURR.StdPrecision,2)"; window.setTimeout(function () { function n(n) { n != null && n.tables[0].rows.length > 0 ? (ar.html(""), lr.html(""), lr.append("<p>" + VIS.Msg.getMsg("VA012_Reconciled") + "<\/p><p style='margin-top: 4px;'>" + VIS.Msg.getMsg("VA012_Unreconciled") + "<\/p>"), ar.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>" + n.tables[0].rows[0].cells.basecurrency + "<\/span> " + Globalize.format(n.tables[0].rows[0].cells.reconciled, "N") + "<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'> <span class='va012-base-curr'>" + n.tables[0].rows[0].cells.basecurrency + "<\/span> " + Globalize.format(n.tables[0].rows[0].cells.unreconciled, "N") + "<\/span>"), n.dispose(), n = null, i = null) : (ar.html(""), lr.html(""), lr.append("<p>" + VIS.Msg.getMsg("VA012_Reconciled") + "<\/p><p style='margin-top: 4px;'>" + VIS.Msg.getMsg("VA012_Unreconciled") + "<\/p>"), ar.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>" + dr + "<\/span> 0<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'><span class='va012-base-curr'>" + dr + "<\/span> 0<\/span>")); c.setStatementListHeight() } var t = VIS.DB.executeDataSet(i.toString(), null, n) }, 2); n = "va012-red-color"; window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadStatements", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _cmbBankAccount: h.val(), _txtSearch: d.val(), _statementPageNo: ti, _PAGESIZE: au, _SEARCHREQUEST: oi }, success: function (n) { n != null && n != "" && (r(n), wt(t(k), !1, "inherit")) }, error: function () { wt(t(k), !1, "inherit") } }) }, 2) }, setStatementListHeight: function () { t("#VA012_contentArea_" + $self.windowNo).height(t("#VA012_mainContainer_" + $self.windowNo).height() - 20); t("#VA012_lstStatement_" + $self.windowNo).height(t("#VA012_rightWrap_" + $self.windowNo).height() - t("#VA012_rightTop_" + $self.windowNo).height() - 18) }, statementOpenEdit: function (n) { return ut.attr("activestatus", "1"), ut.attr("src", "Areas/VA012/Images/hide.png"), ut.attr("title", "Collapse"), s.show(), e.setPaymentListHeight(), c.statementListRecordEdit(n), n = 0, !0 }, statementListEdit: function (n) { var i = t(n.target), r = 0; i.hasClass("glyphicon-edit") && (r = i.data("uid"), ut.attr("activestatus", "1"), ut.attr("src", "Areas/VA012/Images/hide.png"), ut.attr("title", "Collapse"), s.show(), e.setPaymentListHeight(), f.scheduleRefresh(), f.prepayRefresh(), fi = !0, c.statementListRecordEdit(r), r = 0, e.addEffect(i, s)) }, openStatement: function (n) { var e = t(n.target), f = 0, o, i, r, u; if (e.hasClass("glyphicon glyphicon-zoom-in")) { f = e.data("uid"); o = "select ad_window_id from ad_window where name = 'Bank Statement'"; i = 0; try { r = VIS.DB.executeDataReader(o); r.read() && (i = r.getInt(0)); r.dispose(); i > 0 && (u = new VIS.Query, u.addRestriction("C_BankStatement_ID", VIS.Query.prototype.EQUAL, f), u.setRecordCount(1), VIS.viewManager.startWindow(i, u)) } catch (n) { console.log(n) } f = 0 } }, selectedStatementLinesList: function (n) { var i = t(n.target); n.target.type == "checkbox" && (i.is(":checked") && (_bankStatementLineID = parseInt(i.data("uid")), rt.push(_bankStatementLineID), _bankStatementLineID = 0), i.is(":checked") || (_bankStatementLineID = parseInt(i.data("uid")), rt.splice(rt.indexOf(_bankStatementLineID), 1), _bankStatementLineID = 0)) }, statementListRecordEdit: function (n) { f.refreshForm(); c.getStatementLineForEdit(n, c.afterRecordGet) }, selectedScheduleList: function (n) { var i = t(n.target); n.target.type == "checkbox" && (i.is(":checked"), !i.is(":checked")) }, getStatementLineForEdit: function (n, i) { t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/GetStatementLine", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _bankStatementLineID: n }), success: function (n) { i(n) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) }, afterRecordGet: function (n) { var f, e; n != null && n != "" && (f = t.parseJSON(n), s.attr("data-uid", f._bankStatementLineID), ht.val(f._txtStatementNo), ir.val(f._txtStatementPage), si.val(f._txtStatementLine), ui.val(Globalize.format(new Date(f._dtStatementDate), "yyyy-MM-dd")), ai.val(f._cmbPaymentMethod).prop("selected", !0), f._cmbVoucherMatch != null && f._cmbVoucherMatch != "" ? p.val(f._cmbVoucherMatch).prop("selected", !0) : p.prop("selectedIndex", 0), p.trigger("change"), f._cmbContraType != null && f._cmbContraType != "" ? dt.val(f._cmbContraType).prop("selected", !0) : dt.prop("selectedIndex", 0), dt.trigger("change"), ci.val(f._cmbCashBook).prop("selected", !0), vr.val(f._txtCheckNo), u.val(f._txtAmount.toFixed(l)), nt.val(f._txtTrxAmt.toFixed(l)), p.val() == "M" && parseFloat(nt.val()) != 0 && (ft.val(Math.abs(f._txtDifference).toFixed(l)), f._txtDifference != 0 ? ft.attr("vchangable", "N") : ft.attr("vchangable", "Y")), f._cmbDifferenceType != null && f._cmbDifferenceType != "" ? (li.find("*").prop("disabled", !1), et.val(f._cmbDifferenceType).prop("selected", !0)) : et.prop("selectedIndex", 0), et.trigger("change"), u.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")), rr.val(f._txtVoucherNo), gr.val(f._txtDescription), ur.val(f._cmbCharge).prop("selected", !0), ot.val(f._txtCharge), ot.attr("chargeid", f._cmbCharge), gt.val(f._cmbTaxRate).prop("selected", !0), yi.val(f._txtTaxAmount.toFixed(l)), uu.prop("checked", f._chkUseNextTime), f._ctrlCashLine > 0 ? (pt.setValue(f._ctrlCashLine, !1, !0), fi = !1) : kt || (pt.setValue(), f._ctrlPayment <= 0 && (fi = !1)), tt && tt.value > 0 && f._ctrlPayment == 0 && (f._ctrlPayment = tt.value), f._ctrlPayment > 0 ? (tt.setValue(f._ctrlPayment, !1, !0), rr.val() == "" && (e = VIS.Utility.Util.getValueOfString(VIS.DB.executeScalar("select trxno from C_Payment where C_Payment_ID=" + f._ctrlPayment)), rr.val(e)), fi = !1) : kt || (tt.setValue(), fi = !1), f._ctrlOrder > 0 ? yt.setValue(f._ctrlOrder, !1, !0) : kt || yt.setValue(), f._ctrlBusinessPartner > 0 ? a.setValue(f._ctrlBusinessPartner, !1, !0) : kt || a.setValue(), f._ctrlInvoice > 0 ? st.setValue(f._ctrlInvoice, !1, !0) : kt || st.setValue(), ot.trigger("focus")) }, matchStatementDialog: function () { function d() { function t(t) { if (u.html(""), u.append("<option value=0 >-<\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)u.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_bankstatement_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null } var n = "Select Cb.C_Bankstatement_Id, CB.NAME,Cb.Docstatus, COUNT(VA012_ISMATCHINGCONFIRMED) FROM C_BANKSTATEMENT CB INNER JOIN C_BANKSTATEMENTLINE CBL ON cbl.C_BANKSTATEMENT_ID = Cb.C_BANKSTATEMENT_ID Where Cb.Isactive = 'Y' And Cb.Ad_Client_Id = " + VIS.Env.getCtx().getAD_Client_ID() + " And Cb.C_Bankaccount_Id = " + h.val() + " And Cb.Docstatus NOT IN  ('CO','CL','VO') GROUP BY CB.C_BANKSTATEMENT_ID,Cb.Docstatus, CB.NAME", i = VIS.DB.executeDataSet(n.toString(), null, t) } function g() { function i(t) { if (o.html(""), o.append("<option value=0 >-<\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)o.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_tax_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null } var n = "SELECT Name,C_Tax_ID FROM C_Tax WHERE IsActive='Y'AND IsSurcharge='N' AND NVL(Parent_Tax_ID, 0)=0", t; n = VIS.MRole.getDefault().addAccessSQL(n, "C_Tax", !0, !1); t = VIS.DB.executeDataSet(n.toString(), null, i) } function nt() { n = $match.find("#VA012_cmbMatchingBase_" + $self.windowNo); s = $match.find("#VA012_divMatchingBase_" + $self.windowNo); l = $match.find("#VA012_cmbMatchingCriteria_" + $self.windowNo); u = $match.find("#VA012_cmbStatementNo_" + $self.windowNo); p = $match.find("#VA012_ChargeSrch_" + $self.windowNo); o = $match.find("#VA012_cmbTaxRate_" + $self.windowNo); _ChargeLookUp = VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(), $self.windowNo, 3787, VIS.DisplayType.Search); a = new VIS.Controls.VTextBoxButton("C_Charge_ID", !0, !1, !0, VIS.DisplayType.Search, _ChargeLookUp); p.append(a.getControl().css("width", "93%")).append(a.getBtn(0).css("width", "30px").css("height", "30px").css("padding", "0px").css("border-color", "#BBBBBB")) } function tt(n) { var r = t(n.target); r.hasClass("glyphicon-remove") && (i.splice(i.indexOf(r.data("uid")), 1), r.parent().parent().remove()) } function rt() { n = null; s = null; i = []; l = null; w2ui["VA012_gridPayment_" + $self.windowNo] != null && w2ui["VA012_gridPayment_" + $self.windowNo].destroy() } var n = null, s = null, i = [], l = null, u = null, p = null, a = null, o = null, v, r; $match = t("<div class='va012-popform-content'>"); v = ""; v = "<div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_StatementNo") + '<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbStatementNo_' + $self.windowNo + "'><\/select><\/div> <div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_MatchingBase") + '<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbMatchingBase_' + $self.windowNo + "'><\/select><\/div> <div id='VA012_divMatchingBase_" + $self.windowNo + "' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_MatchingCriteria") + '<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbMatchingCriteria_' + $self.windowNo + "'><option value='0'><\/option><option value='AT'>" + VIS.Msg.getMsg("VA012_MatchAnyTwo") + "<\/option><option value='AR'>" + VIS.Msg.getMsg("VA012_MatchAnyThree") + "<\/option><option value='AL'>" + VIS.Msg.getMsg("VA012_MatchAll") + "<\/option><\/select><\/div> <div class='va012-popform-data'><label title = '" + VIS.Msg.getMsg("VA012_SetChargeType") + "' > " + VIS.Msg.getMsg("VA012_Charge") + '<sup style="color: red;">*<\/sup><\/label><div id=\'VA012_ChargeSrch_' + $self.windowNo + "'><\/div><\/div> <div class='va012-popform-data'><label title =' " + VIS.Msg.getMsg("VA012_SetTaxRate") + "' >" + VIS.Msg.getMsg("VA012_TaxRate") + '<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbTaxRate_' + $self.windowNo + "'><\/select><\/div> <\/div>"; $match.append(v); nt(); le(n); d(); g(); r = new VIS.ChildDialog; r.setContent($match); r.setTitle(VIS.Msg.getMsg("VA012_MatchStatement")); r.setWidth(700); r.setHeight(600); r.setEnableResize(!1); r.setModal(!0); r.show(); r.onOkClick = function () { if (i.length > 0) { if (u.val() == null || u.val() == "" || u.val() == "0") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_NoLinesFoundToMatch"), null, "", ""), !1; if (h.val() == null || h.val() == "" || h.val() == "0") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectBankAccountFirst"), null, "", ""), !1; if (l.val() == null || l.val() == "" || l.val() == "0") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectMatchingCriteria"), null, "", ""), !1; if (l.val() == "AT" && i.length < 2) return VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectMin2MatchingBase"), null, "", ""), !1; if (l.val() == "AR" && i.length < 3) return VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectMin3MatchingBase"), null, "", ""), !1; if (a.value == null || VIS.Utility.Util.getValueOfInt(a.value) == 0) return VIS.ADialog.info(VIS.Msg.getMsg("VA012_NoChargeSelected"), null, "", ""), !1; if (o.val() == null || o.val() == "" || o.val() == "0") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_NoTaxRateSelected"), null, "", ""), !1; wt($match, !0, "absolute"); window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/MatchStatementGridData", type: "GET", dataType: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _matchingBaseItemList: i.toString(), _cmbMatchingCriteria: l.val(), _BankAccount: h.val(), _StatementNo: u.val(), _BankCharges: VIS.Utility.Util.getValueOfInt(a.value), _TaxRate: o.val() }, success: function (r) { if (r != null && r != "") { r = t.parseJSON(r); n.prop("selectedIndex", 0); u.prop("selectedIndex", 0); a.value = null; o.prop("selectedIndex", 0); i = []; var l = ""; s.html(""); r.length > 0 ? (re(s, r), _statementlineslist = [], k.html(""), ti = 1, c.loadStatement(bt), it.html(""), f.scheduleRefresh(), f.prepayRefresh(), ei = 1, e.loadPayments(h.val(), b.val(), y.val(), w.val())) : (l = "<div> <p> <b>" + VIS.Msg.getMsg("va012_norecordmatched") + "<\/b> <\/div>", s.append(l)); wt($match, !1, "absolute") } else wt($match, !1, "absolute"), VIS.ADialog.info(VIS.Msg.getMsg(r.toString()), null, "", "") }, error: function () { wt($match, !1, "absolute"); VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", "") } }) }, 2) } else return VIS.ADialog.info(VIS.Msg.getMsg("VA012_NoMatchingBaseSelected"), null, "", ""), !1; return !1 }; r.onCancelClick = function () { w2ui["VA012_gridPayment_" + $self.windowNo] != null && w2ui["VA012_gridPayment_" + $self.windowNo].destroy() }; r.onClose = function () { rt() }; n.on("change", function () { if (i.length <= 0 && s.html(""), !nf(n.val(), i) && n.val() != "0" && n.val() != "") { i.push(n.val()); var t = "<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='" + n.val() + "'class='glyphicon glyphicon-remove'><\/span><\/a> <span>" + n.children()[n[0].selectedIndex].text; s.append(t) } }); s.on(VIS.Events.onTouchStartOrClick, tt) }, matchStatementGridDialog: function () { var n = new VIS.ChildDialog; n.setContent(ou); n.setTitle(VIS.Msg.getMsg("VA012_MatchStatementGrid")); n.setWidth("780px"); n.setHeight(450); n.setEnableResize(!0); n.setModal(!0); n.show(); re() }, paymentScheduleDialog: function () { function it() { var t = "", n; for ($_divPaymentSchedules.html(""), n = 0; n < g.length; n++)t = "<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='" + g[n] + "'  data-udata='" + ri[n] + "' class='glyphicon glyphicon-remove'><\/span><\/a> <span>" + ri[n] + "<\/span> <\/div>", $_divPaymentSchedules.append(t) } function ut(n) { var o = t(n.target), f, e; if (o.hasClass("glyphicon-remove")) { if (v != null && v.length > 0 && (v.length > g.length ? v.splice(g.indexOf(o.data("uid")) + 1, 1) : v.length == g.length && v.splice(g.indexOf(o.data("uid")), 1), Number(v[0]) == "0")) { for (f = 0, e = 0; e < v.length; e++)f += VIS.Utility.Util.getValueOfDecimal(v[e]); f < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")); u.val(f.toFixed(l)); v.length == 1 && Number(v[0]) == "0" && v.splice(0, 1) } for (g.splice(g.indexOf(o.data("uid")), 1), ri.splice(ri.indexOf(o.data("udata")), 1), o.parent().parent().remove(), fr.val(ri.toString()), f = 0, e = 0; e < v.length; e++)f += VIS.Utility.Util.getValueOfDecimal(v[e]); nt.val(f.toFixed(l)); nt.trigger("change"); f == 0 && a.setValue() } } function ft() { $_divPaymentSchedules = $paymentSchedule.find("#VA012_divPaymentSchedules_" + $self.windowNo); y = $paymentSchedule.find("#VA012_ctrlPSInvoice_" + $self.windowNo); p = $paymentSchedule.find("#VA012_ctrlPSBP_" + $self.windowNo); n = $paymentSchedule.find("#VA012_cmbPaymentSchedule_" + $self.windowNo) } function rt() { k = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 3484, VIS.DisplayType.Search, "C_Invoice_ID", 0, !1, "DocStatus IN ('CO','CL') AND C_BPartner_ID=" + d); o = new VIS.Controls.VTextBoxButton("C_Invoice_ID", !1, !1, !0, VIS.DisplayType.Search, k); o.getControl().addClass("va012-input-size-2"); y.append(o.getControl()); y.append(o.getBtn(0)); y.append(o.getBtn(1)); o.fireValueChanged = function () { b = 0; b = o.value; n.html(""); ot() } } function et() { tt = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 2893, VIS.DisplayType.Search, "C_BPartner_ID", 0, !1, null); h = new VIS.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, VIS.DisplayType.Search, du); h.getControl().addClass("va012-input-size-2"); p.append(h.getControl()); p.append(h.getBtn(0)); p.append(h.getBtn(1)); h.fireValueChanged = function () { d = 0; d = h.value; k = null; o = null; y.html(""); b = null; rt() } } function ot() { function i(i) { if (n.html(""), n.append("<option value=0 ><\/option>"), i != null) for (var r = 0; r < i.tables[0].rows.length; r++)n.append("<option paymentdata='" + VIS.Utility.encodeText(i.tables[0].rows[r].cells.name) + "/" + VIS.Utility.encodeText(i.tables[0].rows[r].cells.businesspartner) + "' value=" + VIS.Utility.Util.getValueOfInt(i.tables[0].rows[r].cells.c_invoicepayschedule_id) + ">" + VIS.Utility.encodeText(i.tables[0].rows[r].cells.name) + "<\/option>"); i.dispose(); i = null; t = null; n.prop("selectedIndex", 0) } var t = "SELECT BP.NAME as businesspartner,PAY.C_INVOICEPAYSCHEDULE_ID,  PAY.DOCUMENTNO AS NAME  FROM C_INVOICEPAYSCHEDULE PAY  INNER JOIN C_INVOICE INV  ON PAY.C_INVOICE_ID=INV.C_INVOICE_ID  INNER JOIN C_BPARTNER BP  ON BP.C_BPARTNER_ID=INV.C_BPARTNER_ID  INNER JOIN VA009_PAYMENTMETHOD PM  ON (PM.VA009_PAYMENTMETHOD_ID =PAY.VA009_PAYMENTMETHOD_ID )  INNER JOIN C_DOCTYPE DT  ON DT.C_DOCTYPE_ID            =INV.C_DOCTYPE_ID  WHERE PAY.VA009_ISPAID        ='N'  AND PAY.ISACTIVE              ='Y'  AND INV.DOCSTATUS            IN ('CO','CL')  AND PM.VA009_PAYMENTBASETYPE! ='B' AND PAY.C_INVOICE_ID=" + b; VIS.DB.executeDataSet(t.toString(), null, i) } function ht() { k = null; o = null; b = null; y = null; tt = null; h = null; d = null; p = null; n = null } var k = null, o = null, b = null, y = null, tt = null, h = null, d = null, p = null, n = null, w, c; $paymentSchedule = t("<div class='va012-popform-content'>"); w = ""; w = "<div> <label>" + VIS.Msg.getMsg("VA012_BusinessPartner") + "<\/label> <div id='VA012_ctrlPSBP_" + $self.windowNo + "' ><\/div> <\/div>"; w += "<div> <label>" + VIS.Msg.getMsg("VA012_Invoice") + "<\/label> <div id='VA012_ctrlPSInvoice_" + $self.windowNo + "' ><\/div> <\/div>"; w += "<div> <label>" + VIS.Msg.getMsg("VA012_PaymentSchedules") + "<\/label> <select id='VA012_cmbPaymentSchedule_" + $self.windowNo + "'  style=' width: 100%; ' ><\/select> <\/div>"; w += "<div id='VA012_divPaymentSchedules_" + $self.windowNo + "' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px;margin-top: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>"; $paymentSchedule.append(w); ft(); c = new VIS.ChildDialog; c.setContent($paymentSchedule); c.setTitle(VIS.Msg.getMsg("VA012_PaymentSchedules")); c.setWidth("500px"); it(); c.setEnableResize(!1); c.setModal(!0); c.show(); et(); rt(); a.value && (h.setValue(a.value, !1, !0), p.find("*").prop("disabled", !0)); st.value && (o.setValue(st.value, !1, !0), y.find("*").prop("disabled", !0)); n.on("change", function () { n.val() > 0 && e.checkScheduleCondition(n.val(), parseInt(s.attr("data-uid")), g.toString(), u.val()) && (nf(n.val(), g) ? VIS.ADialog.info(VIS.Msg.getMsg("VA012_AlreadySelected"), null, "", "") : (g.push(n.val()), ri.push(this.options[this.selectedIndex].getAttribute("paymentdata")), it(), e.setInvoiceAndBPartner(n.val(), "IS")), fr.val(ri.toString())) }); $_divPaymentSchedules.on(VIS.Events.onTouchStartOrClick, ut); c.onOkClick = function () { }; c.onCancelClick = function () { f.scheduleRefresh(); f.refreshForm(); ht() } }, prepayOrderDialog: function () { function r() { var t = "", n; for ($_divPrepayOrders.html(""), n = 0; n < tr.length; n++)t = "<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='" + tr[n] + "'  data-udata='" + sr[n] + "' class='glyphicon glyphicon-remove'><\/span><\/a> <span>" + sr[n] + "<\/span> <\/div>", $_divPrepayOrders.append(t) } function u(n) { var i = t(n.target); i.hasClass("glyphicon-remove") && (tr.splice(tr.indexOf(i.data("uid")), 1), sr.splice(sr.indexOf(i.data("udata")), 1), i.parent().parent().remove(), wu.val(sr.toString())) } function f() { $_divPrepayOrders = $prepayOrder.find("#VA012_divPrepayOrders_" + $self.windowNo) } var i, n; $prepayOrder = t("<div class='va012-popform-content'>"); i = ""; i = "<div id='VA012_divPrepayOrders_" + $self.windowNo + "' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>"; $prepayOrder.append(i); f(); n = new VIS.ChildDialog; n.setContent($prepayOrder); n.setTitle(VIS.Msg.getMsg("VA012_PrepayOrders")); n.setWidth("500px"); r(); n.setEnableResize(!1); n.setModal(!0); n.show(); $_divPrepayOrders.on(VIS.Events.onTouchStartOrClick, u) } }; f = { newRecord: function () { function n(n) { datasource = []; for (var t = 0; t < n.length; t++)datasource.push({ label: n[t].name, value: n[t].name, ids: n[t].chargeID }); ot.autocomplete("option", "source", datasource); ot.autocomplete("search", ""); ot.trigger("focus") } function h(n, i) { ot.attr("chargeid", 0); t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetCharge", dataType: "json", data: { searchText: n }, success: function (n) { var r = JSON.parse(n); datasource = []; i(t.map(r, function (n) { return { label: n.name, value: n.name, ids: n.chargeID } })); t(self.div).autocomplete("search", ""); t(self.div).trigger("focus") } }) } s = o.find("#VA012_formNewRecord_" + $self.windowNo); pu = o.find("#VA012_formBtnNewRecord_" + $self.windowNo); f.getNewRecordDesign(); f.getNewRecordControls(); f.loadCurrency(); f.loadPaymentMethod(); f.loadVoucherMatch(); f.loadContraType(); f.loadCashBook(); f.loadDifferenceType(); f.loadTransferType(); f.loadCharge(); f.loadTaxRate(); f.loadPayment(); f.loadOrder(); f.loadBusinessPartner(); f.loadInvoice(); f.loadCashLine(); parseFloat(u.val()) <= 0 && u.addClass("va012-mandatory"); ht.val() != "" && ht.removeClass("va012-mandatory"); ui.val() != "" && ui.removeClass("va012-mandatory"); ot.on("blur", function () { (ot.val() == "" || ot.val() == null) && ot.attr("chargeid", 0) }); lf.on(VIS.Events.onTouchStartOrClick, function () { VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetCharge", { searchText: "" }, n) }); ot.autocomplete({ minLength: 0, scroll: !0, source: function (n, t) { n.term.trim().length != 0 && h(n.term, t) }, select: function (n, i) { t(this).val(i.item.ids); t(this).attr("chargeid", i.item.ids) } }); ut.on(VIS.Events.onTouchStartOrClick, function () { ut.attr("activestatus") == "0" ? (s.show(), ut.attr("activestatus", "1"), ut.removeClass("vis vis-plus"), ut.addClass("fa fa-minus"), ut.attr("title", "Collapse")) : (s.hide(), ut.attr("activestatus", "0"), ut.addClass("vis vis-plus"), ut.removeClass("fa fa-minus"), ut.attr("title", "Expand")); parseFloat(u.val()) <= 0 && u.addClass("va012-mandatory"); ht.val() != "" && ht.removeClass("va012-mandatory"); ui.val() != "" && ui.removeClass("va012-mandatory"); f.scheduleRefresh(); f.prepayRefresh(); f.refreshForm(); e.setPaymentListHeight() }); hf.on(VIS.Events.onTouchStartOrClick, function () { parseInt(s.attr("data-uid")) > 0 ? (f.scheduleRefresh(), f.prepayRefresh(), fi = !0, c.statementListRecordEdit(s.attr("data-uid"))) : (f.scheduleRefresh(), f.prepayRefresh(), f.refreshForm()) }); s.hide(); p.on("change", function () { if (p.val() == "M") { _divCtrlCashLine.find("*").prop("disabled", !0); _divCtrlCashLine.hide(); pi.find("*").prop("disabled", !0); er.find("*").prop("disabled", !0); wi.find("*").prop("disabled", !0); or.find("*").prop("disabled", !0); pi.hide(); er.hide(); wi.hide(); or.hide(); var n = VIS.Utility.Util.getValueOfInt(VIS.DB.executeScalar("SELECT Count(AD_ModuleInfo_ID) FROM AD_ModuleInfo WHERE PREFIX='VA034_' AND IsActive = 'Y'")); n > 0 ? (ct.show(), ct.find("*").prop("disabled", !1)) : (ct.find("*").prop("disabled", !0), ct.hide()); lt.find("*").prop("disabled", !0); at.find("*").prop("disabled", !0); vt.find("*").prop("disabled", !0); lt.hide(); at.hide(); vt.hide(); wr.show(); br.show(); li.show(); bi.show(); ki.show(); di.show(); gi.show(); nr.show(); bi.find("*").prop("disabled", !1); ki.find("*").prop("disabled", !1); di.find("*").prop("disabled", !1); gi.find("*").prop("disabled", !1); nr.find("*").prop("disabled", !1); fr.prop("disabled", !0); pr.css("pointer-events", "auto") } else p.val() == "V" ? (_divCtrlCashLine.find("*").prop("disabled", !0), _divCtrlCashLine.hide(), pi.find("*").prop("disabled", !0), er.find("*").prop("disabled", !0), wi.find("*").prop("disabled", !0), or.find("*").prop("disabled", !0), pi.hide(), er.hide(), wi.hide(), or.hide(), ct.show(), lt.show(), at.show(), vt.show(), ct.find("*").prop("disabled", !1), lt.find("*").prop("disabled", !1), at.find("*").prop("disabled", !1), vt.find("*").prop("disabled", !1), bi.find("*").prop("disabled", !0), ki.find("*").prop("disabled", !0), di.find("*").prop("disabled", !1), gi.find("*").prop("disabled", !0), nr.find("*").prop("disabled", !0), pr.css("pointer-events", "none"), wr.hide(), br.hide(), li.hide(), bi.hide(), ki.hide(), di.hide(), gi.hide(), nr.hide()) : p.val() == "C" && (pi.show(), wi.show(), pi.find("*").prop("disabled", !1), wi.find("*").prop("disabled", !1), ct.find("*").prop("disabled", !0), lt.find("*").prop("disabled", !0), at.find("*").prop("disabled", !0), vt.find("*").prop("disabled", !0), ct.hide(), lt.hide(), at.hide(), vt.hide(), bi.find("*").prop("disabled", !0), ki.find("*").prop("disabled", !0), di.find("*").prop("disabled", !0), gi.find("*").prop("disabled", !0), nr.find("*").prop("disabled", !0), pr.css("pointer-events", "none"), wr.hide(), br.hide(), li.hide(), bi.hide(), ki.hide(), di.hide(), gi.hide(), nr.hide()); hi.text(VIS.Msg.getMsg("VA012_More")); e.setPaymentListHeight() }); et.on("change", function () { et.val() == "CH" ? (ct.show(), lt.show(), at.show(), vt.show(), ct.find("*").prop("disabled", !1), lt.find("*").prop("disabled", !1), at.find("*").prop("disabled", !1), vt.find("*").prop("disabled", !1)) : p.val() == "M" && (lt.find("*").prop("disabled", !0), at.find("*").prop("disabled", !0), vt.find("*").prop("disabled", !0), lt.hide(), at.hide(), vt.hide()); e.setPaymentListHeight() }); dt.on("change", function () { dt.val() == "CB" ? (er.find("*").prop("disabled", !1), or.find("*").prop("disabled", !1)) : (ci.prop("selectedIndex", 0), vr.val(""), er.find("*").prop("disabled", !0), or.find("*").prop("disabled", !0)); dt.val() == "BB" ? (_divCtrlCashLine.find("*").prop("disabled", !0), _divCtrlCashLine.hide(), ct.show(), lt.show(), at.show(), vt.show(), ct.find("*").prop("disabled", !1), lt.find("*").prop("disabled", !1), at.find("*").prop("disabled", !1), vt.find("*").prop("disabled", !1)) : p.val() == "C" && (_divCtrlCashLine.show(), _divCtrlCashLine.find("*").prop("disabled", !1), ct.find("*").prop("disabled", !0), lt.find("*").prop("disabled", !0), at.find("*").prop("disabled", !0), vt.find("*").prop("disabled", !0), ct.hide(), lt.hide(), at.hide(), vt.hide()); e.setPaymentListHeight() }); gt.on("change", function () { if (yi.val("0"), gt.val() > 0) { var n = VIS.DB.executeScalar("SELECT RATE FROM C_TAX WHERE C_TAX_ID=" + gt.val()); yi.val((u.val() - u.val() / (n / 100 + 1)).toFixed(l)) } nt.trigger("change") }); hi.on(VIS.Events.onTouchStartOrClick, function () { hi.attr("visiblestatus") == "0" ? (hi.attr("visiblestatus", "1"), hi.text(VIS.Msg.getMsg("VA012_Hide")), pi.show(), wi.show(), _divCtrlCashLine.show(), ct.show(), lt.show(), at.show(), vt.show(), wr.show(), br.show(), li.show(), bi.show(), ki.show(), di.show(), gi.show(), nr.show()) : (hi.attr("visiblestatus", "0"), hi.text(VIS.Msg.getMsg("VA012_More")), p.trigger("change")); e.setPaymentListHeight() }); s.on("keyup", function (n) { n.which == 32 && (i.is(":focus") && i.trigger("click"), r.is(":focus") && r.trigger("click"), hi.is(":focus") && hi.trigger("click")); n.which == 13 && fu.is(":focus") && fu.trigger("click") }); fu.on(VIS.Events.onTouchStartOrClick, function () { var n = f.getFormData(); if (n[0]._cmbBankAccount == null || n[0]._cmbBankAccount == "" || n[0]._cmbBankAccount == "0") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectBankAccountFirst"), null, "", ""); return } if (n[0]._txtStatementNo == null || n[0]._txtStatementNo == "" || n[0]._txtStatementNo == "0") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseEnterStatementNo"), null, "", ""); return } if (n[0]._dtStatementDate == null || n[0]._dtStatementDate == "" || n[0]._dtStatementDate == "0") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseEnterStatementDate"), null, "", ""); return } if (n[0]._txtAmount == null || n[0]._txtAmount == "" || n[0]._txtAmount == "0" || n[0]._txtAmount == "0.00") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseEnterAmount"), null, "", ""); return } if (!(n[0]._ctrlInvoice == null || n[0]._ctrlInvoice == "" || n[0]._ctrlInvoice == "0") && !(n[0]._ctrlBusinessPartner == null || n[0]._ctrlBusinessPartner == "" || n[0]._ctrlBusinessPartner == "0") && (n[0]._ctrlPayment == null || n[0]._ctrlPayment == "" || n[0]._ctrlPayment == "0") && (n[0]._scheduleList == null || n[0]._scheduleList == "")) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectPaySchedule"), null, "", ""); return } if (!(n[0]._ctrlBusinessPartner == null || n[0]._ctrlBusinessPartner == "" || n[0]._ctrlBusinessPartner == "0") && (n[0]._ctrlInvoice == null || n[0]._ctrlInvoice == "" || n[0]._ctrlInvoice == "0") && (n[0]._ctrlPayment == null || n[0]._ctrlPayment == "" || n[0]._ctrlPayment == "0") && (n[0]._scheduleList == null || n[0]._scheduleList == "") && (n[0]._ctrlOrder == null || n[0]._ctrlOrder == "" || n[0]._ctrlOrder == "0") && (n[0]._cmbCharge == null || n[0]._cmbCharge == "" || n[0]._cmbCharge == "0")) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectAnyOne"), null, "", ""); return } if (n[0]._cmbVoucherMatch == "C") if (n[0]._cmbContraType == "BB") { if (n[0]._cmbCharge == null || n[0]._cmbCharge == "" || n[0]._cmbCharge == "0") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectCharge"), null, "", ""); return } } else if (n[0]._cmbContraType == "CB") { if (n[0]._ctrlCashLine == null || n[0]._ctrlCashLine == "" || n[0]._ctrlCashLine == "0") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectCashJournalLine"), null, "", ""); return } } else { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectContraType"), null, "", ""); return } if (n[0]._cmbVoucherMatch == "V" && (n[0]._cmbCharge == null || n[0]._cmbCharge == "" || n[0]._cmbCharge == "0")) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectCharge"), null, "", ""); return } if (parseFloat(n[0]._txtDifference) != 0 && n[0]._cmbVoucherMatch == "M") { if (n[0]._cmbDifferenceType == null || n[0]._cmbDifferenceType == "" || n[0]._cmbDifferenceType == "0") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectDifferenceType"), null, "", ""); return } if (parseFloat(n[0]._txtDifference) < 0 && n[0]._cmbDifferenceType != "OU") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectDifferenceTypeOU"), null, "", ""); return } } wt(o, !0, "absolute"); f.insertNewRecord(n, f.afterInsertion) }); ht.on("keypress", function () { ir.val("1"); si.val("10") }); ht.on("change", function () { ht.val() == "" ? ht.addClass("va012-mandatory") : ht.removeClass("va012-mandatory") }); si.on("keypress", function (n) { if (n.which != 8 && n.which != 0 && (n.which < 48 || n.which > 57)) return !1 }); ir.on("keypress", function (n) { if (n.which != 8 && n.which != 0 && (n.which < 48 || n.which > 57)) return !1; si.val("10") }); of.on(VIS.Events.onTouchStartOrClick, function () { f.scheduleRefresh(); f.prepayRefresh(); f.refreshForm(); (ht.val() == "" || ht.val() == null) && ht.val("0"); e.getMaxStatement("BT"); s.attr("data-uid", 0); ir.val("1"); si.val("10") }); nt.on("change", function () { if (ft.attr("vchangable") == "Y" && (ft.val(0..toFixed(l)), li.find("*").prop("disabled", !0)), parseFloat(nt.val()) != 0 && p.val() == "M" && (ft.attr("vchangable") == "Y" && (ft.val((Math.abs(nt.val()) - Math.abs(u.val())).toFixed(l)), parseFloat(ft.val()) != 0 && li.find("*").prop("disabled", !1)), gt.val() > 0 && parseFloat(ft.val()) != 0)) { var n = VIS.DB.executeScalar("SELECT RATE FROM C_TAX WHERE C_TAX_ID=" + gt.val()); yi.val((ft.val() - ft.val() / (n / 100 + 1)).toFixed(l)) } }); u.on("blur", function () { if ((u.val() == "" || u.val() == null) && (u.val(0), u.addClass("va012-mandatory")), parseFloat(u.val()) > 0 ? u.removeClass("va012-mandatory") : u.addClass("va012-mandatory"), u.val(parseFloat(u.val()).toFixed(l)), r.attr("v_active") == "1" && u.val() > 0 && u.val((-u.val()).toFixed(l)), i.attr("v_active") == "1" && u.val() < 0 && (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")), u.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : u.val() > 0 && (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")), gt.val() > 0) { var n = VIS.DB.executeScalar("SELECT RATE FROM C_TAX WHERE C_TAX_ID=" + gt.val()); yi.val((u.val() - u.val() / (n / 100 + 1)).toFixed(l)) } nt.trigger("change") }); bu.hover(function () { $tooltip = t('<div  class="va012-div-tooltip"><h4>' + VIS.Msg.getMsg("VA012_Information") + "<\/h4><p>" + VIS.Msg.getMsg("VA012_InformationText") + "<\/p><\/div>"); o.append($tooltip); t(".va012-div-tooltip").show() }, function () { o.find(".va012-div-tooltip").remove() }); ui.on("change", function () { ui.val() == "" ? ui.addClass("va012-mandatory") : ui.removeClass("va012-mandatory") }); bu.mousemove(function (n) { t(".va012-div-tooltip").css("top", n.pageY - 50).css("left", n.pageX) }); i.on(VIS.Events.onTouchStartOrClick, function () { u.val() < 0 && u.val(u.val() * -1); i.removeClass("va012-inactive"); i.addClass("va012-active"); i.attr("v_active", "1"); r.removeClass("va012-active"); r.addClass("va012-inactive"); r.attr("v_active", "0"); u.blur() }); r.on(VIS.Events.onTouchStartOrClick, function () { u.val() > 0 && u.val(u.val() * -1); r.removeClass("va012-inactive"); r.addClass("va012-active"); r.attr("v_active", "1"); i.removeClass("va012-active"); i.addClass("va012-inactive"); i.attr("v_active", "0"); u.blur() }) }, getNewRecordDesign: function () { }, getNewRecordControls: function () { ht = s.find("#VA012_txtStatementNo_" + $self.windowNo); of = s.find("#VA012_btnStatementNo_" + $self.windowNo); ir = s.find("#VA012_txtStatementPage_" + $self.windowNo); si = s.find("#VA012_txtStatementLine_" + $self.windowNo); ui = s.find("#VA012_dtStatementDate_" + $self.windowNo); ai = s.find("#VA012_cmbPaymentMethod_" + $self.windowNo); dt = s.find("#VA012_cmbContraType_" + $self.windowNo); ci = s.find("#VA012_cmbCashBook_" + $self.windowNo); vi = s.find("#VA012_cmbTransferType_" + $self.windowNo); vr = s.find("#VA012_txtCheckNo_" + $self.windowNo); p = s.find("#VA012_cmbVoucherMatch_" + $self.windowNo); u = s.find("#VA012_txtAmount_" + $self.windowNo); nt = s.find("#VA012_txtTrxAmt_" + $self.windowNo); ft = s.find("#VA012_txtDifference_" + $self.windowNo); et = s.find("#VA012_cmbDifferenceType_" + $self.windowNo); rr = s.find("#VA012_txtVoucherNo_" + $self.windowNo); gr = s.find("#VA012_txtDescription_" + $self.windowNo); ur = s.find("#VA012_cmbCharge_" + $self.windowNo); ot = s.find("#VA012_txtCharge_" + $self.windowNo); gt = s.find("#VA012_cmbTaxRate_" + $self.windowNo); yi = s.find("#VA012_txtTaxAmount_" + $self.windowNo); yr = s.find("#VA012_ctrlCashLine_" + $self.windowNo); tu = s.find("#VA012_ctrlPayment_" + $self.windowNo); nu = s.find("#VA012_ctrlOrder_" + $self.windowNo); iu = s.find("#VA012_ctrlInvoice_" + $self.windowNo); ru = s.find("#VA012_ctrlBusinessPartner_" + $self.windowNo); uu = s.find("#VA012_chkUseNextTime_" + $self.windowNo); fu = s.find("#VA012_btnSave_" + $self.windowNo); pr = s.find("#VA012_btnPaymentSchedule_" + $self.windowNo); sf = s.find("#VA012_btnPrepay_" + $self.windowNo); fr = s.find("#VA012_txtPaymentSchedule_" + $self.windowNo); wu = s.find("#VA012_txtPrepayOrder_" + $self.windowNo); ut = pu.find("#VA012_btnNewRecord_" + $self.windowNo); hf = pu.find("#VA012_btnUndo_" + $self.windowNo); cf = o.find("#VA012_btnDelete_" + $self.windowNo); bu = s.find("#VA012_btnAmount_" + $self.windowNo); i = s.find("#VA012_btnIn_" + $self.windowNo); r = s.find("#VA012_btnOut_" + $self.windowNo) }, loadPaymentMethod: function () { function t(t) { if (ai.html(""), ai.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)ai.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.va009_paymentmethod_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.va009_name) + "<\/option>"); t.dispose(); t = null; n = null; ai.prop("selectedIndex", 0) } var n = "SELECT VA009_NAME,VA009_PAYMENTMETHOD_ID FROM VA009_PAYMENTMETHOD WHERE ISACTIVE='Y'  AND AD_CLIENT_ID=" + VIS.Env.getCtx().getAD_Client_ID() + " AND AD_ORG_ID=" + VIS.Env.getCtx().getAD_Org_ID(), i = VIS.DB.executeDataSet(n.toString(), null, t) }, loadCurrency: function () { ni = VIS.DB.executeScalar("SELECT C_CURRENCY_ID FROM C_BANKACCOUNT WHERE C_BANKACCOUNT_ID=" + h.val()); l = VIS.DB.executeScalar("SELECT STDPRECISION FROM C_CURRENCY WHERE C_CURRENCY_ID=" + ni) }, loadCashBook: function () { function t(t) { if (ci.html(""), ci.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)ci.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_cashbook_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null; ci.prop("selectedIndex", 0) } var n = "SELECT NAME,C_CashBook_ID FROM C_CashBook WHERE ISACTIVE='Y'  AND AD_CLIENT_ID=" + VIS.Env.getCtx().getAD_Client_ID() + " AND AD_ORG_ID=" + VIS.Env.getCtx().getAD_Org_ID(), i = VIS.DB.executeDataSet(n.toString(), null, t) }, loadContraType: function () { dt.html(""); dt.append("<option value=0 ><\/option>"); dt.append("<option value='BB' >" + VIS.Msg.getMsg("VA012_BankToBank") + "<\/option>"); dt.append("<option value='CB' >" + VIS.Msg.getMsg("VA012_CashToBank") + "<\/option>"); dt.prop("selectedIndex", 0) }, loadTransferType: function () { vi.html(""); vi.append("<option value=0 ><\/option>"); vi.append("<option value='CH' >" + VIS.Msg.getMsg("VA012_Cash") + "<\/option>"); vi.append("<option value='CK' >" + VIS.Msg.getMsg("VA012_Check") + "<\/option>"); vi.prop("selectedIndex", 0) }, loadVoucherMatch: function () { p.html(""); p.append("<option value='M' >" + VIS.Msg.getMsg("VA012_Payment") + "<\/option>"); p.append("<option value='V' >" + VIS.Msg.getMsg("VA012_Voucher") + "<\/option>"); p.append("<option value='C' >" + VIS.Msg.getMsg("VA012_Contra") + "<\/option>"); p.prop("selectedIndex", 0) }, loadDifferenceType: function () { et.html(""); et.append("<option value=0 ><\/option>"); et.append("<option value='OU' >" + VIS.Msg.getMsg("VA012_OverUnderPayment") + "<\/option>"); et.append("<option value='DA' >" + VIS.Msg.getMsg("VA012_DiscountAmount") + "<\/option>"); et.append("<option value='WO' >" + VIS.Msg.getMsg("VA012_WriteoffAmount") + "<\/option>"); et.append("<option value='CH' >" + VIS.Msg.getMsg("VA012_Charge") + "<\/option>"); et.prop("selectedIndex", 0) }, loadCharge: function () { function t(t) { if (ur.html(""), ur.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)ur.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_charge_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null; ur.prop("selectedIndex", 0) } var n = "SELECT NAME,C_CHARGE_ID FROM C_CHARGE WHERE ISACTIVE='Y' AND AD_CLIENT_ID=" + VIS.Env.getCtx().getAD_Client_ID() + " AND AD_ORG_ID=" + VIS.Env.getCtx().getAD_Org_ID(), i = VIS.DB.executeDataSet(n.toString(), null, t) }, loadTaxRate: function () { function i(t) { if (gt.html(""), gt.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)gt.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_tax_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null; gt.prop("selectedIndex", 0) } var n = "SELECT Name,C_Tax_ID FROM C_Tax WHERE IsActive='Y'AND IsSurcharge='N' AND NVL(Parent_Tax_ID, 0)=0", t; n = VIS.MRole.getDefault().addAccessSQL(n, "C_Tax", !0, !1); t = VIS.DB.executeDataSet(n.toString(), null, i) }, loadPayment: function () { wf = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 5043, VIS.DisplayType.Search, "C_Payment_ID", 0, !1, " DocStatus IN ('CO','CL') AND C_BankAccount_ID = " + h.val()); tt = new VIS.Controls.VTextBoxButton("C_Payment_ID", !1, !1, !0, VIS.DisplayType.Search, wf); tt.getControl().addClass("va012-input-size-2"); tt.getControl().attr("tabindex", "10"); tu.append(tt.getControl()); tu.append(tt.getBtn(0)); tu.append(tt.getBtn(1)); tt.fireValueChanged = function () { hr = 0; hr = tt.value; tt.value; kt || fi || tt.value && (e.checkPaymentCondition(hr, 0, u.val()) ? e.setInvoiceAndBPartner(hr, "PY") : tt.setValue()); fi = !1 }; fi = !1 }, loadOrder: function () { ne = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 5043, VIS.DisplayType.Search, "C_Order_ID", 0, !1, "C_ORDER_ID IN (SELECT ORD.C_ORDER_ID  FROM C_ORDER ORD  LEFT JOIN C_DOCTYPE DT  ON ORD.C_DOCTYPETARGET_ID=DT.C_DOCTYPE_ID  INNER JOIN VA009_PAYMENTMETHOD PM  ON (PM.VA009_PAYMENTMETHOD_ID =ORD.VA009_PAYMENTMETHOD_ID )  WHERE DT.DOCSUBTYPESO         ='PR'   AND ORD.DOCSTATUS             ='WP'   AND ORD.ISACTIVE              ='Y'   AND PM.VA009_PAYMENTBASETYPE! ='B')"); yt = new VIS.Controls.VTextBoxButton("C_Order_ID", !1, !1, !0, VIS.DisplayType.Search, ne); yt.getControl().addClass("va012-input-size-2"); yt.getControl().attr("tabindex", "13"); nu.append(yt.getControl()); nu.append(yt.getBtn(0)); nu.append(yt.getBtn(1)); yt.fireValueChanged = function () { kr = 0; kr = yt.value; yt.value && (kt || (e.checkPrepayCondition(yt.value, 0, null, u.val()) ? e.setInvoiceAndBPartner(kr, "PO") : yt.setValue())) } }, loadCashLine: function () { var n = " C_CASHLINE_ID IN (SELECT CSL.C_CASHLINE_ID  FROM C_CASH CS  INNER JOIN C_CASHLINE CSL  ON CS.C_CASH_ID=CSL.C_CASH_ID  INNER JOIN c_charge chrg  ON chrg.c_charge_id        =csl.c_charge_id  WHERE CS.ISACTIVE          ='Y'  AND CSL.CashType           ='C'  AND chrg.dtd001_chargetype ='CON'  AND CS.DOCSTATUS          IN ('CO','CL')  AND CSL.VA012_ISRECONCILED ='N'  AND CSL.C_BankAccount_ID =" + (h.val() == null ? 0 : h.val()) + " )"; yr.html(""); pf = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 1008317, VIS.DisplayType.Search, "C_CashLine_ID", 0, !1, n); pt = new VIS.Controls.VTextBoxButton("C_CashLine_ID", !1, !1, !0, VIS.DisplayType.Search, pf); pt.getControl().addClass("va012-input-size-2"); pt.getControl().attr("tabindex", "10"); yr.append(pt.getControl()); yr.append(pt.getBtn(0)); yr.append(pt.getBtn(1)); pt.fireValueChanged = function () { ku = 0; ku = pt.value; pt.value && (kt || fi || e.checkContraCondition(pt.value, 0, u.val()) || pt.setValue(), fi = !1); fi = !1 } }, loadBusinessPartner: function () { du = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 2893, VIS.DisplayType.Search, "C_BPartner_ID", 0, !1, null); a = new VIS.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, VIS.DisplayType.Search, du); a.getControl().addClass("va012-input-size-2"); a.getControl().attr("tabindex", "12"); ru.append(a.getControl()); ru.append(a.getBtn(0)); ru.append(a.getBtn(1)); a.fireValueChanged = function () { eu = 0; eu = a.value } }, loadInvoice: function () { bf = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 3484, VIS.DisplayType.Search, "C_Invoice_ID", 0, !1, "DocStatus IN ('CO','CL')"); st = new VIS.Controls.VTextBoxButton("C_Invoice_ID", !1, !1, !0, VIS.DisplayType.Search, bf); st.getControl().addClass("va012-input-size-2"); st.getControl().attr("tabindex", "11"); iu.append(st.getControl()); iu.append(st.getBtn(0)); iu.append(st.getBtn(1)); st.fireValueChanged = function () { cr = 0; cr = st.value; st.value && (e.checkInvoiceCondition(cr, u.val()) ? e.setBPartner(cr) : st.setValue()) } }, getFormData: function () { var n = {}, t = []; return n._bankStatementLineID = s.attr("data-uid"), n._txtStatementNo = ht.val(), n._txtStatementPage = ir.val(), n._txtStatementLine = si.val(), n._dtStatementDate = ui.val(), n._cmbPaymentMethod = ai.val(), n._cmbCurrency = ni, n._cmbVoucherMatch = p.val(), n._txtDescription = VIS.Utility.encodeText(gr.val()), n._txtVoucherNo = VIS.Utility.encodeText(rr.val()), n._cmbCharge = ot.attr("chargeid"), n._cmbTaxRate = gt.val(), n._txtTaxAmount = yi.val(), n._ctrlPayment = hr, n._ctrlOrder = kr, n._ctrlCashLine = ku, n._ctrlInvoice = cr, n._ctrlBusinessPartner = eu, n._chkUseNextTime = uu.is(":checked"), n._cmbBank = ii.val(), n._cmbBankAccount = h.val(), n._cmbBankAccountClasses = hu.val(), n._cmbTransactionType = y.val(), n._scheduleList = g.toString(), n._cmbContraType = dt.val(), n._cmbCashBook = ci.val(), n._cmbTransferType = vi.val(), n._txtCheckNo = vr.val(), n._cmbDifferenceType = et.val(), et.val() == "CH" ? (n._txtAmount = nt.val(), n._txtTrxAmt = u.val()) : (n._txtAmount = u.val(), n._txtTrxAmt = nt.val()), n._txtDifference = ft.val(), t.push(n), t }, insertNewRecord: function (n, i) { t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/InsertData", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _formData: n }), success: function (n) { i(n) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) }, afterInsertion: function (n) { if (n != null && n != "") { var i = t.parseJSON(n); i == "Success" ? (si.val(parseInt(si.val()) + 10), wt(o, !1, "absolute"), VIS.ADialog.info(VIS.Msg.getMsg("VA012_RecordSaved"), null, "", ""), rt = [], k.html(""), ti = 1, c.loadStatement(bt), it.html(""), f.scheduleRefresh(), f.prepayRefresh(), ei = 1, e.loadPayments(h.val(), b.val(), y.val(), w.val()), f.scheduleRefresh(), f.prepayRefresh(), f.refreshForm()) : (wt(o, !1, "absolute"), VIS.ADialog.info(VIS.Msg.getMsg(i), null, "", "")) } }, refreshForm: function () { s.attr("data-uid", 0); e.getMaxStatement("LO"); ui.val(te); ai.prop("selectedIndex", 0); p.prop("selectedIndex", 0); p.trigger("change"); u.val(0..toFixed(l)); nt.val(0..toFixed(l)); ft.val(0..toFixed(l)); ft.attr("vchangable", "Y"); et.prop("selectedIndex", 0); gr.val(""); rr.val(""); ur.prop("selectedIndex", 0); ot.attr("chargeid", 0); ot.val(""); gt.prop("selectedIndex", 0); yi.val(0..toFixed(l)); uu.attr("checked", !1); tt.setValue(); yt.setValue(); pt.setValue(); a.setValue(); st.setValue(); eu = 0; hr = 0; kr = 0; cr = 0; i.trigger("click"); f.loadCurrency(); u.trigger("focus"); u.select(); dt.prop("selectedIndex", 0); ci.prop("selectedIndex", 0); vi.prop("selectedIndex", 0); vr.val("") }, scheduleRefresh: function () { g = []; ri = []; v = []; fr.val("") }, prepayRefresh: function () { tr = []; sr = []; wu.val("") }, newRecordDispose: function () { s = null; pu = null; ht = null; of = null; ir = null; si = null; ui = null; ai = null; dt = null; ci = null; vi = null; vr = null; ni = null; p = null; u = null; nt = null; ft = null; et = null; bu = null; i = null; r = null; gr = null; rr = null; ur = null; ot = null; gt = null; yi = null; yr = null; nu = null; tu = null; iu = null; ru = null; uu = null; fu = null; pr = null; sf = null; fr = null; wu = null; ut = null; hf = null; cf = null; hi = null; gf = null; wf = null; yt = null; kr = null; tt = null; ee = null; hr = null; pt = null; pf = null; ku = null; du = null; a = null; eu = null; bf = null; st = null; cr = null; te = null; gu = null } }; t(window).resize(function () { e.setPaymentListHeight(); c.setStatementListHeight(); lu.height(t("#VA012_mainContainer_" + $self.windowNo).height()) }); this.getRoot = function () { return o }; this.setSize = function () { lu.height(t("#VA012_mainContainer_" + $self.windowNo).height()) }; this.disposeComponents = function () { $self = null; o = null; ii = null; h = null; hu = null; w = null; df = null; b = null; y = null; tf = null; rf = null; k = null; it = null; bt = ""; lr = null; ar = null; ue = null; fe = null; pi = null; er = null; _divCtrlCashLine = null; wi = null; or = null; ct = null; wr = null; br = null; li = null; lt = null; lf = null; at = null; vt = null; bi = null; ki = null; di = null; gi = null; nr = null; d = null; af = null; uf = null; ff = null; ef = null; cu = null; lu = null; dr = null; kf = null; rt = []; g = []; ri = []; tr = []; sr = []; f.newRecordDispose() } } i.prototype.dispose = function () { this.disposeComponents(); this.frame && this.frame.dispose(); this.frame = null }; i.prototype.init = function (n, t) { this.windowNo = n; this.frame = t; this.Initialize(); this.frame.getContentGrid().append(this.getRoot()); this.setSize() }; n.AForms = n.AForms || {}; n.AForms.bankStatement = i }(VA012, jQuery), function () { }(); VA012 = window.VA012 || {}, function (n, t) { n.UploadExcel = function (i, r, u) { function ut(n) { for (u.children().remove(), j = 0; j < n.ExcelCol.length; j++)j == 1 ? u.append("<li index=" + j + " style='border:none;float:none' >" + n.ExcelCol[j] + "<\/li>") : u.append("<li index=" + j + " >" + n.ExcelCol[j] + "<\/li>") } var k = null, f = [], l = [], a = 0, o = 0, c = Date.now().toString(), s = 1048576, v = 0, h = 0, p = [], e = null, nt = i, ft = t(window).width(), et = t(window).height(), c = Date.now().toString(), ot = r; savedFileName = ""; var d = t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:40%;width: 40%;left: 32%;position:absolute;z-index:99999;'>"), w = null, b = null; this.isWait = !1; self = this; var tt = function () { var n = null, i = 0, t; for (t in f) i = parseInt(f[t].size / s), e.size % s > 0 && i++ , v += i, n = {}, n.Name = f[t].name, n.Size = f[t].size, p.push(n); g() }, g = function () { var t; if (f == null || f.length == 0) { y(!1); return } if (!(o >= f.length)) { var n = new XMLHttpRequest, i = new FormData, r = f[o].name.substring(0, f[o].name.lastIndexOf(".")) + c + f[o].name.substring(f[o].name.lastIndexOf(".")); savedFileName = r; i.append("file", f[o].slice(h * s, h * s + Number(s))); n.open("POST", VIS.Application.contextUrl + "VA012/UploadExcel/SaveFileinTemp?fileName=" + r + "&folderKey=" + c + "&orgFileName=" + f[o].name, !1); n.send(i); k = n.responseText; a++; h++; t = parseInt(f[o].size / s); f[o].size % s > 0 && t++; h == t && (o++ , h = 0); a <= v && rt(parseInt(a / v * 80)); window.setTimeout(function () { g() }, 2) } }, it = function (n) { for (var t = [], i, w, r, b, u = 0; u < n.files.length; u++) { if (e = n.files[u], e == undefined) return; if (e.size <= 0) return f = [], l = [], a = 0, o = 0, c = null, s = null, v = 0, h = 0, p = [], e = null, VIS.ADialog.info("VADMS_FileSizeShouldGreaterThan0KB"), y(!1), !1; if (e.name.indexOf("&") > -1 || e.name.indexOf("?") > -1 || e.name.indexOf("#") > -1 || e.name.indexOf("/") > -1 || e.name.indexOf("\\") > -1) { t.push(e.name); continue } for (i in f) if (e.name == f[i].name) { window.setTimeout(function () { y(!1); VIS.ADialog.info("fileAlreadyAttached") }, 20); return } if (l != null) for (i in l) if (e.name == l[i].Name && !l[i].IsDeleted) { window.setTimeout(function () { y(!1); VIS.ADialog.info("fileAlreadyAttached") }, 20); return } w = {}; w.Name = e.name; w.Size = e.size; f.push(e) } if (t.length > 0) { r = ""; for (b in t) r += t[b].toString() + "\n"; r += t.length == 1 ? "File has" : "Files have"; r += " invalid name. Please change the file name and try again."; y(!1); VIS.ADialog.info("", !0, r) } }, y = function (n) { if (t("body").find("#progressbar").remove(), n) { w = t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute;height: 35px;'>"); b = t("<span class='vis-ui-label'  style='position:absolute;left: 60%;top: 4px;'>").append("0%"); w.append(b); d.append(w); var i = t("<div id='progressbar' style='z-index: 999999;' class='vadms-Busy-Progress'><\/div>"); i.append(d); i.appendTo("<body>") } else t("body").find("progressbar").remove() }, rt = function (n) { w.css("width", n + "%"); b.empty(); b.append(n + "%") }; return this.getFolderKey = c, this.getSavedFileName = savedFileName, this.GetUploadedExcelColumns = function () { var t, u, i; if (o >= f.length) return t = [], u = VIS.Application.contextUrl + "VA012/UploadExcel/SaveAttachmentEntries", t.push({ Files: JSON.stringify(p) }), t.push({ FolderKey: c }), t.push({ FileName: savedFileName }), t.push({ Mapping: r }), i = n.ControllerRequestAjaxParameter1(u, t, !1), r.ExcelCol = i.ExcelCol, r.FileName = i.FileName, ut(i), i }, y(!0), it(i), tt(), k } }(VA012, jQuery); VA012 = window.VA012 || {}, function (n) { function t() { VIS.CalloutEngine.call(this, "VA012.VA012_Contra") } var r = VIS.Logging.Level, i = VIS.Utility.Util; VIS.Utility.inheritPrototype(t, VIS.CalloutEngine); t.prototype.SetContra = function (n, t, r, u, f) { if (this.isCalloutActive()) return ""; if (this.setCalloutActive(!0), f == null) r.setValue("VA012_IsContra", !1); else { var e = i.getValueOfString(VIS.DB.executeScalar("SELECT DTD001_ChargeType FROM C_Charge WHERE  C_Charge_ID=" + f.toString())); e == "CON" ? r.setValue("VA012_IsContra", !0) : r.setValue("VA012_IsContra", !1) } return this.setCalloutActive(!1), "" }; n.Model = n.Model || {}; n.Model.VA012_Contra = t }(VA012, jQuery)