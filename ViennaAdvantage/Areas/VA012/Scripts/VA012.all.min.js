/*Version 2.0.6.0*/VA012=window.VA012||{},function(n,t){function i(){function go(n){n!=null&&n!=""&&(v=t(n),a.getControls(),a.setBankAndAccount(),u.newRecord(),a.getBaseCurrency(),a.loadPayments("0","0","PY",yt.val()),ns(),a.dragPayments(),a.dropPayments(),io=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetAD_Column_IDForPayMethod",null))}function ns(){te=re("Bank Statement");ce.on(VIS.Events.onTouchStartOrClick,function(n){n.stopPropagation();var i=vf.width();i>50&&t(".va012-left-content").hide();vf.animate({width:i>50?40:200},300,"swing",function(){i<50&&t(".va012-left-content").show()})});gi.on("change",function(){h.val("0");a.loadBankAccount()});h.on("change",function(){VIS.Env.getCtx().setContext($self.windowNo,"BankAccount_ID",h.val());u.loadPayment();u.loadCashLine();ui.html("");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();nr=1;storepaymentdata=[];a.loadPayments(h.val()==null?0:h.val(),pt.val(),ct.val(),yt.val());ti=[];vt.html("");vi=1;it.loadStatement(hi);a.SetBankAccountOrganizationInContext(VIS.Utility.Util.getValueOfInt(t("option:selected",h).attr("orgid")))});pt.on("change",function(){ui.html("");nr=1;storepaymentdata=[];a.loadPayments(h.val()==null?0:h.val(),pt.val(),ct.val(),yt.val())});ct.on("change",function(){ct.val()=="CO"?(pt.prop("selectedIndex",0),pt.prop("disabled",!0)):(pt.prop("selectedIndex",0),pt.prop("disabled",!1));ui.html("");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();nr=1;of=0;ae=50;eo=1;storepaymentdata=[];a.loadPayments(h.val()==null?0:h.val(),pt.val(),ct.val(),yt.val())});ee.on(VIS.Events.onTouchStartOrClick,function(){yt.val()==""?VIS.ADialog.info("VA012_PleaseEnterStatementDate",null,"",""):it.statementDialog()});oe.on(VIS.Events.onTouchStartOrClick,function(){it.matchStatementDialog()});bu.on(VIS.Events.onTouchStartOrClick,function(){it.paymentScheduleDialog()});ve.on(VIS.Events.onTouchStartOrClick,function(){it.prepayOrderDialog()});be.on(VIS.Events.onTouchStartOrClick,function(){si.val()!=null&&si.val()!=""?(ir=!0,ti=[],vt.html(""),vi=1,it.loadStatement(hi)):(ti=[],vt.html(""),vi=1,it.loadStatement(hi))});si.keypress(function(n){n.which==13&&(si.val()!=null&&si.val()!=""?(ir=!0,ti=[],vt.html(""),vi=1,it.loadStatement(hi)):(ti=[],vt.html(""),vi=1,it.loadStatement(hi)))});se.on(VIS.Events.onTouchStartOrClick,function(){ti.length>0?t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/UnmatchStatement",contentType:"application/json; charset=utf-8",data:JSON.stringify({_statementLinesList:ti.toString()}),success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n[0]._status=="Success"&&n[0]._statementOk!=null&&VIS.ADialog.info("VA012_StatementsUnmatched",null," "+n[0]._statementOk,""),n[0]._error!=null&&VIS.ADialog.info(n[0]._error,null,"",""),n[0]._statementNo!=null&&VIS.ADialog.info("VA012_CompletedRecord",null," "+n[0]._statementNo,""),n[0]._statementNoNotUpdate!=null&&VIS.ADialog.info("VA012_ErrorSaving",null," "+n[0]._statementNoNotUpdate,""),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),ti=[],storepaymentdata=[],vt.html(""),vi=1,it.loadStatement(hi),ui.html(""),u.scheduleRefresh(),u.prepayRefresh(),nr=1,a.loadPayments(h.val(),pt.val(),ct.val(),yt.val()))},error:function(n){VIS.ADialog.info(n,null,"","")}}):VIS.ADialog.info("VA012_NoRecordSelected",null,"","")});he.on(VIS.Events.onTouchStartOrClick,function(){if(h.val()==null||h.val()==""||h.val()=="0"){VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"","");return}t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/ProcessStatement",contentType:"application/json; charset=utf-8",data:JSON.stringify({_statementLinesList:ti.toString(),_accountID:h.val()}),success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n[0]._error!=null?VIS.ADialog.info("",null,n[0]._error,""):n[0]._statementProcessed!=null?VIS.ADialog.info("",null,n[0]._statementProcessed+" "+VIS.Msg.getMsg("VA012_StatementsProcessed"),""):n[0]._statementNotProcessed!=null?VIS.ADialog.info("",null,n[0]._statementNotProcessed+" "+VIS.Msg.getMsg("VA012_StatementsNotProcessed"),""):n[0]._statementUnmatchedLines!=null&&VIS.ADialog.info("",null,n[0]._statementUnmatchedLines+" "+VIS.Msg.getMsg("VA012_ExistsUnmatched"),""),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),storepaymentdata=[],ti=[],vt.html(""),vi=1,it.loadStatement(hi),ui.html(""),u.scheduleRefresh(),u.prepayRefresh(),nr=1,a.loadPayments(h.val(),pt.val(),ct.val(),yt.val()))},error:function(n){VIS.ADialog.info(n,null,"","")}})});pe.on(VIS.Events.onTouchStartOrClick,function(){ti.length>0||parseInt(f.attr("data-uid"))>0?VIS.ADialog.ask(VIS.Msg.getMsg("VA012_WantToDelete"))&&t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/DeleteStatement",contentType:"application/json; charset=utf-8",data:JSON.stringify({_statementLinesList:ti.toString(),_statementLineID:f.attr("data-uid")}),success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n[0]._status=="Success"&&n[0]._statementProcessed!=null&&VIS.ADialog.info(n[0]._statementProcessed+" "+VIS.Msg.getMsg("VA012_StatementsDeleted"),null,"",""),n[0]._statementNotProcessed!=null&&VIS.ADialog.info(n[0]._statementNotProcessed+" "+VIS.Msg.getMsg("VA012_StatementsNotDeleted"),null,"",""),n[0]._error!=null&&VIS.ADialog.info(n[0]._error,null,"",""),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),ti=[],storepaymentdata=[],vt.html(""),vi=1,it.loadStatement(hi),ui.html(""),u.scheduleRefresh(),u.prepayRefresh(),nr=1,a.loadPayments(h.val(),pt.val(),ct.val(),yt.val()))},error:function(n){VIS.ADialog.info(n,null,"","")}}):VIS.ADialog.info("VA012_NoRecordSelected",null,"","")});ui.on("scroll",a.paymentScroll);vt.on("scroll",a.statementScroll);vt.on(VIS.Events.onTouchStartOrClick,it.statementListEdit);vt.on(VIS.Events.onTouchStartOrClick,it.openStatement);vt.on(VIS.Events.onTouchStartOrClick,it.selectedStatementLinesList);ui.on(VIS.Events.onTouchStartOrClick,it.selectedScheduleList);ui.on(VIS.Events.onTouchStartOrClick,function(n){n.target.type!="checkbox"&&(t(n.target).closest(".row").find(":checkbox").is(":checked")?t(n.target).closest(".row").find(":checkbox").prop("checked",!1):t(n.target).closest(".row").find(":checkbox").prop("checked",!0));i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())])});yt.addClass("va012-mandatory");yt.on("change",function(){if(yt.val()=="")yt.addClass("va012-mandatory");else{if(new Date(yt.val())>new Date)return VIS.ADialog.info("VA012_StatementDateToday",null,"",""),yt.val(""),!1;yt.removeClass("va012-mandatory")}storepaymentdata=[];a.loadPayments(h.val()==null?0:h.val(),pt.val(),ct.val(),yt.val())});hu.fireValueChanged=a.loadDataOnBPChanged;_btnSearchPayment.on(VIS.Events.onTouchStartOrClick,function(){a.loadAndResetPaymentData()});_txtSearchPayment.keypress(function(n){n.which==13&&a.loadAndResetPaymentData()})}function ts(){var t=wo.isDecimalSeparatorDot(window.navigator.language),n=_txtSearchPayment.val();return n==""||t||n.contains("=")||n.contains(",")&&(n=n.replace(",",".")),n}function is(n){t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/getMatchRecData",contentType:"application/json; charset=utf-8",success:function(t){if(n.html(""),n.append("<option value=0 >-<\/option>"),t=JSON.parse(t),t!=null&&t.length>0)for(var i=0;i<t.length;i++)n.append("<option value="+t[i].Value+">"+t[i].Name+"<\/option>")},error:function(n){VIS.ADialog.info(n,null,"","")}})}function ao(n,t){w2ui["VA012_gridPayment_"+$self.windowNo]!=null&&w2ui["VA012_gridPayment_"+$self.windowNo].destroy();var i=null;i=n.w2grid({name:"VA012_gridPayment_"+$self.windowNo,recordHeight:25,show:{toolbar:!1,selectColumn:!1,toolbarReload:!1,toolbarColumns:!1,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1},records:[],columns:[{field:"_trxDate",caption:"Tran. Date",sortable:!1,size:"80px",display:!1},{field:"_trxNo",caption:"Auth Code/ Trx no.",sortable:!1,size:"30%",hidden:!1},{field:"_salesAmt",caption:"Trx Amount",sortable:!1,size:"15%",hidden:!1,style:"text-align: right",render:function(n){return parseFloat(n._salesAmt).toLocaleString(window.navigator.language,{minimumFractionDigits:n._StdPrecision,maximumFractionDigits:n._StdPrecision})}},{field:"_netAmt",caption:"Statement Amount",sortable:!1,size:"15%",hidden:!1,style:"text-align: right",render:function(n){return parseFloat(n._netAmt).toLocaleString(window.navigator.language,{minimumFractionDigits:n._StdPrecision,maximumFractionDigits:n._StdPrecision})}},{field:"_difference",caption:"Difference",sortable:!1,size:"15%",hidden:!1,style:"text-align: right"},{field:"_chargeType",caption:"Charge Type",sortable:!1,size:"80px",display:!0},{field:"_taxRate",caption:"Tax Rate",sortable:!1,size:"80px",display:!0},{field:"_taxAmt",caption:"Tax Amt",sortable:!1,size:"15%",hidden:!1,style:"text-align: right",render:function(n){return parseFloat(n._taxAmt).toLocaleString(window.navigator.language,{minimumFractionDigits:n._StdPrecision,maximumFractionDigits:n._StdPrecision})}},],onChange:function(){},onClick:function(){},onDelete:function(){},onSubmit:function(){}});i.add(t)}function hf(n){if(n!=null&&d.length>0){t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetCurrencyandConversionType",dataType:"json",data:{_invoiceSchedules:n},success:function(n){var t=JSON.parse(n);(t!=null||t!="")&&i(t)}});function i(n){if(n.currencyId!=0&&d!=null){s.val(n.currencyId).prop("selected",!0);for(var i=0;s[0].length>i;i++)VIS.Utility.Util.getValueOfInt(s[0][i].value)==n.currencyId||VIS.Utility.Util.getValueOfInt(s[0][i].value)==at?t(s[0][i]).show():t(s[0][i]).hide();s.removeClass("va012-mandatory");s.attr("disabled",!1);y.val(n.conversionTypeId).prop("selected",!0)}else s.val(at).prop("selected",!0),s.attr("disabled",!0),s.removeClass("va012-mandatory"),y.val(n.conversionTypeId).prop("selected",!0);y.trigger("change")}}else s.prop("selectedIndex",0),s.addClass("va012-mandatory"),s.attr("disabled",!1),y.prop("selectedIndex",0),y.addClass("va012-mandatory")}function r(n){var t=0;return dotFormatter=$self.dotFormatter,typeof n=="string"?n:n=n.toString(),dotFormatter?(n=n.contains("−")?(-1*du.GetConvertedNumber(n,dotFormatter)).toString():du.GetConvertedNumber(n,dotFormatter).toString(),t=n!=""?n:t):(n=n.contains("−")&&!n.contains(".")?(-1*du.GetConvertedNumber(n,dotFormatter)).toString():n.contains("−")&&n.contains(".")?(-1*du.GetConvertedNumber(n,dotFormatter)).toString():du.GetConvertedNumber(n,dotFormatter).toString(),t=n!=""?n:t),parseFloat(t).toFixed(b)}function ue(n,i,r,u){var f=VIS.Utility.Util.getValueOfInt(n),e,o;if(f==0){u(n);return}e=VIS.Utility.Util.getValueOfDecimal(i);o=VIS.Utility.Util.getValueOfInt(r);t.ajax({url:VIS.Application.contextUrl+"VA012/BankStatement/CalculateSurcharge",type:"GET",contentType:"application/json; charset=utf-8",data:{_tax_ID:f,_chargeAmt:e,_stdPrecision:o},success:function(n){u(n)},error:function(n){VIS.ADialog.info(n,null,"","")}})}function fe(n,t){return t.indexOf(n)>-1}function ni(n,i,r){if(cf=t("<div class='vis-apanel-busy va012-busy-bank-statement'>"),cf.css({position:r,width:"95%",height:"95%","text-align":"center",visibility:"hidden"}),i)cf.css({visibility:"visible"});else{n.find(".va012-busy-bank-statement").remove();return}n.append(cf)}var v,du,re,a,it,u;this.windowNo;$self=this;v=t("<div/>");this.frame;var cf=null,gi=null,h=null,lf=null,yt=null,ee=null,oe=null,pt=null,ct=null,vt=null,ui=null,af=null,hi="",au=null,vu=null,tf=null,fo=null,ir=!1,ti=[],d=[],wi=[],lt=[],eu=[],ou=[],se=null,he=null,ce=null,vf=null,yf=null,at=0,b=2,ii=!1,rr=!1,nr=1,eo=1,vi=1,le=50,ae=50,pf=0,wf=0,oo=null,f=null,bf=null,gt=null,kf=null,ci=null,fr=null,nt=null,ot=null,ur=null,er=null,su=null,p=null,i=null,c=null,w=null,k=null,yu=null,lr=null,or=null,rt=null,ut=null,wt=null,pu=null,rf=null,tu=null,uf=null,ff=null,wu=null,ef=null,bu=null,ve=null,tr=null,df=null,bt=null,ye=null,pe=null,vo=null,yo=null,ar=null,iu=null,vr=null,ru=null,li=null,so=null,ku=null,yi=null,fi=null,we=null,ei=null,ai=null,yr=null,pr=null,wr=null,br=null,kr=null,sr=null,hr=null,si=null,be=null,bi=null,ho=null,gf=null,e=null,o=null,ke=0,of=0,co=null,st=null,kt=null,de=null,et=null,oi=null,ge=null,tt=null,ri=null,po=null,ne=null,ht=null,uu=null,te=0,no=null,dt=null,fu=null,s=null,y=null,l=null,g=null,ft=null,dr=!1;storepaymentdata=[];du=VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount);this.dotFormatter=VIS.Env.isDecimalPoint();var wo=new VIS.CultureSeparator,ie=new Date,to=ie.getFullYear()+"-"+("0"+(ie.getMonth()+1)).slice(-2)+"-"+("0"+ie.getDate()).slice(-2),sf,bo,lo,ko,io=null,hu=_txtSearchPayment=_btnSearchPayment=null,ro=0,uo=null,cu=null,gr=null,gu=null,ki=null,nf=null,cr=!1,pi=null,lu=null,di=null,nu=0;this.Initialize=function(){ro=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA012/BankStatement/GetModulePrefix",{prefix:"VA034_"});go(a.loadFormDesign());c.addVetoableChangeListener(this);wt.addVetoableChangeListener(this);i.addVetoableChangeListener(this);w.addVetoableChangeListener(this)};re=function(n){return VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA012/BankStatement/GetWindowforzoom",{WindowName:n},null)};a={loadDataOnBPChanged:function(){ui.html("");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();a.loadAndResetPaymentData()},loadFormDesign:function(){_formDesign=t('<div class="va012-assign-content">');divContainer=t('  <div id="VA012_mainContainer_'+$self.windowNo+'" class="va012-main-container">');divTable=t('<table id="VA012_table_'+$self.windowNo+'" style="width: 100%;">');tableTr=t("<tr>");tableTd=t('<td id="VA012_tdLeft_'+$self.windowNo+'" style="width: 200px;position: relative;">   <div class="va012-left-part">              <div class="va012-left-title">                  <h4>    <i id="VA012_btnHide_'+$self.windowNo+'" class="fa fa-bars" alt="lines" style="cursor: pointer;background: rgba(var(--v-c-primary),1);"><\/i> <\/h4>              <\/div>              <div class="va012-left-content">                  <div class="va012-left-data">                      <label  id="VA012_lblBank_'+$self.windowNo+'" >'+VIS.Msg.getMsg("VA012_Bank")+'<sup style="color: red;">*<\/sup><\/label>                      <select id="VA012_cmbBank_'+$self.windowNo+'" ><\/select>                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <label  id="VA012_lblBankAccount_'+$self.windowNo+'" >'+VIS.Msg.getMsg("VA012_BankAccount")+'<sup style="color: red;">*<\/sup><\/label>                      <select id="VA012_cmbBankAccount_'+$self.windowNo+'"   ><\/select>                  <\/div>                  <!-- end of left-data -->                  <div class="va012-left-data">                      <label  id="VA012_lblStatementDate_'+$self.windowNo+'" >'+VIS.Msg.getMsg("VA012_StatementDate")+'<sup style="color: red;">*<\/sup><\/label>                      <input type="date" max="9999-12-31" id="VA012_statementDate_'+$self.windowNo+'"   >                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <a id="VA012_btnLoadStatement_'+$self.windowNo+'">'+VIS.Msg.getMsg("VA012_LoadStatement")+'<\/a>                      <a id="VA012_btnMatchStatement_'+$self.windowNo+'">'+VIS.Msg.getMsg("VA012_MatchStatement")+"<\/a>                  <\/div>                  <!-- end of left-data -->              <\/div>              <!-- end of left-content -->          <\/div>          <!-- end of left-part --> <\/td>");tableTd1=t('<td style="position: relative;">');contentDiv=t('<div id="VA012_contentArea_'+$self.windowNo+'" class="va012-content-area" style="position: absolute;" >');divMidWrap=t('<div id="VA012_middleWrap_'+$self.windowNo+'" class="va012-middle-wrap">');divtopWrap=t('<div class="va012-mid-top-wrap" id="VA012_formBtnNewRecord_'+$self.windowNo+'">                      <div class="va012-icons-wrap">                          <span>                              <i class="va012-undo vis vis-ignore" alt="undo" title="Undo" id="VA012_btnUndo_'+$self.windowNo+'"><\/i><\/span>                          <span>                              <i class="va012-hide-show-newform vis vis-plus" activestatus="0" alt="add" title = "Expand" id="VA012_btnNewRecord_'+$self.windowNo+'"><\/i><\/span>                      <\/div>                      <!-- end of icons-wrap -->                  <\/div>');divformWrap=t('<div class="va012-form-wrap va012-newform" id="VA012_formNewRecord_'+$self.windowNo+'" data-uid="0" style="height:55%;overflow-y:auto;width:101%;">');divRow1=t('<div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementNumber")+' <sup style="color: red;">*<\/sup><\/label>                                  <input  tabindex="1" id="VA012_txtStatementNo_'+$self.windowNo+'" type="text" class="va012-input-size">                                  <i  id="VA012_btnStatementNo_'+$self.windowNo+'" class="fa fa-plus va012-add-icon"><\/i>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementPage")+'<\/label>                                  <input tabindex="2" value="1" id="VA012_txtStatementPage_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementLine")+'<\/label>                                  <input tabindex="3" value="10" id="VA012_txtStatementLine_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  ');divRow2=t('<div class="row va012-fl-padd" style="width:102%">');row2Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementDate")+'<sup style="color: red;">*<\/sup><\/label>                                  <input tabindex="4" id="VA012_dtStatementDate_'+$self.windowNo+'" type="date" max="9999-12-31">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->');row2Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">');row2Col2divAmt=t('<div class="va012-form-group va012-form-data" >');row2Col2Lble=t("<label>"+VIS.Msg.getMsg("VA012_Amount")+'<sup style="color: red;">*<\/sup><\/label>');row2Col2btnIn=t('<a tabindex="5" id="VA012_btnIn_'+$self.windowNo+'" v_active="1" class="va012-inout-icon va012-active">In<\/a>');row2Col2btnOut=t('<a tabindex="6" id="VA012_btnOut_'+$self.windowNo+'" v_active="0" class="va012-inout-icon va012-inactive">Out<\/a>');i=new VIS.Controls.VAmountTextBox("VA012_txtAmount_"+$self.windowNo+"",!1,!1,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));i.setValue(0);i.getControl().addClass("va012-input-size-amt va012-right-align va012-txtamount");row2Col2btnIcon=t('<a id="VA012_btnAmount_'+$self.windowNo+'" class="va012-info-icon"><\/a>');row2Col3=t('<div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_VoucherMatch")+'<sup style="color: red;">*<\/sup><\/label>                                  <select tabindex="8" id="VA012_cmbVoucherMatch_'+$self.windowNo+'">                                  <\/select>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  ');divRow3=t('                      <div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-8 col-sm-8 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_Description")+'<\/label>                                  <input tabindex="9" id="VA012_txtDescription_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divVoucherNo_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_VoucherNo")+'<\/label>                                  <input tabindex="9" id="VA012_txtVoucherNo_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  ');divRow4=t('<div class="row va012-fl-padd" style="width:102%">');divRow4Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">');divRow4Col1TrxAmt=t('<div id="VA012_divTrxAmt_'+$self.windowNo+'" class="va012-form-group va012-form-data">');divRow4Col1Lbl=t("<label>"+VIS.Msg.getMsg("VA012_TrxAmt")+'<sup style="color: red;">*<\/sup><\/label>');c=new VIS.Controls.VAmountTextBox("VA012_txtTrxAmt_"+$self.windowNo+"",!1,!0,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));c.getControl().addClass("va012-right-align");c.setValue(0..toFixed(b));divRow4Col1TrxAmt.append(divRow4Col1Lbl).append(c.getControl());divRow4Col1.append(divRow4Col1TrxAmt);divRow4Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">');divRow4Col2Diff=t('<div id="VA012_divDifference_'+$self.windowNo+'" class="va012-form-group va012-form-data">');divRow4Col2DiffLbl=t("<label>"+VIS.Msg.getMsg("VA012_Difference")+'<sup id="Ast_Difference_'+$self.windowNo+'" style="color: red;">*<\/sup><\/label>');w=new VIS.Controls.VAmountTextBox("VA012_txtDifference_"+$self.windowNo+"",!1,!0,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));w.getControl().addClass("va012-right-align");w.setValue(0);w.getControl().trigger("blur");divRow4Col2Diff.append(divRow4Col2DiffLbl).append(w.getControl());divRow4Col2.append(divRow4Col2Diff);divRow4Col3=t('<div class="col-md-4 col-sm-4 va012-padd-0">');divRow4Col3DiffType=t('<div id="VA012_divDifferenceType_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_DifferenceType")+'<sup id="Ast_DifferenceType_'+$self.windowNo+'" style="color: red;">*<\/sup><\/label>                                  <select tabindex="9" id="VA012_cmbDifferenceType_'+$self.windowNo+'">                                  <\/select>                              <\/div>                              <!-- end of form-group -->');divRow4Col3.append(divRow4Col3DiffType);divRow4.append(divRow4Col1).append(divRow4Col2).append(divRow4Col3);divRow5=t('<div class="row va012-fl-padd" style="width:102%">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divContraType_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_ContraType")+'<sup id="Ast_ContraType_'+$self.windowNo+'" style="color: red;">*<\/sup><\/label><\/label>                                      <select tabindex="10" id="VA012_cmbContraType_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCashBook_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CashBook")+'<\/label>                                      <select tabindex="10" id="VA012_cmbCashBook_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <div id="VA012_divCtrlCashLine_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CashJournalLine")+'<sup id="Ast_CashJournalLine_'+$self.windowNo+'" style="color: red;">*<\/sup><\/label>                                      <div id="VA012_ctrlCashLine_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCheckNo_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CheckNo")+'<\/label>                                      <input  disabled tabindex="12" id="VA012_txtCheckNo_'+$self.windowNo+'" type="text">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->  ');divRow6=t('<div class="row va012-fl-padd" style="width:102%">');divRow6Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCharge_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Charge")+'<sup class="astric_'+$self.windowNo+'" style="color: red;">*<\/sup><\/label>                                      <div style=" position: relative; float: left; width: 100%; ">                                      <input tabindex="10" chargeid="" type="text" id="VA012_txtCharge_'+$self.windowNo+'" style=" width: 100%; ">                                      <img id="VA012_btnCharge_'+$self.windowNo+'" class="VA012-img-combo" alt="">                                     <\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow6Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divTaxRate_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_TaxRate")+'<sup class="astric_'+$self.windowNo+'" style="color: red;">*<\/sup><\/label>                                      <select tabindex="11" id="VA012_cmbTaxRate_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow6Col3=t('<div class="col-md-4 col-sm-4 va012-padd-0">');divRow6Col3divTax=t('<div id="VA012_divTaxAmount_'+$self.windowNo+'" class="va012-form-group va012-form-data">');divRow6Col3divTaxLbl=t("<label>"+VIS.Msg.getMsg("VA012_TaxAmount")+"<\/label>");wt=new VIS.Controls.VAmountTextBox("VA012_txtTaxAmount_"+$self.windowNo+"",!1,!0,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));wt.setValue(0);wt.getControl().addClass("va012-right-align");divRow6Col3divTax.append(divRow6Col3divTaxLbl).append(wt.getControl());divRow6Col3.append(divRow6Col3divTax);divRow6.append(divRow6Col1).append(divRow6Col2).append(divRow6Col3);divRow7=t('<div class="row va012-fl-padd" style="width:102%">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlPayment_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Payment")+'<\/label>                                      <div id="VA012_ctrlPayment_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlInvoice_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Invoice")+'<\/label>                                      <div id="VA012_ctrlInvoice_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlBusinessPartner_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_BusinessPartner")+'<\/label>                                      <div id="VA012_ctrlBusinessPartner_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->  ');divRow8=t('<div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPaymentSchedule_'+$self.windowNo+'" class="va012-form-data" >                              <label>'+VIS.Msg.getMsg("VA012_PaymentSchedules")+'<\/label>                              <input disabled id="VA012_txtPaymentSchedule_'+$self.windowNo+'" type="text" class="va012-input-size">                              <a tabindex="13"  id="VA012_btnPaymentSchedule_'+$self.windowNo+'" class="va012-edit-icon"><\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPrepayOrder_'+$self.windowNo+'" class="va012-form-data" >                              <label>'+VIS.Msg.getMsg("VA012_PrepayOrders")+'<\/label>                              <div id="VA012_ctrlOrder_'+$self.windowNo+'"><\/div>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divTrxOrg_'+$self.windowNo+'" class="va012-form-data" >                              <label>'+VIS.Msg.getMsg("VA012_TrxOrg")+'<\/label>                              <div id="VA012_ctrlTrxOrg_'+$self.windowNo+'"><\/div>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  ');divRow9=t('<div class="row va012-fl-padd" style="width:102%">                       <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-check">                                  <input tabindex="13" id="VA012_chkUseNextTime_'+$self.windowNo+'" type="checkbox">                                  <label style="position: absolute;">'+VIS.Msg.getMsg("VA012_UseNextTime")+'<\/label>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-2 col-sm-2 va012-padd-0" >                              <div class="va012-form-data" id="VA012_divMore_'+$self.windowNo+'">                                  <a tabindex="14" visiblestatus="0" class="va012-more" id="VA012_btnMore_'+$self.windowNo+'" href="#">'+VIS.Msg.getMsg("VA012_More")+'<\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-6 col-sm-6 va012-padd-0" >                          <div style="float:right;">                              <a tabindex="15" title="Save Record" id="VA012_btnSave_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue" style=" float: left;">'+VIS.Msg.getMsg("VA012_SaveandNew")+"<\/a>                          <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->");divRow10=t('<div class="row va012-fl-padd" style="width:102%">');divRow10Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCurrency_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Currency")+'<sup style="color: red;">*<\/sup><\/label>                                      <select tabindex="10" id="VA012_txtCurrency_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow10Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divConversionType_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_ConversionType")+'<sup style="color: red;">*<\/sup><\/label>                                      <select tabindex="11" id="VA012_txtConversionType_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow10Col3=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divPaymentMethod_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_PaymentMethod")+'<sup style="color: red;">*<\/sup><\/label>                                      <select tabindex="16" id="VA012_txtPaymentMethod_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow10.append(divRow10Col1).append(divRow10Col2).append(divRow10Col3);divRow11=t('<div class="row va012-fl-padd" style="width:102%">');divRow11Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCheckNum_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CheckNo")+'<sup style="color: red;">*<\/sup><\/label>                                      <input tabindex="17" id="VA012_txtCheckNum_'+$self.windowNo+'" type="text">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow11Col2=t('<div class="col-md-4 col-sm-4 va012-padd-1">                                  <div id="VA012_divCheckDate_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CheckDate")+'<sup style="color: red;">*<\/sup><\/label>                                      <input tabindex="18" id="VA012_txtCheckDate_'+$self.windowNo+'" type="date" max="9999-12-31">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow11.append(divRow11Col1).append(divRow11Col2);payHeaderWrap=t('<div id="VA012_paymentHeaderWrap_'+$self.windowNo+'" class="va012-payment-header-wrap">                      <div class="va012-headersearchfilter">                           <div class="va012-searchfilter">                              <select id="VA012_cmbTransactionType_'+$self.windowNo+'">                             <option value="PY">'+VIS.Msg.getMsg("VA012_Payments")+'<\/option>                             <option value="PO">'+VIS.Msg.getMsg("VA012_PrepayOrders")+'<\/option>                              <option value="IS">'+VIS.Msg.getMsg("VA012_InvoiceSchedule")+'<\/option>                              <option value="CO">'+VIS.Msg.getMsg("VA012_Contra")+'<\/option>                              <\/select>                          <\/div>                          <div class="va012-searchfilter">                              <select id="VA012_cmbSearchPaymentMethod_'+$self.windowNo+'">                              <\/select>                          <\/div>                       <div id=VA012_DivBusinessPartner_'+$self.windowNo+' class="va012-searchfilter">                       <\/div>                       <div class="VA012-search-wrap va012-searchfilter">                        <input value = "" placeholder="'+VIS.Msg.getMsg("VA012_Search")+'..." type = "text" id = VA012_txtSearch_Payment_'+$self.windowNo+'>                        <a class= "va012-search-icon va012-search-icon-right" id = VA012_btnSearch_Payment_'+$self.windowNo+' title="'+VIS.Msg.getMsg("VA012_SearchTitle")+'"> <span class="glyphicon glyphicon-search"><\/span><\/a >                       <\/div>                          <\/div>                      <\/div>                      <!-- end of payment-header-wrap -->                  <div id="VA012_paymentList_'+$self.windowNo+'" class="va012-payment-list">                                           <div class="va012-payment-content" id="VA012_lstPayments_'+$self.windowNo+'">                   <\/div>                  <\/div>                  <!-- end of payment-list -->                <\/div>');rightWrap=t('<div id="VA012_rightWrap_'+$self.windowNo+'" class="va012-right-wrap">                  <div id="VA012_rightTop_'+$self.windowNo+'" class="va012-right-top">                      <div class="row">                          <div class="col-md-3 col-sm-3" style=" padding-right: 5px; ">                              <div class="va012-pay-text" id="VA012_secReconciled_'+$self.windowNo+'" >                                <p>'+VIS.Msg.getMsg("VA012_Reconciled")+'<\/p>                                <p style="margin-top: 4px;">'+VIS.Msg.getMsg("VA012_Unreconciled")+'<\/p>                              <\/div>                          <\/div>                          <!-- end of col -->                          <div class="col-md-9 col-sm-9" style=" padding-left: 5px; ">                              <div class="va012-pay-text" id="VA012_secUnreconciled_'+$self.windowNo+'">                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-green"><span class="va012-base-curr"><\/span> 0<\/span>                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-red"><span class="va012-base-curr"><\/span> 0<\/span>                              <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                      <div class="row">                          <div class="col-md-12 col-sm-12" style=" padding-left: 5px; ">                      <div style=" /* float: right; */ padding-left: 10px;">                               <a id="VA012_btnUnmatch_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue" title="Show Unmatched Record" style=" float: left; ">'+VIS.Msg.getMsg("VA012_Unmatch")+'<\/a>                              <a id="VA012_btnProcess_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue" title="Clear Matched Record" style=" float: left; margin-left: 5px; ">'+VIS.Msg.getMsg("VA012_Process")+'<\/a>                             <a id="VA012_btnDelete_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue" title="Delete Selected Record" style=" float: left; margin-left: 5px; ">'+VIS.Msg.getMsg("VA012_Delete")+'<\/a>                       <\/div>                           <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <div class="row">                          <div class="col-md-12 col-sm-12" style=" padding-right: 5px; ">                           <div class="va012-right-search">                            <div class="va012-search-wrap">                               <input id="VA012_txtSearch_'+$self.windowNo+'" value="" placeholder="'+VIS.Msg.getMsg("VA012_Search")+'..." type="text">                               <a id="VA012_btnSearch_'+$self.windowNo+'" class="va012-search-icon"><span class="glyphicon glyphicon-search"><\/span><\/a>                          <\/div>                      <!-- end of search-wrap -->                         <\/div>                  <!-- end of right-search -->                        <\/div>                       <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <\/div>                  <!-- end of right-top -->                    <div class="va012-right-content" id="VA012_lstStatement_'+$self.windowNo+'">                  <\/div>                  <!-- end of right-content -->              <\/div>');row2Col2divAmt.append(row2Col2Lble).append(row2Col2btnIn).append(row2Col2btnOut).append(i.getControl()).append(row2Col2btnIcon);row2Col2.append(row2Col2divAmt);divRow2.append(row2Col1).append(row2Col2).append(row2Col3);divformWrap.append(divRow1).append(divRow2).append(divRow10).append(divRow11).append(divRow3).append(divRow4).append(divRow5).append(divRow6).append(divRow7).append(divRow8).append(divRow9);var n="C_BPartner.IsActive='Y' AND C_BPartner.IsSummary ='N' AND C_BPartner.AD_Org_ID IN(0,@BankAccount_Org_ID@) AND C_BPartner.AD_Client_ID = "+VIS.context.getAD_Client_ID(),r=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,3499,VIS.DisplayType.Search,"C_BPartner_ID",0,!1,n);return hu=new VIS.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,VIS.DisplayType.Search,r),divMidWrap.append(divtopWrap).append(divformWrap).append(payHeaderWrap),t(payHeaderWrap).find("#VA012_DivBusinessPartner_"+$self.windowNo).append(hu.getControl().attr("id","C_BPartner_ID_"+$self.windowNo).addClass("BPSearchText").attr("placeholder",VIS.Msg.getMsg("VA012_BusinessPartner"))).append(hu.getBtn(0).addClass("btnBPSearch")),contentDiv.append(divMidWrap).append(rightWrap),tableTd1.append(contentDiv),tableTr.append(tableTd).append(tableTd1),sf=t('<div  id="VA012_gridMatchStatePopUp_'+$self.windowNo+'"" style="display:block;width:auto;height:auto"><div  style="    width: 50%;float: left;" ><label>'+VIS.Msg.getMsg("VA012_ChargeType")+'<\/label><div  id="VA012_ChargeSrch_'+$self.windowNo+'"><\/div><\/div><div ><label>'+VIS.Msg.getMsg("VA012_Taxrate")+'<\/label><select  id="VA012_cmbTaxRate_'+$self.windowNo+'"><\/select><\/div><div style="width:auto;height:270px" id="VA012_gridMatchState_'+$self.windowNo+'""><\/div><\/div>'),bo=sf.find("#VA012_gridMatchState_"+$self.windowNo),lo=sf.find("#VA012_ChargeSrch_"+$self.windowNo),ko=sf.find("#VA012_cmbTaxRate_"+$self.windowNo),_ChargeLookUp=VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(),$self.windowNo,3787,VIS.DisplayType.Search),$ChargeControl=new VIS.Controls.VTextBoxButton("C_Charge_ID",!0,!1,!0,VIS.DisplayType.Search,_ChargeLookUp),lo.append($ChargeControl.getControl().css("width","93%")).append($ChargeControl.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")),divTable.append(tableTr),_formDesign.append(divContainer).append(divTable),_formDesign},setBankAndAccount:function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/SetBankAndAccount",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n!=null&&(wf=n.Table[0].C_BANK_ID,pf=n.Table[0].C_BANKACCOUNT_ID));a.loadBank()}})},addEffect:function(n,t,i){var r={to:t,className:"wsp-ui-effects-transfer"};n.effect("transfer",r,600,i)},setInvoiceAndBPartner:function(n,i){t.ajax({url:VIS.Application.contextUrl+"BankStatement/SetInvoiceAndBPartner",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_paymentID:n,_cmbTransactionType:i},success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),i=="PY"?(n._invoiceID>0?dt.setValue(n._invoiceID,!1,!0):dt.setValue(),n._bPartnerID>0?ht.setValue(n._bPartnerID,!1,!0):ht.setValue(),n.count==1&&n.VA034_DepositSlipNo!=""&&lr.val(n.VA034_DepositSlipNo)):i=="PO"?ht.value||ht.setValue(n._bPartnerID,!1,!0):i=="IS"&&(ht.value||ht.setValue(n._bPartnerID,!1,!0)))}})},setBPartner:function(n){t.ajax({url:VIS.Application.contextUrl+"BankStatement/SetBPartner",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_invoiceID:n},success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n>0?ht.setValue(n,!1,!0):ht.setValue())}})},getMaxStatement:function(n){h.val()>0?t.ajax({url:VIS.Application.contextUrl+"BankStatement/MaxStatement",type:"GET",datatype:"json",data:{_bankAccount:h.val()==null?0:h.val(),_origin:n,_pageNo:0},contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),gt.val(n.statementNo),ci.val(n.pageno),fr.val(n.lineno))}}):(gt.val("0"),ci.val("0"),fr.val("0"))},getOverUnderPayment:function(n){t.ajax({url:VIS.Application.contextUrl+"BankStatement/getOverUnderPayment",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_paymentID:n},success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),n._difference!=0&&(w.setValue(VIS.Utility.Util.getValueOfDecimal(Math.abs(n._difference))),yi.find("*").prop("disabled",!1),k.val(n._differenceType).prop("selected",!0),w.getControl().attr("vchangable","N"),p.val()=="M"&&c.setValue(VIS.Utility.Util.getValueOfDecimal(n._payamt.toFixed(b)))))}})},getControls:function(){gi=v.find("#VA012_cmbBank_"+$self.windowNo);h=v.find("#VA012_cmbBankAccount_"+$self.windowNo);lf=v.find("#VA012_STAT_cmbBankAccountClassName_"+$self.windowNo);yt=v.find("#VA012_statementDate_"+$self.windowNo);oo=v.find("#VA012_BankChargeDiv"+$self.windowNo);pt=v.find("#VA012_cmbSearchPaymentMethod_"+$self.windowNo);ct=v.find("#VA012_cmbTransactionType_"+$self.windowNo);ee=v.find("#VA012_btnLoadStatement_"+$self.windowNo);oe=v.find("#VA012_btnMatchStatement_"+$self.windowNo);vt=v.find("#VA012_lstStatement_"+$self.windowNo);ui=v.find("#VA012_lstPayments_"+$self.windowNo);af=v.find("#VA012_paymentList_"+$self.windowNo);au=v.find("#VA012_secReconciled_"+$self.windowNo);vu=v.find("#VA012_secUnreconciled_"+$self.windowNo);si=v.find("#VA012_txtSearch_"+$self.windowNo);be=v.find("#VA012_btnSearch_"+$self.windowNo);se=v.find("#VA012_btnUnmatch_"+$self.windowNo);he=v.find("#VA012_btnProcess_"+$self.windowNo);ce=v.find("#VA012_btnHide_"+$self.windowNo);vf=v.find("#VA012_tdLeft_"+$self.windowNo);yf=v.find("#VA012_table_"+$self.windowNo);bi=v.find("#VA012_btnMore_"+$self.windowNo);ho=v.find("#VA012_divMore_"+$self.windowNo);ar=v.find("#VA012_divContraType_"+$self.windowNo);iu=v.find("#VA012_divCashBook_"+$self.windowNo);_divCtrlCashLine=v.find("#VA012_divCtrlCashLine_"+$self.windowNo);vr=v.find("#VA012_divTransferType_"+$self.windowNo);ru=v.find("#VA012_divCheckNo_"+$self.windowNo);li=v.find("#VA012_divVoucherNo_"+$self.windowNo);so=v.find("#VA012_divTrxAmt_"+$self.windowNo);ku=v.find("#VA012_divDifference_"+$self.windowNo);yi=v.find("#VA012_divDifferenceType_"+$self.windowNo);fi=v.find("#VA012_divCharge_"+$self.windowNo);we=v.find("#VA012_btnCharge_"+$self.windowNo);ei=v.find("#VA012_divTaxRate_"+$self.windowNo);ai=v.find("#VA012_divTaxAmount_"+$self.windowNo);yr=v.find("#VA012_divCtrlPayment_"+$self.windowNo);pr=v.find("#VA012_divCtrlInvoice_"+$self.windowNo);wr=v.find("#VA012_divCtrlBusinessPartner_"+$self.windowNo);br=v.find("#VA012_divPrepayOrder_"+$self.windowNo);kr=v.find("#VA012_divPaymentSchedule_"+$self.windowNo);_divPaymentMethod=v.find("#VA012_divPaymentMethod_"+$self.windowNo);sr=v.find("#VA012_divCheckNum_"+$self.windowNo);hr=v.find("#VA012_divCheckDate_"+$self.windowNo);_txtSearchPayment=v.find("#VA012_txtSearch_Payment_"+$self.windowNo);_btnSearchPayment=v.find("#VA012_btnSearch_Payment_"+$self.windowNo);gr=v.find("#VA012_divTrxOrg_"+$self.windowNo)},getBaseCurrency:function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetBaseCurrency",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),tf=n._code,fo=n._id,t(".va012-base-curr").text(tf))}})},loadBank:function(){function n(n){if(gi.html(""),gi.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)gi.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].Value)+">"+n[t].Name+"<\/option>");gi.prop("selectedIndex",0);wf>0&&(gi.val(wf).prop("selected",!0),wf=0);a.loadBankAccount()}t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetBank",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",success:function(i){i!=null&&i!=""&&(_ds=t.parseJSON(i),n(_ds))}})},loadBankAccount:function(){function n(n){if(h.html(""),h.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)h.append("<option orgid="+VIS.Utility.Util.getValueOfInt(n[t].OrgId)+" stdprecision="+VIS.Utility.Util.getValueOfInt(n[t].StdPrecision)+" currencyid="+VIS.Utility.Util.getValueOfInt(n[t].CurrencyId)+" value="+VIS.Utility.Util.getValueOfInt(n[t].BankAccountId)+">"+VIS.Utility.encodeText(n[t].AccountNo)+"<\/option>");h.prop("selectedIndex",0);pf>0&&(h.val(pf).prop("selected",!0),pf=0);a.getMaxStatement("LO");a.loadSearchPaymentMethod()}t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetBankAccount",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{bankId:gi.val()},success:function(i){i!=null&&i!=""&&(i=t.parseJSON(i),n(i))}})},SetBankAccountOrganizationInContext:function(n){VIS.Env.getCtx().setContext($self.windowNo,"BankAccount_Org_ID",n)},LoadPaymentsPages:function(n,i,r){ir=si.val()!=null&&si.val()!=""?!0:!1;t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadPaymentsPages",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_accountID:n,_paymentPageNo:nr,_PAGESIZE:ae,_paymentMethodID:i,_transactionType:r,businessPartnerId:hu.value,txtSearch:_txtSearchPayment.val()},success:function(n){n!=null&&n!=""&&(of=JSON.parse(n))}})},loadPayments:function(n,i,r,u){function e(n){var u,i,f,e;if(n=t.parseJSON(n),n.length>0&&(storepaymentdata=storepaymentdata.concat(n)),n=storepaymentdata,u="",ui.html(""),n!=null&&n.length>0)for(i=0;i<n.length;i++)f=new Date(n[i].DateAcct).toLocaleDateString(),e="va012-red-color",e=n[i].c_bankstatementline_id==null||n[i].c_bankstatementline_id=="0"||n[i].c_bankstatementline_id==0?"va012-red-color":"va012-green-color",u="",u='<div class="drag-no-drag"><div draggable="true" class="va012-mid-data-wrap ',(r=="PY"||r=="CO")&&(u+=e),u+=' " paymentdata="'+VIS.Utility.encodeText(new Date(n[i].DueDate).toLocaleDateString())+"_"+VIS.Utility.encodeText(n[i].DueAmt)+'" data-uid="'+n[i].c_payment_id,u+=' " paymentamount = " '+VIS.Utility.Util.getValueOfDecimal(n[i].convertedamount,"N")+'" paymentmethodid="'+VIS.Utility.Util.getValueOfInt(n[i].PaymentMethodId)+'" paymentbasetype="'+VIS.Utility.Util.getValueOfString(n[i].PaymentBaseType)+'"><div class="va012-payment-wrap" ><div class="row"> <div class="col-md-3 col-sm-3">    <div class="va012-form-check">        <input type="checkbox" data-uid="'+n[i].c_payment_id+'"  >    <div title="'+VIS.Msg.getMsg("VA012_PaymentAmount")+'" class="va012-inside-form-check" style=" float: left; width: 85%; ">      <label style=" width: 100%; ">'+n[i].currency+" "+parseFloat(n[i].paymentamount).toLocaleString(navigator.language,{minimumFractionDigits:b,maximumFractionDigits:b})+"<\/label>",n[i].isconverted=="Y"&&(u+="      <span>"+n[i].basecurrency+" "+parseFloat(n[i].convertedamount).toLocaleString(navigator.language,{minimumFractionDigits:b,maximumFractionDigits:b})+"<\/span>"),u+='   <\/div><\/div>    <!-- end of form-group -->  <\/div>  <!-- end of col -->  <div class="col-md-4 col-sm-4">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Business Partner">'+VIS.Utility.encodeText(n[i].businesspartner)+'<\/p>         <span title="'+VIS.Msg.getMsg("VA012_InvReference")+'">'+VIS.Utility.encodeText(n[i].bpgroup)+'<\/span>       <span title="Document No.">'+VIS.Utility.encodeText(n[i].paymentno)+'<\/span>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col --> <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text"><p title="Payment Type">'+VIS.Utility.encodeText(n[i].paymenttype)+"<\/p><\/div><\/div><!-- end of form-group --><\/div><!-- end of col -->",u+=r=="PY"&&ro>0?'  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Deposit Slip No">'+VIS.Utility.encodeText(n[i].depositslipno)+'<\/p>           <p title="Authentication Code">'+VIS.Utility.encodeText(n[i].authcode)+'<\/p>           <p title="Account Date">'+f+'<\/p>           <p title="Payment Method">'+n[i].PaymentMethod+"<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->":'  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Authentication Code">'+VIS.Utility.encodeText(n[i].authcode)+'<\/p>           <p title="Account Date">'+f+'<\/p>           <p title="Payment Method">'+n[i].PaymentMethod+"<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->",u+="<\/div><!-- end of row --><\/div> <!-- end of payment-wrap --><\/div> <!-- end of mid-data-wrap -->",ui.append(u);_sql=null;a.setPaymentListHeight();a.dragPayments()}if(n>0){ni(t(af),!0,"inherit");var f=ts();window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadPayments",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_accountID:n,_paymentPageNo:nr,_PAGESIZE:le,_paymentMethodID:i,_transactionType:r,statementDate:u==null||u==""?new Date:u,businessPartnerId:hu.value,txtSearch:f},success:function(n){n!=null&&n!=""&&(e(n),ni(t(af),!1,"inherit"))},error:function(){ni(t(af),!1,"inherit")}})},2)}},setPaymentListHeight:function(){var n;clearTimeout(n);n=setTimeout(function(){t("#VA012-content-area"+$self.windowNo).height(t("#VA012_mainContainer_"+$self.windowNo).height()-20);bt.attr("activestatus")=="1"?t("#VA012_paymentList_"+$self.windowNo).height(t("#VA012_middleWrap_"+$self.windowNo).height()-t("#VA012_formBtnNewRecord_"+$self.windowNo).height()-t("#VA012_formNewRecord_"+$self.windowNo).height()-t("#VA012_paymentHeaderWrap_"+$self.windowNo).height()-42):t("#VA012_paymentList_"+$self.windowNo).height(t("#VA012_middleWrap_"+$self.windowNo).height()-t("#VA012_formBtnNewRecord_"+$self.windowNo).height()-t("#VA012_paymentHeaderWrap_"+$self.windowNo).height()-27)},2)},loadSearchPaymentMethod:function(){function n(n){if(cu=n,pt.html(""),pt.append("<option value=0 >"+VIS.Msg.getMsg("VA012_SelectPaymentMethod")+"<\/option>"),n!=null)for(var t=0;t<n.length;t++)pt.append("<option value="+n[t].chargeID+">"+VIS.Utility.encodeText(n[t].name)+"<\/option>");pt.prop("selectedIndex",0);h.trigger("change")}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetPaymentMethods",null,n)},paymentScroll:function(){of=0;t(this).scrollTop()+t(this).innerHeight()+2>=this.scrollHeight&&(a.LoadPaymentsPages(h.val(),pt.val(),ct.val()),nr<of&&(nr++,a.loadPayments(h.val(),pt.val(),ct.val(),yt.val())))},statementScroll:function(){ke=0;t(this).scrollTop()>0&&t(this).scrollTop()+t(this).innerHeight()+1>=this.scrollHeight&&(it.LoadStatementsPages(),vi<ke&&(vi++,it.loadStatement(hi)))},dragPayments:function(){ui.find(".va012-mid-data-wrap").draggable({start:function(n,t){t.helper.addClass("va012-dragging")},drag:function(){},stop:function(n,t){t.helper.removeClass("va012-dragging")},cursor:"move",cursorAt:{left:5},revert:"invalid",helper:"clone"})},dropPayments:function(){vt.find(".va012-right-data-wrap").droppable({hoverClass:"va012-dropping",drop:function(n,s){var v,g,h,l,w,k,p;if(t(s.draggable).data("uid")>0&&t(this).data("uid")>0){if(ct.val()=="PY"){if(v=t(s.draggable).data("uid"),t(s.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_PaymentAlreadyMatchedOthrStatement",null,"","");return}di=VIS.Utility.Util.getValueOfString(t(s.draggable).attr("paymentbasetype"));nu=VIS.Utility.Util.getValueOfInt(t(s.draggable).attr("paymentmethodid"));p=t(this).data("uid");a.checkPaymentCondition(t(s.draggable).data("uid"),t(this).data("uid"),r(i.getControl().val()))&&(it.statementOpenEdit(t(this).data("uid"),v),window.setTimeout(function(){if(r(c.getControl().val())==0){var n=nt.val();u.refreshForm();nt.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}nt.attr("readonly",!0);ii=!0;tt.setValue(v,!1,!0);y.val()>0?y.attr("disabled",!0):y.attr("disabled",!1);a.setInvoiceAndBPartner(t(s.draggable).data("uid"),"PY");ii=!1},500))}else if(ct.val()=="IS"){if(g=t(s.draggable).data("uid"),parseInt(f.attr("data-uid"))!=t(this).data("uid")&&u.scheduleRefresh(),di=VIS.Utility.Util.getValueOfString(t(s.draggable).attr("paymentbasetype")),nu=VIS.Utility.Util.getValueOfInt(t(s.draggable).attr("paymentmethodid")),a.checkScheduleCondition(t(s.draggable).data("uid"),t(this).data("uid"),d.toString(),r(i.getControl().val()))){if(fe(parseInt(t(s.draggable).data("uid")),d))VIS.ADialog.info("VA012_AlreadySelected",null,"","");else if(d.push(parseInt(t(s.draggable).data("uid"))),wi.push(t(s.draggable).attr("paymentdata")),lt.push(t(s.draggable).attr("paymentamount")),Number(lt[0])=="0"){for(h=0,l=0;l<lt.length;l++)h+=VIS.Utility.Util.getValueOfDecimal(lt[l]);h<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"));i.setValue(VIS.Utility.Util.getValueOfDecimal(h.toFixed(b)))}ii=!0;it.statementOpenEdit(t(this).data("uid"),g);tr.val(wi.toString());window.setTimeout(function(){if(r(c.getControl().val())==0){var n=nt.val();u.refreshForm();u.scheduleRefresh();nt.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}a.setInvoiceAndBPartner(t(s.draggable).data("uid"),"IS");nt.attr("readonly",!0);lt.length==1&&(lt[0]=VIS.Utility.Util.getValueOfString(r(c.getControl().val())));c.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())])},500)}}else ct.val()=="PO"&&(w=t(s.draggable).data("uid"),parseInt(f.attr("data-uid"))!=t(this).data("uid")&&u.prepayRefresh(),di=VIS.Utility.Util.getValueOfString(t(s.draggable).attr("paymentbasetype")),nu=VIS.Utility.Util.getValueOfInt(t(s.draggable).attr("paymentmethodid")),a.checkPrepayCondition(t(s.draggable).data("uid"),t(this).data("uid"),eu.toString(),r(i.getControl().val()))&&(it.statementOpenEdit(t(this).data("uid"),w),window.setTimeout(function(){if(r(c.getControl().val())==0){var n=nt.val();u.refreshForm();u.prepayRefresh();nt.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}nt.attr("readonly",!0);ii=!0;st.setValue(w,!1,!0);ii=!1;a.setInvoiceAndBPartner(t(s.draggable).data("uid"),"PO")},500)));if(ct.val()=="CO"){if(k=t(s.draggable).data("uid"),t(s.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_CashLineAlreadyMatchedOthrStmt",null,"","");return}di=VIS.Utility.Util.getValueOfString(t(s.draggable).attr("paymentbasetype"));nu=VIS.Utility.Util.getValueOfInt(t(s.draggable).attr("paymentmethodid"));p=t(this).data("uid");a.checkContraCondition(t(s.draggable).data("uid"),t(this).data("uid"),r(i.getControl().val()))&&(it.statementOpenEdit(p,k),window.setTimeout(function(){if(r(c.getControl().val())==0){var n=nt.val();u.refreshForm();nt.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}nt.attr("readonly",!0);ii=!0;et.setValue(k,!1,!0);ii=!1},500))}}}});f.droppable({hoverClass:"va012-dropping",drop:function(n,u){var f,w,s,v,k,y,g;if(t(u.draggable).data("uid")>0){if(di=VIS.Utility.Util.getValueOfString(t(u.draggable).attr("paymentbasetype")),nu=VIS.Utility.Util.getValueOfInt(t(u.draggable).attr("paymentmethodid")),ct.val()=="CO")if(p.val()=="C"){if(ot.val()!="CB"){VIS.ADialog.info("VA012_ContraSelectCashToBank",null,"","");return}}else{VIS.ADialog.info("VA012_SelectVoucherContra",null,"","");return}else if(p.val()!="M"){VIS.ADialog.info("VA012_SelectVoucherPayment",null,"","");return}if(ct.val()=="PY"){if(t(u.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_PaymentAlreadyMatchedOthrStatement",null,"","");return}if(t(u.draggable).data("uid")>0)if(VIS.Utility.Util.getValueOfInt(ri)==0)tt.setValue(t(u.draggable).data("uid"),!1,!0);else{VIS.Utility.Util.getValueOfInt(ri)==VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid"))?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"","");return}}if(ct.val()=="IS"&&a.checkScheduleCondition(t(u.draggable).data("uid"),t(this).attr("data-uid"),"",r(i.getControl().val()))){if(s=0,fe(parseInt(t(u.draggable).data("uid")),d)){VIS.ADialog.info("VA012_AlreadySelected",null,"","");return}if(f=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetConvtAmount",{recordID:parseInt(t(u.draggable).data("uid")),bnkAct_Id:h.val(),transcType:ct.val(),stmtDate:nt.val()}),f.length==0||f[0].DueAmount==0){VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}if(w=t(this).attr("data-uid"),d.push(parseInt(t(u.draggable).data("uid"))),wi.push(t(u.draggable).attr("paymentdata")),lt.push(f[0].DueAmount),s=0,Number(lt.length)>0)for(v=0;v<lt.length;v++)s+=VIS.Utility.Util.getValueOfDecimal(lt[v]);s<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),s>0&&i.getControl().removeClass("va012-mandatory"));w==0?i.setValue(VIS.Utility.Util.getValueOfDecimal(s.toFixed(b))):nt.attr("readonly",!0);a.setInvoiceAndBPartner(t(u.draggable).data("uid"),"IS");!dr&&pi?(t(l[0]).children("option").each(function(){t(this).attr("paymentbasetype")=="S"?t(this).show():t(this).hide()}),k=l.val(),k=="0"?di=="S"&&(l.val(f[0]._paymentMethod_Id).prop("selected",!0),l.removeClass("va012-mandatory")):(y=VIS.Utility.Util.getValueOfString(t("option:selected",l).attr("paymentbasetype")),y=="S"?di==y&&(l.val(f[0]._paymentMethod_Id).prop("selected",!0),l.removeClass("va012-mandatory")):(l.val(0).prop("selected",!0),l.attr("disabled",!1),l.addClass("va012-mandatory")))):f[0]._paymentMethod_Id?l.val(f[0]._paymentMethod_Id).prop("selected",!0):l.val(0).prop("selected",!0);pi||l.trigger("change");tr.val(wi.toString());c.setValue(VIS.Utility.Util.getValueOfDecimal(s.toFixed(b)));c.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]);g=d!=null?d.toString():null;hf(g)}if(ct.val()=="PO"){if(VIS.Utility.Util.getValueOfInt(kt)!=0){VIS.Utility.Util.getValueOfInt(kt)==VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid"))?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"","");return}st.setValue(t(u.draggable).data("uid"),!1,!0)}if(ct.val()=="CO"&&t(u.draggable).data("uid")>0){if(t(u.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_CashLineAlreadyMatchedOthrStmt",null,"","");return}if(VIS.Utility.Util.getValueOfInt(oi)!=0){VIS.Utility.Util.getValueOfInt(oi)==VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid"))?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"","");return}if(a.checkContraCondition(t(u.draggable).data("uid"),t(this).attr("data-uid"),r(i.getControl().val()))){if(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))==0){VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}c.setValue(r(i.getControl().val()));i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]);et.setValue(t(u.draggable).data("uid"),!1,!0)}}}ii=!1}})},checkFormPaymentCondition:function(n,u){var f=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckFormPaymentCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_paymentID:n,_amount:u},success:function(n){n=t.parseJSON(n);n._status=="Success"?(f=!0,n._amount!=null&&n._amount!=0&&(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(b))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0")))):(VIS.ADialog.info(n._status,null,"",""),f=!1)},error:function(){VIS.ADialog.info("error",null,"","");f=!1}}),f},checkFormPrepayCondition:function(n,u){var s=0,f;return ht.value&&(s=ht.value),f=!1,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckFormPrepayCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_orderID:n,_amount:u,_currencyId:at,_formBPartnerID:s},success:function(n){n=t.parseJSON(n);n._status=="Success"?(f=!0,n._amount>0&&(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(b))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0")))):(VIS.ADialog.info(n._status,null,"",""),f=!1)},error:function(){VIS.ADialog.info("error",null,"","");f=!1}}),f},checkInvoiceCondition:function(n,i){var r=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckInvoiceCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_invoiceID:n,_amount:i},success:function(n){n=t.parseJSON(n);n=="Success"?r=!0:(VIS.ADialog.info(n,null,"",""),r=!1)},error:function(){VIS.ADialog.info("error",null,"","");r=!1}}),r},checkPaymentCondition:function(n,a,v){var p=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckPaymentCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:a,_amount:v,statmtDate:nt.val(),accountID:h.val()},success:function(n){if(n=t.parseJSON(n),n._status=="Success")if(p=!0,n._amount!=null&&n._amount!=0){if(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(b))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"),i.getControl().addClass("va012-mandatory"),c.getControl().addClass("va012-mandatory")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),i.getControl().removeClass("va012-mandatory"),c.getControl().removeClass("va012-mandatory")),c.setValue(VIS.Utility.Util.getValueOfDecimal(n._trxamount.toFixed(b))),n._currency_Id!=0&&VIS.Utility.Util.getValueOfString(tt.value)!=null){s.val(at).prop("selected",!0);for(var h=0;s[0].length>h;h++)VIS.Utility.Util.getValueOfInt(s[0][h].value)==at?t(s[0][h]).show():t(s[0][h]).hide();s.removeClass("va012-mandatory");s.attr("disabled",!1);t(y[0][0]).hide();y.val(n._conversionType_Id).prop("selected",!0);y.attr("disabled",!0)}else s.val(at).prop("selected",!0),s.attr("disabled",!0),s.removeClass("va012-mandatory"),y.val(n._conversionType_Id).prop("selected",!0);y.trigger("change");n._paymentMethod_Id?(l.val(n._paymentMethod_Id).prop("selected",!0),l.attr("disabled",!0),l.removeClass("va012-mandatory")):l.addClass("va012-mandatory");n._checkNo&&(sr.show(),g.val(n._checkNo),g.attr("disabled",!0),g.removeClass("va012-mandatory"));n._checkDate&&(hr.show(),ft.val(Globalize.format(new Date(n._checkDate),"yyyy-MM-dd")),ft.attr("disabled",!0),ft.removeClass("va012-mandatory"))}else if(n._checkNo&&VIS.Utility.Util.getValueOfString(g.val()).equals("")&&(sr.show(),g.val(n._checkNo),g.attr("disabled",!1),g.removeClass("va012-mandatory")),a==0&&v!=0){if(f[0].attributes["data-uid"].value>0&&(a=f[0].attributes["data-uid"].value),tt!=null&&tt.value>0&&a>0)return it.statementListRecordEdit(a,tt.value,!0),nt.attr("readonly",!0),p=!0}else a==0&&(u.refreshForm(),VIS.ADialog.info("VA012_ConversionRateNotFound",null,"",""),p=!1);else VIS.ADialog.info(n._status,null,"",""),p=!1},error:function(){VIS.ADialog.info("error",null,"","");p=!1}}),p},checkScheduleCondition:function(n,i,r,u){var e,f;if(at==null||at==0){VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"","");return}return e=0,ht.value&&(e=ht.value),f=!1,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckScheduleCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:i,_listToCheck:r,_amount:u,_currencyId:at,_formBPartnerID:e},success:function(n){n=t.parseJSON(n);n=="Success"?f=!0:(VIS.ADialog.info(n,null,"",""),f=!1)},error:function(){VIS.ADialog.info("error",null,"","");f=!1}}),f},checkScheduleTotal:function(n,i,r){var u=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckScheduleTotal",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_listToCheck:n,_amount:i,_currencyId:at,_destinationID:r},success:function(n){n=t.parseJSON(n);n=="Success"?u=!0:(VIS.ADialog.info(n,null,"",""),u=!1)},error:function(){VIS.ADialog.info("error",null,"","");u=!1}}),u},checkPrepayCondition:function(n,u,h,c){var v=0,a,p;return ht.value&&(v=ht.value),a=!1,p=u,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckPrepayCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:u,_listToCheck:h,_amount:c,_currencyId:at,_formBPartnerID:v,stateDate:nt.val()},success:function(h){if(h=t.parseJSON(h),h._status=="Success")if(a=!0,h._amount!=0){if(i.setValue(VIS.Utility.Util.getValueOfDecimal(h._amount.toFixed(b))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),r(i.getControl().val())>0&&i.getControl().removeClass("va012-mandatory")),h._currency_Id!=0&&VIS.Utility.Util.getValueOfString(st.value)!=null){s.val(h._currency_Id).prop("selected",!0);for(var v=0;s[0].length>v;v++)VIS.Utility.Util.getValueOfInt(s[0][v].value)==h._currency_Id||VIS.Utility.Util.getValueOfInt(s[0][v].value)==at?t(s[0][v]).show():t(s[0][v]).hide();s.removeClass("va012-mandatory");s.attr("disabled",!1);t(y[0][0]).hide();y.val(h._conversionType_Id).prop("selected",!0);y.attr("disabled",!1)}else s.val(at).prop("selected",!0),s.attr("disabled",!0),s.removeClass("va012-mandatory"),y.val(h._conversionType_Id).prop("selected",!0);y.trigger("change");h._paymentMethod_Id?(l.val(h._paymentMethod_Id).prop("selected",!0),l.attr("disabled",!1)):(l.val(0).prop("selected",!0),l.attr("disabled",!1));l.trigger("change")}else{if(u==0&&c!=0&&(f[0].attributes["data-uid"].value>0&&(u=f[0].attributes["data-uid"].value),n>0&&u>0))return it.statementListRecordEdit(u,n,!0),nt.attr("readonly",!0),a=!0;a=p>0?!0:!1}else VIS.ADialog.info(h._status,null,"",""),a=!1},error:function(){VIS.ADialog.info("error",null,"","");a=!1}}),a},checkContraCondition:function(n,u,h){var l=0,c;return ht.value&&(l=ht.value),c=!1,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckContraCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:u,_amount:h,_currencyId:at,_formBPartnerID:l,stateDate:nt.val()},success:function(l){if(l=t.parseJSON(l),l._status=="Success")if(c=!0,i.setValue(VIS.Utility.Util.getValueOfDecimal(l._amount.toFixed(b))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),r(i.getControl().val())>0&&i.getControl().removeClass("va012-mandatory")),l._amount!=0&&VIS.Utility.Util.getValueOfString(et.value)!=null){s.val(at).prop("selected",!0);for(var a=0;s[0].length>a;a++)VIS.Utility.Util.getValueOfInt(s[0][a].value)==at?t(s[0][a]).show():t(s[0][a]).hide();if(s.removeClass("va012-mandatory"),s.attr("disabled",!1),t(y[0][0]).hide(),y.val(l._conversionType_Id).prop("selected",!0),y.removeClass("va012-mandatory"),y.attr("disabled",!0),u==0&&h!=0&&(f[0].attributes["data-uid"].value>0&&(u=f[0].attributes["data-uid"].value),n>0&&u>0))return it.statementOpenEdit(u,n),nt.attr("readonly",!0),c=!0}else VIS.Utility.Util.getValueOfInt(u)>0?c=!0:(VIS.ADialog.info("VA012_ConversionRateNotFound",null,"",""),c=!1);else VIS.ADialog.info(l._status,null,"",""),c=!1},error:function(){VIS.ADialog.info("error",null,"","");c=!1}}),c},matchByDrag:function(n,u){var f=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/MatchByDrag",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragPaymentID:n,_dragStatementID:u},success:function(n){n=t.parseJSON(n);n._status=="Success"?(f=!0,n._amount!=null&&n._amount!=0&&(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(b))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0")),rt.trigger("focus"))):(VIS.ADialog.info(n._status,null,"",""),f=!1)},error:function(){VIS.ADialog.info("error",null,"","");f=!1}}),f},loadAndResetPaymentData:function(){ui.html("");nr=1;of=0;ae=50;eo=1;storepaymentdata=[];a.loadPayments(h.val()==null?0:h.val(),pt.val(),ct.val(),yt.val())}};this.vetoablechange=function(n){if(n.propertyName=="VA012_txtDifference_"+$self.windowNo+"")w.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(b)));else if(n.propertyName=="VA012_txtTaxAmount_"+$self.windowNo+"")wt.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(b)));else if(n.propertyName=="VA012_txtTrxAmt_"+$self.windowNo+"")c.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(b)));else if(n.propertyName=="VA012_txtAmount_"+$self.windowNo+""){var t=r(i.getControl().val());i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(t).toFixed(b)))}};it={statementDialog:function(){function p(){s=$statement.find("#VA012_STAT_cmbBank_"+$self.windowNo);r=$statement.find("#VA012_STAT_cmbBankAccount_"+$self.windowNo);e=$statement.find("#VA012_STAT_cmbBankAccountClassName_"+$self.windowNo);a=$statement.find("#VA012_STAT_statementDate_"+$self.windowNo);c=$statement.find("#VA012_STAT_txtStatementNo_"+$self.windowNo);o=$statement.find("#VA012_ctrlLoadFile_"+$self.windowNo);STAT_ctrlLoadFileTxt=$statement.find("#VA012_ctrlLoadFileTxt_"+$self.windowNo);_tabFile=$statement.find("#VA012_STAT_tabFile_"+$self.windowNo);_tabSchedule=$statement.find("#VA012_STAT_tabSchedule_"+$self.windowNo);lf=$statement.find("#VA012_STAT_cmbBankAccountClassName_"+$self.windowNo)}function w(){s.html("");s.append("<option value="+gi.val()+">"+gi.children()[gi[0].selectedIndex].text+"<\/option>");s.prop("selectedIndex",0)}function b(){r.html("");r.append("<option value="+h.val()+">"+h.children()[h[0].selectedIndex].text+"<\/option>");r.prop("selectedIndex",0)}function k(){function n(n){if(e.html(""),e.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)e.append("<option value="+n[t].Value+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");e.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetBankAccountClasses",{_cmbBankAccount:h.val()},n)}function d(){function n(n){n!=null&&(y=VIS.Utility.Util.getValueOfInt(n[0].chargeID))}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetBankCharge",null,n)}function g(){l=null;$statement=null;s=null;r=null;c=null;o=null;STAT_ctrlLoadFileTxt=null;_tabSchedule=null;_tabFile=null;i=null}var s=null,r=null,e=null,a=null,y=null,c=null,o=null,i=null,l,f;$statement=t("<div class='va012-popform-content'>");l="";l="<div><div class='va012-left-btn'><a id='VA012_STAT_tabFile_"+$self.windowNo+"' class='btn va012-blueBtn' activestatus='1'>"+VIS.Msg.getMsg("VA012_File")+"<\/a><\/div><\/div><div style='border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left;'><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_Bank")+"<\/label><select id='VA012_STAT_cmbBank_"+$self.windowNo+"' class='vis-ev-col-readonly' disabled><\/select><\/div> <div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_BankAccount")+"<\/label><select id='VA012_STAT_cmbBankAccount_"+$self.windowNo+"' class='vis-ev-col-readonly' disabled><\/select><\/div><div class=va012-popform-data><label id=VA012_STAT_lblStatementDate_"+$self.windowNo+">"+VIS.Msg.getMsg("VA012_StatementDate")+'<\/label><input type=date max="9999-12-31" class=vis-ev-col-readonly disabled id=VA012_STAT_statementDate_'+$self.windowNo+"><\/div><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_ClassName")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_STAT_cmbBankAccountClassName_'+$self.windowNo+"'><\/select><\/div><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_StatementNumber")+"<sup style=\"color: red;\">*<\/sup><\/label><input type='text' id='VA012_STAT_txtStatementNo_"+$self.windowNo+"' /> <\/div><div class='va012-popform-data va012-pop-file'><label>"+VIS.Msg.getMsg("VA012_SelectFile")+"<sup style=\"color: red;\">*<\/sup><\/label><input type='text' id='VA012_ctrlLoadFileTxt_"+$self.windowNo+"' disabled><div class='va012-file-upload'><label for='file-input' class='va012-file-label'>"+VIS.Msg.getMsg("VA012_Browse")+"<\/label><input id='VA012_ctrlLoadFile_"+$self.windowNo+"' type='file' accept='.csv,text/plain,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel'/><\/div><\/div><\/div>";$statement.append(l);p();w();b();k();a.val(Globalize.format(new Date(yt.val()),"yyyy-MM-dd"));d();f=new VIS.ChildDialog;f.setContent($statement);f.setTitle(VIS.Msg.getMsg("VA012_LoadStatement"));f.setWidth("500px");f.setEnableResize(!1);f.setModal(!0);f.show();o.on("change",function(){var u=this;r.val()!=null&&r.val()>0?(i=t.parseJSON(n.UploadExcel(u,null,null)),STAT_ctrlLoadFileTxt.val(i._orgfilename)):(o=null,VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"",""))});f.onOkClick=function(){if(si.val(""),_tabFile.attr("activestatus")=="1"){if(r.val()==null||r.val()==""||r.val()=="0")return VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"",""),!1;if(e.val()==null||e.val()==""||e.val()=="0")return VIS.ADialog.info("VA012_PleaseSelectClassFirst",null,"",""),!1;if(c.val()==null||c.val()=="")return VIS.ADialog.info("VA012_PleaseEnterStatementNo",null,"",""),!1;if(o.val()==""==null||o.val()=="")return VIS.ADialog.info("VA012_SelectFileFirst",null,"",""),!1;if(i!=null){if(i._filename==null||i._filename==""||i._path==null||i._path==""){VIS.ADialog.info("VA012_ErrorInGettingFile",null,"","");return}if(i._error!=null&&i._error!=""){VIS.ADialog.info(i._error,null,"","");return}var n=i._path,f=i._filename,s=r.val(),h=c.val(),w=$statement,l=e.val(),p=y;ni(v,!0,"absolute");window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/ImportStatement",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_path:n,_filename:f,_bankaccount:s,_bankAccountCurrency:at,_statementno:h,_statementClassName:l,_statementCharges:p,statementDate:a.val()},success:function(n){hi=n._statementID;hi!=null&&hi!=""?(ti=[],vt.html(""),vi=1,ni(v,!1,"absolute"),it.loadStatement(hi),u.refreshForm()):n._error!=null&&n._error!=""&&(ni(v,!1,"absolute"),VIS.ADialog.info(n._error,null,"",""))},error:function(){ni(v,!1,"absolute");VIS.ADialog.info("error",null,"","")}})},2)}}if(_tabSchedule.attr("activestatus")=="1")return alert("Schedule"),!1};f.onCancelClick=function(){};f.onClose=function(){g()};_tabFile.on(VIS.Events.onTouchStartOrClick,function(){_tabFile.removeClass("va012-grayBtn");_tabFile.addClass("va012-blueBtn");_tabFile.attr("activestatus","1");_tabSchedule.removeClass("va012-blueBtn");_tabSchedule.addClass("va012-grayBtn");_tabSchedule.attr("activestatus","0")});_tabSchedule.on(VIS.Events.onTouchStartOrClick,function(){_tabSchedule.removeClass("va012-grayBtn");_tabSchedule.addClass("va012-blueBtn");_tabSchedule.attr("activestatus","1");_tabFile.removeClass("va012-blueBtn");_tabFile.addClass("va012-grayBtn");_tabFile.attr("activestatus","0")})},LoadStatementsPages:function(){ir=si.val()!=null&&si.val()!=""?!0:!1;t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadStatementsPages",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_cmbBankAccount:h.val(),_txtSearch:si.val(),_statementPageNo:vi,_PAGESIZE:le,_SEARCHREQUEST:ir},success:function(n){n!=null&&n!=""&&(ke=JSON.parse(n))}})},loadStatement:function(){if(ir=si.val()!=null&&si.val()!=""?!0:!1,h.val()>0){ni(t(vt),!0,"inherit");window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadConciledOrUnConciledStatements",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_cmbBankAccount:h.val(),_txtSearch:si.val(),_currencyID:at!=null?at:0,_searchRequest:ir},success:function(n){var r=t.parseJSON(n);i(r);ni(t(vt),!1,"inherit")},error:function(){ni(t(vt),!1,"inherit")}})},2);function i(n){n!=null&&n.length>0?(vu.html(""),au.html(""),au.append("<p>"+VIS.Msg.getMsg("VA012_Reconciled")+"<\/p><p style='margin-top: 4px;'>"+VIS.Msg.getMsg("VA012_Unreconciled")+"<\/p>"),vu.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>"+n[0].basecurrency+"<\/span> "+parseFloat(n[0].reconciled).toLocaleString(navigator.language,{minimumFractionDigits:b,maximumFractionDigits:b})+"<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'> <span class='va012-base-curr'>"+n[0].basecurrency+"<\/span> "+parseFloat(n[0].unreconciled).toLocaleString(navigator.language,{minimumFractionDigits:b,maximumFractionDigits:b})+"<\/span>")):(vu.html(""),au.html(""),au.append("<p>"+VIS.Msg.getMsg("VA012_Reconciled")+"<\/p><p style='margin-top: 4px;'>"+VIS.Msg.getMsg("VA012_Unreconciled")+"<\/p>"),vu.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>"+tf+"<\/span> 0<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'><span class='va012-base-curr'>"+tf+"<\/span> 0<\/span>"));it.setStatementListHeight()}var n="va012-red-color";window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadStatements",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_cmbBankAccount:h.val(),_txtSearch:si.val(),_statementPageNo:vi,_PAGESIZE:le,_SEARCHREQUEST:ir},success:function(n){n!=null&&n!=""&&(r(n),ni(t(vt),!1,"inherit"))},error:function(){ni(t(vt),!1,"inherit")}})},2);function r(i){var u,r;if(i=t.parseJSON(i),u="",i!=null&&i.length>0)for(r=0;r<i.length;r++)u="",n=i[r].docstatus=="CO"||i[r].docstatus=="CL"||i[r].docstatus=="RE"?"va012-gray-color":i[r].c_payment_id==null||i[r].c_payment_id=="0"||i[r].c_payment_id==0?i[r].c_cashline_id!=null&&i[r].c_cashline_id!="0"&&i[r].c_cashline_id!=0?"va012-green-color":i[r].c_charge_id!=null&&i[r].c_charge_id!="0"&&i[r].c_charge_id!=0?i[r].STMTAMT==i[r].trxamount?"va012-green-color":"va012-red-color":(i[r].c_charge_id==null||i[r].c_charge_id=="")&&(i[r].trxno==null||i[r].trxno=="")?"va012-red-color":"va012-red-color":"va012-green-color",u='<div  data-uid="'+i[r].c_bankstatementline_id+'" class="va012-right-data-wrap '+n+'"><div class="va012-statement-wrap"><div class="va012-fl-padd"><div class="col-md-4 col-sm-4 va012-padd-0"><div class="va012-form-check"> <input type="checkbox" data-uid="'+i[r].c_bankstatementline_id+'" > <div class="va012-form-text"> <span style="background: rgba(var(--v-c-on-secondary), .4);color: rgba(var(--v-c-on-primary), 1); padding: 3px;margin-left: 2px;">'+i[r].statementno+"/"+i[r].page+"/"+i[r].line+"<\/span><label>"+new Date(i[r].stmtLineDate).toLocaleDateString()+"<\/label><label>"+i[r].currency+" "+parseFloat(i[r].trxamount).toLocaleString(navigator.language,{minimumFractionDigits:b,maximumFractionDigits:b})+"<\/label>",u+=i[r].trxno==""||i[r].trxno==null?'<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p>'+VIS.Utility.encodeText(i[r].description)+'<\/p> <span title="'+VIS.Msg.getMsg("VA012_CheckNo")+'">'+VIS.Utility.encodeText(i[r].EftCheckNo)+'<\/span><span title="'+VIS.Msg.getMsg("DocumentNo")+'">'+VIS.Utility.encodeText(i[r].invoiceno)+'<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="'+i[r].c_bankstatementline_id+'" class="glyphicon glyphicon-edit" title='+VIS.Msg.getMsg("EditRecord")+'><\/span> <span data-uid="'+i[r].c_bankstatementline_id+'" class="glyphicon glyphicon-zoom-in" title='+VIS.Msg.getMsg("ZoomToRecord")+'><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0 va012-width-xs"><div class="va012-form-data">':'<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p>'+VIS.Utility.encodeText(i[r].description)+"<\/p> <span>"+VIS.Utility.encodeText(i[r].bpgroup)+"<\/span><span>"+VIS.Utility.encodeText(i[r].invoiceno)+'<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p>'+VIS.Utility.encodeText(i[r].trxno)+'<\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="'+i[r].c_bankstatementline_id+'" class="glyphicon glyphicon-edit"><\/span> <span data-uid="'+i[r].c_bankstatementline_id+'" class="glyphicon glyphicon-zoom-in"><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0 va012-width-xs"><div class="va012-form-data">',u+=" <\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <\/div> <!-- end of row --><\/div><!-- end of payment-wrap --><\/div><!-- end of right-data-wrap -->",vt.append(u);_sql=null;it.setStatementListHeight();a.dropPayments()}}},setStatementListHeight:function(){var n=t("#VA012_mainContainer_"+$self.windowNo).height();n==0&&(n=window.innerHeight-107);t("#VA012_contentArea_"+$self.windowNo).height(n-20);t("#VA012_lstStatement_"+$self.windowNo).height(t("#VA012_rightWrap_"+$self.windowNo).height()-t("#VA012_rightTop_"+$self.windowNo).height()-18)},statementOpenEdit:function(n,t){return bt.attr("activestatus","1"),bt.attr("src","Areas/VA012/Images/hide.png"),bt.attr("title","Collapse"),bt.removeClass("vis vis-plus"),bt.addClass("fa fa-minus"),f.show(),a.setPaymentListHeight(),it.statementListRecordEdit(n,t,!0),n=0,!0},statementListEdit:function(n){var i=t(n.target),r=0;i.hasClass("glyphicon-edit")&&(r=i.data("uid"),bt.attr("activestatus","1"),bt.attr("src","Areas/VA012/Images/hide.png"),bt.attr("title","Collapse"),f.show(),bt.removeClass("vis vis-plus"),bt.addClass("fa fa-minus"),a.setPaymentListHeight(),u.scheduleRefresh(),u.prepayRefresh(),rr=!0,it.statementListRecordEdit(r,0,!0),r=0,a.addEffect(i,f))},openStatement:function(n){var u=t(n.target),r=0,i;if(u.hasClass("glyphicon glyphicon-zoom-in")){r=u.data("uid");try{te>0&&(i=new VIS.Query,i.addRestriction("C_BankStatementLine_ID",VIS.Query.prototype.EQUAL,r),i.setRecordCount(1),VIS.viewManager.startWindow(te,i))}catch(n){console.log(n)}r=0}},selectedStatementLinesList:function(n){var i=t(n.target);n.target.type=="checkbox"&&(i.is(":checked")&&(_bankStatementLineID=parseInt(i.data("uid")),ti.push(_bankStatementLineID),_bankStatementLineID=0),i.is(":checked")||(_bankStatementLineID=parseInt(i.data("uid")),ti.splice(ti.indexOf(_bankStatementLineID),1),_bankStatementLineID=0))},statementListRecordEdit:function(n,t,i){VIS.Utility.Util.getValueOfInt(t)==0&&u.refreshForm(i);it.getStatementLineForEdit(n,t,it.afterRecordGet,i)},selectedScheduleList:function(n){var i=t(n.target);n.target.type=="checkbox"&&(i.is(":checked"),!i.is(":checked"))},getStatementLineForEdit:function(n,i,r,u){t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/GetStatementLine",contentType:"application/json; charset=utf-8",data:JSON.stringify({_bankStatementLineID:n,trxType:ct.val(),payment_ID:i!=null?i:0}),success:function(n){r(n,u)},error:function(n){VIS.ADialog.info(n,null,"","")}})},afterRecordGet:function(n,u){var h,it,lt,a,vt,v;if(n!=null&&n!=""){if(h=t.parseJSON(n),f.attr("data-uid",h._bankStatementLineID),gt.val(h._txtStatementNo),ci.val(h._txtStatementPage),fr.val(h._txtStatementLine),nt.val(Globalize.format(new Date(h._dtStatementDate),"yyyy-MM-dd")),h._cmbVoucherMatch!=null&&h._cmbVoucherMatch!=""?p.val(h._cmbVoucherMatch).prop("selected",!0):p.prop("selectedIndex",0),ct.val()=="CO"&&p.val("C").prop("selected",!0),p.trigger("change"),h._cmbContraType!=null&&h._cmbContraType!=""?ot.val(h._cmbContraType).prop("selected",!0):ot.prop("selectedIndex",0),p.val()!=null&&p.val()!=""&&ot.val()!=null&&ot.val()!=""&&(ot.val("CB").prop("selected",!0),ot.trigger("change")),ur.val(h._cmbCashBook).prop("selected",!0),su.val(h._txtCheckNo),i.setValue(VIS.Utility.Util.getValueOfDecimal(h._txtAmount.toFixed(b))),c.setValue(VIS.Utility.Util.getValueOfDecimal(h._txtTrxAmt.toFixed(b))),r(i.getControl().val())<=0?i.getControl().addClass("va012-mandatory"):i.getControl().removeClass("va012-mandatory"),h._reconciled&&(i.getControl().attr("disabled",!0),dr=h._reconciled),r(c.getControl().val())<=0?c.getControl().addClass("va012-mandatory"):c.getControl().removeClass("va012-mandatory"),(p.val()=="M"||p.val()=="C")&&r(c.getControl().val())!=0&&(it=VIS.Utility.Util.getValueOfDecimal(h._txtDifference.toFixed(b)),w.setValue(it),w.getControl().trigger("blur"),h._txtDifference<0?(w.getControl().addClass("va012-mandatory"),t("#Ast_Difference_"+$self.windowNo).show()):(w.getControl().removeClass("va012-mandatory"),t("#Ast_Difference_"+$self.windowNo).hide()),p.val()=="C"&&p.trigger("change")),h._cmbDifferenceType!=null&&h._cmbDifferenceType!=""?(yi.find("*").prop("disabled",!1),k.val(h._cmbDifferenceType).prop("selected",!0)):k.prop("selectedIndex",0),k.trigger("change"),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0")),lr.val(h._txtVoucherNo),yu.val(h._txtDescription),or.val(h._cmbCharge).prop("selected",!0),rt.val(h._txtCharge),rt.attr("chargeid",h._cmbCharge),VIS.Utility.Util.getValueOfInt(h._cmbCharge)==0&&h._cmbDifferenceType!=""&&h._cmbDifferenceType!=null?rt.addClass("va012-mandatory"):rt.removeClass("va012-mandatory"),ut.val(h._cmbTaxRate).prop("selected",!0),VIS.Utility.Util.getValueOfInt(h._cmbTaxRate)==0&&h._cmbDifferenceType!=""&&h._cmbDifferenceType!=null?ut.addClass("va012-mandatory"):ut.removeClass("va012-mandatory"),wt.setValue(VIS.Utility.Util.getValueOfDecimal(h._txtTaxAmount.toFixed(b))),wu.prop("checked",h._chkUseNextTime),h._ctrlCashLine>0?(et.setValue(h._ctrlCashLine,!1,!0),rr=!1):ii||(et.setValue(),h._ctrlPayment<=0&&(rr=!1)),tt&&tt.value>0&&h._ctrlPayment==0&&(h._ctrlPayment=tt.value),h._ctrlPayment>0?(tt.setValue(h._ctrlPayment,!1,!0),lr.val()==""&&(lt=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetTrxNoforVoucher",{_ctrlPayment:h._ctrlPayment}),lr.val(lt)),rr=!1):ii||(tt.setValue(),rr=!1),h._ctrlOrder>0?(ii=!0,st.setValue(h._ctrlOrder,!1,!0),ii=!1):ii||st.setValue(),h._ctrlBusinessPartner>0?ht.setValue(h._ctrlBusinessPartner,!1,!0):ii||ht.setValue(),h._ctrlTrxOrg>0?ki.setValue(h._ctrlTrxOrg,!1,!0):ii||ki.setValue(),h._ctrlInvoice>0?dt.setValue(h._ctrlInvoice,!1,!0):!ii&&u&&dt.setValue(),h._txtCurrency!=0){for(s.val(h._txtCurrency).prop("selected",!0),a=0;s[0].length>a;a++)VIS.Utility.Util.getValueOfInt(s[0][a].value)==h._txtCurrency||VIS.Utility.Util.getValueOfInt(s[0][a].value)==at?t(s[0][a]).show():t(s[0][a]).hide();s.removeClass("va012-mandatory");s.attr("disabled",!1)}h._txtConversionType==0?y.attr("disabled",!1):(y.val(h._txtConversionType).prop("selected",!0),y.removeClass("va012-mandatory"),h._ctrlPayment>0?y.attr("disabled",!0):h._ctrlCashLine>0?y.attr("disabled",!0):(y.attr("disabled",!1),t(y[0][0]).hide()));VIS.Utility.Util.getValueOfDecimal(h._txtDifference.toFixed(b))!=0&&(d.length==0||d.length>0&&f.attr("data-uid")!=0&&Math.abs(r(c.getControl().val()))<Math.abs(r(i.getControl().val())))&&(VIS.Utility.Util.getValueOfInt(st.value)==0&&f.attr("data-uid")==0||f.attr("data-uid")!=0)&&(k.find("option[value=0]").prop("disabled",!0),k.find("option[value=OU]").prop("disabled",!0),k.find("option[value=DA]").prop("disabled",!0),k.find("option[value=WO]").prop("disabled",!0));rt.trigger("focus");h._txtPaymentMethod?dr||h._autoCheckControlled||!h._txtCheckNum?(t(l[0]).find("option").show(),l.val(h._txtPaymentMethod).prop("selected",!0),l.removeClass("va012-mandatory"),h._ctrlPayment?l.attr("disabled",!0):l.attr("disabled",!1)):(t(l[0]).children("option").each(function(){t(this).attr("paymentbasetype")=="S"?t(this).show():t(this).hide()}),vt=l.val(),vt=="0"?(di=="S"||di==null)&&(l.val(h._txtPaymentMethod).prop("selected",!0),l.removeClass("va012-mandatory"),h._ctrlPayment?l.attr("disabled",!0):l.attr("disabled",!1)):(v=VIS.Utility.Util.getValueOfString(t("option:selected",l).attr("paymentbasetype")),v=="S"?di==v&&(l.val(h._txtPaymentMethod).prop("selected",!0),l.removeClass("va012-mandatory"),h._ctrlPayment?l.attr("disabled",!0):l.attr("disabled",!1)):(l.val(0).prop("selected",!0),l.attr("disabled",!1),l.addClass("va012-mandatory")))):(t(l[0]).find("option").show(),l.val(0).prop("selected",!0),l.attr("disabled",!1),l.addClass("va012-mandatory"));h._txtCheckDate?(ft.val(Globalize.format(new Date(h._txtCheckDate),"yyyy-MM-dd")),ft.removeClass("va012-mandatory"),dr||h._autoCheckControlled?(lu=null,ft.attr("disabled",!1)):(lu=ft.val(),ft.attr("disabled",!0))):(lu=null,ft.val(h._txtCheckDate),ft.addClass("va012-mandatory"),ft.attr("disabled",!1));g.val(h._txtCheckNum);h._txtCheckNum?(sr.show(),g.attr("disabled",!0),g.removeClass("va012-mandatory"),hr.show(),uo=h._txtCheckNum,dr||h._autoCheckControlled?(cr=!1,pi=null):(cr=!0,pi=h._txtCheckNum)):(cr=!1,pi=null,l.trigger("change"))}},matchStatementDialog:function(){function p(){function n(n){if(e.html(""),e.append("<option value=0 >-<\/option>"),n!=null)for(var t=0;t<n.length;t++)e.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].Value)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>")}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/LoadStatementNo",{_cmbBankAccount:h.val()},n)}function w(){function n(n){if(o.html(""),o.append("<option value=0 >-<\/option>"),n!=null)for(var t=0;t<n.length;t++)o.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_Tax_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>")}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/LoadTaxRate",null,n)}function b(){n=$match.find("#VA012_cmbMatchingBase_"+$self.windowNo);i=$match.find("#VA012_divMatchingBase_"+$self.windowNo);s=$match.find("#VA012_cmbMatchingCriteria_"+$self.windowNo);e=$match.find("#VA012_cmbStatementNo_"+$self.windowNo);v=$match.find("#VA012_ChargeSrch_"+$self.windowNo);o=$match.find("#VA012_cmbTaxRate_"+$self.windowNo);y=$match.find("#VA012_accept_"+$self.windowNo);_ChargeLookUp=VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(),$self.windowNo,3787,VIS.DisplayType.Search);c=new VIS.Controls.VTextBoxButton("C_Charge_ID",!0,!1,!0,VIS.DisplayType.Search,_ChargeLookUp);v.append(c.getControl().css("width","93%")).append(c.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"))}function k(n){var i=t(n.target);i.hasClass("glyphicon-remove")&&(r.splice(r.indexOf(i.data("uid")),1),i.parent().parent().remove())}function d(){n=null;i=null;r=[];s=null;w2ui["VA012_gridPayment_"+$self.windowNo]!=null&&w2ui["VA012_gridPayment_"+$self.windowNo].destroy()}var n=null,i=null,r=[],s=null,e=null,v=null,c=null,o=null,y=null,l,f;$match=t("<div class='va012-popform-content'>");l="";l="<div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_StatementNo")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbStatementNo_'+$self.windowNo+"'><\/select><\/div> <div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_MatchingBase")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbMatchingBase_'+$self.windowNo+"'><\/select><\/div> <div id='VA012_divMatchingBase_"+$self.windowNo+"' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_MatchingCriteria")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbMatchingCriteria_'+$self.windowNo+"'><option value='0'><\/option><option value='AT'>"+VIS.Msg.getMsg("VA012_MatchAnyTwo")+"<\/option><option value='AR'>"+VIS.Msg.getMsg("VA012_MatchAnyThree")+"<\/option><option value='AL'>"+VIS.Msg.getMsg("VA012_MatchAll")+"<\/option><\/select><\/div> <div class='va012-popform-data'><label title = '"+VIS.Msg.getMsg("VA012_SetChargeType")+"' > "+VIS.Msg.getMsg("VA012_Charge")+'<sup style="color: red;">*<\/sup><\/label><div id=\'VA012_ChargeSrch_'+$self.windowNo+"'><\/div><\/div> <div class='va012-popform-data'><label title =' "+VIS.Msg.getMsg("VA012_SetTaxRate")+"' >"+VIS.Msg.getMsg("VA012_TaxRate")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbTaxRate_'+$self.windowNo+"'><\/select><\/div> <div class='va012-frm-btn va012-btn-blue' style='float: right;'><label style='font-weight: normal;' id ='VA012_accept_"+$self.windowNo+"'>"+VIS.Msg.getMsg("VA012_Accept")+"<\/label><\/div> <\/div>";$match.append(l);b();is(n);p();w();f=new VIS.ChildDialog;f.setContent($match);f.setTitle(VIS.Msg.getMsg("VA012_MatchStatement"));f.setWidth(700);f.setHeight(650);f.setEnableResize(!1);f.setModal(!0);f.show();f.hideButtons();y.click(function(){if(r.length>0){if(e.val()==null||e.val()==""||e.val()=="0")return VIS.ADialog.info("VA012_NoLinesFoundToMatch",null,"",""),!1;if(h.val()==null||h.val()==""||h.val()=="0")return VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"",""),!1;if(s.val()==null||s.val()==""||s.val()=="0")return VIS.ADialog.info("VA012_SelectMatchingCriteria",null,"",""),!1;if(s.val()=="AT"&&r.length<2)return VIS.ADialog.info("VA012_SelectMin2MatchingBase",null,"",""),!1;if(s.val()=="AR"&&r.length<3)return VIS.ADialog.info("VA012_SelectMin3MatchingBase",null,"",""),!1;if(c.value==null||VIS.Utility.Util.getValueOfInt(c.value)==0)return VIS.ADialog.info("VA012_NoChargeSelected",null,"",""),!1;if(o.val()==null||o.val()==""||o.val()=="0")return VIS.ADialog.info("VA012_NoTaxRateSelected",null,"",""),!1;ni($match,!0,"absolute");window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/MatchStatementGridData",type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_matchingBaseItemList:r.toString(),_cmbMatchingCriteria:s.val(),_BankAccount:h.val(),_StatementNo:e.val(),_BankCharges:VIS.Utility.Util.getValueOfInt(c.value),_TaxRate:o.val()},success:function(f){if(f!=null&&f!=""){f=t.parseJSON(f);n.prop("selectedIndex",0);e.prop("selectedIndex",0);c.value=null;o.prop("selectedIndex",0);r=[];var s="";i.html("");f.length>0?(ao(i,f),_statementlineslist=[],storepaymentdata=[],vt.html(""),vi=1,it.loadStatement(hi),ui.html(""),u.scheduleRefresh(),u.prepayRefresh(),nr=1,a.loadPayments(h.val(),pt.val(),ct.val(),yt.val())):(s="<div> <p> <b>"+VIS.Msg.getMsg("va012_norecordmatched")+"<\/b> <\/div>",i.append(s));ni($match,!1,"absolute")}else ni($match,!1,"absolute"),VIS.ADialog.info(f.toString(),null,"","")},error:function(){ni($match,!1,"absolute");VIS.ADialog.info("error",null,"","")}})},2)}else return VIS.ADialog.info("VA012_NoMatchingBaseSelected",null,"",""),!1;return!1});f.onCancelClick=function(){w2ui["VA012_gridPayment_"+$self.windowNo]!=null&&w2ui["VA012_gridPayment_"+$self.windowNo].destroy()};f.onClose=function(){d()};n.on("change",function(){if(r.length<=0&&i.html(""),!fe(n.val(),r)&&n.val()!="0"&&n.val()!=""){r.push(n.val());var u="<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='"+n.val()+"'class='glyphicon glyphicon-remove'><\/span><\/a> <span>"+n.children()[n[0].selectedIndex].text;t(i)[0]!=undefined&&t(i)[0].classList.contains("w2ui-reset","w2ui-grid")&&i.removeClass("w2ui-reset w2ui-grid");i.append(u)}});i.on(VIS.Events.onTouchStartOrClick,k)},matchStatementGridDialog:function(){var n=new VIS.ChildDialog;n.setContent(sf);n.setTitle(VIS.Msg.getMsg("VA012_MatchStatementGrid"));n.setWidth("780px");n.setHeight(450);n.setEnableResize(!0);n.setModal(!0);n.show();ao()},paymentScheduleDialog:function(){function ot(){var u="",t=0,n;for($_divPaymentSchedules.html(""),n=0;n<d.length;n++)u="<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='"+d[n]+"'  data-udata='"+wi[n]+"' class='glyphicon glyphicon-remove'><\/span><\/a> <span>"+wi[n]+"<\/span> <\/div>",$_divPaymentSchedules.append(u),lt.length>0&&(t+=VIS.Utility.Util.getValueOfDecimal(lt[n]));f[0].attributes["data-uid"].value==0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(t.toFixed(b)));c.setValue(VIS.Utility.Util.getValueOfDecimal(t.toFixed(b)));r(i.getControl().val())<0&&e.attr("v_active","0");i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]);d!=null&&d.length>0?hf(d.toString()):hf(null)}function ct(){if(d.length>0&&!pi){var n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetAutoCheckNo",{bnkAct_Id:h.val(),_PayMethod:0,_InvSchdleList:d,voucherMatch:p.val()});n&&(l.val(n._paymentMethod_Id).prop("selected",!0),n._checkNo?g.val(n._checkNo):g.val(""),l.trigger("change"))}}function at(n){var a=t(n.target),u,s,v;if(a.hasClass("glyphicon-remove")){if(lt!=null&&lt.length>0){if(lt.length>d.length?lt.splice(d.indexOf(a.data("uid"))+1,1):lt.length==d.length&&lt.splice(d.indexOf(a.data("uid")),1),u=0,Number(lt.length)>0)for(s=0;s<lt.length;s++)u+=VIS.Utility.Util.getValueOfDecimal(lt[s]);u<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"));f[0].attributes["data-uid"].value==0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(b)))}for(d.splice(d.indexOf(a.data("uid")),1),wi.splice(wi.indexOf(a.data("udata")),1),d.length==0&&f[0].attributes["data-uid"].value>0&&it.statementListRecordEdit(f[0].attributes["data-uid"].value,0,!1),a.parent().parent().remove(),tr.val(wi.toString()),u=0,s=0;s<lt.length;s++)u+=VIS.Utility.Util.getValueOfDecimal(lt[s]);f[0].attributes["data-uid"].value==0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(b)));c.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(b)));i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]);u==0&&ht.setValue();d!=null&&d.length>0?hf(d.toString()):hf(null);d.length>0?(v=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetAutoCheckNo",{bnkAct_Id:h.val(),_PayMethod:0,_InvSchdleList:d,voucherMatch:p.val()}),v&&(l.val(v._paymentMethod_Id).prop("selected",!0),v._checkNo?g.val(v._checkNo):g.val(""))):l.val(0).prop("selected",!0);l.trigger("change")}}function vt(){$_divPaymentSchedules=$paymentSchedule.find("#VA012_divPaymentSchedules_"+$self.windowNo);w=$paymentSchedule.find("#VA012_ctrlPSInvoice_"+$self.windowNo);k=$paymentSchedule.find("#VA012_ctrlPSBP_"+$self.windowNo);n=$paymentSchedule.find("#VA012_cmbPaymentSchedule_"+$self.windowNo)}function st(){ut=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,3484,VIS.DisplayType.MultiKey,"C_Invoice_ID",0,!1,"DocStatus IN ('CO','CL') AND C_Invoice.C_BPartner_ID="+ft);s=new VIS.Controls.VTextBoxButton("C_Invoice_ID",!1,!1,!0,VIS.DisplayType.MultiKey,ut);s.isMultiKeyTextBox=!0;s.getControl().addClass("va012-input-size-2");w.append(s.getControl());w.append(s.getBtn(0));w.append(s.getBtn(1));s.fireValueChanged=function(){rt=null;rt=s.value;n.html("");pt()}}function yt(){et=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,2893,VIS.DisplayType.Search,"C_BPartner_ID",0,!1,null);v=new VIS.Controls.VTextBoxButton("C_BPartner_ID",!1,!1,!0,VIS.DisplayType.Search,ne);v.getControl().addClass("va012-input-size-2");k.append(v.getControl());k.append(v.getBtn(0));k.append(v.getBtn(1));v.fireValueChanged=function(){ft=0;ft=v.value;ut=null;s=null;w.html("");rt=null;st()}}function pt(){function i(t){if(n.html(""),n.append("<option value=0 ><\/option>"),t!=null)for(var i=0;i<t.length;i++){if(t[i].DueAmount==0){VIS.ADialog.info("VA012_ConversionRateNotFound",null," "+VIS.Msg.getMsg("VA012_InvoiceSchedule")+": "+VIS.Utility.Util.getValueOfString(t[i].c_invoicepayschedule_id),"");return}n.append("<option paymentamount="+t[i].DueAmount+" paymentdata='"+VIS.Utility.encodeText(new Date(t[i].DueDate).toLocaleDateString())+"_"+VIS.Utility.encodeText(t[i].DueAmt)+"' value="+VIS.Utility.Util.getValueOfInt(t[i].c_invoicepayschedule_id)+">"+VIS.Utility.encodeText(new Date(t[i].DueDate).toLocaleDateString()+"_"+t[i].DueAmt)+"<\/option>")}n.prop("selectedIndex",0)}t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetInvPaySchedule",dataType:"json",data:{seltdInvoice:rt,accountID:h.val(),statemtDate:nt.val()},success:function(n){var t=JSON.parse(n);(t!=null||t!="")&&i(t)}})}function wt(){ut=null;s=null;rt=null;w=null;et=null;v=null;ft=null;k=null;n=null}var tt,y;if(d.length==0&&wi.length==0)var ut=null,s=null,rt=null,w=null,et=null,v=null,ft=null,k=null,n=null;$paymentSchedule=t("<div class='va012-popform-content'>");tt="";tt="<div> <label>"+VIS.Msg.getMsg("VA012_BusinessPartner")+"<\/label> <div id='VA012_ctrlPSBP_"+$self.windowNo+"' ><\/div> <\/div>";tt+="<div> <label>"+VIS.Msg.getMsg("VA012_Invoice")+"<\/label> <div id='VA012_ctrlPSInvoice_"+$self.windowNo+"' ><\/div> <\/div>";tt+="<div> <label>"+VIS.Msg.getMsg("VA012_PaymentSchedules")+"<\/label> <select id='VA012_cmbPaymentSchedule_"+$self.windowNo+"'  style=' width: 100%; ' ><\/select> <\/div>";tt+="<div id='VA012_divPaymentSchedules_"+$self.windowNo+"' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px;margin-top: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>";$paymentSchedule.append(tt);vt();y=new VIS.ChildDialog;y.setContent($paymentSchedule);y.setTitle(VIS.Msg.getMsg("VA012_PaymentSchedules"));y.setWidth("500px");ot();y.setEnableResize(!1);y.setModal(!0);y.show();yt();st();ht.value&&(v.setValue(ht.value,!1,!0),k.find("*").prop("disabled",!0));dt.value&&(s.setValue(dt.value,!1,!0),w.find("*").prop("disabled",!0));n.on("change",function(){n.val()>0&&a.checkScheduleCondition(n.val(),parseInt(f.attr("data-uid")),"",r(i.getControl().val()))&&(fe(parseInt(n.val()),d)?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(d.push(parseInt(n.val())),wi.push(this.options[this.selectedIndex].getAttribute("paymentdata")),lt.push(this.options[this.selectedIndex].getAttribute("paymentamount")),ot(),ct(),a.setInvoiceAndBPartner(n.val(),"IS")),tr.val(wi.toString()))});$_divPaymentSchedules.on(VIS.Events.onTouchStartOrClick,at);y.onOkClick=function(){};y.onCancelClick=function(){u.scheduleRefresh();wt();f[0].attributes["data-uid"].value>0?it.statementListRecordEdit(f[0].attributes["data-uid"].value,0,!1):u.refreshForm(!1)}},prepayOrderDialog:function(){function r(){var t="",n;for($_divPrepayOrders.html(""),n=0;n<eu.length;n++)t="<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='"+eu[n]+"'  data-udata='"+ou[n]+"' class='glyphicon glyphicon-remove'><\/span><\/a> <span>"+ou[n]+"<\/span> <\/div>",$_divPrepayOrders.append(t)}function u(n){var i=t(n.target);i.hasClass("glyphicon-remove")&&(eu.splice(eu.indexOf(i.data("uid")),1),ou.splice(ou.indexOf(i.data("udata")),1),i.parent().parent().remove(),df.val(ou.toString()))}function f(){$_divPrepayOrders=$prepayOrder.find("#VA012_divPrepayOrders_"+$self.windowNo)}var i,n;$prepayOrder=t("<div class='va012-popform-content'>");i="";i="<div id='VA012_divPrepayOrders_"+$self.windowNo+"' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>";$prepayOrder.append(i);f();n=new VIS.ChildDialog;n.setContent($prepayOrder);n.setTitle(VIS.Msg.getMsg("VA012_PrepayOrders"));n.setWidth("500px");r();n.setEnableResize(!1);n.setModal(!0);n.show();$_divPrepayOrders.on(VIS.Events.onTouchStartOrClick,u)}};u={newRecord:function(){function it(n){datasource=[];for(var t=0;t<n.length;t++)datasource.push({label:n[t].name,value:n[t].name,ids:n[t].chargeID});rt.autocomplete("option","source",datasource);rt.autocomplete("search","");rt.trigger("focus")}function ct(n,i){rt.attr("chargeid",0);t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetCharge",dataType:"json",data:{searchText:n,voucherType:p.val()!=null?p.val():"",bankAcct:h.val()!=null?h.val():0},success:function(n){var r=JSON.parse(n);datasource=[];i(t.map(r,function(n){return{label:n.name,value:n.name,ids:n.chargeID}}));t(self.div).autocomplete("search","");t(self.div).trigger("focus")}})}function n(){p.val()=="V"?(s.val(at).prop("selected",!0),s.removeClass("va012-mandatory"),s.attr("disabled",!0)):(t(s[0]).siblings().show(),s.val(0).prop("selected",!0),s.addClass("va012-mandatory"),s.attr("disabled",!1))}f=v.find("#VA012_formNewRecord_"+$self.windowNo);bf=v.find("#VA012_formBtnNewRecord_"+$self.windowNo);u.getNewRecordDesign();u.getNewRecordControls();u.loadCurrency();u.loadVoucherMatch();u.loadContraType();u.loadCashBook();u.loadDifferenceType();u.loadTransferType();u.loadNewFormCurrency();u.loadConversionTypes();u.loadPaymentMethods();u.loadCharge();u.loadTaxRate();u.loadPayment();u.loadOrder();u.loadBusinessPartner();u.loadTrxOrg();u.loadInvoice();u.loadCashLine();r(i.getControl().val())<=0&&i.getControl().addClass("va012-mandatory");gt.val()!=""&&gt.removeClass("va012-mandatory");nt.val()!=""&&nt.removeClass("va012-mandatory");rt.on("blur",function(){(rt.val()==""||rt.val()==null)&&rt.attr("chargeid",0)});we.on(VIS.Events.onTouchStartOrClick,function(){VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetCharge",{searchText:"",voucherType:p.val()!=null?p.val():"",bankAcct:h.val()!=null?h.val():0},it)});rt.autocomplete({minLength:0,scroll:!0,source:function(n,t){n.term.trim().length!=0&&ct(n.term,t)},select:function(n,i){t(this).val(i.item.ids);t(this).attr("chargeid",i.item.ids);parseInt(t(this).val())&&rt.removeClass("va012-mandatory")}});bt.on(VIS.Events.onTouchStartOrClick,function(){bt.attr("activestatus")=="0"?(f.show(),bt.attr("activestatus","1"),bt.removeClass("vis vis-plus"),bt.addClass("fa fa-minus"),bt.attr("title","Collapse")):(f.hide(),bt.attr("activestatus","0"),bt.addClass("vis vis-plus"),bt.removeClass("fa fa-minus"),bt.attr("title","Expand"));r(i.getControl().val())<=0&&i.getControl().addClass("va012-mandatory");gt.val()!=""&&gt.removeClass("va012-mandatory");nt.val()!=""&&nt.removeClass("va012-mandatory");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();s.trigger("change");a.setPaymentListHeight()});ye.on(VIS.Events.onTouchStartOrClick,function(){u.scheduleRefresh();u.prepayRefresh();u.refreshForm();s.trigger("change")});f.hide();p.on("change",function(){p.val()=="M"?(VIS.Utility.Util.getValueOfInt(oi)!=0&&event!=null&&event.currentTarget.className!=bi[0].className&&(u.refreshSelectedValues(),n()),_divCtrlCashLine.find("*").prop("disabled",!0),_divCtrlCashLine.hide(),ar.find("*").prop("disabled",!0),iu.find("*").prop("disabled",!0),vr.find("*").prop("disabled",!0),ru.find("*").prop("disabled",!0),ar.hide(),iu.hide(),vr.hide(),ru.hide(),_divPaymentMethod.show(),ro>0?(li.show(),li.find("*").prop("disabled",!1)):(li.find("*").prop("disabled",!0),li.hide()),k.val()=="CH"?(u.loadCharge(),fi.find("*").prop("disabled",!1),ei.find("*").prop("disabled",!1),ai.find("*").prop("disabled",!1)):(fi.hide(),ei.hide(),ai.hide(),fi.find("*").prop("disabled",!0),ei.find("*").prop("disabled",!0),ai.find("*").prop("disabled",!0)),divRow4Col1TrxAmt.show(),ku.show(),yi.show(),yr.show(),pr.show(),wr.show(),br.show(),kr.show(),yr.find("*").prop("disabled",!1),pr.find("*").prop("disabled",!1),wr.find("*").prop("disabled",!1),br.find("*").prop("disabled",!1),kr.find("*").prop("disabled",!1),tr.prop("disabled",!0),bu.css("pointer-events","auto"),ut.removeClass("va012-mandatory"),rt.removeClass("va012-mandatory"),k.val()!="CH"&&(ot.prop("selectedIndex",0),rt.attr("chargeid",0),rt.val(""),ut.prop("selectedIndex",0),wt.setValue(0)),ot.removeClass("va012-mandatory"),t(".astric_"+$self.windowNo).hide(),t("#Ast_ContraType_"+$self.windowNo).hide(),t("#Ast_DifferenceType_"+$self.windowNo).hide(),t("#Ast_Difference_"+$self.windowNo).hide()):p.val()=="V"?((oi!=0||ri!=0||d.length>0||kt!=0&&event!=null&&event.currentTarget.className!=bi[0].className)&&(u.refreshSelectedValues(),n()),u.loadCharge(),_divCtrlCashLine.find("*").prop("disabled",!0),_divCtrlCashLine.hide(),ar.find("*").prop("disabled",!0),iu.find("*").prop("disabled",!0),vr.find("*").prop("disabled",!0),ru.find("*").prop("disabled",!0),ar.hide(),ot.prop("selectedIndex",0),iu.hide(),vr.hide(),ru.hide(),li.show(),fi.show(),ei.show(),ai.show(),li.find("*").prop("disabled",!1),fi.find("*").prop("disabled",!1),ei.find("*").prop("disabled",!1),_divPaymentMethod.show(),VIS.Utility.Util.getValueOfInt(rt.attr("chargeid"))==0&&rt.addClass("va012-mandatory"),VIS.Utility.Util.getValueOfInt(ut.val())==0&&ut.addClass("va012-mandatory"),yr.find("*").prop("disabled",!0),pr.find("*").prop("disabled",!0),wr.find("*").prop("disabled",!1),br.find("*").prop("disabled",!0),kr.find("*").prop("disabled",!0),bu.css("pointer-events","none"),divRow4Col1TrxAmt.hide(),c.setValue(0),ku.hide(),w.setValue(0),w.getControl().removeClass("va012-mandatory"),yi.hide(),yi.find("*").prop("disabled",!0),k.removeClass("va012-mandatory"),yr.hide(),pr.hide(),wr.hide(),br.hide(),kr.hide(),ot.removeClass("va012-mandatory"),t(".astric_"+$self.windowNo).show(),t("#Ast_ContraType_"+$self.windowNo).hide(),et.getControl().removeClass("va012-mandatory"),t("#Ast_CashJournalLine_"+$self.windowNo).hide()):p.val()=="C"&&((ri!=0||d.length>0||kt!=0&&event!=null&&event.currentTarget.className!=bi[0].className)&&(u.refreshSelectedValues(),n()),u.loadCharge(),ar.show(),vr.show(),ar.find("*").prop("disabled",!1),vr.find("*").prop("disabled",!1),divRow4Col1TrxAmt.show(),ku.show(),yi.show(),_divPaymentMethod.hide(),r(w.getControl().val())==0&&(li.find("*").prop("disabled",!0),fi.find("*").prop("disabled",!0),ei.find("*").prop("disabled",!0),ai.find("*").prop("disabled",!0),li.hide(),fi.hide(),ei.hide(),ai.hide()),yr.find("*").prop("disabled",!0),pr.find("*").prop("disabled",!0),wr.find("*").prop("disabled",!0),br.find("*").prop("disabled",!0),kr.find("*").prop("disabled",!0),bu.css("pointer-events","none"),yr.hide(),pr.hide(),wr.hide(),br.hide(),kr.hide(),(ot.val()==null||ot.val()==""||ot.val()==0)&&ot.addClass("va012-mandatory"),ut.removeClass("va012-mandatory"),rt.removeClass("va012-mandatory"),t(".astric_"+$self.windowNo).hide(),t("#Ast_ContraType_"+$self.windowNo).show());gr.hide();gr.find("*").prop("disabled",!0);bi.text(VIS.Msg.getMsg("VA012_More"));a.setPaymentListHeight()});k.on("change",function(){k.val()=="CH"?(li.show(),fi.show(),ei.show(),ai.show(),li.find("*").prop("disabled",!1),fi.find("*").prop("disabled",!1),ei.find("*").prop("disabled",!1),(rt.val()==null||rt.val()=="")&&rt.addClass("va012-mandatory"),ut.val()==0&&ut.addClass("va012-mandatory"),t(".astric_"+$self.windowNo).show()):(p.val()=="M"||p.val()=="C")&&(fi.find("*").prop("disabled",!0),ei.find("*").prop("disabled",!0),ai.find("*").prop("disabled",!0),fi.hide(),ei.hide(),ai.hide(),or.prop("selectedIndex",0),rt.attr("chargeid",0),rt.val(""),ut.prop("selectedIndex",0),wt.setValue(0),rt.removeClass("va012-mandatory"),ut.removeClass("va012-mandatory"));k.val()<=0&&r(w.getControl().val())!=0?(k.addClass("va012-mandatory"),t("#Ast_DifferenceType_"+$self.windowNo).show()):k.removeClass("va012-mandatory");a.setPaymentListHeight()});ot.on("change",function(){ot.val()!=null&&ot.val()!=""&&ot.val()!=0?ot.removeClass("va012-mandatory"):ot.addClass("va012-mandatory");ot.val()=="CB"?(iu.find("*").prop("disabled",!1),ru.find("*").prop("disabled",!1),t(".astric_"+$self.windowNo).hide(),et.getControl().addClass("va012-mandatory"),t("#Ast_CashJournalLine_"+$self.windowNo).show()):(ur.prop("selectedIndex",0),su.val(""),iu.find("*").prop("disabled",!0),ru.find("*").prop("disabled",!0),t(".astric_"+$self.windowNo).hide(),et.getControl().removeClass("va012-mandatory"),t("#Ast_CashJournalLine_"+$self.windowNo).hide());ot.val()=="BB"?(_divCtrlCashLine.find("*").prop("disabled",!0),_divCtrlCashLine.hide(),t(".astric_"+$self.windowNo).show(),li.show(),fi.show(),ei.show(),ai.show(),li.find("*").prop("disabled",!1),fi.find("*").prop("disabled",!1),ei.find("*").prop("disabled",!1),rt.addClass("va012-mandatory"),ut.addClass("va012-mandatory"),et.getControl().removeClass("va012-mandatory"),t("#Ast_CashJournalLine_"+$self.windowNo).hide()):p.val()=="C"&&(_divCtrlCashLine.show(),_divCtrlCashLine.find("*").prop("disabled",!1),li.find("*").prop("disabled",!0),r(w.getControl().val())==0&&(fi.find("*").prop("disabled",!0),ei.find("*").prop("disabled",!0),ai.find("*").prop("disabled",!0),fi.hide(),ei.hide(),ai.hide(),rt.removeClass("va012-mandatory"),ut.removeClass("va012-mandatory")),ai.hide());a.setPaymentListHeight()});s.on("change",function(){VIS.Utility.Util.getValueOfInt(s.val())>0?s.removeClass("va012-mandatory"):s.addClass("va012-mandatory")});l.on("change",function(){if(VIS.Utility.Util.getValueOfInt(l.val())>0){var n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetAutoCheckNo",{bnkAct_Id:h.val(),_PayMethod:l.val(),_InvSchdleList:d,voucherMatch:p.val()});if(n._paymentBaseType=="S"){if(sr.show(),pi){g.val()||(g.val(pi),g.attr("disabled",!0),g.removeClass("va012-mandatory"),hr.show(),ft.val(lu),ft.removeClass("va012-mandatory"),l.removeClass("va012-mandatory"));return}(d.length>0||p.val()=="V")&&n&&(n._checkNo?(g.val(n._checkNo),g.attr("disabled",!0),g.removeClass("va012-mandatory")):(g.val(""),g.attr("disabled",!1),g.addClass("va012-mandatory")),n._status&&(g.val(""),VIS.ADialog.info("",null,n._status,"")));g.val()?(g.attr("disabled",!0),g.removeClass("va012-mandatory"),cr=!1,pi=null):(g.attr("disabled",!1),g.addClass("va012-mandatory"),cr=!0,pi=null);hr.show();ft.val()?(ft.attr("disabled",!0),ft.removeClass("va012-mandatory"),lu=null):(ft.attr("disabled",!1),ft.addClass("va012-mandatory"),lu=null)}else sr.hide(),g.val(""),g.removeClass("va012-mandatory"),hr.hide(),ft.val(""),ft.removeClass("va012-mandatory");l.removeClass("va012-mandatory")}else l.attr("disabled",!1),l.addClass("va012-mandatory"),g.val(""),sr.hide(),g.removeClass("va012-mandatory"),ft.val(""),hr.hide(),ft.removeClass("va012-mandatory")});g.on("change",function(){g.val()?(g.removeClass("va012-mandatory"),cr=!0,pi=g.val()):(g.addClass("va012-mandatory"),cr=!1,pi=null)});ft.on("change",function(){ft.val()?(tt.value||ft.val()>nt.val()&&(ft.val(""),VIS.ADialog.info("VA012_ChkDateCantbeGratrStmtDate",null,"","")),ft.removeClass("va012-mandatory")):ft.addClass("va012-mandatory")});y.on("change",function(){if(VIS.Utility.Util.getValueOfInt(y.val())>0){var n=null;d!=null&&d.length>0&&(n=d.toString());n!=null||VIS.Utility.Util.getValueOfInt(st.value)!=0||VIS.Utility.Util.getValueOfInt(tt.value)!=0||VIS.Utility.Util.getValueOfInt(et.value)!=0?t.ajax({type:"POST",url:VIS.Application.contextUrl+"BankStatement/GetConvertedAmount",contentType:"application/json; charset=utf-8",data:JSON.stringify({currency:at,conversionType:y.val(),stmtDate:nt.val(),_schedules:n,_accountId:h.val(),orderId:kt,paymentId:ri,cashLineId:oi}),success:function(n){n=JSON.parse(n);n!=null&&(n._convertedAmt==0?n.schedule_Ids!=null&&n.schedule_Ids.length>0&&(VIS.Utility.Util.getValueOfInt(f.attr("data-uid"))==0&&i.setValue(),c.setValue(),i.getControl().addClass("va012-mandatory"),c.getControl().addClass("va012-mandatory"),VIS.ADialog.info("VA012_ConversionRateNotFound",null," - DocNo: "+n.schedule_Ids.toString(),"")):(VIS.Utility.Util.getValueOfInt(f.attr("data-uid"))==0?(i.setValue(n._convertedAmt),n._convertedAmt>0?i.getControl().removeClass("va012-mandatory"):i.getControl().addClass("va012-mandatory")):(c.setValue(n._convertedAmt),i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())])),kt==0&&VIS.Utility.Util.getValueOfInt(f.attr("data-uid"))==0&&(c.setValue(n._convertedAmt),i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]))));t(y[0][0]).hide();y.removeClass("va012-mandatory")},error:function(n){VIS.ADialog.info(n,null,"","")}}):y.removeClass("va012-mandatory")}else y.addClass("va012-mandatory")});ut.on("change",function(){if(wt.setValue(0),ut.val()>0){var n=0;if(n=r(w.getControl().val())!=0&&p.val()!="V"?r(w.getControl().val()):r(i.getControl().val()),n!=0){ue(ut.val(),n,b,t);function t(n){n=JSON.parse(n);n!=null&&(wt.setValue(VIS.Utility.Util.getValueOfDecimal(n.TaxAmt)),ut.removeClass("va012-mandatory"))}}}else ut.addClass("va012-mandatory")});bi.on(VIS.Events.onTouchStartOrClick,function(){bi.text()==VIS.Msg.getMsg("VA012_More")?(bi.attr("visiblestatus","1"),bi.text(VIS.Msg.getMsg("VA012_Hide")),ar.show(),vr.show(),_divCtrlCashLine.show(),li.show(),fi.show(),ei.show(),ai.show(),divRow4Col1TrxAmt.show(),ku.show(),yi.show(),yr.show(),pr.show(),wr.show(),br.show(),kr.show(),p.val()=="V"&&(gr.show(),uu>0?gr.find("*").prop("disabled",!0):gr.find("*").prop("disabled",!1))):(bi.attr("visiblestatus","0"),bi.text(VIS.Msg.getMsg("VA012_More")),p.trigger("change"));a.setPaymentListHeight()});f.on("keyup",function(n){n.which==32&&(e.is(":focus")&&e.trigger("click"),o.is(":focus")&&o.trigger("click"),bi.is(":focus")&&bi.trigger("click"));n.which==13&&ef.is(":focus")&&ef.trigger("click")});ef.on(VIS.Events.onTouchStartOrClick,function(){var n=u.getFormData(),f,t;if(dr){VIS.ADialog.info("VA012_BSLAlreadyReconciled",null,"","");return}if(n[0]._cmbBankAccount==null||n[0]._cmbBankAccount==""||n[0]._cmbBankAccount=="0"){VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"","");return}if(n[0]._txtStatementNo==null||n[0]._txtStatementNo==""||n[0]._txtStatementNo=="0"){VIS.ADialog.info("VA012_PleaseEnterStatementNo",null,"","");return}if(n[0]._dtStatementDate==null||n[0]._dtStatementDate==""||n[0]._dtStatementDate=="0"){VIS.ADialog.info("VA012_PleaseEnterStatementDate",null,"","");return}if(VIS.Utility.Util.getValueOfInt(n[0]._txtCurrency)==0){VIS.ADialog.info("VA012_PleaseSelectCurrency",null,"","");return}if(VIS.Utility.Util.getValueOfInt(n[0]._txtConversionType)==0){VIS.ADialog.info("VA012_PleaseSelectConversionType",null,"","");return}if(VIS.Utility.Util.getValueOfInt(n[0]._txtPaymentMethod)<=0&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlCashLine)<=0&&n[0]._cmbVoucherMatch!="C"){VIS.ADialog.info("VA012_PleaseSelectPayMethod",null,"","");return}if(!n[0]._ctrlPayment&&g.hasClass("va012-mandatory")&&(n[0]._txtCheckNum==null||n[0]._txtCheckNum=="")){VIS.ADialog.info("VA012_PleaseEnterCheckNo",null,"","");return}if(!n[0]._ctrlPayment&&ft.hasClass("va012-mandatory")&&!n[0]._txtCheckDate){VIS.ADialog.info("VA012_PleaseSelectCheckDate",null,"","");return}if(!(n[0]._ctrlInvoice==null||n[0]._ctrlInvoice==""||n[0]._ctrlInvoice=="0")&&!(n[0]._ctrlBusinessPartner==null||n[0]._ctrlBusinessPartner==""||n[0]._ctrlBusinessPartner=="0")&&(n[0]._ctrlPayment==null||n[0]._ctrlPayment==""||n[0]._ctrlPayment=="0")&&(n[0]._scheduleList==null||n[0]._scheduleList=="")){VIS.ADialog.info("VA012_PleaseSelectPaySchedule",null,"","");return}if(!(n[0]._ctrlBusinessPartner==null||n[0]._ctrlBusinessPartner==""||n[0]._ctrlBusinessPartner=="0")&&(n[0]._ctrlInvoice==null||n[0]._ctrlInvoice==""||n[0]._ctrlInvoice=="0")&&(n[0]._ctrlPayment==null||n[0]._ctrlPayment==""||n[0]._ctrlPayment=="0")&&(n[0]._scheduleList==null||n[0]._scheduleList=="")&&(n[0]._ctrlOrder==null||n[0]._ctrlOrder==""||n[0]._ctrlOrder=="0")&&(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0")){VIS.ADialog.info("VA012_PleaseSelectAnyOne",null,"","");return}if(n[0]._cmbVoucherMatch=="M"&&(n[0]._ctrlInvoice==null||n[0]._ctrlInvoice==""||n[0]._ctrlInvoice=="0")&&(n[0]._ctrlPayment==null||n[0]._ctrlPayment==""||n[0]._ctrlPayment=="0")&&(n[0]._scheduleList==null||n[0]._scheduleList=="")&&(n[0]._ctrlOrder==null||n[0]._ctrlOrder==""||n[0]._ctrlOrder=="0")&&(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0")){VIS.ADialog.info("VA012_PleaseSelectAnyOne",null,"","");return}if(n[0]._txtAmount==null||n[0]._txtAmount==""||n[0]._txtAmount=="0"||n[0]._txtAmount=="0.00"){VIS.ADialog.info("VA012_PleaseEnterAmount",null,"","");return}if(n[0]._cmbVoucherMatch=="C")if(n[0]._cmbContraType=="BB"){if(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0"){VIS.ADialog.info("VA012_PleaseSelectCharge",null,"","");rt.addClass("va012-mandatory");return}if(n[0]._cmbTaxRate==null||n[0]._cmbTaxRate==""||n[0]._cmbTaxRate=="0"){VIS.ADialog.info("VA012_PleaseSelectTaxRate",null,"","");ut.addClass("va012-mandatory");return}}else if(n[0]._cmbContraType=="CB"){if(n[0]._ctrlCashLine==null||n[0]._ctrlCashLine==""||n[0]._ctrlCashLine=="0"){VIS.ADialog.info("VA012_PleaseSelectCashJournalLine",null,"","");return}}else{VIS.ADialog.info("VA012_PleaseSelectContraType",null,"","");return}if(n[0]._cmbVoucherMatch=="V"){if(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0"){VIS.ADialog.info("VA012_PleaseSelectCharge",null,"","");rt.addClass("va012-mandatory");return}if(n[0]._cmbTaxRate==null||n[0]._cmbTaxRate==""||n[0]._cmbTaxRate=="0"){VIS.ADialog.info("VA012_PleaseSelectTaxRate",null,"","");ut.addClass("va012-mandatory");return}}if(parseFloat(n[0]._txtDifference)!=0&&n[0]._cmbVoucherMatch=="M"&&(n[0]._cmbDifferenceType==null||n[0]._cmbDifferenceType==""||n[0]._cmbDifferenceType=="0")){VIS.ADialog.info("VA012_PleaseSelectDifferenceType",null,"","");return}if(parseFloat(n[0]._txtDifference)!=0&&n[0]._cmbDifferenceType=="CH"){if(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0"){VIS.ADialog.info("VA012_PleaseSelectCharge",null,"","");rt.addClass("va012-mandatory");return}if(n[0]._cmbTaxRate==null||n[0]._cmbTaxRate==""||n[0]._cmbTaxRate=="0"){VIS.ADialog.info("VA012_PleaseSelectTaxRate",null,"","");ut.addClass("va012-mandatory");return}}if(parseFloat(n[0]._txtDifference)!=0&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlPayment)!=0&&n[0]._cmbDifferenceType!="CH"){VIS.ADialog.info("VA012_PlsSelectDiffTypeCharge",null,"","");return}if(VIS.Utility.Util.getValueOfDecimal(n[0]._txtDifference)!=0&&VIS.Utility.Util.getValueOfInt(n[0]._scheduleList.length)>0&&Math.abs(r(i.getControl().val()))>Math.abs(r(c.getControl().val()))&&n[0]._cmbDifferenceType!="CH"){VIS.ADialog.info("MoreScheduleAmount",null,"","");return}if(VIS.Utility.Util.getValueOfString(n[0]._scheduleList)==""&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlPayment)==0&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlOrder)==0&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlCashLine)==0&&VIS.Utility.Util.getValueOfInt(n[0]._cmbCharge)==0){VIS.ADialog.info("VA012_PleaseSelectAnyOne",null,"","");return}if(VIS.Utility.Util.getValueOfString(n[0]._cmbDifferenceType)=="CH"||VIS.Utility.Util.getValueOfString(n[0]._cmbVoucherMatch)=="V"){if(f=VIS.Utility.Util.getValueOfInt(n[0]._cmbTaxRate),t=0,t=VIS.Utility.Util.getValueOfString(n[0]._cmbDifferenceType)=="CH"?VIS.Utility.Util.getValueOfDecimal(n[0]._txtDifference):VIS.Utility.Util.getValueOfDecimal(n[0]._txtAmount),f>0&&t!=0){ue(n[0]._cmbTaxRate,t,b,e);function e(t){t=JSON.parse(t);t!=null&&(n[0]._surChargeAmt=t.SurchargeAmt,n[0]._txtTaxAmount=t.TaxAmt,ni(v,!0,"absolute"),u.insertNewRecord(n,u.afterInsertion))}}}else ni(v,!0,"absolute"),u.insertNewRecord(n,u.afterInsertion)});gt.on("keypress",function(){ci.val("1");fr.val("10")});gt.on("change",function(){gt.val()==""?gt.addClass("va012-mandatory"):gt.removeClass("va012-mandatory")});fr.on("keypress",function(n){if(n.which!=8&&n.which!=0&&(n.which<48||n.which>57))return!1});ci.on("keypress",function(n){if(n.which!=8&&n.which!=0&&(n.which<48||n.which>57))return!1});ci.on("change",function(){_origin="LO";t.ajax({url:VIS.Application.contextUrl+"BankStatement/MaxStatement",type:"GET",datatype:"json",data:{_bankAccount:h.val()==null?0:h.val(),_origin:_origin,_pageNo:ci.val()<=0?0:ci.val()},contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),ci.val()<=0&&gt.val()==n.statementNo?(fr.val(n.lineno),ci.val(n.pageno),VIS.ADialog.info("VA012_NotAcceptZero",null,"","")):ci.val()>0&&gt.val()==n.statementNo?fr.val(n.lineno):ci.val()<=0&&(ci.val("1"),VIS.ADialog.info("VA012_NotAcceptZero",null,"","")))}})});kf.on(VIS.Events.onTouchStartOrClick,function(){u.scheduleRefresh();u.prepayRefresh();u.refreshForm();(gt.val()==""||gt.val()==null)&&gt.val("0");a.getMaxStatement("BT");f.attr("data-uid",0)});wt.getControl().on("change",function(){r(wt.getControl().val())==0||r(wt.getControl().val())==null?wt.setValue(0):wt.setValue(VIS.Utility.Util.getValueOfDecimal(r(wt.getControl().val())))});c.getControl().on("blur",function(n,u,e){if(p.val()!="V")if(VIS.Utility.Util.getValueOfDecimal(u)!=0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(u).toFixed(b)))),VIS.Utility.Util.getValueOfDecimal(e)!=0&&(c.setValue(),c.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(e).toFixed(b)))),VIS.Utility.Util.getValueOfDecimal(r(c.getControl().val()))==0?(c.setValue(0),c.getControl().addClass("va012-mandatory")):VIS.Utility.Util.getValueOfDecimal(r(c.getControl().val()))<0?c.getControl().addClass("va012-mandatory"):(c.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(r(c.getControl().val())).toFixed(b))),c.getControl().removeClass("va012-mandatory")),w.getControl().attr("vchangable")=="Y"&&(w.setValue(0),yi.find("*").prop("disabled",!0)),p.val()=="M"||p.val()=="C"){if(w.getControl().attr("vchangable")=="Y"&&(w.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(r(c.getControl().val())-r(i.getControl().val())).toFixed(b))),VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0?(VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))<0?(w.getControl().addClass("va012-mandatory"),t("#Ast_Difference_"+$self.windowNo).show()):w.getControl().removeClass("va012-mandatory"),r(c.getControl().val())==0?(yi.find("*").prop("disabled",!0),k.val("0")):yi.find("*").prop("disabled",!1),(d.length==0||d.length>0&&f.attr("data-uid")!=0&&Math.abs(r(c.getControl().val()))<Math.abs(r(i.getControl().val())))&&(VIS.Utility.Util.getValueOfInt(st.value)==0&&f.attr("data-uid")==0||f.attr("data-uid")!=0)&&(k.find("option[value=0]").prop("disabled",!0),k.find("option[value=OU]").prop("disabled",!0),k.find("option[value=DA]").prop("disabled",!0),k.find("option[value=WO]").prop("disabled",!0),k.val()!="CH"&&k.val("0").prop("selected",!0)),k.val()<=0&&r(c.getControl().val())!=0?(k.addClass("va012-mandatory"),t("#Ast_DifferenceType_"+$self.windowNo).show()):k.removeClass("va012-mandatory")):(yi.find("*").prop("disabled",!0),k.val("0").prop("selected",!0),k.trigger("change"),k.removeClass("va012-mandatory"),t("#Ast_DifferenceType_"+$self.windowNo).hide())),VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0&&ut.val()>0){ue(ut.val(),r(w.getControl().val()),b,o);function o(n){n=JSON.parse(n);n!=null&&n!=0&&wt.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(n.TaxAmt).toFixed(b)));ut.val()>0&&VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0&&(VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))<0?w.getControl().addClass("va012-mandatory"):w.getControl().removeClass("va012-mandatory"));VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0&&(VIS.Utility.Util.getValueOfInt(tt.getValue())!=0||VIS.Utility.Util.getValueOfInt(et.getValue())!=0)?(k.val("CH").prop("selected",!0),k.trigger("change")):VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0&&d.toString()!=""||(k.val("0").prop("selected",!0),k.trigger("change"))}}}else VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0&&VIS.Utility.Util.getValueOfInt(tt.getValue())!=0&&(k.val("CH").prop("selected",!0),k.trigger("change"))});w.getControl().on("blur",function(){r(w.getControl().val())==0||r(w.getControl().val())==null?yi.find("*").prop("disabled",!0):yi.find("*").prop("disabled",!1)});i.getControl().on("blur",function(n,t){VIS.Utility.Util.getValueOfDecimal(t)!=0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(t).toFixed(b))));VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))==0&&(i.setValue(0),i.getControl().addClass("va012-mandatory"));var u=VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()));if(o.attr("v_active")=="1"&&u>0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(-1*u).toFixed(b)))),e.attr("v_active")=="1"&&u<0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(-1*u).toFixed(b)))),VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"),i.getControl().addClass("va012-mandatory")):VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))>0&&(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),i.getControl().removeClass("va012-mandatory")),VIS.Utility.Util.getValueOfInt(ut.val())>0&&r(i.getControl().val())!=0&&p.val()=="V"){ue(ut.val(),r(i.getControl().val()),b,f);function f(n){n=JSON.parse(n);n!=null&&n!=0&&(wt.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(n.TaxAmt).toFixed(b))),ut.removeClass("va012-mandatory"));c.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())])}}else c.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())])});gf.hover(function(){$tooltip=t('<div  class="va012-div-tooltip"><h4>'+VIS.Msg.getMsg("VA012_Information")+"<\/h4><p>"+VIS.Msg.getMsg("VA012_InformationText")+"<\/p><\/div>");v.append($tooltip);t(".va012-div-tooltip").show()},function(){v.find(".va012-div-tooltip").remove()});nt.on("blur",function(){if(nt.val()=="")nt.addClass("va012-mandatory");else if(!(f[0].attributes["data-uid"].value>0)||!(tt.getValue()>0||et.getValue()>0||dt.getValue()>0||st.getValue()>0||d.length>0)){nt.removeClass("va012-mandatory");var u=0,n=null,t=null;if(p.val()=="M"?tr.val()!=0&&(tt.getValue()==null||tt.getValue()==0)?d.length!=0&&(n="IS",t=d.join()):(tr.val()==null||tr.val()==0)&&tt.getValue()!=null&&tt.getValue()!=0?(n="PY",t=tt.getValue()):VIS.Utility.Util.getValueOfInt(st.value)!=0&&VIS.Utility.Util.getValueOfInt(ht.value)!=0&&(n="PO",t=st.value,i.getControl().attr("disabled",!0)):p.val()=="C"&&VIS.Utility.Util.getValueOfInt(et.value)!=0&&VIS.Utility.Util.getValueOfInt(tt.getValue())==0&&VIS.Utility.Util.getValueOfInt(tr.val())==0&&(n="CO",t=et.value),n!=null&&t!=null){VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetConvtAmount",{recordID:t,bnkAct_Id:h.val(),transcType:n,stmtDate:nt.val()},s);function s(t){for(var f=0;f<t.length;f++){if(t.length==0||t[f].DueAmount==0){i.setValue();c.setValue();w.setValue();w.getControl().trigger("blur");i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}u+=t[f].DueAmount}if(u!=0)i.setValue(u),n!="PO"?(c.setValue(u),i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())])):(i.getControl().removeClass("va012-mandatory"),i.getControl().attr("disabled",!0),e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"));else{i.setValue();c.setValue();w.setValue();w.getControl().trigger("blur");VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}}}}});gf.mousemove(function(n){t(".va012-div-tooltip").css("top",n.pageY-50).css("left",n.pageX)});e.on(VIS.Events.onTouchStartOrClick,function(){r(c.getControl().val())==0&&VIS.Utility.Util.getValueOfInt(st.value)>0||p.val()!="M"&&(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))<0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))*-1),e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]))});o.on(VIS.Events.onTouchStartOrClick,function(){r(c.getControl().val())==0&&VIS.Utility.Util.getValueOfInt(st.value)>0||p.val()!="M"&&(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))>0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))*-1),o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"),i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]))})},getNewRecordDesign:function(){},getNewRecordControls:function(){gt=f.find("#VA012_txtStatementNo_"+$self.windowNo);kf=f.find("#VA012_btnStatementNo_"+$self.windowNo);ci=f.find("#VA012_txtStatementPage_"+$self.windowNo);fr=f.find("#VA012_txtStatementLine_"+$self.windowNo);nt=f.find("#VA012_dtStatementDate_"+$self.windowNo);ot=f.find("#VA012_cmbContraType_"+$self.windowNo);ur=f.find("#VA012_cmbCashBook_"+$self.windowNo);er=f.find("#VA012_cmbTransferType_"+$self.windowNo);su=f.find("#VA012_txtCheckNo_"+$self.windowNo);p=f.find("#VA012_cmbVoucherMatch_"+$self.windowNo);i.getControl().addClass("va012-mandatory");c.getControl().addClass("va012-mandatory");k=f.find("#VA012_cmbDifferenceType_"+$self.windowNo);lr=f.find("#VA012_txtVoucherNo_"+$self.windowNo);yu=f.find("#VA012_txtDescription_"+$self.windowNo);or=f.find("#VA012_cmbCharge_"+$self.windowNo);rt=f.find("#VA012_txtCharge_"+$self.windowNo);ut=f.find("#VA012_cmbTaxRate_"+$self.windowNo);pu=f.find("#VA012_ctrlCashLine_"+$self.windowNo);tu=f.find("#VA012_ctrlPayment_"+$self.windowNo);rf=f.find("#VA012_ctrlOrder_"+$self.windowNo);uf=f.find("#VA012_ctrlInvoice_"+$self.windowNo);ff=f.find("#VA012_ctrlBusinessPartner_"+$self.windowNo);wu=f.find("#VA012_chkUseNextTime_"+$self.windowNo);ef=f.find("#VA012_btnSave_"+$self.windowNo);bu=f.find("#VA012_btnPaymentSchedule_"+$self.windowNo);ve=f.find("#VA012_btnPrepay_"+$self.windowNo);tr=f.find("#VA012_txtPaymentSchedule_"+$self.windowNo);df=f.find("#VA012_txtPrepayOrder_"+$self.windowNo);bt=bf.find("#VA012_btnNewRecord_"+$self.windowNo);ye=bf.find("#VA012_btnUndo_"+$self.windowNo);pe=v.find("#VA012_btnDelete_"+$self.windowNo);gf=f.find("#VA012_btnAmount_"+$self.windowNo);e=f.find("#VA012_btnIn_"+$self.windowNo);o=f.find("#VA012_btnOut_"+$self.windowNo);s=f.find("#VA012_txtCurrency_"+$self.windowNo);y=f.find("#VA012_txtConversionType_"+$self.windowNo);l=f.find("#VA012_txtPaymentMethod_"+$self.windowNo);g=f.find("#VA012_txtCheckNum_"+$self.windowNo);ft=f.find("#VA012_txtCheckDate_"+$self.windowNo);gu=f.find("#VA012_ctrlTrxOrg_"+$self.windowNo)},loadPaymentMethod:function(){function n(n){if(_cmbPaymentMethod.html(""),_cmbPaymentMethod.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)_cmbPaymentMethod.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].Value)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");_cmbPaymentMethod.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/LoadPaymentMethod",{AD_Client:VIS.Env.getCtx().getAD_Client_ID(),AD_Org:VIS.Env.getCtx().getAD_Org_ID()},n)},loadCurrency:function(){var n=VIS.Utility.Util.getValueOfInt(t("option:selected",h).attr("currencyid")),i=VIS.Utility.Util.getValueOfInt(t("option:selected",h).attr("stdprecision"));n>0?at=n:n=null;b=i>0?i:null},loadCashBook:function(){function n(n){if(ur.html(""),ur.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)ur.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].Value)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");ur.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/LoadCashbook",null,n)},loadContraType:function(){ot.html("");ot.append("<option value=0 ><\/option>");ot.append("<option value='BB' >"+VIS.Msg.getMsg("VA012_BankToBank")+"<\/option>");ot.append("<option value='CB' >"+VIS.Msg.getMsg("VA012_CashToBank")+"<\/option>");ot.prop("selectedIndex",0)},loadTransferType:function(){er.html("");er.append("<option value=0 ><\/option>");er.append("<option value='CH' >"+VIS.Msg.getMsg("VA012_Cash")+"<\/option>");er.append("<option value='CK' >"+VIS.Msg.getMsg("VA012_Check")+"<\/option>");er.prop("selectedIndex",0)},loadVoucherMatch:function(){p.html("");p.append("<option value='M' >"+VIS.Msg.getMsg("VA012_Payment")+"<\/option>");p.append("<option value='V' >"+VIS.Msg.getMsg("VA012_Voucher")+"<\/option>");p.append("<option value='C' >"+VIS.Msg.getMsg("VA012_Contra")+"<\/option>");p.prop("selectedIndex",0)},loadDifferenceType:function(){k.html("");k.append("<option value=0 ><\/option>");k.append("<option value='OU' >"+VIS.Msg.getMsg("VA012_OverUnderPayment")+"<\/option>");k.append("<option value='DA' >"+VIS.Msg.getMsg("VA012_DiscountAmount")+"<\/option>");k.append("<option value='WO' >"+VIS.Msg.getMsg("VA012_WriteoffAmount")+"<\/option>");k.append("<option value='CH' >"+VIS.Msg.getMsg("VA012_Charge")+"<\/option>");k.prop("selectedIndex",0)},loadCharge:function(){function n(n){if(or.html(""),or.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)or.append("<option value="+n[t].chargeID+">"+VIS.Utility.encodeText(n[t].name)+"<\/option>");or.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetChargeData",{voucherType:p.val()!=null?p.val():"",bankAcct:h.val()!=null?h.val():0},n)},loadTaxRate:function(){function n(n){if(ut.html(""),ut.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)ut.append("<option value="+n[t].C_Tax_ID+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");ut.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/LoadTaxRate",null,n)},loadPayment:function(){tu!=undefined&&tu!=null&&tu.empty();var n=VIS.Utility.Util.getValueOfInt(h.val())!=0?"C_Payment.DocStatus IN ('CO','CL') AND C_Payment.IsReconciled = 'N' AND C_Payment.C_BankAccount_ID = @BankAccount_ID@":"C_Payment.DocStatus IN ('CO','CL') AND C_Payment.IsReconciled = 'N' ";ge=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,0,VIS.DisplayType.Search,"C_Payment_ID",0,!1,n);tt=new VIS.Controls.VTextBoxButton("C_Payment_ID",!1,!1,!0,VIS.DisplayType.Search,ge);tt.getControl().addClass("va012-input-size-2");tt.getControl().attr("tabindex","10");tu.append(tt.getControl());tu.append(tt.getBtn(0));tu.append(tt.getBtn(1));tt.fireValueChanged=function(){if(VIS.Utility.Util.getValueOfInt(tt.value)!=0&&VIS.Utility.Util.getValueOfInt(ri)!=0){VIS.Utility.Util.getValueOfInt(ri)==tt.value?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(tt.setValue(ri,!1,!0),VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"",""));return}if(ri=0,ri=tt.value,ii||rr||tt.value&&(a.checkPaymentCondition(ri,0,r(i.getControl().val()))?a.setInvoiceAndBPartner(ri,"PY"):tt.setValue()),rr=!1,!tt.value&&ri==null&&tt.value==null){var n=f[0].attributes["data-uid"].value;f[0].attributes["data-uid"].value!=0||ri!=null||tt.value||u.refreshForm();n>0&&ri==null&&tt.value==null&&it.statementListRecordEdit(n,0,!0)}};rr=!1},loadOrder:function(){co=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,5043,VIS.DisplayType.Search,"C_Order_ID",0,!1,"C_ORDER_ID IN (SELECT ORD.C_ORDER_ID  FROM C_Order ORD  LEFT JOIN C_DocType DT  ON (ORD.C_DOCTYPETARGET_ID=DT.C_DOCTYPE_ID)  INNER JOIN VA009_PaymentMethod PM  ON (PM.VA009_PAYMENTMETHOD_ID =ORD.VA009_PAYMENTMETHOD_ID )  WHERE DT.DOCSUBTYPESO         ='PR'   AND ORD.DOCSTATUS             ='WP'   AND ORD.ISACTIVE              ='Y'   AND PM.VA009_PAYMENTBASETYPE !='B')");st=new VIS.Controls.VTextBoxButton("C_Order_ID",!1,!1,!0,VIS.DisplayType.Search,co,re("Sales Order"));st.getControl().addClass("va012-input-size-2");st.getControl().attr("tabindex","13");rf.append(st.getControl());rf.append(st.getBtn(0));rf.append(st.getBtn(1));st.fireValueChanged=function(){if(VIS.Utility.Util.getValueOfInt(st.value)!=0&&VIS.Utility.Util.getValueOfInt(kt)!=0){VIS.Utility.Util.getValueOfInt(kt)==st.value?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(st.setValue(kt,!1,!0),VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"",""));return}if(kt=0,kt=st.value,st.value&&(ii||(a.checkPrepayCondition(st.value,0,null,r(i.getControl().val()))?(a.setInvoiceAndBPartner(kt,"PO"),(f[0].attributes["data-uid"].value>0&&!kt||f[0].attributes["data-uid"].value==0&&kt)&&i.getControl().attr("disabled",!0)):(kt=0,st.setValue()))),!kt&&!st.value){var n=f[0].attributes["data-uid"].value;f[0].attributes["data-uid"].value!=0||kt!=null||st.value||u.refreshForm();n>0&&kt==null&&!st.value&&it.statementListRecordEdit(n,0,!0)}}},loadCashLine:function(){var n=" C_CASHLINE_ID IN (SELECT CSL.C_CASHLINE_ID  FROM C_Cash CS  INNER JOIN C_CashLine CSL  ON (CS.C_CASH_ID=CSL.C_CASH_ID)  INNER JOIN C_Charge chrg  ON (chrg.c_charge_id =csl.c_charge_id)  WHERE CS.ISACTIVE          ='Y'  AND CSL.CashType           ='C'  AND chrg.dtd001_chargetype ='CON'  AND CS.DOCSTATUS          IN ('CO','CL')  AND CSL.VA012_ISRECONCILED ='N'  AND CSL.C_BankAccount_ID ="+(h.val()==null?0:h.val())+" )";pu.html("");de=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,1008317,VIS.DisplayType.Search,"C_CashLine_ID",0,!1,n);et=new VIS.Controls.VTextBoxButton("C_CashLine_ID",!1,!1,!0,VIS.DisplayType.Search,de);et.getControl().addClass("va012-input-size-2");et.getControl().attr("tabindex","10");pu.append(et.getControl());pu.append(et.getBtn(0));pu.append(et.getBtn(1));et.fireValueChanged=function(){if(VIS.Utility.Util.getValueOfInt(et.value)!=0&&VIS.Utility.Util.getValueOfInt(oi)!=0){VIS.Utility.Util.getValueOfInt(oi)==et.value?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(et.setValue(oi,!1,!0),VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"",""));return}if(oi=0,oi=et.value,et.value&&(ii||rr||a.checkContraCondition(et.value,0,r(i.getControl().val()))||(oi=0,et.setValue()),rr=!1),rr=!1,oi==null&&et.value==null){var n=f[0].attributes["data-uid"].value;f[0].attributes["data-uid"].value!=0||oi!=null||et.value||u.refreshForm();n>0&&oi==null&&et.value==null&&it.statementListRecordEdit(n,0,!0)}}},loadBusinessPartner:function(){ne=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,2893,VIS.DisplayType.Search,"C_BPartner_ID",0,!1,null);ht=new VIS.Controls.VTextBoxButton("C_BPartner_ID",!1,!1,!0,VIS.DisplayType.Search,ne);ht.getControl().addClass("va012-input-size-2");ht.getControl().attr("tabindex","12");ff.append(ht.getControl());ff.append(ht.getBtn(0));ff.append(ht.getBtn(1));ht.fireValueChanged=function(){uu=0;uu=ht.value;uu>0?(gr.find("*").prop("disabled",!0),nf=0,ki.setValue()):(gr.find("*").prop("disabled",!1),nf=0)}},loadTrxOrg:function(){var n="AD_Org.IsActive='Y' AND AD_Org.IsSummary ='N' AND (AD_Org.IsCostCenter='Y' OR AD_Org.IsProfitCenter='Y') AND CAST(AD_Org.LegalEntityOrg AS int) IN(0,@BankAccount_Org_ID@) AND AD_Org.AD_Client_ID = "+VIS.context.getAD_Client_ID(),t=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,0,VIS.DisplayType.Search,"AD_Org_ID",0,!1,n);ki=new VIS.Controls.VTextBoxButton("AD_Org_ID",!1,!1,!0,VIS.DisplayType.Search,t,re("Organization Units"));ki.getControl().addClass("va012-input-size-2");ki.getControl().attr("tabindex","13");gu.append(ki.getControl());gu.append(ki.getBtn(0));gu.append(ki.getBtn(1));ki.fireValueChanged=function(){nf=0;nf=ki.value}},loadInvoice:function(){no=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,3484,VIS.DisplayType.MultiKey,"C_Invoice_ID",0,!1,"DocStatus IN ('CO','CL')");dt=new VIS.Controls.VTextBoxButton("C_Invoice_ID",!1,!1,!0,VIS.DisplayType.MultiKey,no);dt.isMultiKeyTextBox=!0;dt.getControl().addClass("va012-input-size-2");dt.getControl().attr("tabindex","11");uf.append(dt.getControl());uf.append(dt.getBtn(0));uf.append(dt.getBtn(1));dt.fireValueChanged=function(){fu=null;fu=dt.value;dt.value&&(a.checkInvoiceCondition(fu,r(i.getControl().val()))?a.setBPartner(fu):dt.setValue())}},getFormData:function(){var n={},t=[];return n._bankStatementLineID=f.attr("data-uid"),n._txtStatementNo=gt.val(),n._txtStatementPage=ci.val(),n._txtStatementLine=fr.val(),n._dtStatementDate=nt.val(),n._cmbCurrency=at,n._cmbVoucherMatch=p.val(),n._txtDescription=VIS.Utility.encodeText(yu.val()),n._txtVoucherNo=VIS.Utility.encodeText(lr.val()),n._cmbCharge=rt.attr("chargeid"),n._cmbTaxRate=ut.val(),n._txtTaxAmount=r(wt.getControl().val()),n._ctrlPayment=ri,n._ctrlOrder=kt,n._ctrlCashLine=oi,n._ctrlInvoice=fu,n._ctrlBusinessPartner=uu,n._chkUseNextTime=wu.is(":checked"),n._cmbBank=gi.val(),n._cmbBankAccount=h.val(),n._cmbBankAccountClasses=lf.val(),n._cmbTransactionType=ct.val(),n._scheduleList=d.toString(),n._cmbContraType=ot.val(),n._cmbCashBook=ur.val(),n._cmbTransferType=er.val(),n._txtCheckNo=su.val(),n._cmbDifferenceType=k.val(),k.val()=="CH"&&p.val()!="C"?(n._txtAmount=r(c.getControl().val()),n._txtTrxAmt=r(i.getControl().val())):(n._txtAmount=r(i.getControl().val()),n._txtTrxAmt=r(c.getControl().val())),n._txtDifference=r(w.getControl().val()),n._txtConversionType=y.val(),n._txtCurrency=s.val(),n._txtPaymentMethod=l.val(),n._txtCheckNum=g.val(),n._txtCheckDate=ft.val(),n._ctrlTrxOrg=nf,n._EftOrManualCheckNo=pi,n._OverrideAutoCheck=cr,t.push(n),t},insertNewRecord:function(n,i){t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/InsertData",contentType:"application/json; charset=utf-8",data:JSON.stringify({_formData:n}),success:function(n){i(n)},error:function(n){VIS.ADialog.info(n,null,"","")}})},afterInsertion:function(n){if(n!=null&&n!=""){var i=t.parseJSON(n);i=="Success"?(ni(v,!1,"absolute"),VIS.ADialog.info("VA012_RecordSaved",null,"",""),ti=[],vt.html(""),vi=1,it.loadStatement(hi),ui.html(""),u.scheduleRefresh(),u.prepayRefresh(),nr=1,storepaymentdata=[],a.loadPayments(h.val(),pt.val(),ct.val(),yt.val()),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),s.addClass("va012-mandatory"),y.addClass("va012-mandatory")):(ni(v,!1,"absolute"),i.contains(" ")?VIS.ADialog.info("",null,i,""):VIS.ADialog.info(i,null,"",""))}},refreshForm:function(n){f.attr("data-uid",0);(event==undefined||event.currentTarget.id!=kf[0].id)&&a.getMaxStatement("LO");nt.attr("readonly",!1);var r=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetStatementDate",{bankAcct:h.val()});r!=""&&r!=null?nt.val(Globalize.format(new Date(r),"yyyy-MM-dd")):nt.val(to);p.prop("selectedIndex",0);p.trigger("change");i.getControl().attr("disabled",!1);i.setValue(0);c.setValue(0);w.setValue(0);w.getControl().trigger("blur");w.getControl().attr("vchangable","Y");k.prop("selectedIndex",0);k.removeClass("va012-mandatory");w.getControl().removeClass("va012-mandatory");t("#Ast_DifferenceType_"+$self.windowNo).hide();t("#Ast_Difference_"+$self.windowNo).hide();t("#Ast_CashJournalLine_"+$self.windowNo).hide();et.getControl().removeClass("va012-mandatory");yu.val("");lr.val("");or.prop("selectedIndex",0);rt.attr("chargeid",0);rt.val("");ut.prop("selectedIndex",0);wt.setValue(0);wu.attr("checked",!1);tt.setValue();st.setValue();et.setValue();ht.setValue();n==undefined&&dt.setValue();uu=0;ri=0;kt=0;oi=0;fu=null;e.trigger("click");u.loadCurrency();ot.prop("selectedIndex",0);ur.prop("selectedIndex",0);er.prop("selectedIndex",0);su.val("");this.setNewFormDefaultCurrency();t(s[0]).find("option").show();this.setNewFormDefaultConversionType();l.attr("disabled",!1);t(".astric_"+$self.windowNo).hide();l.addClass("va012-mandatory");this.loadPaymentMethods();y.attr("disabled",!1);s.attr("disabled",!1);dr=!1;g.val("");sr.hide();g.removeClass("va012-mandatory");ft.val("");hr.hide();ft.removeClass("va012-mandatory");uo=null;cr=!1;pi=null;di=null;nu=0;ki.setValue()},scheduleRefresh:function(){d=[];wi=[];lt=[];tr.val("");di=null;nu=0},prepayRefresh:function(){eu=[];ou=[];df.val("");di=null;nu=0},refreshSelectedValues:function(){f.attr("data-uid",0);a.getMaxStatement("LO");nt.attr("readonly",!1);var n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetStatementDate",{bankAcct:h.val()});n!=""&&n!=null?nt.val(Globalize.format(new Date(n),"yyyy-MM-dd")):nt.val(to);i.getControl().attr("disabled",!1);i.setValue(0);c.setValue(0);w.setValue(0);w.getControl().trigger("blur");w.getControl().attr("vchangable","Y");k.prop("selectedIndex",0);k.removeClass("va012-mandatory");t("#Ast_DifferenceType_"+$self.windowNo).hide();yu.val("");lr.val("");or.prop("selectedIndex",0);rt.attr("chargeid",0);rt.val("");ut.prop("selectedIndex",0);wt.setValue(0);wu.attr("checked",!1);tt.setValue();st.setValue();et.setValue();ht.setValue();dt.setValue();uu=0;ri=0;kt=0;oi=0;fu=null;u.scheduleRefresh();e.trigger("click");ot.prop("selectedIndex",0);ur.prop("selectedIndex",0);er.prop("selectedIndex",0);su.val("");this.loadNewFormCurrency();y.addClass("va012-mandatory");this.loadConversionTypes();this.loadPaymentMethods();l.attr("disabled",!1);l.addClass("va012-mandatory");s.addClass("va012-mandatory");y.prop("selectedIndex",0);y.attr("disabled",!1);s.attr("disabled",!1);dr=!1;g.val("");sr.hide();g.removeClass("va012-mandatory");ft.val("");hr.hide();ft.removeClass("va012-mandatory")},newRecordDispose:function(){f=null;bf=null;gt=null;kf=null;ci=null;fr=null;nt=null;ot=null;ur=null;er=null;su=null;at=null;p=null;i=null;w=null;k=null;gf=null;e=null;o=null;yu=null;lr=null;or=null;rt=null;ut=null;wt=null;pu=null;rf=null;tu=null;uf=null;ff=null;wu=null;ef=null;bu=null;ve=null;tr=null;df=null;bt=null;ye=null;pe=null;bi=null;ho=null;ge=null;st=null;kt=null;tt=null;po=null;ri=null;et=null;de=null;oi=null;ne=null;ht=null;uu=null;no=null;dt=null;fu=null;to=null;ie=null;s=null;y=null;dr=null;l=null;ft=null;g=null;gu=null;ki=null;nf=null},loadNewFormCurrency:function(){var n=null,u,i,r;if(t(s[0]).empty(),u=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,457,VIS.DisplayType.TableDir,"C_Currency_ID",0,!1,"IsMyCurrency='Y'"),n=u.getData(!0,!0,!1,!1),s.append('<option value="0" ><\/option>'),n!=null&&n!=undefined&&n.length>0){for(i=0;i<n.length;i++)s.append("<option value="+n[i].Key+">"+n[i].Name+"<\/option>");r=VIS.Utility.Util.getValueOfInt(t("option:selected",h).attr("currencyid"));s.val(r);r<=0?s.addClass("va012-mandatory"):s.removeClass("va012-mandatory")}},loadConversionTypes:function(){var n=null,u,i,r;if(t(y[0]).empty(),u=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,10269,VIS.DisplayType.TableDir,"C_ConversionType_ID",0,!1,"IsActive='Y'"),n=u.getData(!0,!0,!1,!1),y.append('<option value="0" ><\/option>'),n!=null&&n!=undefined&&n.length>0){for(i=0;i<n.length;i++)y.append("<option value="+n[i].Key+">"+n[i].Name+"<\/option>");r=VIS.Env.getCtx().getContextAsInt("#C_ConversionType_ID");r!=0?(y.val(r),y.removeClass("va012-mandatory")):(y.val(0),y.addClass("va012-mandatory"))}},loadPaymentMethods:function(){if(t(l[0]).empty(),io&&(l.append('<option value="0" ><\/option>'),cu!=null&&cu.length>0)){for(var n=0;n<cu.length;n++)l.append("<option paymentbasetype="+cu[n].PaymentBaseType+" value="+cu[n].chargeID+">"+VIS.Utility.encodeText(cu[n].name)+"<\/option>");l.val(0);l.addClass("va012-mandatory");sr.hide();g.removeClass("va012-mandatory");hr.hide();ft.removeClass("va012-mandatory")}},setNewFormDefaultCurrency:function(){var n=VIS.Utility.Util.getValueOfInt(t("option:selected",h).attr("currencyid"));s.val(n);n<=0?s.addClass("va012-mandatory"):s.removeClass("va012-mandatory")},setNewFormDefaultConversionType:function(){var n=VIS.Env.getCtx().getContextAsInt("#C_ConversionType_ID");n!=0?(y.val(n),y.removeClass("va012-mandatory")):(y.val(0),y.addClass("va012-mandatory"))}};t(window).resize(function(){a.setPaymentListHeight();it.setStatementListHeight();yf.height(t("#VA012_mainContainer_"+$self.windowNo).height())});this.getRoot=function(){return v};this.setSize=function(){var n=t("#VA012_mainContainer_"+$self.windowNo).height();n==0&&(n=window.innerHeight-107);yf.height(n);a.setPaymentListHeight();it.setStatementListHeight()};this.disposeComponents=function(){$self=null;v=null;gi=null;h=null;lf=null;yt=null;oo=null;pt=null;ct=null;ee=null;oe=null;vt=null;ui=null;hi="";au=null;vu=null;vo=null;yo=null;ar=null;iu=null;_divCtrlCashLine=null;vr=null;ru=null;li=null;so=null;divRow4Col1TrxAmt=null;ku=null;yi=null;fi=null;we=null;ei=null;ai=null;yr=null;pr=null;wr=null;br=null;kr=null;si=null;be=null;se=null;he=null;ce=null;vf=null;yf=null;tf=null;fo=null;ti=[];d=[];wi=[];eu=[];ou=[];u.newRecordDispose();io=null;hu=_txtSearchPayment=_btnSearchPayment=null;uo=null;gr=null;gu=null;ki=null;cr=!1;pi=null;lu=null;di=null;nu=0;te=0}}i.prototype.sizeChanged=function(n){_table.height(n)};i.prototype.refresh=function(){this.setSize()};i.prototype.dispose=function(){this.disposeComponents();this.frame&&this.frame.dispose();this.frame=null};i.prototype.init=function(n,t){this.windowNo=n;this.frame=t;this.Initialize();this.frame.getContentGrid().append(this.getRoot());this.setSize()};n.AForms=n.AForms||{};n.AForms.bankStatement=i}(VA012,jQuery);VA012=window.VA012||{},function(n,t){n.UploadExcel=function(i,r,u){function ut(n){for(u.children().remove(),j=0;j<n.ExcelCol.length;j++)j==1?u.append("<li index="+j+" style='border:none;float:none' >"+n.ExcelCol[j]+"<\/li>"):u.append("<li index="+j+" >"+n.ExcelCol[j]+"<\/li>")}var k=null,f=[],c=[],l=0,o=0,a=Date.now().toString(),s=1048576,v=0,h=0,p=[],e=null,nt=i,ft=t(window).width(),et=t(window).height(),a=Date.now().toString(),ot=r;savedFileName="";var d=t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:40%;width: 40%;left: 32%;position:absolute;z-index:99999;'>"),w=null,b=null;this.isWait=!1;self=this;var tt=function(){var n=null,t=0;for(var i in f)t=parseInt(f[i].size/s),e.size%s>0&&t++,v+=t,n={},n.Name=f[i].name,n.Size=f[i].size,p.push(n);g()},g=function(){var t;if(f==null||f.length==0){y(!1);return}if(!(o>=f.length)){var n=new XMLHttpRequest,i=new FormData,r=f[o].name.substring(0,f[o].name.lastIndexOf("."))+a+f[o].name.substring(f[o].name.lastIndexOf("."));savedFileName=r;i.append("file",f[o].slice(h*s,h*s+Number(s)));n.open("POST",VIS.Application.contextUrl+"VA012/UploadExcel/SaveFileinTemp?fileName="+r+"&folderKey="+a+"&orgFileName="+f[o].name,!1);n.send(i);k=n.responseText;l++;h++;t=parseInt(f[o].size/s);f[o].size%s>0&&t++;h==t&&(o++,h=0);l<=v&&rt(parseInt(l/v*80));window.setTimeout(function(){g()},2)}},it=function(n){for(var i,w,r,b,t=[],u=0;u<n.files.length;u++){if(e=n.files[u],e==undefined)return;if(e.size<=0)return f=[],c=[],l=0,o=0,a=null,s=null,v=0,h=0,p=[],e=null,VIS.ADialog.info("VADMS_FileSizeShouldGreaterThan0KB"),y(!1),!1;if(e.name.indexOf("&")>-1||e.name.indexOf("?")>-1||e.name.indexOf("#")>-1||e.name.indexOf("/")>-1||e.name.indexOf("\\")>-1){t.push(e.name);continue}for(i in f)if(e.name==f[i].name){window.setTimeout(function(){y(!1);VIS.ADialog.info("fileAlreadyAttached")},20);return}if(c!=null)for(i in c)if(e.name==c[i].Name&&!c[i].IsDeleted){window.setTimeout(function(){y(!1);VIS.ADialog.info("fileAlreadyAttached")},20);return}w={};w.Name=e.name;w.Size=e.size;f.push(e)}if(t.length>0){r="";for(b in t)r+=t[b].toString()+"\n";r+=t.length==1?"File has":"Files have";r+=" invalid name. Please change the file name and try again.";y(!1);VIS.ADialog.info("",!0,r)}},y=function(n){if(t("body").find("#progressbar").remove(),n){w=t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute;height: 35px;'>");b=t("<span class='vis-ui-label'  style='position:absolute;left: 60%;top: 4px;'>").append("0%");w.append(b);d.append(w);var i=t("<div id='progressbar' style='z-index: 999999;' class='vadms-Busy-Progress'><\/div>");i.append(d);i.appendTo("<body>")}else t("body").find("progressbar").remove()},rt=function(n){w.css("width",n+"%");b.empty();b.append(n+"%")};return this.getFolderKey=a,this.getSavedFileName=savedFileName,this.GetUploadedExcelColumns=function(){var t,u,i;if(o>=f.length)return t=[],u=VIS.Application.contextUrl+"VA012/UploadExcel/SaveAttachmentEntries",t.push({Files:JSON.stringify(p)}),t.push({FolderKey:a}),t.push({FileName:savedFileName}),t.push({Mapping:r}),i=n.ControllerRequestAjaxParameter1(u,t,!1),r.ExcelCol=i.ExcelCol,r.FileName=i.FileName,ut(i),i},y(!0),it(i),tt(),k}}(VA012,jQuery);VA012=window.VA012||{},function(n){function t(){VIS.CalloutEngine.call(this,"VA012.VA012_Contra")}var r=VIS.Logging.Level,i=VIS.Utility.Util;VIS.Utility.inheritPrototype(t,VIS.CalloutEngine);t.prototype.SetContra=function(n,t,r,u,f){if(this.isCalloutActive())return"";if(this.setCalloutActive(!0),f==null)r.setValue("VA012_IsContra",!1);else{var e=VIS.dataContext.getJSONRecord("VA012/Statement/GetChargeType",i.getValueOfInt(f));e=="CON"?r.setValue("VA012_IsContra",!0):r.setValue("VA012_IsContra",!1)}return this.setCalloutActive(!1),""};t.prototype.SetConversionType=function(n,t,i,r,u,f){var o,h,e;if(this.isCalloutActive()||u==null||u.toString()=="")return i.setValue("StmtAmt",0),i.setValue("TrxAmt",0),i.setValue("ChargeAmt",0),i.setValue("C_ConversionType_ID",0),"";if(this.setCalloutActive(!0),VIS.Utility.Util.getValueOfInt(i.getValue("C_CashLine_ID"))>0){if(o=i.getValue("DateAcct"),o==null)return i.setValue("C_CashLine_ID",0),this.setCalloutActive(!1),"PlzSelectStmtDate";if(h=i.getValue("C_CashLine_ID").toString()+","+i.getValue("C_Currency_ID").toString()+","+o.toString()+","+i.getValue("AD_Org_ID").toString(),e=VIS.dataContext.getJSONRecord("VA012/Statement/GetCashDetails",h),e!=null){e.Amount!=0?(i.setValue("StmtAmt",e.Amount),i.setValue("TrxAmt",e.Amount),i.setValue("C_ConversionType_ID",e.C_ConversionType_ID)):(i.setValue("StmtAmt",0),i.setValue("TrxAmt",0),i.setValue("C_ConversionType_ID",0),i.setValue("C_CashLine_ID",0),VIS.ADialog.info("VA012_ConversionRateNotFound"));var c=VIS.Utility.Util.getValueOfDecimal(i.getValue("StmtAmt")),l=VIS.Utility.Util.getValueOfDecimal(i.getValue("TrxAmt")),s=c-l,a=VIS.Utility.Util.getValueOfDecimal(i.getValue("InterestAmt"));s=s-a;i.setValue("ChargeAmt",s)}}else i.getValue("C_Payment_ID")<=0&&i.setValue("C_ConversionType_ID",0);return this.setCalloutActive(!1),n=t=i=r=u=f=null,""};t.prototype.SetTenderType=function(n,t,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);var o=VIS.dataContext.getJSONRecord("VA012/Statement/GetPaymentRule",i.getValueOfInt(f));return o!=null&&o!=""&&(o=="D"?r.setValue("TenderType","D"):o=="K"?r.setValue("TenderType","C"):o=="S"?r.setValue("TenderType","K"):o=="T"?r.setValue("TenderType","A"):o=="L"?r.setValue("TenderType","L"):r.setValue("TenderType","A")),this.setCalloutActive(!1),n=t=r=u=f=e=null,""};t.prototype.SetPaymentMethod=function(n,t,r,u,f,e){var s,o;return this.isCalloutActive()||f==null||f.toString()==""?"":(this.setCalloutActive(!0),s="1",u.getColumnName()=="C_Invoice_ID"&&(s="1"),u.getColumnName()=="C_Order_ID"&&(s="2"),o=VIS.dataContext.getJSONRecord("VA012/Statement/GetPaymentMethod",i.getValueOfInt(f)+","+s),this.setCalloutActive(!1),o!=null&&o!=""&&(r.setValue("VA009_PaymentMethod_ID",o.VA009_PaymentMethod_ID),r.setValue("C_ConversionType_ID",o.C_ConversionType_ID)),n=t=r=u=f=e=null,"")};n.Model=n.Model||{};n.Model.VA012_Contra=t}(VA012,jQuery)
