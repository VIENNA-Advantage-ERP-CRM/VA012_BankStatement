/*Version 1.0.16.1*/
VA012 = window.VA012 || {}, function (n, t) { function i() { function se(n) { n != null && n != "" && (s = t(n), e.getControls(), e.setBankAndAccount(), u.newRecord(), e.getBaseCurrency(), e.loadPayments("0", "0", "PY"), he(), e.dragPayments(), e.dropPayments()) } function he() { ff.on(VIS.Events.onTouchStartOrClick, function (n) { n.stopPropagation(); var i = hu.width(); i > 50 && t(".va012-left-content").hide(); hu.animate({ width: i > 50 ? 40 : 200 }, 300, "swing", function () { i < 50 && t(".va012-left-content").show() }) }); ni.on("change", function () { h.val("0"); e.loadBankAccount() }); h.on("change", function () { u.loadCurrency(); u.loadCashLine(); it.html(""); u.scheduleRefresh(); u.prepayRefresh(); u.refreshForm(); ri = 1; e.loadPayments(h.val() == null ? 0 : h.val(), k.val(), p.val()); tt = []; w.html(""); gt = 1; c.loadStatement(pt) }); k.on("change", function () { it.html(""); ri = 1; e.loadPayments(h.val() == null ? 0 : h.val(), k.val(), p.val()) }); p.on("change", function () { p.val() == "CO" ? (k.prop("selectedIndex", 0), k.prop("disabled", !0)) : (k.prop("selectedIndex", 0), k.prop("disabled", !1)); it.html(""); u.scheduleRefresh(); u.prepayRefresh(); u.refreshForm(); ri = 1; e.loadPayments(h.val() == null ? 0 : h.val(), k.val(), p.val()) }); nf.on(VIS.Events.onTouchStartOrClick, function () { c.statementDialog() }); tf.on(VIS.Events.onTouchStartOrClick, function () { c.matchStatementDialog() }); vr.on(VIS.Events.onTouchStartOrClick, function () { c.paymentScheduleDialog() }); of.on(VIS.Events.onTouchStartOrClick, function () { c.prepayOrderDialog() }); lf.on(VIS.Events.onTouchStartOrClick, function () { b.val() != null && b.val() != "" ? (ui = !0, tt = [], w.html(""), gt = 1, c.loadStatement(pt)) : (tt = [], w.html(""), gt = 1, c.loadStatement(pt)) }); b.keypress(function (n) { n.which == 13 && (b.val() != null && b.val() != "" ? (ui = !0, tt = [], w.html(""), gt = 1, c.loadStatement(pt)) : (tt = [], w.html(""), gt = 1, c.loadStatement(pt))) }); rf.on(VIS.Events.onTouchStartOrClick, function () { tt.length > 0 ? t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/UnmatchStatement", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _statementLinesList: tt.toString() }), success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n[0]._status == "Success" && n[0]._statementOk != null && VIS.ADialog.info(n[0]._statementOk + " " + VIS.Msg.getMsg("VA012_StatementsUnmatched"), null, "", ""), n[0]._error != null && VIS.ADialog.info(n[0]._error, null, "", ""), n[0]._statementNo != null && VIS.ADialog.info(n[0]._statementNo + " " + VIS.Msg.getMsg("VA012_CompletedRecord"), null, "", ""), n[0]._statementNoNotUpdate != null && VIS.ADialog.info(n[0]._statementNoNotUpdate + " " + VIS.Msg.getMsg("VA012_ErrorSaving"), null, "", ""), u.scheduleRefresh(), u.prepayRefresh(), u.refreshForm(), tt = [], w.html(""), gt = 1, c.loadStatement(pt), it.html(""), u.scheduleRefresh(), u.prepayRefresh(), ri = 1, e.loadPayments(h.val(), k.val(), p.val())) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) : VIS.ADialog.info(VIS.Msg.getMsg("VA012_NoRecordSelected"), null, "", "") }); uf.on(VIS.Events.onTouchStartOrClick, function () { if (h.val() == null || h.val() == "" || h.val() == "0") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectBankAccountFirst"), null, "", ""); return } t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/ProcessStatement", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _statementLinesList: tt.toString(), _accountID: h.val() }), success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n[0]._statementProcessed != null && VIS.ADialog.info(n[0]._statementProcessed + " " + VIS.Msg.getMsg("VA012_StatementsProcessed"), null, "", ""), n[0]._error != null && VIS.ADialog.info(n[0]._error, null, "", ""), n[0]._statementNotProcessed != null && VIS.ADialog.info(n[0]._statementNotProcessed + " " + VIS.Msg.getMsg("VA012_StatementsNotProcessed"), null, "", ""), n[0]._statementUnmatchedLines != null && VIS.ADialog.info(n[0]._statementUnmatchedLines + " " + VIS.Msg.getMsg("VA012_ExistsUnmatched"), null, "", ""), u.scheduleRefresh(), u.prepayRefresh(), u.refreshForm(), tt = [], w.html(""), gt = 1, c.loadStatement(pt), it.html(""), u.scheduleRefresh(), u.prepayRefresh(), ri = 1, e.loadPayments(h.val(), k.val(), p.val())) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) }); hf.on(VIS.Events.onTouchStartOrClick, function () { tt.length > 0 || parseInt(o.attr("data-uid")) > 0 ? VIS.ADialog.ask(VIS.Msg.getMsg("VA012_WantToDelete")) && t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/DeleteStatement", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _statementLinesList: tt.toString(), _statementLineID: o.attr("data-uid") }), success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n[0]._status == "Success" && n[0]._statementProcessed != null && VIS.ADialog.info(n[0]._statementProcessed + " " + VIS.Msg.getMsg("VA012_StatementsDeleted"), null, "", ""), n[0]._statementNotProcessed != null && VIS.ADialog.info(n[0]._statementNotProcessed + " " + VIS.Msg.getMsg("VA012_StatementsNotDeleted"), null, "", ""), n[0]._error != null && VIS.ADialog.info(n[0]._error, null, "", ""), u.scheduleRefresh(), u.prepayRefresh(), u.refreshForm(), tt = [], w.html(""), gt = 1, c.loadStatement(pt), it.html(""), u.scheduleRefresh(), u.prepayRefresh(), ri = 1, e.loadPayments(h.val(), k.val(), p.val())) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) : VIS.ADialog.info(VIS.Msg.getMsg("VA012_NoRecordSelected"), null, "", "") }); it.on("scroll", e.paymentScroll); w.on("scroll", e.statementScroll); w.on(VIS.Events.onTouchStartOrClick, c.statementListEdit); w.on(VIS.Events.onTouchStartOrClick, c.openStatement); w.on(VIS.Events.onTouchStartOrClick, c.selectedStatementLinesList); it.on(VIS.Events.onTouchStartOrClick, c.selectedScheduleList); it.on(VIS.Events.onTouchStartOrClick, function () { f.trigger("blur") }) } function te(n, t) { w2ui["VA012_gridPayment_" + $self.windowNo] != null && w2ui["VA012_gridPayment_" + $self.windowNo].destroy(); var i = null; i = n.w2grid({ name: "VA012_gridPayment_" + $self.windowNo, recordHeight: 25, show: { toolbar: !1, selectColumn: !1, toolbarReload: !1, toolbarColumns: !1, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1 }, records: [], columns: [{ field: "_trxDate", caption: "Tran. Date", sortable: !1, size: "80px", display: !1 }, { field: "_trxNo", caption: "Auth Code/ Trx no.", sortable: !1, size: "30%", hidden: !1 }, { field: "_salesAmt", caption: "Sales Amount", sortable: !1, size: "15%", hidden: !1, style: "text-align: right" }, { field: "_netAmt", caption: "Net Amount", sortable: !1, size: "15%", hidden: !1, style: "text-align: right" }, { field: "_difference", caption: "Difference", sortable: !1, size: "15%", hidden: !1, style: "text-align: right" }, { field: "_chargeType", caption: "Charge Type", sortable: !1, size: "80px", display: !0 }, { field: "_taxRate", caption: "Tax Rate", sortable: !1, size: "80px", display: !0 }, { field: "_taxAmt", caption: "Tax Amt", sortable: !1, size: "15%", hidden: !1, style: "text-align: right" }, ], onChange: function () { }, onClick: function () { }, onDelete: function () { }, onSubmit: function () { } }); i.add(t) } function gu(n, t) { return t.indexOf(n) > -1 } function yt(n, i, r) { if (ou = t("<div class='vis-apanel-busy va012-busy-bank-statement'>"), ou.css({ position: r, width: "95%", height: "95%", "text-align": "center", visibility: "hidden" }), i) ou.css({ visibility: "visible" }); else { n.find(".va012-busy-bank-statement").remove(); return } n.append(ou) } var s, e, c, u; this.windowNo; $self = this; s = t("<div/>"); this.frame; var ou = null, ni = null, h = null, su = null, nf = null, tf = null, k = null, p = null, w = null, it = null, pt = "", hr = null, cr = null, br = null, bf = null, ui = !1, tt = [], d = [], ti = [], v = [], gi = [], er = [], rf = null, uf = null, ff = null, hu = null, cu = null, dt = 0, l = 2, wt = !1, ii = !1, ri = 1, gt = 1, lu = 50, au = 0, vu = 0, kf = null, o = null, yu = null, hi = null, ef = null, nr = null, fi = null, kr = null, ci = null, bt = null, oi = null, li = null, lr = null, y = null, f = null, g = null, rt = null, ut = null, dr = null, tr = null, ir = null, ft = null, kt = null, ai = null, ar = null, gr = null, nu = null, tu = null, iu = null, ru = null, uu = null, vr = null, of = null, rr = null, pu = null, ot = null, sf = null, hf = null, ie = null, re = null, vi = null, ur = null, yi = null, fr = null, st = null, yr = null, pr = null, si = null, ht = null, cf = null, ct = null, lt = null, pi = null, wi = null, bi = null, ki = null, di = null, b = null, lf = null, ei = null, df = null, wu = null, i = null, r = null, af = 0, vf = 0, gf = null, at = null, wr = null, yf = null, vt = null, bu = null, pf = null, nt = null, or = null, ue = null, ku = null, a = null, fu = null, wf = null, et = null, sr = null, du = new Date, ne = du.getFullYear() + "-" + ("0" + (du.getMonth() + 1)).slice(-2) + "-" + ("0" + du.getDate()).slice(-2), eu, fe, ee, oe; this.Initialize = function () { se(e.loadFormDesign()) }; e = { loadFormDesign: function () { var n = '  <div class="va012-assign-content">  <div id="VA012_mainContainer_' + $self.windowNo + '" class="va012-main-container">  <table id="VA012_table_' + $self.windowNo + '" style="width: 100%;"><tr><td id="VA012_tdLeft_' + $self.windowNo + '" style="width: 200px;position: relative;">   <div class="va012-left-part">              <div class="va012-left-title">                  <h4>                      <img id="VA012_btnHide_' + $self.windowNo + '" src="Areas/VA012/Images/lines.png" alt="lines" style = "cursor: pointer;" ><\/h4>              <\/div>              <div class="va012-left-content">                  <div class="va012-left-data">                      <label  id="VA012_lblBank_' + $self.windowNo + '" >' + VIS.Msg.getMsg("VA012_Bank") + '<\/label>                      <select id="VA012_cmbBank_' + $self.windowNo + '" ><\/select>                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <label  id="VA012_lblBankAccount_' + $self.windowNo + '" >' + VIS.Msg.getMsg("VA012_BankAccount") + '<\/label>                      <select id="VA012_cmbBankAccount_' + $self.windowNo + '"   ><\/select>                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <a id="VA012_btnLoadStatement_' + $self.windowNo + '">' + VIS.Msg.getMsg("VA012_LoadStatement") + '<\/a>                      <a id="VA012_btnMatchStatement_' + $self.windowNo + '">' + VIS.Msg.getMsg("VA012_MatchStatement") + '<\/a>                  <\/div>                  <!-- end of left-data -->              <\/div>              <!-- end of left-content -->          <\/div>          <!-- end of left-part --> <\/td> <td style="position: relative;">          <div id="VA012_contentArea_' + $self.windowNo + '" class="va012-content-area" style="position: absolute;" >              <div id="VA012_middleWrap_' + $self.windowNo + '" class="va012-middle-wrap">                  <div class="va012-mid-top-wrap" id="VA012_formBtnNewRecord_' + $self.windowNo + '">                      <div class="va012-icons-wrap">                              <img class="va012-undo" alt="undo" title="Undo" id="VA012_btnUndo_' + $self.windowNo + '"><\/span>                          <span>                              <img class="va012-hide-show-newform" src="Areas/VA012/Images/add.png" activestatus="0" alt="add" title = "Expand" id="VA012_btnNewRecord_' + $self.windowNo + '"><\/span>                      <\/div>                      <!-- end of icons-wrap -->                  <\/div>                  <!-- end of mid-top-wrap -->                    <div class="va012-form-wrap va012-newform" id="VA012_formNewRecord_' + $self.windowNo + '" data-uid="0">                      <div class="row va012-fl-padd">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementNumber") + '<\/label>                                  <input  tabindex="1" id="VA012_txtStatementNo_' + $self.windowNo + '" type="text" class="va012-input-size">                                  <a  id="VA012_btnStatementNo_' + $self.windowNo + '" class="va012-add-icon"><\/a>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementPage") + '<\/label>                                  <input tabindex="2" value="1" id="VA012_txtStatementPage_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementLine") + '<\/label>                                  <input tabindex="3" value="10" id="VA012_txtStatementLine_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementDate") + '<\/label>                                  <input tabindex="4" id="VA012_dtStatementDate_' + $self.windowNo + '" type="date">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data" >                                  <label>' + VIS.Msg.getMsg("VA012_Amount") + '<\/label>                                  <a tabindex="5" id="VA012_btnIn_' + $self.windowNo + '" v_active="1" class="va012-inout-icon va012-active">In<\/a>                                  <a tabindex="6" id="VA012_btnOut_' + $self.windowNo + '" v_active="0" class="va012-inout-icon va012-inactive">Out<\/a>                                  <input tabindex="7" autofocus  value="0.00" id="VA012_txtAmount_' + $self.windowNo + '" type="number" class="va012-input-size-amt va012-right-align va012-txtamount">                                <a id="VA012_btnAmount_' + $self.windowNo + '" class="va012-info-icon"><\/a>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_VoucherMatch") + '<\/label>                                  <select tabindex="8" id="VA012_cmbVoucherMatch_' + $self.windowNo + '">                                  <\/select>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                          <div class="col-md-8 col-sm-8 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_Description") + '<\/label>                                  <input tabindex="9" id="VA012_txtDescription_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divVoucherNo_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_VoucherNo") + '<\/label>                                  <input tabindex="9" id="VA012_txtVoucherNo_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                 <div id="VA012_divTrxAmt_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                   <label>' + VIS.Msg.getMsg("VA012_TrxAmt") + '<\/label>                                   <input disabled tabindex="9" id="VA012_txtTrxAmt_' + $self.windowNo + '" type="number" class="va012-right-align">                                 <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                 <div id="VA012_divDifference_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                   <label>' + VIS.Msg.getMsg("VA012_Difference") + '<\/label>                                   <input disabled tabindex="9" vchangable="Y" id="VA012_txtDifference_' + $self.windowNo + '" type="number" class="va012-right-align">                                 <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divDifferenceType_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_DifferenceType") + '<\/label>                                  <select tabindex="9" id="VA012_cmbDifferenceType_' + $self.windowNo + '">                                  <\/select>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divContraType_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_ContraType") + '<\/label>                                      <select tabindex="10" id="VA012_cmbContraType_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCashBook_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_CashBook") + '<\/label>                                      <select tabindex="10" id="VA012_cmbCashBook_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <div id="VA012_divCtrlCashLine_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_CashJournalLine") + '<\/label>                                      <div id="VA012_ctrlCashLine_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCheckNo_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_CheckNo") + '<\/label>                                      <input  disabled tabindex="12" id="VA012_txtCheckNo_' + $self.windowNo + '" type="text">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCharge_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_Charge") + '<\/label>                                      <div style=" position: relative; float: left; width: 100%; ">                                      <input tabindex="10" chargeid="" type="text" id="VA012_txtCharge_' + $self.windowNo + '" style=" width: 100%; ">                                      <img id="VA012_btnCharge_' + $self.windowNo + '" class="VA012-img-combo" alt="">                                     <\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divTaxRate_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_TaxRate") + '<\/label>                                      <select tabindex="11" id="VA012_cmbTaxRate_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divTaxAmount_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_TaxAmount") + '<\/label>                                      <input tabindex="12" class="va012-right-align"  value="0.00" id="VA012_txtTaxAmount_' + $self.windowNo + '" type="number">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlPayment_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_Payment") + '<\/label>                                      <div id="VA012_ctrlPayment_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlInvoice_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_Invoice") + '<\/label>                                      <div id="VA012_ctrlInvoice_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlBusinessPartner_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_BusinessPartner") + '<\/label>                                      <div id="VA012_ctrlBusinessPartner_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPaymentSchedule_' + $self.windowNo + '" class="va012-form-data" >                              <label>' + VIS.Msg.getMsg("VA012_PaymentSchedules") + '<\/label>                              <input disabled id="VA012_txtPaymentSchedule_' + $self.windowNo + '" type="text" class="va012-input-size">                              <a tabindex="13"  id="VA012_btnPaymentSchedule_' + $self.windowNo + '" class="va012-edit-icon"><\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPrepayOrder_' + $self.windowNo + '" class="va012-form-data" >                              <label>' + VIS.Msg.getMsg("VA012_PrepayOrders") + '<\/label>                              <div id="VA012_ctrlOrder_' + $self.windowNo + '" ><\/div>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                        <div class="row va012-fl-padd">                       <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-check">                                  <input tabindex="13" id="VA012_chkUseNextTime_' + $self.windowNo + '" type="checkbox">                                  <label style="position: absolute;">' + VIS.Msg.getMsg("VA012_UseNextTime") + '<\/label>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-2 col-sm-2 va012-padd-0" >                              <div class="va012-form-data" id="VA012_divMore_' + $self.windowNo + '">                                  <a tabindex="14" visiblestatus="0" class="va012-more" id="VA012_btnMore_' + $self.windowNo + '" href="#">' + VIS.Msg.getMsg("VA012_More") + '<\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-6 col-sm-6 va012-padd-0" >                          <div style="float:right;">                              <a tabindex="15" title="Save Record" id="VA012_btnSave_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" style=" float: left;">' + VIS.Msg.getMsg("VA012_SaveandNew") + '<\/a>                          <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                  <\/div>                  <!-- end of form-wrap -->                  <div id="VA012_paymentHeaderWrap_' + $self.windowNo + '" class="va012-payment-header-wrap">                          <div class="pull-left">                              <a class="va012-frm-btn va012-btn-gray" style="cursor: default;">' + VIS.Msg.getMsg("VA012_UpcomingTransactions") + '<\/a>                          <\/div>                      <div style=" float: right; width: 60%; ">                           <div class="va012-width-30" style=" float: left; width: 49%; ">                              <select id="VA012_cmbTransactionType_' + $self.windowNo + '">                             <option value="PY">' + VIS.Msg.getMsg("VA012_Payments") + '<\/option>                             <option value="PO">' + VIS.Msg.getMsg("VA012_PrepayOrders") + '<\/option>                              <option value="IS">' + VIS.Msg.getMsg("VA012_InvoiceSchedule") + '<\/option>                              <option value="CO">' + VIS.Msg.getMsg("VA012_Contra") + '<\/option>                              <\/select>                          <\/div>                          <div class="va012-width-30" style=" float: right; width: 49%; ">                              <select id="VA012_cmbSearchPaymentMethod_' + $self.windowNo + '">                              <\/select>                          <\/div>                          <\/div>                      <\/div>                      <!-- end of payment-header-wrap -->                  <div id="VA012_paymentList_' + $self.windowNo + '" class="va012-payment-list">                                           <div class="va012-payment-content" id="VA012_lstPayments_' + $self.windowNo + '">                   <\/div>                  <\/div>                  <!-- end of payment-list -->                <\/div>              <!-- end of middle-wrap -->              <div id="VA012_rightWrap_' + $self.windowNo + '" class="va012-right-wrap">                  <div id="VA012_rightTop_' + $self.windowNo + '" class="va012-right-top">                      <div class="row">                          <div class="col-md-3 col-sm-3" style=" padding-right: 5px; ">                              <div class="va012-pay-text" id="VA012_secReconciled_' + $self.windowNo + '" >                                <p>' + VIS.Msg.getMsg("VA012_Reconciled") + '<\/p>                                <p style="margin-top: 4px;">' + VIS.Msg.getMsg("VA012_Unreconciled") + '<\/p>                              <\/div>                          <\/div>                          <!-- end of col -->                          <div class="col-md-9 col-sm-9" style=" padding-left: 5px; ">                              <div class="va012-pay-text" id="VA012_secUnreconciled_' + $self.windowNo + '">                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-green"><span class="va012-base-curr"><\/span> 0<\/span>                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-red"><span class="va012-base-curr"><\/span> 0<\/span>                              <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                      <div class="row">                          <div class="col-md-12 col-sm-12" style=" padding-left: 5px; ">                      <div style=" /* float: right; */ padding-left: 10px;">                               <a id="VA012_btnUnmatch_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" title="Show Unmatched Record" style=" float: left; ">' + VIS.Msg.getMsg("VA012_Unmatch") + '<\/a>                              <a id="VA012_btnProcess_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" title="Clear Matched Record" style=" float: left; margin-left: 5px; ">' + VIS.Msg.getMsg("VA012_Process") + '<\/a>                             <a id="VA012_btnDelete_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" title="Delete Selected Record" style=" float: left; margin-left: 5px; ">' + VIS.Msg.getMsg("VA012_Delete") + '<\/a>                       <\/div>                           <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <div class="row">                          <div class="col-md-12 col-sm-12" style=" padding-right: 5px; ">                           <div class="va012-right-search">                            <div class="va012-search-wrap">                               <input id="VA012_txtSearch_' + $self.windowNo + '" value="" placeholder="' + VIS.Msg.getMsg("VA012_Search") + '..." type="text">                               <a id="VA012_btnSearch_' + $self.windowNo + '" class="va012-search-icon"><span class="glyphicon glyphicon-search"><\/span><\/a>                          <\/div>                      <!-- end of search-wrap -->                         <\/div>                  <!-- end of right-search -->                        <\/div>                       <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <\/div>                  <!-- end of right-top -->                    <div class="va012-right-content" id="VA012_lstStatement_' + $self.windowNo + '">                  <\/div>                  <!-- end of right-content -->              <\/div>              <!-- end of right-wrap -->          <\/div>          <!-- end of content-area -->  <\/td><\/tr><\/table>      <\/div>      <!-- end of main-container -->    <\/div>  <!-- end of assign-content -->  '; return eu = t('<div  id="VA012_gridMatchStatePopUp_' + $self.windowNo + '"" style="display:block;width:auto;height:auto"><div  style="    width: 50%;float: left;" ><label>' + VIS.Msg.getMsg("VA012_ChargeType") + '<\/label><select  id="VA012_cmbChargeType_' + $self.windowNo + '"><\/select><\/div><div ><label>' + VIS.Msg.getMsg("VA012_Taxrate") + '<\/label><select  id="VA012_cmbTaxRate_' + $self.windowNo + '"><\/select><\/div><div style="width:auto;height:270px" id="VA012_gridMatchState_' + $self.windowNo + '""><\/div><\/div>'), fe = eu.find("#VA012_gridMatchState_" + $self.windowNo), ee = eu.find("#VA012_cmbChargeType_" + $self.windowNo), oe = eu.find("#VA012_cmbTaxRate_" + $self.windowNo), n }, setBankAndAccount: function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/SetBankAndAccount", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n != null && (vu = n.Table[0].C_BANK_ID, au = n.Table[0].C_BANKACCOUNT_ID)); e.loadBank() } }) }, addEffect: function (n, t, i) { var r = { to: t, className: "wsp-ui-effects-transfer" }; n.effect("transfer", r, 600, i) }, setInvoiceAndBPartner: function (n, i) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/SetInvoiceAndBPartner", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _paymentID: n, _cmbTransactionType: i }, success: function (n) { if (n != null && n != "") if (n = t.parseJSON(t.parseJSON(n)), i == "PY") { n._invoiceID > 0 ? et.setValue(n._invoiceID, !1, !0) : et.setValue(); n._bPartnerID > 0 ? a.setValue(n._bPartnerID, !1, !0) : a.setValue(); var r = VIS.DB.executeScalar("SELECT COUNT(*) FROM AD_ModuleInfo WHERE Prefix='VA034_' AND IsActive='Y'"); r == 1 && n.VA034_DepositSlipNo != "" && tr.val(n.VA034_DepositSlipNo) } else i == "PO" ? a.value || a.setValue(n._bPartnerID, !1, !0) : i == "IS" && (a.value || a.setValue(n._bPartnerID, !1, !0)) } }) }, setBPartner: function (n) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/SetBPartner", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _invoiceID: n }, success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n > 0 ? a.setValue(n, !1, !0) : a.setValue()) } }) }, getMaxStatement: function (n) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/MaxStatement", type: "GET", datatype: "json", data: { _bankAccount: h.val() == null ? 0 : h.val(), _origin: n }, contentType: "application/json; charset=utf-8", success: function (n) { n != null && n != "" && (n = t.parseJSON(t.parseJSON(n)), hi.val(n.statementNo), nr.val(n.pageno), fi.val(n.lineno)) } }) }, getOverUnderPayment: function (n) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/getOverUnderPayment", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _paymentID: n }, success: function (n) { n != null && n != "" && (n = t.parseJSON(t.parseJSON(n)), n._difference != 0 && (rt.val(Math.abs(n._difference).toFixed(l)), si.find("*").prop("disabled", !1), ut.val(n._differenceType).prop("selected", !0), rt.attr("vchangable", "N"), y.val() == "M" && g.val(parseFloat(n._payamt).toFixed(l)))) } }) }, getControls: function () { ni = s.find("#VA012_cmbBank_" + $self.windowNo); h = s.find("#VA012_cmbBankAccount_" + $self.windowNo); su = s.find("#VA012_STAT_cmbBankAccountClassName_" + $self.windowNo); kf = s.find("#VA012_BankChargeDiv" + $self.windowNo); k = s.find("#VA012_cmbSearchPaymentMethod_" + $self.windowNo); p = s.find("#VA012_cmbTransactionType_" + $self.windowNo); nf = s.find("#VA012_btnLoadStatement_" + $self.windowNo); tf = s.find("#VA012_btnMatchStatement_" + $self.windowNo); w = s.find("#VA012_lstStatement_" + $self.windowNo); it = s.find("#VA012_lstPayments_" + $self.windowNo); hr = s.find("#VA012_secReconciled_" + $self.windowNo); cr = s.find("#VA012_secUnreconciled_" + $self.windowNo); b = s.find("#VA012_txtSearch_" + $self.windowNo); lf = s.find("#VA012_btnSearch_" + $self.windowNo); rf = s.find("#VA012_btnUnmatch_" + $self.windowNo); uf = s.find("#VA012_btnProcess_" + $self.windowNo); ff = s.find("#VA012_btnHide_" + $self.windowNo); hu = s.find("#VA012_tdLeft_" + $self.windowNo); cu = s.find("#VA012_table_" + $self.windowNo); ei = s.find("#VA012_btnMore_" + $self.windowNo); df = s.find("#VA012_divMore_" + $self.windowNo); vi = s.find("#VA012_divContraType_" + $self.windowNo); ur = s.find("#VA012_divCashBook_" + $self.windowNo); _divCtrlCashLine = s.find("#VA012_divCtrlCashLine_" + $self.windowNo); yi = s.find("#VA012_divTransferType_" + $self.windowNo); fr = s.find("#VA012_divCheckNo_" + $self.windowNo); st = s.find("#VA012_divVoucherNo_" + $self.windowNo); yr = s.find("#VA012_divTrxAmt_" + $self.windowNo); pr = s.find("#VA012_divDifference_" + $self.windowNo); si = s.find("#VA012_divDifferenceType_" + $self.windowNo); ht = s.find("#VA012_divCharge_" + $self.windowNo); cf = s.find("#VA012_btnCharge_" + $self.windowNo); ct = s.find("#VA012_divTaxRate_" + $self.windowNo); lt = s.find("#VA012_divTaxAmount_" + $self.windowNo); pi = s.find("#VA012_divCtrlPayment_" + $self.windowNo); wi = s.find("#VA012_divCtrlInvoice_" + $self.windowNo); bi = s.find("#VA012_divCtrlBusinessPartner_" + $self.windowNo); ki = s.find("#VA012_divPrepayOrder_" + $self.windowNo); di = s.find("#VA012_divPaymentSchedule_" + $self.windowNo) }, getBaseCurrency: function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetBaseCurrency", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", success: function (n) { n != null && n != "" && (n = t.parseJSON(t.parseJSON(n)), br = n._code, bf = n._id, t(".va012-base-curr").text(br)) } }) }, loadBank: function () { function i(t) { if (ni.html(""), ni.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++) ni.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_bank_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null; ni.prop("selectedIndex", 0); vu > 0 && (ni.val(vu).prop("selected", !0), vu = 0); e.loadBankAccount() } var n = "SELECT NAME,C_BANK_ID FROM C_Bank WHERE ISACTIVE='Y'", t; n = VIS.MRole.getDefault().addAccessSQL(n, "C_Bank", !0, !1); t = VIS.DB.executeDataSet(n.toString(), null, i) }, loadBankAccount: function () { function t(t) { if (h.html(""), h.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++) h.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_bankaccount_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.accountno) + "<\/option>"); t.dispose(); t = null; n = null; h.prop("selectedIndex", 0); au > 0 && (h.val(au).prop("selected", !0), au = 0); e.getMaxStatement("LO"); e.loadSearchPaymentMethod() } var n = "SELECT ACCOUNTNO,C_BANKACCOUNT_ID FROM C_BANKACCOUNT WHERE ISACTIVE='Y' AND C_BANK_ID=" + ni.val(), i = VIS.DB.executeDataSet(n.toString(), null, t) }, LoadPaymentsPages: function (n, i, r) { ui = b.val() != null && b.val() != "" ? !0 : !1; t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadPaymentsPages", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _accountID: n, _paymentPageNo: ri, _PAGESIZE: lu, _paymentMethodID: i, _transactionType: r }, success: function (n) { n != null && n != "" && (vf = JSON.parse(n)) } }) }, loadPayments: function (n, i, r) { function u(n) { var u, i, f, o; if (n = t.parseJSON(n), u = "", n != null && n.length > 0) for (i = 0; i < n.length; i++) f = "va012-red-color", f = n[i].c_bankstatementline_id == null || n[i].c_bankstatementline_id == "0" || n[i].c_bankstatementline_id == 0 ? "va012-red-color" : "va012-green-color", u = "", u = '<div class="drag-no-drag"><div draggable="true" class="va012-mid-data-wrap ', (r == "PY" || r == "CO") && (u += f), u += ' " paymentdata="' + VIS.Utility.encodeText(n[i].paymentno) + "/" + VIS.Utility.encodeText(n[i].businesspartner) + '" data-uid="' + n[i].c_payment_id, u += ' " paymentamount = " ' + VIS.Utility.Util.getValueOfDecimal(n[i].convertedamount, "N") + '"><div class="va012-payment-wrap" ><div class="row"> <div class="col-md-3 col-sm-3">    <div class="va012-form-check">        <input type="checkbox" data-uid="' + n[i].c_payment_id + '"  >    <div title="Payment" class="va012-inside-form-check" style=" float: left; width: 85%; ">      <label style=" width: 100%; ">' + n[i].currency + " " + Globalize.format(n[i].paymentamount, "N") + "<\/label>", n[i].isconverted == "Y" && (u += "      <span>" + n[i].basecurrency + " " + Globalize.format(n[i].convertedamount, "N") + "<\/span>"), u += '   <\/div><\/div>    <!-- end of form-group -->  <\/div>  <!-- end of col -->  <div class="col-md-4 col-sm-4">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Business Partner">' + VIS.Utility.encodeText(n[i].businesspartner) + "<\/p>         <span>" + VIS.Utility.encodeText(n[i].bpgroup) + '<\/span>       <span title="Document No.">' + VIS.Utility.encodeText(n[i].paymentno) + '<\/span>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col --> <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text"><p title="Payment Type">' + VIS.Utility.encodeText(n[i].paymenttype) + "<\/p><\/div><\/div><!-- end of form-group --><\/div><!-- end of col -->", o = VIS.Utility.Util.getValueOfInt(VIS.DB.executeScalar("SELECT Count(AD_ModuleInfo_ID) FROM AD_ModuleInfo WHERE PREFIX='VA034_' AND IsActive = 'Y'")), u += r == "PY" && o > 0 ? '  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Deposit Slip No">' + VIS.Utility.encodeText(n[i].depositslipno) + '<\/p>           <p title="Authentication Code">' + VIS.Utility.encodeText(n[i].authcode) + "<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->" : '  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Authentication Code">' + VIS.Utility.encodeText(n[i].authcode) + "<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->", u += "<\/div><!-- end of row --><\/div> <!-- end of payment-wrap --><\/div> <!-- end of mid-data-wrap -->", u += '<div class="va012-mid-data-wrap-img-no-drag ">', u += r == "PY" && o > 0 ? '<div class="col-md-1 col-sm-1">' : '<div class="col-md-3 col-sm-3">', + '  <div class="va012-form-data">', u += n[i].imageurl != null && n[i].imageurl != "" ? '    <img src="' + n[i].imageurl + '" alt=""x>' : '<img src="Areas/VA012/Images/defaultBP.png" alt=""x>', u += "<\/div><\/div><\/div><!-- end of no-drag --><\/div><!-- end of drag-no-drag -->", it.append(u); _sql = null; e.setPaymentListHeight(); e.dragPayments() } yt(t(it), !0, "inherit"); window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadPayments", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _accountID: n, _paymentPageNo: ri, _PAGESIZE: lu, _paymentMethodID: i, _transactionType: r }, success: function (n) { n != null && n != "" && (u(n), yt(t(it), !1, "inherit")) }, error: function () { yt(t(it), !1, "inherit") } }) }, 2) }, setPaymentListHeight: function () { var n; clearTimeout(n); n = setTimeout(function () { t("#VA012-content-area" + $self.windowNo).height(t("#VA012_mainContainer_" + $self.windowNo).height() - 20); ot.attr("activestatus") == "1" ? t("#VA012_paymentList_" + $self.windowNo).height(t("#VA012_middleWrap_" + $self.windowNo).height() - t("#VA012_formBtnNewRecord_" + $self.windowNo).height() - t("#VA012_formNewRecord_" + $self.windowNo).height() - t("#VA012_paymentHeaderWrap_" + $self.windowNo).height() - 42) : t("#VA012_paymentList_" + $self.windowNo).height(t("#VA012_middleWrap_" + $self.windowNo).height() - t("#VA012_formBtnNewRecord_" + $self.windowNo).height() - t("#VA012_paymentHeaderWrap_" + $self.windowNo).height() - 27) }, 2) }, loadSearchPaymentMethod: function () { function i(t) { if (k.html(""), k.append("<option value=0 >" + VIS.Msg.getMsg("VA012_SelectPaymentMethod") + "<\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++) k.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.va009_paymentmethod_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.va009_name) + "<\/option>"); t.dispose(); t = null; n = null; k.prop("selectedIndex", 0); h.trigger("change") } var n = "SELECT VA009_NAME,VA009_PAYMENTMETHOD_ID FROM VA009_PAYMENTMETHOD WHERE ISACTIVE='Y' AND VA009_PAYMENTBASETYPE!='B' AND AD_CLIENT_ID=" + VIS.Env.getCtx().getAD_Client_ID(), t; VIS.Env.getCtx().getAD_Org_ID() != 0 && (n += " AND AD_ORG_ID IN( " + VIS.Env.getCtx().getAD_Org_ID() + ",0)"); t = VIS.DB.executeDataSet(n.toString(), null, i) }, paymentScroll: function () { vf = 0; t(this).scrollTop() > 0 && t(this).scrollTop() + t(this).innerHeight() + 2 >= this.scrollHeight && (e.LoadPaymentsPages(h.val(), k.val(), p.val()), ri < vf && (ri++, e.loadPayments(h.val(), k.val(), p.val()))) }, statementScroll: function () { af = 0; t(this).scrollTop() > 0 && t(this).scrollTop() + t(this).innerHeight() + 1 >= this.scrollHeight && (c.LoadStatementsPages(), gt < af && (gt++, c.loadStatement(pt))) }, dragPayments: function () { it.find(".va012-mid-data-wrap").draggable({ start: function (n, t) { t.helper.addClass("va012-dragging") }, drag: function () { }, stop: function (n, t) { t.helper.removeClass("va012-dragging") }, cursor: "move", cursorAt: { left: 5 }, revert: "invalid", helper: "clone" }) }, dropPayments: function () { w.find(".va012-right-data-wrap").droppable({ hoverClass: "va012-dropping", drop: function (n, s) { var a, y, h, w; if (t(s.draggable).data("uid") > 0 && t(this).data("uid") > 0) { if (p.val() == "PY") { if (h = t(s.draggable).data("uid"), t(s.draggable).hasClass("va012-green-color")) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PaymentAlreadyMatchedOthrStatement"), null, "", ""); return } w = t(this).data("uid"); e.checkPaymentCondition(t(s.draggable).data("uid"), t(this).data("uid"), f.val()) && (c.statementOpenEdit(t(this).data("uid")), window.setTimeout(function () { wt = !0; nt.setValue(h, !1, !0); e.setInvoiceAndBPartner(t(s.draggable).data("uid"), "PY"); wt = !1 }, 200)) } else if (p.val() == "IS") { if (parseInt(o.attr("data-uid")) != t(this).data("uid") && u.scheduleRefresh(), e.checkScheduleCondition(t(s.draggable).data("uid"), t(this).data("uid"), d.toString(), f.val())) { if (gu(parseInt(t(s.draggable).data("uid")), d)) VIS.ADialog.info(VIS.Msg.getMsg("VA012_AlreadySelected"), null, "", ""); else if (d.push(parseInt(t(s.draggable).data("uid"))), ti.push(t(s.draggable).attr("paymentdata")), v.push(t(s.draggable).attr("paymentamount")), Number(v[0]) == "0") { for (a = 0, y = 0; y < v.length; y++) a += VIS.Utility.Util.getValueOfDecimal(v[y]); a < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")); f.val(a.toFixed(l)) } wt = !0; c.statementOpenEdit(t(this).data("uid")); e.setInvoiceAndBPartner(t(s.draggable).data("uid"), "IS"); rr.val(ti.toString()); window.setTimeout(function () { for (var t = 0, n = 0; n < v.length; n++) t += VIS.Utility.Util.getValueOfDecimal(v[n]); g.val(t.toFixed(l)); g.trigger("change") }, 200) } } else p.val() == "PO" && (parseInt(o.attr("data-uid")) != t(this).data("uid") && u.prepayRefresh(), e.checkPrepayCondition(t(s.draggable).data("uid"), t(this).data("uid"), gi.toString(), f.val()) && (c.statementOpenEdit(t(this).data("uid")), window.setTimeout(function () { wt = !0; at.setValue(t(s.draggable).data("uid"), !1, !0); e.setInvoiceAndBPartner(t(s.draggable).data("uid"), "PO"); wt = !1 }, 200))); if (p.val() == "CO") { if (h = t(s.draggable).data("uid"), t(s.draggable).hasClass("va012-green-color")) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_CashLineAlreadyMatchedOthrStmt"), null, "", ""); return } w = t(this).data("uid"); e.checkContraCondition(t(s.draggable).data("uid"), t(this).data("uid"), f.val()) && (c.statementOpenEdit(t(this).data("uid")), window.setTimeout(function () { wt = !0; vt.setValue(h, !1, !0); wt = !1 }, 200)) } } } }); o.droppable({ hoverClass: "va012-dropping", drop: function (n, u) { var s, o; if (t(u.draggable).data("uid") > 0) { if (p.val() == "CO") if (y.val() == "C") { if (bt.val() != "CB") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_ContraSelectCashToBank"), null, "", ""); return } } else { VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectVoucherContra"), null, "", ""); return } else if (y.val() != "M") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectVoucherPayment"), null, "", ""); return } if (p.val() == "PY") { if (t(u.draggable).hasClass("va012-green-color")) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PaymentAlreadyMatchedOthrStatement"), null, "", ""); return } t(u.draggable).data("uid") > 0 && e.checkPaymentCondition(t(u.draggable).data("uid"), t(this).attr("data-uid"), f.val()) && nt.setValue(t(u.draggable).data("uid"), !1, !0) } if (p.val() == "IS" && e.checkScheduleCondition(t(u.draggable).data("uid"), t(this).attr("data-uid"), d.toString(), f.val())) { if (gu(parseInt(t(u.draggable).data("uid")), d)) VIS.ADialog.info(VIS.Msg.getMsg("VA012_AlreadySelected"), null, "", ""); else { if (d.push(parseInt(t(u.draggable).data("uid"))), ti.push(t(u.draggable).attr("paymentdata")), f.val() == "0.00" && v.push("0"), v.push(t(u.draggable).attr("paymentamount")), Number(v[0]) == "0") { for (s = 0, o = 0; o < v.length; o++) s += VIS.Utility.Util.getValueOfDecimal(v[o]); s < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")); f.val(s.toFixed(l)) } e.setInvoiceAndBPartner(t(u.draggable).data("uid"), "IS") } for (rr.val(ti.toString()), s = 0, o = 0; o < v.length; o++) s += VIS.Utility.Util.getValueOfDecimal(v[o]); g.val(s.toFixed(l)); g.trigger("change") } if (p.val() == "PO" && e.checkPrepayCondition(t(u.draggable).data("uid"), t(this).attr("data-uid"), gi.toString(), f.val()) && (at.setValue(t(u.draggable).data("uid"), !1, !0), e.setInvoiceAndBPartner(t(u.draggable).data("uid"), "PO")), p.val() == "CO" && t(u.draggable).data("uid") > 0) { if (t(u.draggable).hasClass("va012-green-color")) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_CashLineAlreadyMatchedOthrStmt"), null, "", ""); return } e.checkContraCondition(t(u.draggable).data("uid"), t(this).attr("data-uid"), f.val()) && vt.setValue(t(u.draggable).data("uid"), !1, !0) } } wt = !1 } }) }, checkFormPaymentCondition: function (n, u) { var e = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckFormPaymentCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _paymentID: n, _amount: u }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (e = !0, n._amount != null && n._amount != 0 && (f.val(n._amount.toFixed(l)), f.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")))) : (VIS.ADialog.info(VIS.Msg.getMsg(n._status), null, "", ""), e = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); e = !1 } }), e }, checkFormPrepayCondition: function (n, u) { var o = 0, e; return a.value && (o = a.value), e = !1, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckFormPrepayCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _orderID: n, _amount: u, _currencyId: dt, _formBPartnerID: o }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (e = !0, n._amount > 0 && (f.val(n._amount.toFixed(l)), f.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")))) : (VIS.ADialog.info(VIS.Msg.getMsg(n._status), null, "", ""), e = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); e = !1 } }), e }, checkInvoiceCondition: function (n, i) { var r = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckInvoiceCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _invoiceID: n, _amount: i }, success: function (n) { n = t.parseJSON(n); n == "Success" ? r = !0 : (VIS.ADialog.info(VIS.Msg.getMsg(n), null, "", ""), r = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); r = !1 } }), r }, checkPaymentCondition: function (n, u, e) { var o = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckPaymentCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: u, _amount: e }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (o = !0, n._amount != null && n._amount != 0 && (f.val(n._amount.toFixed(l)), f.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")), g.val(n._trxamount.toFixed(l)))) : (VIS.ADialog.info(VIS.Msg.getMsg(n._status), null, "", ""), o = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); o = !1 } }), o }, checkScheduleCondition: function (n, i, r, u) { var e, f; if (dt == null || dt == 0) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectBankAccountFirst"), null, "", ""); return } return e = 0, a.value && (e = a.value), f = !1, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckScheduleCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: i, _listToCheck: r, _amount: u, _currencyId: dt, _formBPartnerID: e }, success: function (n) { n = t.parseJSON(n); n == "Success" ? f = !0 : (VIS.ADialog.info(VIS.Msg.getMsg(n), null, "", ""), f = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); f = !1 } }), f }, checkScheduleTotal: function (n, i, r) { var u = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckScheduleTotal", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _listToCheck: n, _amount: i, _currencyId: dt, _destinationID: r }, success: function (n) { n = t.parseJSON(n); n == "Success" ? u = !0 : (VIS.ADialog.info(VIS.Msg.getMsg(n), null, "", ""), u = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); u = !1 } }), u }, checkPrepayCondition: function (n, u, e, o) { var h = 0, s; return a.value && (h = a.value), s = !1, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckPrepayCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: u, _listToCheck: e, _amount: o, _currencyId: dt, _formBPartnerID: h }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (s = !0, n._amount > 0 && (f.val(n._amount.toFixed(l)), f.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")))) : (VIS.ADialog.info(VIS.Msg.getMsg(n._status), null, "", ""), s = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); s = !1 } }), s }, checkContraCondition: function (n, u, e) { var s = 0, o; return a.value && (s = a.value), o = !1, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckContraCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: u, _amount: e, _currencyId: dt, _formBPartnerID: s }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (o = !0, f.val(n._amount.toFixed(l)), f.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0"))) : (VIS.ADialog.info(VIS.Msg.getMsg(n._status), null, "", ""), o = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); o = !1 } }), o }, matchByDrag: function (n, u) { var e = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/MatchByDrag", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragPaymentID: n, _dragStatementID: u }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (e = !0, n._amount != null && n._amount != 0 && (f.val(n._amount.toFixed(l)), f.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")), ft.trigger("focus"))) : (VIS.ADialog.info(VIS.Msg.getMsg(n._status), null, "", ""), e = !1) }, error: function () { VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", ""); e = !1 } }), e } }; c = { statementDialog: function () { function p() { a = $statement.find("#VA012_STAT_cmbBank_" + $self.windowNo); r = $statement.find("#VA012_STAT_cmbBankAccount_" + $self.windowNo); e = $statement.find("#VA012_STAT_cmbBankAccountClassName_" + $self.windowNo); o = $statement.find("#VA012_STAT_txtStatementNo_" + $self.windowNo); l = $statement.find("#VA012_ctrlLoadFile_" + $self.windowNo); STAT_ctrlLoadFileTxt = $statement.find("#VA012_ctrlLoadFileTxt_" + $self.windowNo); _tabFile = $statement.find("#VA012_STAT_tabFile_" + $self.windowNo); _tabSchedule = $statement.find("#VA012_STAT_tabSchedule_" + $self.windowNo); su = $statement.find("#VA012_STAT_cmbBankAccountClassName_" + $self.windowNo) } function k() { a.html(""); a.append("<option value=" + ni.val() + ">" + ni.children()[ni[0].selectedIndex].text + "<\/option>"); a.prop("selectedIndex", 0) } function d() { r.html(""); r.append("<option value=" + h.val() + ">" + h.children()[h[0].selectedIndex].text + "<\/option>"); r.prop("selectedIndex", 0) } function g() { function t(t) { var i, r; if (e.html(""), e.append("<option value=0 ><\/option>"), t != null) for (i = 0; i < t.tables[0].rows.length; i++) r = t.tables[0].rows[i].cells.va012_bankstatementclass_id, e.append("<option value=" + r + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null; e.prop("selectedIndex", 0) } var n = " SELECT BSC.VA012_BANKSTATEMENTCLASSNAME AS NAME, CONCAT(CONCAT(SC.NAME,'_'),VA012_BANKSTATEMENTCLASS_ID) AS VA012_BANKSTATEMENTCLASS_ID FROM VA012_BANKSTATEMENTCLASS BSC INNER JOIN VA012_STATEMENTCLASS SC ON BSC.VA012_STATEMENTCLASS_ID=SC.VA012_STATEMENTCLASS_ID WHERE C_BANKACCOUNT_ID = " + h.val(), i = VIS.DB.executeDataSet(n.toString(), null, t) } function nt() { function t(t) { if (t != null) for (var i = 0; i < t.tables[0].rows.length; i++) y = VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_charge_id); t.dispose(); t = null; n = null } var n = "SELECT C_CHARGE_ID, NAME FROM C_CHARGE WHERE ISACTIVE = 'Y' AND AD_CLIENT_ID = " + VIS.Env.getCtx().getAD_Client_ID() + " AND ROWNUM = 1 ORDER BY NAME  ", i = VIS.DB.executeDataSet(n.toString(), null, t) } function it() { v = null; $statement = null; a = null; r = null; o = null; l = null; STAT_ctrlLoadFileTxt = null; _tabSchedule = null; _tabFile = null; i = null } var a = null, r = null, e = null, y = null, o = null, l = null, i = null, v, f; $statement = t("<div class='va012-popform-content'>"); v = ""; v = "<div><div class='va012-left-btn'><a id='VA012_STAT_tabFile_" + $self.windowNo + "' class='btn va012-blueBtn' activestatus='1'>" + VIS.Msg.getMsg("VA012_File") + "<\/a><\/div><\/div><div style='border: 2px solid #1AA0ED;padding: 10px; float: left;'><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_Bank") + "<\/label><select id='VA012_STAT_cmbBank_" + $self.windowNo + "' disabled><\/select><\/div> <div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_BankAccount") + "<\/label><select id='VA012_STAT_cmbBankAccount_" + $self.windowNo + "' disabled><\/select><\/div><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_ClassName") + "<\/label><select id='VA012_STAT_cmbBankAccountClassName_" + $self.windowNo + "'><\/select><\/div><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_StatementNumber") + "<\/label><input type='text' id='VA012_STAT_txtStatementNo_" + $self.windowNo + "' /> <\/div><div class='va012-popform-data va012-pop-file'><label>" + VIS.Msg.getMsg("VA012_SelectFile") + "<\/label><input type='text' id='VA012_ctrlLoadFileTxt_" + $self.windowNo + "' disabled><div class='va012-file-upload'><label for='file-input' class='va012-file-label'>" + VIS.Msg.getMsg("VA012_Browse") + "<\/label><input id='VA012_ctrlLoadFile_" + $self.windowNo + "' type='file' accept='.csv,text/plain,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel'/><\/div><\/div><\/div>"; $statement.append(v); p(); k(); d(); g(); nt(); f = new VIS.ChildDialog; f.setContent($statement); f.setTitle(VIS.Msg.getMsg("VA012_LoadStatement")); f.setWidth("500px"); f.setEnableResize(!1); f.setModal(!0); f.show(); o.on("keypress", function (n) { if (n.which != 8 && n.which != 0 && (n.which < 48 || n.which > 57)) return !1 }); l.on("change", function () { var u = this; r.val() != null && r.val() > 0 ? (i = t.parseJSON(n.UploadExcel(u, null, null)), STAT_ctrlLoadFileTxt.val(i._orgfilename)) : (l = null, VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectBankAccountFirst"), null, "", "")) }); f.onOkClick = function () { if (b.val(""), _tabFile.attr("activestatus") == "1") { if (r.val() == null || r.val() == "" || r.val() == "0") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectBankAccountFirst"), null, "", ""), !1; if (e.val() == null || e.val() == "" || e.val() == "0") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectClassFirst"), null, "", ""), !1; if (o.val() == null || o.val() == "") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseEnterStatementNo"), null, "", ""), !1; if (l.val() == "" == null || l.val() == "") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectFileFirst"), null, "", ""), !1; if (i != null) { if (i._filename == null || i._filename == "" || i._path == null || i._path == "") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_ErrorInGettingFile"), null, "", ""); return } if (i._error != null && i._error != "") { VIS.ADialog.info(i._error, null, "", ""); return } var n = i._path, f = i._filename, h = r.val(), a = o.val(), k = $statement, v = e.val(), p = y; yt(s, !0, "absolute"); window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/ImportStatement", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _path: n, _filename: f, _bankaccount: h, _bankAccountCurrency: dt, _statementno: a, _statementClassName: v, _statementCharges: p }, success: function (n) { pt = n._statementID; pt != null && pt != "" ? (tt = [], w.html(""), gt = 1, yt(s, !1, "absolute"), c.loadStatement(pt), u.refreshForm()) : n._error != null && n._error != "" && (yt(s, !1, "absolute"), VIS.ADialog.info(VIS.Msg.getMsg(n._error), null, "", "")) }, error: function () { yt(s, !1, "absolute"); VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", "") } }) }, 2) } } if (_tabSchedule.attr("activestatus") == "1") return alert("Schedule"), !1 }; f.onCancelClick = function () { }; f.onClose = function () { it() }; _tabFile.on(VIS.Events.onTouchStartOrClick, function () { _tabFile.removeClass("va012-grayBtn"); _tabFile.addClass("va012-blueBtn"); _tabFile.attr("activestatus", "1"); _tabSchedule.removeClass("va012-blueBtn"); _tabSchedule.addClass("va012-grayBtn"); _tabSchedule.attr("activestatus", "0") }); _tabSchedule.on(VIS.Events.onTouchStartOrClick, function () { _tabSchedule.removeClass("va012-grayBtn"); _tabSchedule.addClass("va012-blueBtn"); _tabSchedule.attr("activestatus", "1"); _tabFile.removeClass("va012-blueBtn"); _tabFile.addClass("va012-grayBtn"); _tabFile.attr("activestatus", "0") }) }, LoadStatementsPages: function () { ui = b.val() != null && b.val() != "" ? !0 : !1; t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadStatementsPages", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _cmbBankAccount: h.val(), _txtSearch: b.val(), _statementPageNo: gt, _PAGESIZE: lu, _SEARCHREQUEST: ui }, success: function (n) { n != null && n != "" && (af = JSON.parse(n)) } }) }, loadStatement: function () { function r(i) { var u, r; if (i = t.parseJSON(i), u = "", i != null && i.length > 0) for (r = 0; r < i.length; r++) u = "", n = i[r].docstatus == "CO" || i[r].docstatus == "CL" || i[r].docstatus == "RE" ? "va012-gray-color" : i[r].c_payment_id == null || i[r].c_payment_id == "0" || i[r].c_payment_id == 0 ? (i[r].c_charge_id != null || i[r].c_charge_id == "") && (i[r].trxno != null || i[r].trxno == "") ? "va012-red-color" : i[r].c_charge_id != null && i[r].c_charge_id != "0" && i[r].c_charge_id != 0 ? "va012-green-color" : i[r].c_cashline_id != null && i[r].c_cashline_id != "0" && i[r].c_cashline_id != 0 ? "va012-green-color" : "va012-red-color" : "va012-green-color", u = '<div  data-uid="' + i[r].c_bankstatementline_id + '" class="va012-right-data-wrap ' + n + '"><div class="va012-statement-wrap"><div class="va012-fl-padd"><div class="col-md-4 col-sm-4 va012-padd-0"><div class="va012-form-check"> <input type="checkbox" data-uid="' + i[r].c_bankstatementline_id + '" > <div class="va012-form-text"> <span style="background: #999;color: white; padding: 3px;margin-left: 2px;">' + i[r].statementno + "/" + i[r].page + "/" + i[r].line + "<\/span><label>" + i[r].currency + " " + Globalize.format(i[r].trxamount, "N") + "<\/label>", u += i[r].trxno == "" || i[r].trxno == null ? '<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p>' + VIS.Utility.encodeText(i[r].description) + "<\/p> <span>" + VIS.Utility.encodeText(i[r].bpgroup) + "<\/span><span>" + VIS.Utility.encodeText(i[r].invoiceno) + '<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="' + i[r].c_bankstatementline_id + '" class="glyphicon glyphicon-edit"><\/span> <span data-uid="' + i[r].c_bankstatement_id + '" class="glyphicon glyphicon-zoom-in"><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0 va012-width-xs"><div class="va012-form-data">' : '<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p>' + VIS.Utility.encodeText(i[r].description) + "<\/p> <span>" + VIS.Utility.encodeText(i[r].bpgroup) + "<\/span><span>" + VIS.Utility.encodeText(i[r].invoiceno) + '<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p>' + VIS.Utility.encodeText(i[r].trxno) + '<\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="' + i[r].c_bankstatementline_id + '" class="glyphicon glyphicon-edit"><\/span> <span data-uid="' + i[r].c_bankstatement_id + '" class="glyphicon glyphicon-zoom-in"><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0 va012-width-xs"><div class="va012-form-data">', u += i[r].imageurl != null && i[r].imageurl != "" ? '    <img src="' + i[r].imageurl + '" alt="">' : ' <img src="Areas/VA012/Images/defaultBP.png" alt="">', u += " <\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <\/div> <!-- end of row --><\/div><!-- end of payment-wrap --><\/div><!-- end of right-data-wrap -->", w.append(u); _sql = null; c.setStatementListHeight(); e.dropPayments() } var i, n; ui = b.val() != null && b.val() != "" ? !0 : !1; yt(t(w), !0, "inherit"); i = "SELECT NVL(ROUND(SUM(  CASE  WHEN (BSL.C_PAYMENT_ID IS NOT NULL OR BSL.C_CHARGE_ID IS NOT NULL OR BSL.C_CASHLINE_ID IS NOT NULL)  THEN (  CASE  WHEN ( BSL.C_CURRENCY_ID! =BCURR.C_CURRENCY_ID)  THEN BSL.StmtAmt*(   CASE  WHEN CCR.MULTIPLYRATE IS NOT NULL  THEN CCR.MULTIPLYRATE   ELSE CCR1.DIVIDERATE   END)  ELSE BSL.StmtAmt  END)  END),NVL(CURR.StdPrecision,2)),0) AS RECONCILED,  NVL(ROUND(SUM(  CASE  WHEN (BSL.C_PAYMENT_ID IS NULL AND BSL.C_CHARGE_ID IS NULL AND  BSL.C_CASHLINE_ID IS NULL)  THEN (  CASE  WHEN ( BSL.C_CURRENCY_ID! = BCURR.C_CURRENCY_ID)  THEN BSL.StmtAmt*(  CASE    WHEN CCR.MULTIPLYRATE IS NOT NULL  THEN CCR.MULTIPLYRATE   ELSE CCR1.DIVIDERATE   END)  ELSE BSL.StmtAmt  END)  END),NVL(CURR.StdPrecision,2)),0) AS UNRECONCILED,BCURR.ISO_CODE AS BASECURRENCY   FROM C_BANKSTATEMENT BS   INNER JOIN C_BANKSTATEMENTLINE BSL  ON BS.C_BANKSTATEMENT_ID=BSL.C_BANKSTATEMENT_ID  LEFT JOIN C_BPARTNER BP  ON BSL.C_BPARTNER_ID     =BP.C_BPARTNER_ID  LEFT JOIN C_CURRENCY CURR   ON BSL.C_CURRENCY_ID=CURR.C_CURRENCY_ID  INNER JOIN AD_CLIENTINFO CINFO   ON CINFO.AD_CLIENT_ID =BSL.AD_CLIENT_ID   INNER JOIN C_ACCTSCHEMA AC   ON AC.C_ACCTSCHEMA_ID =CINFO.C_ACCTSCHEMA1_ID   LEFT JOIN C_CURRENCY BCURR   ON " + dt + " =BCURR.C_CURRENCY_ID   LEFT JOIN C_CONVERSION_RATE CCR   ON (CCR.C_CURRENCY_ID   =BSL.C_CURRENCY_ID   AND CCR.ISACTIVE        ='Y'   AND CCR.C_CURRENCY_TO_ID=" + dt + " AND CCR.AD_CLIENT_ID    =BSL.AD_CLIENT_ID  AND CCR.AD_ORG_ID      IN (BSL.AD_ORG_ID,0)  AND SYSDATE BETWEEN CCR.VALIDFROM AND CCR.VALIDTO)   LEFT JOIN C_CONVERSION_RATE CCR1  ON (CCR1.C_CURRENCY_ID   =" + dt + " AND CCR1.C_CURRENCY_TO_ID=BSL.C_CURRENCY_ID  AND CCR1.ISACTIVE        ='Y'  AND CCR1.AD_CLIENT_ID    =BSL.AD_CLIENT_ID  AND CCR1.AD_ORG_ID      IN (BSL.AD_ORG_ID,0)  AND SYSDATE BETWEEN CCR1.VALIDFROM AND CCR1.VALIDTO)  WHERE BS.ISACTIVE='Y' AND BS.C_BANKACCOUNT_ID= " + h.val() + " AND BS.DOCSTATUS !='VO' AND BS.AD_CLIENT_ID=" + VIS.Env.getCtx().getAD_Client_ID(); VIS.Env.getCtx().getAD_Org_ID() != 0 && (i += " AND BS.AD_ORG_ID=" + VIS.Env.getCtx().getAD_Org_ID()); ui && (i += " AND (UPPER(BP.NAME) LIKE UPPER('%" + b.val() + "%') OR UPPER(BSL.DESCRIPTION) LIKE UPPER('%" + b.val() + "%') OR UPPER(BS.NAME) LIKE UPPER('%" + b.val() + "%') OR UPPER(BSL.StmtAmt) LIKE UPPER('%" + b.val() + "%') OR UPPER(BSL.TRXNO) LIKE UPPER('%" + b.val() + "%') OR UPPER(BSL.TrxAmt) LIKE UPPER('%" + b.val() + "%'))"); i += " GROUP BY BCURR.ISO_CODE ,NVL(CURR.StdPrecision,2)"; window.setTimeout(function () { function n(n) { n != null && n.tables[0].rows.length > 0 ? (cr.html(""), hr.html(""), hr.append("<p>" + VIS.Msg.getMsg("VA012_Reconciled") + "<\/p><p style='margin-top: 4px;'>" + VIS.Msg.getMsg("VA012_Unreconciled") + "<\/p>"), cr.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>" + n.tables[0].rows[0].cells.basecurrency + "<\/span> " + Globalize.format(n.tables[0].rows[0].cells.reconciled, "N") + "<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'> <span class='va012-base-curr'>" + n.tables[0].rows[0].cells.basecurrency + "<\/span> " + Globalize.format(n.tables[0].rows[0].cells.unreconciled, "N") + "<\/span>"), n.dispose(), n = null, i = null) : (cr.html(""), hr.html(""), hr.append("<p>" + VIS.Msg.getMsg("VA012_Reconciled") + "<\/p><p style='margin-top: 4px;'>" + VIS.Msg.getMsg("VA012_Unreconciled") + "<\/p>"), cr.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>" + br + "<\/span> 0<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'><span class='va012-base-curr'>" + br + "<\/span> 0<\/span>")); c.setStatementListHeight() } var t = VIS.DB.executeDataSet(i.toString(), null, n) }, 2); n = "va012-red-color"; window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadStatements", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _cmbBankAccount: h.val(), _txtSearch: b.val(), _statementPageNo: gt, _PAGESIZE: lu, _SEARCHREQUEST: ui }, success: function (n) { n != null && n != "" && (r(n), yt(t(w), !1, "inherit")) }, error: function () { yt(t(w), !1, "inherit") } }) }, 2) }, setStatementListHeight: function () { t("#VA012_contentArea_" + $self.windowNo).height(t("#VA012_mainContainer_" + $self.windowNo).height() - 20); t("#VA012_lstStatement_" + $self.windowNo).height(t("#VA012_rightWrap_" + $self.windowNo).height() - t("#VA012_rightTop_" + $self.windowNo).height() - 18) }, statementOpenEdit: function (n) { return ot.attr("activestatus", "1"), ot.attr("src", "Areas/VA012/Images/hide.png"), ot.attr("title", "Collapse"), o.show(), e.setPaymentListHeight(), c.statementListRecordEdit(n), n = 0, !0 }, statementListEdit: function (n) { var i = t(n.target), r = 0; i.hasClass("glyphicon-edit") && (r = i.data("uid"), ot.attr("activestatus", "1"), ot.attr("src", "Areas/VA012/Images/hide.png"), ot.attr("title", "Collapse"), o.show(), e.setPaymentListHeight(), u.scheduleRefresh(), u.prepayRefresh(), ii = !0, c.statementListRecordEdit(r), r = 0, e.addEffect(i, o)) }, openStatement: function (n) { var e = t(n.target), f = 0, o, i, r, u; if (e.hasClass("glyphicon glyphicon-zoom-in")) { f = e.data("uid"); o = "select ad_window_id from ad_window where name = 'Bank Statement'"; i = 0; try { r = VIS.DB.executeDataReader(o); r.read() && (i = r.getInt(0)); r.dispose(); i > 0 && (u = new VIS.Query, u.addRestriction("C_BankStatement_ID", VIS.Query.prototype.EQUAL, f), u.setRecordCount(1), VIS.viewManager.startWindow(i, u)) } catch (n) { console.log(n) } f = 0 } }, selectedStatementLinesList: function (n) { var i = t(n.target); n.target.type == "checkbox" && (i.is(":checked") && (_bankStatementLineID = parseInt(i.data("uid")), tt.push(_bankStatementLineID), _bankStatementLineID = 0), i.is(":checked") || (_bankStatementLineID = parseInt(i.data("uid")), tt.splice(tt.indexOf(_bankStatementLineID), 1), _bankStatementLineID = 0)) }, statementListRecordEdit: function (n) { u.refreshForm(); c.getStatementLineForEdit(n, c.afterRecordGet) }, selectedScheduleList: function (n) { var i = t(n.target); n.target.type == "checkbox" && (i.is(":checked"), !i.is(":checked")) }, getStatementLineForEdit: function (n, i) { t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/GetStatementLine", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _bankStatementLineID: n }), success: function (n) { i(n) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) }, afterRecordGet: function (n) { var u, e; n != null && n != "" && (u = t.parseJSON(n), o.attr("data-uid", u._bankStatementLineID), hi.val(u._txtStatementNo), nr.val(u._txtStatementPage), fi.val(u._txtStatementLine), kr.val(Globalize.format(new Date(u._dtStatementDate), "yyyy-MM-dd")), ci.val(u._cmbPaymentMethod).prop("selected", !0), u._cmbVoucherMatch != null && u._cmbVoucherMatch != "" ? y.val(u._cmbVoucherMatch).prop("selected", !0) : y.prop("selectedIndex", 0), y.trigger("change"), u._cmbContraType != null && u._cmbContraType != "" ? bt.val(u._cmbContraType).prop("selected", !0) : bt.prop("selectedIndex", 0), bt.trigger("change"), oi.val(u._cmbCashBook).prop("selected", !0), lr.val(u._txtCheckNo), f.val(u._txtAmount.toFixed(l)), g.val(u._txtTrxAmt.toFixed(l)), y.val() == "M" && parseFloat(g.val()) != 0 && (rt.val(Math.abs(u._txtDifference).toFixed(l)), u._txtDifference != 0 ? rt.attr("vchangable", "N") : rt.attr("vchangable", "Y")), u._cmbDifferenceType != null && u._cmbDifferenceType != "" ? (si.find("*").prop("disabled", !1), ut.val(u._cmbDifferenceType).prop("selected", !0)) : ut.prop("selectedIndex", 0), ut.trigger("change"), f.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")), tr.val(u._txtVoucherNo), dr.val(u._txtDescription), ir.val(u._cmbCharge).prop("selected", !0), ft.val(u._txtCharge), ft.attr("chargeid", u._cmbCharge), kt.val(u._cmbTaxRate).prop("selected", !0), ai.val(u._txtTaxAmount.toFixed(l)), ru.prop("checked", u._chkUseNextTime), u._ctrlCashLine > 0 ? (vt.setValue(u._ctrlCashLine, !1, !0), ii = !1) : wt || (vt.setValue(), u._ctrlPayment <= 0 && (ii = !1)), nt && nt.value > 0 && u._ctrlPayment == 0 && (u._ctrlPayment = nt.value), u._ctrlPayment > 0 ? (nt.setValue(u._ctrlPayment, !1, !0), tr.val() == "" && (e = VIS.Utility.Util.getValueOfString(VIS.DB.executeScalar("select trxno from C_Payment where C_Payment_ID=" + u._ctrlPayment)), tr.val(e)), ii = !1) : wt || (nt.setValue(), ii = !1), u._ctrlOrder > 0 ? at.setValue(u._ctrlOrder, !1, !0) : wt || at.setValue(), u._ctrlBusinessPartner > 0 ? a.setValue(u._ctrlBusinessPartner, !1, !0) : wt || a.setValue(), u._ctrlInvoice > 0 ? et.setValue(u._ctrlInvoice, !1, !0) : wt || et.setValue(), ft.trigger("focus")) }, matchStatementDialog: function () { function y() { function t(t) { if (f.html(""), f.append("<option value=0 >-<\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++) f.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_charge_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null; f.prop("selectedIndex", 0) } var n = "SELECT C_CHARGE_ID, NAME FROM C_CHARGE WHERE ISACTIVE = 'Y' AND AD_CLIENT_ID = " + VIS.Env.getCtx().getAD_Client_ID() + " ORDER BY NAME  ", i = VIS.DB.executeDataSet(n.toString(), null, t) } function b() { function t(t) { if (o.html(""), o.append("<option value=0 >-<\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++) o.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_bankstatement_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null } var n = "Select Cb.C_Bankstatement_Id, CB.NAME,Cb.Docstatus, COUNT(VA012_ISMATCHINGCONFIRMED) FROM C_BANKSTATEMENT CB INNER JOIN C_BANKSTATEMENTLINE CBL ON cbl.C_BANKSTATEMENT_ID = Cb.C_BANKSTATEMENT_ID Where Cb.Isactive = 'Y' And Cb.Ad_Client_Id = " + VIS.Env.getCtx().getAD_Client_ID() + " And Cb.C_Bankaccount_Id = " + h.val() + " And Cb.Docstatus NOT IN  ('CO','CL','VO') GROUP BY CB.C_BANKSTATEMENT_ID,Cb.Docstatus, CB.NAME", i = VIS.DB.executeDataSet(n.toString(), null, t) } function d() { function i(t) { if (s.html(""), s.append("<option value=0 >-<\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++) s.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_tax_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null } var n = "SELECT Name,C_Tax_ID FROM C_Tax WHERE IsActive='Y'", t; n = VIS.MRole.getDefault().addAccessSQL(n, "C_Tax", !0, !1); t = VIS.DB.executeDataSet(n.toString(), null, i) } function g() { n = $match.find("#VA012_cmbMatchingBase_" + $self.windowNo); l = $match.find("#VA012_divMatchingBase_" + $self.windowNo); a = $match.find("#VA012_cmbMatchingCriteria_" + $self.windowNo); o = $match.find("#VA012_cmbStatementNo_" + $self.windowNo); f = $match.find("#VA012_cmbChargeType_" + $self.windowNo); s = $match.find("#VA012_cmbTaxRate_" + $self.windowNo) } function nt(n) { var r = t(n.target); r.hasClass("glyphicon-remove") && (i.splice(i.indexOf(r.data("uid")), 1), r.parent().parent().remove()) } function tt() { n = null; l = null; i = []; a = null; w2ui["VA012_gridPayment_" + $self.windowNo] != null && w2ui["VA012_gridPayment_" + $self.windowNo].destroy() } var n = null, l = null, i = [], a = null, o = null, f = null, s = null, v, r; $match = t("<div class='va012-popform-content'>"); v = ""; v = "<div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_StatementNo") + "<\/label><select id='VA012_cmbStatementNo_" + $self.windowNo + "'><\/select><\/div> <div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_MatchingBase") + "<\/label><select id='VA012_cmbMatchingBase_" + $self.windowNo + "'><option value='0'><\/option><option value='BP'>" + VIS.Msg.getMsg("VA012_BusinessPartner") + "<\/option><option value='PA'>" + VIS.Msg.getMsg("VA012_PaymentAmount") + "<\/option><option value='CN'>" + VIS.Msg.getMsg("VA012_CheckNumber") + "<\/option><option value='CH'>" + VIS.Msg.getMsg("VA012_Charge") + "<\/option><option value='IN'>" + VIS.Msg.getMsg("VA012_Invoice") + "<\/option><option value='OR'>" + VIS.Msg.getMsg("VA012_Order") + "<\/option><option value='AC'>" + VIS.Msg.getMsg("VA012_AuthCode") + "<\/option><\/select><\/div> <div id='VA012_divMatchingBase_" + $self.windowNo + "' style='width:100%;border: 2px solid #1AA0ED;padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_MatchingCriteria") + "<\/label><select id='VA012_cmbMatchingCriteria_" + $self.windowNo + "'><option value='0'><\/option><option value='AT'>" + VIS.Msg.getMsg("VA012_MatchAnyTwo") + "<\/option><option value='AR'>" + VIS.Msg.getMsg("VA012_MatchAnyThree") + "<\/option><option value='AL'>" + VIS.Msg.getMsg("VA012_MatchAll") + "<\/option><\/select><\/div> <div class='va012-popform-data'><label title = '" + VIS.Msg.getMsg("VA012_SetChargeType") + "' > " + VIS.Msg.getMsg("VA012_Charge") + "<\/label><select id='VA012_cmbChargeType_" + $self.windowNo + "'><\/select><\/div> <div class='va012-popform-data'><label title =' " + VIS.Msg.getMsg("VA012_SetTaxRate") + "' >" + VIS.Msg.getMsg("VA012_TaxRate") + "<\/label><select id='VA012_cmbTaxRate_" + $self.windowNo + "'><\/select><\/div> <\/div>"; $match.append(v); g(); b(); y(); d(); r = new VIS.ChildDialog; r.setContent($match); r.setTitle(VIS.Msg.getMsg("VA012_MatchStatement")); r.setWidth(700); r.setHeight(600); r.setEnableResize(!1); r.setModal(!0); r.show(); r.onOkClick = function () { if (i.length > 0) { if (o.val() == null || o.val() == "" || o.val() == "0") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_NoLinesFoundToMatch"), null, "", ""), !1; if (h.val() == null || h.val() == "" || h.val() == "0") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectBankAccountFirst"), null, "", ""), !1; if (a.val() == null || a.val() == "" || a.val() == "0") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectMatchingCriteria"), null, "", ""), !1; if (a.val() == "AT" && i.length < 2) return VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectMin2MatchingBase"), null, "", ""), !1; if (a.val() == "AR" && i.length < 3) return VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectMin3MatchingBase"), null, "", ""), !1; if (f.val() == null || f.val() == "" || f.val() == "0") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_NoChargeSelected"), null, "", ""), !1; if (s.val() == null || s.val() == "" || s.val() == "0") return VIS.ADialog.info(VIS.Msg.getMsg("VA012_NoTaxRateSelected"), null, "", ""), !1; yt($match, !0, "absolute"); window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/MatchStatementGridData", type: "GET", dataType: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _matchingBaseItemList: i.toString(), _cmbMatchingCriteria: a.val(), _BankAccount: h.val(), _StatementNo: o.val(), _BankCharges: f.val(), _TaxRate: s.val() }, success: function (r) { if (r != null && r != "") { r = t.parseJSON(r); n.prop("selectedIndex", 0); o.prop("selectedIndex", 0); f.prop("selectedIndex", 0); s.prop("selectedIndex", 0); i = []; var a = ""; l.html(""); r.length > 0 ? (te(l, r), _statementlineslist = [], w.html(""), gt = 1, c.loadStatement(pt), it.html(""), u.scheduleRefresh(), u.prepayRefresh(), ri = 1, e.loadPayments(h.val(), k.val(), p.val())) : (a = "<div> <p> <b>" + VIS.Msg.getMsg("va012_norecordmatched") + "<\/b> <\/div>", l.append(a)); yt($match, !1, "absolute") } else yt($match, !1, "absolute"), VIS.ADialog.info(VIS.Msg.getMsg(r.toString()), null, "", "") }, error: function () { yt($match, !1, "absolute"); VIS.ADialog.info(VIS.Msg.getMsg("error"), null, "", "") } }) }, 2) } else return VIS.ADialog.info(VIS.Msg.getMsg("VA012_NoMatchingBaseSelected"), null, "", ""), !1; return !1 }; r.onCancelClick = function () { w2ui["VA012_gridPayment_" + $self.windowNo] != null && w2ui["VA012_gridPayment_" + $self.windowNo].destroy() }; r.onClose = function () { tt() }; n.on("change", function () { if (i.length <= 0 && l.html(""), !gu(n.val(), i) && n.val() != "0" && n.val() != "") { i.push(n.val()); var t = "<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='" + n.val() + "'class='glyphicon glyphicon-remove'><\/span><\/a> <span>" + n.children()[n[0].selectedIndex].text; l.append(t) } }); l.on(VIS.Events.onTouchStartOrClick, nt) }, matchStatementGridDialog: function () { var n = new VIS.ChildDialog; n.setContent(eu); n.setTitle(VIS.Msg.getMsg("VA012_MatchStatementGrid")); n.setWidth("780px"); n.setHeight(450); n.setEnableResize(!0); n.setModal(!0); n.show(); te() }, paymentScheduleDialog: function () { function it() { var t = "", n; for ($_divPaymentSchedules.html(""), n = 0; n < d.length; n++) t = "<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='" + d[n] + "'  data-udata='" + ti[n] + "' class='glyphicon glyphicon-remove'><\/span><\/a> <span>" + ti[n] + "<\/span> <\/div>", $_divPaymentSchedules.append(t) } function ut(n) { var o = t(n.target), u, e; if (o.hasClass("glyphicon-remove")) { if (v != null && v.length > 0 && (v.length > d.length ? v.splice(d.indexOf(o.data("uid")) + 1, 1) : v.length == d.length && v.splice(d.indexOf(o.data("uid")), 1), Number(v[0]) == "0")) { for (u = 0, e = 0; e < v.length; e++) u += VIS.Utility.Util.getValueOfDecimal(v[e]); u < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")); f.val(u.toFixed(l)); v.length == 1 && Number(v[0]) == "0" && v.splice(0, 1) } for (d.splice(d.indexOf(o.data("uid")), 1), ti.splice(ti.indexOf(o.data("udata")), 1), o.parent().parent().remove(), rr.val(ti.toString()), u = 0, e = 0; e < v.length; e++) u += VIS.Utility.Util.getValueOfDecimal(v[e]); g.val(u.toFixed(l)); g.trigger("change"); u == 0 && a.setValue() } } function ft() { $_divPaymentSchedules = $paymentSchedule.find("#VA012_divPaymentSchedules_" + $self.windowNo); y = $paymentSchedule.find("#VA012_ctrlPSInvoice_" + $self.windowNo); p = $paymentSchedule.find("#VA012_ctrlPSBP_" + $self.windowNo); n = $paymentSchedule.find("#VA012_cmbPaymentSchedule_" + $self.windowNo) } function rt() { k = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 3484, VIS.DisplayType.Search, "C_Invoice_ID", 0, !1, "DocStatus IN ('CO','CL') AND C_BPartner_ID=" + nt); s = new VIS.Controls.VTextBoxButton("C_Invoice_ID", !1, !1, !0, VIS.DisplayType.Search, k); s.getControl().addClass("va012-input-size-2"); y.append(s.getControl()); y.append(s.getBtn(0)); y.append(s.getBtn(1)); s.fireValueChanged = function () { b = 0; b = s.value; n.html(""); st() } } function ot() { tt = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 2893, VIS.DisplayType.Search, "C_BPartner_ID", 0, !1, null); h = new VIS.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, VIS.DisplayType.Search, ku); h.getControl().addClass("va012-input-size-2"); p.append(h.getControl()); p.append(h.getBtn(0)); p.append(h.getBtn(1)); h.fireValueChanged = function () { nt = 0; nt = h.value; k = null; s = null; y.html(""); b = null; rt() } } function st() { function i(i) { if (n.html(""), n.append("<option value=0 ><\/option>"), i != null) for (var r = 0; r < i.tables[0].rows.length; r++) n.append("<option paymentdata='" + VIS.Utility.encodeText(i.tables[0].rows[r].cells.name) + "/" + VIS.Utility.encodeText(i.tables[0].rows[r].cells.businesspartner) + "' value=" + VIS.Utility.Util.getValueOfInt(i.tables[0].rows[r].cells.c_invoicepayschedule_id) + ">" + VIS.Utility.encodeText(i.tables[0].rows[r].cells.name) + "<\/option>"); i.dispose(); i = null; t = null; n.prop("selectedIndex", 0) } var t = "SELECT BP.NAME as businesspartner,PAY.C_INVOICEPAYSCHEDULE_ID,  PAY.DOCUMENTNO AS NAME  FROM C_INVOICEPAYSCHEDULE PAY  INNER JOIN C_INVOICE INV  ON PAY.C_INVOICE_ID=INV.C_INVOICE_ID  INNER JOIN C_BPARTNER BP  ON BP.C_BPARTNER_ID=INV.C_BPARTNER_ID  INNER JOIN VA009_PAYMENTMETHOD PM  ON (PM.VA009_PAYMENTMETHOD_ID =PAY.VA009_PAYMENTMETHOD_ID )  INNER JOIN C_DOCTYPE DT  ON DT.C_DOCTYPE_ID            =INV.C_DOCTYPE_ID  WHERE PAY.VA009_ISPAID        ='N'  AND PAY.ISACTIVE              ='Y'  AND INV.DOCSTATUS            IN ('CO','CL')  AND PM.VA009_PAYMENTBASETYPE! ='B' AND PAY.C_INVOICE_ID=" + b; VIS.DB.executeDataSet(t.toString(), null, i) } function ht() { k = null; s = null; b = null; y = null; tt = null; h = null; nt = null; p = null; n = null } var k = null, s = null, b = null, y = null, tt = null, h = null, nt = null, p = null, n = null, w, c; $paymentSchedule = t("<div class='va012-popform-content'>"); w = ""; w = "<div> <label>" + VIS.Msg.getMsg("VA012_BusinessPartner") + "<\/label> <div id='VA012_ctrlPSBP_" + $self.windowNo + "' ><\/div> <\/div>"; w += "<div> <label>" + VIS.Msg.getMsg("VA012_Invoice") + "<\/label> <div id='VA012_ctrlPSInvoice_" + $self.windowNo + "' ><\/div> <\/div>"; w += "<div> <label>" + VIS.Msg.getMsg("VA012_PaymentSchedules") + "<\/label> <select id='VA012_cmbPaymentSchedule_" + $self.windowNo + "'  style=' width: 100%; ' ><\/select> <\/div>"; w += "<div id='VA012_divPaymentSchedules_" + $self.windowNo + "' style='width:100%;border: 2px solid #1AA0ED;padding: 10px; float: left; margin-bottom: 10px;margin-top: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>"; $paymentSchedule.append(w); ft(); c = new VIS.ChildDialog; c.setContent($paymentSchedule); c.setTitle(VIS.Msg.getMsg("VA012_PaymentSchedules")); c.setWidth("500px"); it(); c.setEnableResize(!1); c.setModal(!0); c.show(); ot(); rt(); a.value && (h.setValue(a.value, !1, !0), p.find("*").prop("disabled", !0)); et.value && (s.setValue(et.value, !1, !0), y.find("*").prop("disabled", !0)); n.on("change", function () { n.val() > 0 && e.checkScheduleCondition(n.val(), parseInt(o.attr("data-uid")), d.toString(), f.val()) && (gu(n.val(), d) ? VIS.ADialog.info(VIS.Msg.getMsg("VA012_AlreadySelected"), null, "", "") : (d.push(n.val()), ti.push(this.options[this.selectedIndex].getAttribute("paymentdata")), it(), e.setInvoiceAndBPartner(n.val(), "IS")), rr.val(ti.toString())) }); $_divPaymentSchedules.on(VIS.Events.onTouchStartOrClick, ut); c.onOkClick = function () { }; c.onCancelClick = function () { u.scheduleRefresh(); u.refreshForm(); ht() } }, prepayOrderDialog: function () { function r() { var t = "", n; for ($_divPrepayOrders.html(""), n = 0; n < gi.length; n++) t = "<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='" + gi[n] + "'  data-udata='" + er[n] + "' class='glyphicon glyphicon-remove'><\/span><\/a> <span>" + er[n] + "<\/span> <\/div>", $_divPrepayOrders.append(t) } function u(n) { var i = t(n.target); i.hasClass("glyphicon-remove") && (gi.splice(gi.indexOf(i.data("uid")), 1), er.splice(er.indexOf(i.data("udata")), 1), i.parent().parent().remove(), pu.val(er.toString())) } function f() { $_divPrepayOrders = $prepayOrder.find("#VA012_divPrepayOrders_" + $self.windowNo) } var i, n; $prepayOrder = t("<div class='va012-popform-content'>"); i = ""; i = "<div id='VA012_divPrepayOrders_" + $self.windowNo + "' style='width:100%;border: 2px solid #1AA0ED;padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>"; $prepayOrder.append(i); f(); n = new VIS.ChildDialog; n.setContent($prepayOrder); n.setTitle(VIS.Msg.getMsg("VA012_PrepayOrders")); n.setWidth("500px"); r(); n.setEnableResize(!1); n.setModal(!0); n.show(); $_divPrepayOrders.on(VIS.Events.onTouchStartOrClick, u) } }; u = { newRecord: function () { function n(n) { datasource = []; for (var t = 0; t < n.length; t++) datasource.push({ label: n[t].name, value: n[t].name, ids: n[t].chargeID }); ft.autocomplete("option", "source", datasource); ft.autocomplete("search", ""); ft.trigger("focus") } function h(n, i) { ft.attr("chargeid", 0); t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetCharge", dataType: "json", data: { searchText: n }, success: function (n) { var r = JSON.parse(n); datasource = []; i(t.map(r, function (n) { return { label: n.name, value: n.name, ids: n.chargeID } })); t(self.div).autocomplete("search", ""); t(self.div).trigger("focus") } }) } o = s.find("#VA012_formNewRecord_" + $self.windowNo); yu = s.find("#VA012_formBtnNewRecord_" + $self.windowNo); u.getNewRecordDesign(); u.getNewRecordControls(); u.loadCurrency(); u.loadPaymentMethod(); u.loadVoucherMatch(); u.loadContraType(); u.loadCashBook(); u.loadDifferenceType(); u.loadTransferType(); u.loadCharge(); u.loadTaxRate(); u.loadPayment(); u.loadOrder(); u.loadBusinessPartner(); u.loadInvoice(); u.loadCashLine(); ft.on("blur", function () { (ft.val() == "" || ft.val() == null) && ft.attr("chargeid", 0) }); cf.on(VIS.Events.onTouchStartOrClick, function () { VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetCharge", { searchText: "" }, n) }); ft.autocomplete({ minLength: 0, scroll: !0, source: function (n, t) { n.term.trim().length != 0 && h(n.term, t) }, select: function (n, i) { t(this).val(i.item.ids); t(this).attr("chargeid", i.item.ids) } }); ot.on(VIS.Events.onTouchStartOrClick, function () { ot.attr("activestatus") == "0" ? (o.show(), ot.attr("activestatus", "1"), ot.attr("src", "Areas/VA012/Images/hide.png"), ot.attr("title", "Collapse")) : (o.hide(), ot.attr("activestatus", "0"), ot.attr("src", "Areas/VA012/Images/add.png"), ot.attr("title", "Expand")); u.scheduleRefresh(); u.prepayRefresh(); u.refreshForm(); e.setPaymentListHeight() }); sf.on(VIS.Events.onTouchStartOrClick, function () { parseInt(o.attr("data-uid")) > 0 ? (u.scheduleRefresh(), u.prepayRefresh(), ii = !0, c.statementListRecordEdit(o.attr("data-uid"))) : (u.scheduleRefresh(), u.prepayRefresh(), u.refreshForm()) }); o.hide(); y.on("change", function () { if (y.val() == "M") { _divCtrlCashLine.find("*").prop("disabled", !0); _divCtrlCashLine.hide(); vi.find("*").prop("disabled", !0); ur.find("*").prop("disabled", !0); yi.find("*").prop("disabled", !0); fr.find("*").prop("disabled", !0); vi.hide(); ur.hide(); yi.hide(); fr.hide(); var n = VIS.Utility.Util.getValueOfInt(VIS.DB.executeScalar("SELECT Count(AD_ModuleInfo_ID) FROM AD_ModuleInfo WHERE PREFIX='VA034_' AND IsActive = 'Y'")); n > 0 ? (st.show(), st.find("*").prop("disabled", !1)) : (st.find("*").prop("disabled", !0), st.hide()); ht.find("*").prop("disabled", !0); ct.find("*").prop("disabled", !0); lt.find("*").prop("disabled", !0); ht.hide(); ct.hide(); lt.hide(); yr.show(); pr.show(); si.show(); pi.show(); wi.show(); bi.show(); ki.show(); di.show(); pi.find("*").prop("disabled", !1); wi.find("*").prop("disabled", !1); bi.find("*").prop("disabled", !1); ki.find("*").prop("disabled", !1); di.find("*").prop("disabled", !1); rr.prop("disabled", !0); vr.css("pointer-events", "auto") } else y.val() == "V" ? (_divCtrlCashLine.find("*").prop("disabled", !0), _divCtrlCashLine.hide(), vi.find("*").prop("disabled", !0), ur.find("*").prop("disabled", !0), yi.find("*").prop("disabled", !0), fr.find("*").prop("disabled", !0), vi.hide(), ur.hide(), yi.hide(), fr.hide(), st.show(), ht.show(), ct.show(), lt.show(), st.find("*").prop("disabled", !1), ht.find("*").prop("disabled", !1), ct.find("*").prop("disabled", !1), lt.find("*").prop("disabled", !1), pi.find("*").prop("disabled", !0), wi.find("*").prop("disabled", !0), bi.find("*").prop("disabled", !1), ki.find("*").prop("disabled", !0), di.find("*").prop("disabled", !0), vr.css("pointer-events", "none"), yr.hide(), pr.hide(), si.hide(), pi.hide(), wi.hide(), bi.hide(), ki.hide(), di.hide()) : y.val() == "C" && (vi.show(), yi.show(), vi.find("*").prop("disabled", !1), yi.find("*").prop("disabled", !1), st.find("*").prop("disabled", !0), ht.find("*").prop("disabled", !0), ct.find("*").prop("disabled", !0), lt.find("*").prop("disabled", !0), st.hide(), ht.hide(), ct.hide(), lt.hide(), pi.find("*").prop("disabled", !0), wi.find("*").prop("disabled", !0), bi.find("*").prop("disabled", !0), ki.find("*").prop("disabled", !0), di.find("*").prop("disabled", !0), vr.css("pointer-events", "none"), yr.hide(), pr.hide(), si.hide(), pi.hide(), wi.hide(), bi.hide(), ki.hide(), di.hide()); ei.text(VIS.Msg.getMsg("VA012_More")); e.setPaymentListHeight() }); ut.on("change", function () { ut.val() == "CH" ? (st.show(), ht.show(), ct.show(), lt.show(), st.find("*").prop("disabled", !1), ht.find("*").prop("disabled", !1), ct.find("*").prop("disabled", !1), lt.find("*").prop("disabled", !1)) : y.val() == "M" && (ht.find("*").prop("disabled", !0), ct.find("*").prop("disabled", !0), lt.find("*").prop("disabled", !0), ht.hide(), ct.hide(), lt.hide()); e.setPaymentListHeight() }); bt.on("change", function () { bt.val() == "CB" ? (ur.find("*").prop("disabled", !1), fr.find("*").prop("disabled", !1)) : (oi.prop("selectedIndex", 0), lr.val(""), ur.find("*").prop("disabled", !0), fr.find("*").prop("disabled", !0)); bt.val() == "BB" ? (_divCtrlCashLine.find("*").prop("disabled", !0), _divCtrlCashLine.hide(), st.show(), ht.show(), ct.show(), lt.show(), st.find("*").prop("disabled", !1), ht.find("*").prop("disabled", !1), ct.find("*").prop("disabled", !1), lt.find("*").prop("disabled", !1)) : y.val() == "C" && (_divCtrlCashLine.show(), _divCtrlCashLine.find("*").prop("disabled", !1), st.find("*").prop("disabled", !0), ht.find("*").prop("disabled", !0), ct.find("*").prop("disabled", !0), lt.find("*").prop("disabled", !0), st.hide(), ht.hide(), ct.hide(), lt.hide()); e.setPaymentListHeight() }); kt.on("change", function () { if (ai.val("0"), kt.val() > 0) { var n = VIS.DB.executeScalar("SELECT RATE FROM C_TAX WHERE C_TAX_ID=" + kt.val()); ai.val((f.val() - f.val() / (n / 100 + 1)).toFixed(l)) } g.trigger("change") }); ei.on(VIS.Events.onTouchStartOrClick, function () { ei.attr("visiblestatus") == "0" ? (ei.attr("visiblestatus", "1"), ei.text(VIS.Msg.getMsg("VA012_Hide")), vi.show(), yi.show(), _divCtrlCashLine.show(), st.show(), ht.show(), ct.show(), lt.show(), yr.show(), pr.show(), si.show(), pi.show(), wi.show(), bi.show(), ki.show(), di.show()) : (ei.attr("visiblestatus", "0"), ei.text(VIS.Msg.getMsg("VA012_More")), y.trigger("change")); e.setPaymentListHeight() }); o.on("keyup", function (n) { n.which == 32 && (i.is(":focus") && i.trigger("click"), r.is(":focus") && r.trigger("click"), ei.is(":focus") && ei.trigger("click")); n.which == 13 && uu.is(":focus") && uu.trigger("click") }); uu.on(VIS.Events.onTouchStartOrClick, function () { var n = u.getFormData(); if (n[0]._cmbBankAccount == null || n[0]._cmbBankAccount == "" || n[0]._cmbBankAccount == "0") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_SelectBankAccountFirst"), null, "", ""); return } if (n[0]._txtStatementNo == null || n[0]._txtStatementNo == "" || n[0]._txtStatementNo == "0") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseEnterStatementNo"), null, "", ""); return } if (n[0]._dtStatementDate == null || n[0]._dtStatementDate == "" || n[0]._dtStatementDate == "0") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseEnterStatementDate"), null, "", ""); return } if (n[0]._txtAmount == null || n[0]._txtAmount == "" || n[0]._txtAmount == "0" || n[0]._txtAmount == "0.00") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseEnterAmount"), null, "", ""); return } if (!(n[0]._ctrlInvoice == null || n[0]._ctrlInvoice == "" || n[0]._ctrlInvoice == "0") && !(n[0]._ctrlBusinessPartner == null || n[0]._ctrlBusinessPartner == "" || n[0]._ctrlBusinessPartner == "0") && (n[0]._ctrlPayment == null || n[0]._ctrlPayment == "" || n[0]._ctrlPayment == "0") && (n[0]._scheduleList == null || n[0]._scheduleList == "")) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectPaySchedule"), null, "", ""); return } if (!(n[0]._ctrlBusinessPartner == null || n[0]._ctrlBusinessPartner == "" || n[0]._ctrlBusinessPartner == "0") && (n[0]._ctrlInvoice == null || n[0]._ctrlInvoice == "" || n[0]._ctrlInvoice == "0") && (n[0]._ctrlPayment == null || n[0]._ctrlPayment == "" || n[0]._ctrlPayment == "0") && (n[0]._scheduleList == null || n[0]._scheduleList == "") && (n[0]._ctrlOrder == null || n[0]._ctrlOrder == "" || n[0]._ctrlOrder == "0") && (n[0]._cmbCharge == null || n[0]._cmbCharge == "" || n[0]._cmbCharge == "0")) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectAnyOne"), null, "", ""); return } if (n[0]._cmbVoucherMatch == "C") if (n[0]._cmbContraType == "BB") { if (n[0]._cmbCharge == null || n[0]._cmbCharge == "" || n[0]._cmbCharge == "0") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectCharge"), null, "", ""); return } } else if (n[0]._cmbContraType == "CB") { if (n[0]._ctrlCashLine == null || n[0]._ctrlCashLine == "" || n[0]._ctrlCashLine == "0") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectCashJournalLine"), null, "", ""); return } } else { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectContraType"), null, "", ""); return } if (n[0]._cmbVoucherMatch == "V" && (n[0]._cmbCharge == null || n[0]._cmbCharge == "" || n[0]._cmbCharge == "0")) { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectCharge"), null, "", ""); return } if (parseFloat(n[0]._txtDifference) != 0 && n[0]._cmbVoucherMatch == "M") { if (n[0]._cmbDifferenceType == null || n[0]._cmbDifferenceType == "" || n[0]._cmbDifferenceType == "0") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectDifferenceType"), null, "", ""); return } if (parseFloat(n[0]._txtDifference) < 0 && n[0]._cmbDifferenceType != "OU") { VIS.ADialog.info(VIS.Msg.getMsg("VA012_PleaseSelectDifferenceTypeOU"), null, "", ""); return } } yt(s, !0, "absolute"); u.insertNewRecord(n, u.afterInsertion) }); hi.on("keypress", function (n) { if (n.which != 8 && n.which != 0 && (n.which < 48 || n.which > 57)) return !1; nr.val("1"); fi.val("10") }); fi.on("keypress", function (n) { if (n.which != 8 && n.which != 0 && (n.which < 48 || n.which > 57)) return !1 }); nr.on("keypress", function (n) { if (n.which != 8 && n.which != 0 && (n.which < 48 || n.which > 57)) return !1; fi.val("10") }); ef.on(VIS.Events.onTouchStartOrClick, function () { u.scheduleRefresh(); u.prepayRefresh(); u.refreshForm(); (hi.val() == "" || hi.val() == null) && hi.val("0"); e.getMaxStatement("BT"); o.attr("data-uid", 0); nr.val("1"); fi.val("10") }); g.on("change", function () { if (rt.attr("vchangable") == "Y" && (rt.val(0..toFixed(l)), si.find("*").prop("disabled", !0)), parseFloat(g.val()) != 0 && y.val() == "M" && (rt.attr("vchangable") == "Y" && (rt.val((Math.abs(g.val()) - Math.abs(f.val())).toFixed(l)), parseFloat(rt.val()) != 0 && si.find("*").prop("disabled", !1)), kt.val() > 0 && parseFloat(rt.val()) != 0)) { var n = VIS.DB.executeScalar("SELECT RATE FROM C_TAX WHERE C_TAX_ID=" + kt.val()); ai.val((rt.val() - rt.val() / (n / 100 + 1)).toFixed(l)) } }); f.on("blur", function () { if ((f.val() == "" || f.val() == null) && f.val(0), f.val(parseFloat(f.val()).toFixed(l)), r.attr("v_active") == "1" && f.val() > 0 && f.val((-f.val()).toFixed(l)), i.attr("v_active") == "1" && f.val() < 0 && (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")), f.val() < 0 ? (r.removeClass("va012-inactive"), r.addClass("va012-active"), r.attr("v_active", "1"), i.removeClass("va012-active"), i.addClass("va012-inactive"), i.attr("v_active", "0")) : f.val() > 0 && (i.removeClass("va012-inactive"), i.addClass("va012-active"), i.attr("v_active", "1"), r.removeClass("va012-active"), r.addClass("va012-inactive"), r.attr("v_active", "0")), kt.val() > 0) { var n = VIS.DB.executeScalar("SELECT RATE FROM C_TAX WHERE C_TAX_ID=" + kt.val()); ai.val((f.val() - f.val() / (n / 100 + 1)).toFixed(l)) } g.trigger("change") }); wu.hover(function () { $tooltip = t('<div  class="va012-div-tooltip"><h4>' + VIS.Msg.getMsg("VA012_Information") + "<\/h4><p>" + VIS.Msg.getMsg("VA012_InformationText") + "<\/p><\/div>"); s.append($tooltip); t(".va012-div-tooltip").show() }, function () { s.find(".va012-div-tooltip").remove() }); wu.mousemove(function (n) { t(".va012-div-tooltip").css("top", n.pageY - 50).css("left", n.pageX) }); i.on(VIS.Events.onTouchStartOrClick, function () { f.val() < 0 && f.val(f.val() * -1); i.removeClass("va012-inactive"); i.addClass("va012-active"); i.attr("v_active", "1"); r.removeClass("va012-active"); r.addClass("va012-inactive"); r.attr("v_active", "0"); f.blur() }); r.on(VIS.Events.onTouchStartOrClick, function () { f.val() > 0 && f.val(f.val() * -1); r.removeClass("va012-inactive"); r.addClass("va012-active"); r.attr("v_active", "1"); i.removeClass("va012-active"); i.addClass("va012-inactive"); i.attr("v_active", "0"); f.blur() }) }, getNewRecordDesign: function () { }, getNewRecordControls: function () { hi = o.find("#VA012_txtStatementNo_" + $self.windowNo); ef = o.find("#VA012_btnStatementNo_" + $self.windowNo); nr = o.find("#VA012_txtStatementPage_" + $self.windowNo); fi = o.find("#VA012_txtStatementLine_" + $self.windowNo); kr = o.find("#VA012_dtStatementDate_" + $self.windowNo); ci = o.find("#VA012_cmbPaymentMethod_" + $self.windowNo); bt = o.find("#VA012_cmbContraType_" + $self.windowNo); oi = o.find("#VA012_cmbCashBook_" + $self.windowNo); li = o.find("#VA012_cmbTransferType_" + $self.windowNo); lr = o.find("#VA012_txtCheckNo_" + $self.windowNo); y = o.find("#VA012_cmbVoucherMatch_" + $self.windowNo); f = o.find("#VA012_txtAmount_" + $self.windowNo); g = o.find("#VA012_txtTrxAmt_" + $self.windowNo); rt = o.find("#VA012_txtDifference_" + $self.windowNo); ut = o.find("#VA012_cmbDifferenceType_" + $self.windowNo); tr = o.find("#VA012_txtVoucherNo_" + $self.windowNo); dr = o.find("#VA012_txtDescription_" + $self.windowNo); ir = o.find("#VA012_cmbCharge_" + $self.windowNo); ft = o.find("#VA012_txtCharge_" + $self.windowNo); kt = o.find("#VA012_cmbTaxRate_" + $self.windowNo); ai = o.find("#VA012_txtTaxAmount_" + $self.windowNo); ar = o.find("#VA012_ctrlCashLine_" + $self.windowNo); nu = o.find("#VA012_ctrlPayment_" + $self.windowNo); gr = o.find("#VA012_ctrlOrder_" + $self.windowNo); tu = o.find("#VA012_ctrlInvoice_" + $self.windowNo); iu = o.find("#VA012_ctrlBusinessPartner_" + $self.windowNo); ru = o.find("#VA012_chkUseNextTime_" + $self.windowNo); uu = o.find("#VA012_btnSave_" + $self.windowNo); vr = o.find("#VA012_btnPaymentSchedule_" + $self.windowNo); of = o.find("#VA012_btnPrepay_" + $self.windowNo); rr = o.find("#VA012_txtPaymentSchedule_" + $self.windowNo); pu = o.find("#VA012_txtPrepayOrder_" + $self.windowNo); ot = yu.find("#VA012_btnNewRecord_" + $self.windowNo); sf = yu.find("#VA012_btnUndo_" + $self.windowNo); hf = s.find("#VA012_btnDelete_" + $self.windowNo); wu = o.find("#VA012_btnAmount_" + $self.windowNo); i = o.find("#VA012_btnIn_" + $self.windowNo); r = o.find("#VA012_btnOut_" + $self.windowNo) }, loadPaymentMethod: function () { function t(t) { if (ci.html(""), ci.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++) ci.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.va009_paymentmethod_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.va009_name) + "<\/option>"); t.dispose(); t = null; n = null; ci.prop("selectedIndex", 0) } var n = "SELECT VA009_NAME,VA009_PAYMENTMETHOD_ID FROM VA009_PAYMENTMETHOD WHERE ISACTIVE='Y'  AND AD_CLIENT_ID=" + VIS.Env.getCtx().getAD_Client_ID() + " AND AD_ORG_ID=" + VIS.Env.getCtx().getAD_Org_ID(), i = VIS.DB.executeDataSet(n.toString(), null, t) }, loadCurrency: function () { dt = VIS.DB.executeScalar("SELECT C_CURRENCY_ID FROM C_BANKACCOUNT WHERE C_BANKACCOUNT_ID=" + h.val()); l = VIS.DB.executeScalar("SELECT STDPRECISION FROM C_CURRENCY WHERE C_CURRENCY_ID=" + dt) }, loadCashBook: function () { function t(t) { if (oi.html(""), oi.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++) oi.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_cashbook_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null; oi.prop("selectedIndex", 0) } var n = "SELECT NAME,C_CashBook_ID FROM C_CashBook WHERE ISACTIVE='Y'  AND AD_CLIENT_ID=" + VIS.Env.getCtx().getAD_Client_ID() + " AND AD_ORG_ID=" + VIS.Env.getCtx().getAD_Org_ID(), i = VIS.DB.executeDataSet(n.toString(), null, t) }, loadContraType: function () { bt.html(""); bt.append("<option value=0 ><\/option>"); bt.append("<option value='BB' >" + VIS.Msg.getMsg("VA012_BankToBank") + "<\/option>"); bt.append("<option value='CB' >" + VIS.Msg.getMsg("VA012_CashToBank") + "<\/option>"); bt.prop("selectedIndex", 0) }, loadTransferType: function () { li.html(""); li.append("<option value=0 ><\/option>"); li.append("<option value='CH' >" + VIS.Msg.getMsg("VA012_Cash") + "<\/option>"); li.append("<option value='CK' >" + VIS.Msg.getMsg("VA012_Check") + "<\/option>"); li.prop("selectedIndex", 0) }, loadVoucherMatch: function () { y.html(""); y.append("<option value='M' >" + VIS.Msg.getMsg("VA012_Payment") + "<\/option>"); y.append("<option value='V' >" + VIS.Msg.getMsg("VA012_Voucher") + "<\/option>"); y.append("<option value='C' >" + VIS.Msg.getMsg("VA012_Contra") + "<\/option>"); y.prop("selectedIndex", 0) }, loadDifferenceType: function () { ut.html(""); ut.append("<option value=0 ><\/option>"); ut.append("<option value='OU' >" + VIS.Msg.getMsg("VA012_OverUnderPayment") + "<\/option>"); ut.append("<option value='DA' >" + VIS.Msg.getMsg("VA012_DiscountAmount") + "<\/option>"); ut.append("<option value='WO' >" + VIS.Msg.getMsg("VA012_WriteoffAmount") + "<\/option>"); ut.append("<option value='CH' >" + VIS.Msg.getMsg("VA012_Charge") + "<\/option>"); ut.prop("selectedIndex", 0) }, loadCharge: function () { function t(t) { if (ir.html(""), ir.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++) ir.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_charge_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null; ir.prop("selectedIndex", 0) } var n = "SELECT NAME,C_CHARGE_ID FROM C_CHARGE WHERE ISACTIVE='Y' AND AD_CLIENT_ID=" + VIS.Env.getCtx().getAD_Client_ID() + " AND AD_ORG_ID=" + VIS.Env.getCtx().getAD_Org_ID(), i = VIS.DB.executeDataSet(n.toString(), null, t) }, loadTaxRate: function () { function t(t) { if (kt.html(""), kt.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++) kt.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_tax_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null; kt.prop("selectedIndex", 0) } var n = "SELECT Name,C_Tax_ID FROM C_Tax WHERE IsActive='Y' AND EXPORT_ID IS NOT NULL", i = VIS.DB.executeDataSet(n.toString(), null, t) }, loadPayment: function () { pf = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 5043, VIS.DisplayType.Search, "C_Payment_ID", 0, !1, "DocStatus IN ('CO','CL')"); nt = new VIS.Controls.VTextBoxButton("C_Payment_ID", !1, !1, !0, VIS.DisplayType.Search, pf); nt.getControl().addClass("va012-input-size-2"); nt.getControl().attr("tabindex", "10"); nu.append(nt.getControl()); nu.append(nt.getBtn(0)); nu.append(nt.getBtn(1)); nt.fireValueChanged = function () { or = 0; or = nt.value; nt.value; wt || ii || nt.value && (e.checkPaymentCondition(or, 0, f.val()) ? e.setInvoiceAndBPartner(or, "PY") : nt.setValue()); ii = !1 }; ii = !1 }, loadOrder: function () { gf = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 5043, VIS.DisplayType.Search, "C_Order_ID", 0, !1, "C_ORDER_ID IN (SELECT ORD.C_ORDER_ID  FROM C_ORDER ORD  LEFT JOIN C_DOCTYPE DT  ON ORD.C_DOCTYPETARGET_ID=DT.C_DOCTYPE_ID  INNER JOIN VA009_PAYMENTMETHOD PM  ON (PM.VA009_PAYMENTMETHOD_ID =ORD.VA009_PAYMENTMETHOD_ID )  WHERE DT.DOCSUBTYPESO         ='PR'   AND ORD.DOCSTATUS             ='WP'   AND ORD.ISACTIVE              ='Y'   AND PM.VA009_PAYMENTBASETYPE! ='B')"); at = new VIS.Controls.VTextBoxButton("C_Order_ID", !1, !1, !0, VIS.DisplayType.Search, gf); at.getControl().addClass("va012-input-size-2"); at.getControl().attr("tabindex", "13"); gr.append(at.getControl()); gr.append(at.getBtn(0)); gr.append(at.getBtn(1)); at.fireValueChanged = function () { wr = 0; wr = at.value; at.value && (wt || (e.checkPrepayCondition(at.value, 0, null, f.val()) ? e.setInvoiceAndBPartner(wr, "PO") : at.setValue())) } }, loadCashLine: function () { var n = " C_CASHLINE_ID IN (SELECT CSL.C_CASHLINE_ID  FROM C_CASH CS  INNER JOIN C_CASHLINE CSL  ON CS.C_CASH_ID=CSL.C_CASH_ID  INNER JOIN c_charge chrg  ON chrg.c_charge_id        =csl.c_charge_id  WHERE CS.ISACTIVE          ='Y'  AND CSL.CashType           ='C'  AND chrg.dtd001_chargetype ='CON'  AND CS.DOCSTATUS          IN ('CO','CL')  AND CSL.VA012_ISRECONCILED ='N'  AND CSL.C_BankAccount_ID =" + (h.val() == null ? 0 : h.val()) + " )"; ar.html(""); yf = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 1008317, VIS.DisplayType.Search, "C_CashLine_ID", 0, !1, n); vt = new VIS.Controls.VTextBoxButton("C_CashLine_ID", !1, !1, !0, VIS.DisplayType.Search, yf); vt.getControl().addClass("va012-input-size-2"); vt.getControl().attr("tabindex", "10"); ar.append(vt.getControl()); ar.append(vt.getBtn(0)); ar.append(vt.getBtn(1)); vt.fireValueChanged = function () { bu = 0; bu = vt.value; vt.value && (wt || ii || e.checkContraCondition(vt.value, 0, f.val()) || vt.setValue(), ii = !1); ii = !1 } }, loadBusinessPartner: function () { ku = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 2893, VIS.DisplayType.Search, "C_BPartner_ID", 0, !1, null); a = new VIS.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, VIS.DisplayType.Search, ku); a.getControl().addClass("va012-input-size-2"); a.getControl().attr("tabindex", "12"); iu.append(a.getControl()); iu.append(a.getBtn(0)); iu.append(a.getBtn(1)); a.fireValueChanged = function () { fu = 0; fu = a.value } }, loadInvoice: function () { wf = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 3484, VIS.DisplayType.Search, "C_Invoice_ID", 0, !1, "DocStatus IN ('CO','CL')"); et = new VIS.Controls.VTextBoxButton("C_Invoice_ID", !1, !1, !0, VIS.DisplayType.Search, wf); et.getControl().addClass("va012-input-size-2"); et.getControl().attr("tabindex", "11"); tu.append(et.getControl()); tu.append(et.getBtn(0)); tu.append(et.getBtn(1)); et.fireValueChanged = function () { sr = 0; sr = et.value; et.value && (e.checkInvoiceCondition(sr, f.val()) ? e.setBPartner(sr) : et.setValue()) } }, getFormData: function () { var n = {}, t = []; return n._bankStatementLineID = o.attr("data-uid"), n._txtStatementNo = hi.val(), n._txtStatementPage = nr.val(), n._txtStatementLine = fi.val(), n._dtStatementDate = kr.val(), n._cmbPaymentMethod = ci.val(), n._cmbCurrency = dt, n._cmbVoucherMatch = y.val(), n._txtDescription = VIS.Utility.encodeText(dr.val()), n._txtVoucherNo = VIS.Utility.encodeText(tr.val()), n._cmbCharge = ft.attr("chargeid"), n._cmbTaxRate = kt.val(), n._txtTaxAmount = ai.val(), n._ctrlPayment = or, n._ctrlOrder = wr, n._ctrlCashLine = bu, n._ctrlInvoice = sr, n._ctrlBusinessPartner = fu, n._chkUseNextTime = ru.is(":checked"), n._cmbBank = ni.val(), n._cmbBankAccount = h.val(), n._cmbBankAccountClasses = su.val(), n._cmbTransactionType = p.val(), n._scheduleList = d.toString(), n._cmbContraType = bt.val(), n._cmbCashBook = oi.val(), n._cmbTransferType = li.val(), n._txtCheckNo = lr.val(), n._cmbDifferenceType = ut.val(), ut.val() == "CH" ? (n._txtAmount = g.val(), n._txtTrxAmt = f.val()) : (n._txtAmount = f.val(), n._txtTrxAmt = g.val()), n._txtDifference = rt.val(), t.push(n), t }, insertNewRecord: function (n, i) { t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/InsertData", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _formData: n }), success: function (n) { i(n) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) }, afterInsertion: function (n) { if (n != null && n != "") { var i = t.parseJSON(n); i == "Success" ? (fi.val(parseInt(fi.val()) + 10), yt(s, !1, "absolute"), VIS.ADialog.info(VIS.Msg.getMsg("VA012_RecordSaved"), null, "", ""), tt = [], w.html(""), gt = 1, c.loadStatement(pt), it.html(""), u.scheduleRefresh(), u.prepayRefresh(), ri = 1, e.loadPayments(h.val(), k.val(), p.val()), u.scheduleRefresh(), u.prepayRefresh(), u.refreshForm()) : (yt(s, !1, "absolute"), VIS.ADialog.info(VIS.Msg.getMsg(i), null, "", "")) } }, refreshForm: function () { o.attr("data-uid", 0); e.getMaxStatement("LO"); kr.val(ne); ci.prop("selectedIndex", 0); y.prop("selectedIndex", 0); y.trigger("change"); f.val(0..toFixed(l)); g.val(0..toFixed(l)); rt.val(0..toFixed(l)); rt.attr("vchangable", "Y"); ut.prop("selectedIndex", 0); dr.val(""); tr.val(""); ir.prop("selectedIndex", 0); ft.attr("chargeid", 0); ft.val(""); kt.prop("selectedIndex", 0); ai.val(0..toFixed(l)); ru.attr("checked", !1); nt.setValue(); at.setValue(); vt.setValue(); a.setValue(); et.setValue(); fu = 0; or = 0; wr = 0; sr = 0; i.trigger("click"); u.loadCurrency(); f.trigger("focus"); f.select(); bt.prop("selectedIndex", 0); oi.prop("selectedIndex", 0); li.prop("selectedIndex", 0); lr.val("") }, scheduleRefresh: function () { d = []; ti = []; v = []; rr.val("") }, prepayRefresh: function () { gi = []; er = []; pu.val("") }, newRecordDispose: function () { o = null; yu = null; hi = null; ef = null; nr = null; fi = null; kr = null; ci = null; bt = null; oi = null; li = null; lr = null; dt = null; y = null; f = null; g = null; rt = null; ut = null; wu = null; i = null; r = null; dr = null; tr = null; ir = null; ft = null; kt = null; ai = null; ar = null; gr = null; nu = null; tu = null; iu = null; ru = null; uu = null; vr = null; of = null; rr = null; pu = null; ot = null; sf = null; hf = null; ei = null; df = null; pf = null; at = null; wr = null; nt = null; ue = null; or = null; vt = null; yf = null; bu = null; ku = null; a = null; fu = null; wf = null; et = null; sr = null; ne = null; du = null } }; t(window).resize(function () { e.setPaymentListHeight(); c.setStatementListHeight(); cu.height(t("#VA012_mainContainer_" + $self.windowNo).height()) }); this.getRoot = function () { return s }; this.setSize = function () { cu.height(t("#VA012_mainContainer_" + $self.windowNo).height()) }; this.disposeComponents = function () { $self = null; s = null; ni = null; h = null; su = null; kf = null; k = null; p = null; nf = null; tf = null; w = null; it = null; pt = ""; hr = null; cr = null; ie = null; re = null; vi = null; ur = null; _divCtrlCashLine = null; yi = null; fr = null; st = null; yr = null; pr = null; si = null; ht = null; cf = null; ct = null; lt = null; pi = null; wi = null; bi = null; ki = null; di = null; b = null; lf = null; rf = null; uf = null; ff = null; hu = null; cu = null; br = null; bf = null; tt = []; d = []; ti = []; gi = []; er = []; u.newRecordDispose() } } i.prototype.dispose = function () { this.disposeComponents(); this.frame && this.frame.dispose(); this.frame = null }; i.prototype.init = function (n, t) { this.windowNo = n; this.frame = t; this.Initialize(); this.frame.getContentGrid().append(this.getRoot()); this.setSize() }; n.AForms = n.AForms || {}; n.AForms.bankStatement = i }(VA012, jQuery), function () { }(); VA012 = window.VA012 || {}, function (n, t) { n.UploadExcel = function (i, r, u) { function ut(n) { for (u.children().remove(), j = 0; j < n.ExcelCol.length; j++) j == 1 ? u.append("<li index=" + j + " style='border:none;float:none' >" + n.ExcelCol[j] + "<\/li>") : u.append("<li index=" + j + " >" + n.ExcelCol[j] + "<\/li>") } var k = null, f = [], l = [], a = 0, o = 0, c = Date.now().toString(), s = 1048576, v = 0, h = 0, p = [], e = null, nt = i, ft = t(window).width(), et = t(window).height(), c = Date.now().toString(), ot = r; savedFileName = ""; var d = t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:40%;width: 40%;left: 32%;position:absolute;z-index:99999;'>"), w = null, b = null; this.isWait = !1; self = this; var tt = function () { var n = null, i = 0, t; for (t in f) i = parseInt(f[t].size / s), e.size % s > 0 && i++, v += i, n = {}, n.Name = f[t].name, n.Size = f[t].size, p.push(n); g() }, g = function () { var t; if (f == null || f.length == 0) { y(!1); return } if (!(o >= f.length)) { var n = new XMLHttpRequest, i = new FormData, r = f[o].name.substring(0, f[o].name.lastIndexOf(".")) + c + f[o].name.substring(f[o].name.lastIndexOf(".")); savedFileName = r; i.append("file", f[o].slice(h * s, h * s + Number(s))); n.open("POST", VIS.Application.contextUrl + "VA012/UploadExcel/SaveFileinTemp?fileName=" + r + "&folderKey=" + c + "&orgFileName=" + f[o].name, !1); n.send(i); k = n.responseText; a++; h++; t = parseInt(f[o].size / s); f[o].size % s > 0 && t++; h == t && (o++, h = 0); a <= v && rt(parseInt(a / v * 80)); window.setTimeout(function () { g() }, 2) } }, it = function (n) { for (var t = [], i, w, r, b, u = 0; u < n.files.length; u++) { if (e = n.files[u], e == undefined) return; if (e.size <= 0) return f = [], l = [], a = 0, o = 0, c = null, s = null, v = 0, h = 0, p = [], e = null, VIS.ADialog.info("VADMS_FileSizeShouldGreaterThan0KB"), y(!1), !1; if (e.name.indexOf("&") > -1 || e.name.indexOf("?") > -1 || e.name.indexOf("#") > -1 || e.name.indexOf("/") > -1 || e.name.indexOf("\\") > -1) { t.push(e.name); continue } for (i in f) if (e.name == f[i].name) { window.setTimeout(function () { y(!1); VIS.ADialog.info("fileAlreadyAttached") }, 20); return } if (l != null) for (i in l) if (e.name == l[i].Name && !l[i].IsDeleted) { window.setTimeout(function () { y(!1); VIS.ADialog.info("fileAlreadyAttached") }, 20); return } w = {}; w.Name = e.name; w.Size = e.size; f.push(e) } if (t.length > 0) { r = ""; for (b in t) r += t[b].toString() + "\n"; r += t.length == 1 ? "File has" : "Files have"; r += " invalid name. Please change the file name and try again."; y(!1); VIS.ADialog.info("", !0, r) } }, y = function (n) { if (t("body").find("#progressbar").remove(), n) { w = t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute;height: 35px;'>"); b = t("<span class='vis-ui-label'  style='position:absolute;left: 60%;top: 4px;'>").append("0%"); w.append(b); d.append(w); var i = t("<div id='progressbar' style='z-index: 999999;' class='vadms-Busy-Progress'><\/div>"); i.append(d); i.appendTo("<body>") } else t("body").find("progressbar").remove() }, rt = function (n) { w.css("width", n + "%"); b.empty(); b.append(n + "%") }; return this.getFolderKey = c, this.getSavedFileName = savedFileName, this.GetUploadedExcelColumns = function () { var t, u, i; if (o >= f.length) return t = [], u = VIS.Application.contextUrl + "VA012/UploadExcel/SaveAttachmentEntries", t.push({ Files: JSON.stringify(p) }), t.push({ FolderKey: c }), t.push({ FileName: savedFileName }), t.push({ Mapping: r }), i = n.ControllerRequestAjaxParameter1(u, t, !1), r.ExcelCol = i.ExcelCol, r.FileName = i.FileName, ut(i), i }, y(!0), it(i), tt(), k } }(VA012, jQuery); VA012 = window.VA012 || {}, function (n) { function t() { VIS.CalloutEngine.call(this, "VA012.VA012_Contra") } var r = VIS.Logging.Level, i = VIS.Utility.Util; VIS.Utility.inheritPrototype(t, VIS.CalloutEngine); t.prototype.SetContra = function (n, t, r, u, f) { if (this.isCalloutActive()) return ""; if (this.setCalloutActive(!0), f == null) r.setValue("VA012_IsContra", !1); else { var e = i.getValueOfString(VIS.DB.executeScalar("SELECT DTD001_ChargeType FROM C_Charge WHERE  C_Charge_ID=" + f.toString())); e == "CON" ? r.setValue("VA012_IsContra", !0) : r.setValue("VA012_IsContra", !1) } return this.setCalloutActive(!1), "" }; n.Model = n.Model || {}; n.Model.VA012_Contra = t }(VA012, jQuery)