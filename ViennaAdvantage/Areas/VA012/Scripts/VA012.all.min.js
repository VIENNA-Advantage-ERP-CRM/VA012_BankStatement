/*Version 1.0.22.13*/VA012 = window.VA012 || {}, function (n, t) { function i() { function ke(n) { n != null && n != "" && (c = t(n), h.getControls(), h.setBankAndAccount(), u.newRecord(), h.getBaseCurrency(), h.loadPayments("0", "0", "PY", at.val()), de(), h.dragPayments(), h.dropPayments()) } function de() { af.on(VIS.Events.onTouchStartOrClick, function (n) { n.stopPropagation(); var i = wu.width(); i > 50 && t(".va012-left-content").hide(); wu.animate({ width: i > 50 ? 40 : 200 }, 300, "swing", function () { i < 50 && t(".va012-left-content").show() }) }); hi.on("change", function () { l.val("0"); h.loadBankAccount() }); l.on("change", function () { u.loadPayment(); u.loadCurrency(); u.loadCashLine(); ti.html(""); u.scheduleRefresh(); u.prepayRefresh(); u.refreshForm(); ci = 1; storepaymentdata = []; h.loadPayments(l.val() == null ? 0 : l.val(), vt.val(), ut.val(), at.val()); wt = []; ht.html(""); fi = 1; g.loadStatement(ii) }); vt.on("change", function () { ti.html(""); ci = 1; storepaymentdata = []; h.loadPayments(l.val() == null ? 0 : l.val(), vt.val(), ut.val(), at.val()) }); ut.on("change", function () { ut.val() == "CO" ? (vt.prop("selectedIndex", 0), vt.prop("disabled", !0)) : (vt.prop("selectedIndex", 0), vt.prop("disabled", !1)); ti.html(""); u.scheduleRefresh(); u.prepayRefresh(); u.refreshForm(); ci = 1; rf = 0; ue = 50; ae = 1; storepaymentdata = []; h.loadPayments(l.val() == null ? 0 : l.val(), vt.val(), ut.val(), at.val()) }); sf.on(VIS.Events.onTouchStartOrClick, function () { at.val() == "" ? VIS.ADialog.info("VA012_PleaseEnterStatementDate", null, "", "") : g.statementDialog() }); hf.on(VIS.Events.onTouchStartOrClick, function () { g.matchStatementDialog() }); nu.on(VIS.Events.onTouchStartOrClick, function () { g.paymentScheduleDialog() }); pf.on(VIS.Events.onTouchStartOrClick, function () { g.prepayOrderDialog() }); df.on(VIS.Events.onTouchStartOrClick, function () { ni.val() != null && ni.val() != "" ? (vi = !0, wt = [], ht.html(""), fi = 1, g.loadStatement(ii)) : (wt = [], ht.html(""), fi = 1, g.loadStatement(ii)) }); ni.keypress(function (n) { n.which == 13 && (ni.val() != null && ni.val() != "" ? (vi = !0, wt = [], ht.html(""), fi = 1, g.loadStatement(ii)) : (wt = [], ht.html(""), fi = 1, g.loadStatement(ii))) }); cf.on(VIS.Events.onTouchStartOrClick, function () { wt.length > 0 ? t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/UnmatchStatement", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _statementLinesList: wt.toString() }), success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n[0]._status == "Success" && n[0]._statementOk != null && VIS.ADialog.info(n[0]._statementOk + " " + VIS.Msg.getMsg("VA012_StatementsUnmatched"), null, "", ""), n[0]._error != null && VIS.ADialog.info(n[0]._error, null, "", ""), n[0]._statementNo != null && VIS.ADialog.info(n[0]._statementNo + " " + VIS.Msg.getMsg("VA012_CompletedRecord"), null, "", ""), n[0]._statementNoNotUpdate != null && VIS.ADialog.info(n[0]._statementNoNotUpdate + " " + VIS.Msg.getMsg("VA012_ErrorSaving"), null, "", ""), u.scheduleRefresh(), u.prepayRefresh(), u.refreshForm(), wt = [], storepaymentdata = [], ht.html(""), fi = 1, g.loadStatement(ii), ti.html(""), u.scheduleRefresh(), u.prepayRefresh(), ci = 1, h.loadPayments(l.val(), vt.val(), ut.val(), at.val())) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) : VIS.ADialog.info("VA012_NoRecordSelected", null, "", "") }); lf.on(VIS.Events.onTouchStartOrClick, function () { if (l.val() == null || l.val() == "" || l.val() == "0") { VIS.ADialog.info("VA012_SelectBankAccountFirst", null, "", ""); return } t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/ProcessStatement", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _statementLinesList: wt.toString(), _accountID: l.val() }), success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n[0]._statementProcessed != null && VIS.ADialog.info(n[0]._statementProcessed + " " + VIS.Msg.getMsg("VA012_StatementsProcessed"), null, "", ""), n[0]._error != null && VIS.ADialog.info(n[0]._error, null, "", ""), n[0]._statementNotProcessed != null && VIS.ADialog.info(n[0]._statementNotProcessed + " " + VIS.Msg.getMsg("VA012_StatementsNotProcessed"), null, "", ""), n[0]._statementUnmatchedLines != null && VIS.ADialog.info(n[0]._statementUnmatchedLines + " " + VIS.Msg.getMsg("VA012_ExistsUnmatched"), null, "", ""), u.scheduleRefresh(), u.prepayRefresh(), u.refreshForm(), storepaymentdata = [], wt = [], ht.html(""), fi = 1, g.loadStatement(ii), ti.html(""), u.scheduleRefresh(), u.prepayRefresh(), ci = 1, h.loadPayments(l.val(), vt.val(), ut.val(), at.val())) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) }); bf.on(VIS.Events.onTouchStartOrClick, function () { wt.length > 0 || parseInt(a.attr("data-uid")) > 0 ? VIS.ADialog.ask(VIS.Msg.getMsg("VA012_WantToDelete")) && t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/DeleteStatement", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _statementLinesList: wt.toString(), _statementLineID: a.attr("data-uid") }), success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n[0]._status == "Success" && n[0]._statementProcessed != null && VIS.ADialog.info(n[0]._statementProcessed + " " + VIS.Msg.getMsg("VA012_StatementsDeleted"), null, "", ""), n[0]._statementNotProcessed != null && VIS.ADialog.info(n[0]._statementNotProcessed + " " + VIS.Msg.getMsg("VA012_StatementsNotDeleted"), null, "", ""), n[0]._error != null && VIS.ADialog.info(n[0]._error, null, "", ""), u.scheduleRefresh(), u.prepayRefresh(), u.refreshForm(), wt = [], storepaymentdata = [], ht.html(""), fi = 1, g.loadStatement(ii), ti.html(""), u.scheduleRefresh(), u.prepayRefresh(), ci = 1, h.loadPayments(l.val(), vt.val(), ut.val(), at.val())) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) : VIS.ADialog.info("VA012_NoRecordSelected", null, "", "") }); ti.on("scroll", h.paymentScroll); ht.on("scroll", h.statementScroll); ht.on(VIS.Events.onTouchStartOrClick, g.statementListEdit); ht.on(VIS.Events.onTouchStartOrClick, g.openStatement); ht.on(VIS.Events.onTouchStartOrClick, g.selectedStatementLinesList); ti.on(VIS.Events.onTouchStartOrClick, g.selectedScheduleList); ti.on(VIS.Events.onTouchStartOrClick, function (n) { n.target.type != "checkbox" && (t(n.target).closest(".row").find(":checkbox").is(":checked") ? t(n.target).closest(".row").find(":checkbox").prop("checked", !1) : t(n.target).closest(".row").find(":checkbox").prop("checked", !0)); i.getControl().trigger("blur", [r(i.getControl().val()), r(s.getControl().val())]) }); at.addClass("va012-mandatory"); at.on("change", function () { if (at.val() == "") at.addClass("va012-mandatory"); else { if (new Date(at.val()) > new Date) return VIS.ADialog.info("VA012_StatementDateToday", null, "", ""), at.val(""), !1; at.removeClass("va012-mandatory") } storepaymentdata = []; h.loadPayments(l.val() == null ? 0 : l.val(), vt.val(), ut.val(), at.val()) }) } function ge(n) { t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/getMatchRecData", contentType: "application/json; charset=utf-8", success: function (t) { if (n.html(""), n.append("<option value=0 >-<\/option>"), t = JSON.parse(t), t != null && t.length > 0) for (var i = 0; i < t.length; i++)n.append("<option value=" + t[i].Value + ">" + t[i].Name + "<\/option>") }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) } function le(n, t) { w2ui["VA012_gridPayment_" + $self.windowNo] != null && w2ui["VA012_gridPayment_" + $self.windowNo].destroy(); var i = null; i = n.w2grid({ name: "VA012_gridPayment_" + $self.windowNo, recordHeight: 25, show: { toolbar: !1, selectColumn: !1, toolbarReload: !1, toolbarColumns: !1, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1 }, records: [], columns: [{ field: "_trxDate", caption: "Tran. Date", sortable: !1, size: "80px", display: !1 }, { field: "_trxNo", caption: "Auth Code/ Trx no.", sortable: !1, size: "30%", hidden: !1 }, { field: "_salesAmt", caption: "Trx Amount", sortable: !1, size: "15%", hidden: !1, style: "text-align: right" }, { field: "_netAmt", caption: "Statement Amount", sortable: !1, size: "15%", hidden: !1, style: "text-align: right" }, { field: "_difference", caption: "Difference", sortable: !1, size: "15%", hidden: !1, style: "text-align: right" }, { field: "_chargeType", caption: "Charge Type", sortable: !1, size: "80px", display: !0 }, { field: "_taxRate", caption: "Tax Rate", sortable: !1, size: "80px", display: !0 }, { field: "_taxAmt", caption: "Tax Amt", sortable: !1, size: "15%", hidden: !1, style: "text-align: right" },], onChange: function () { }, onClick: function () { }, onDelete: function () { }, onSubmit: function () { } }); i.add(t) } function au(n) { if (n != null && b.length > 0) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetCurrencyandConversionType", dataType: "json", data: { _invoiceSchedules: n }, success: function (n) { var t = JSON.parse(n); (t != null || t != "") && i(t) } }); function i(n) { if (n.currencyId != 0 && b != null) { o.val(n.currencyId).prop("selected", !0); for (var i = 0; o[0].length > i; i++)VIS.Utility.Util.getValueOfInt(o[0][i].value) == n.currencyId || VIS.Utility.Util.getValueOfInt(o[0][i].value) == et ? t(o[0][i]).show() : t(o[0][i]).hide(); o.removeClass("va012-mandatory"); o.attr("disabled", !1); y.val(n.conversionTypeId).prop("selected", !0) } else o.val(et).prop("selected", !0), o.attr("disabled", !0), o.removeClass("va012-mandatory"), y.val(n.conversionTypeId).prop("selected", !0); y.trigger("change") } } else o.prop("selectedIndex", 0), o.addClass("va012-mandatory"), o.attr("disabled", !1), y.prop("selectedIndex", 0), y.addClass("va012-mandatory") } function r(n) { var t = 0; return dotFormatter = $self.dotFormatter, typeof n == "string" ? n : n = n.toString(), dotFormatter ? (n.contains("−") ? n = (-1 * iu.GetConvertedNumber(n, dotFormatter)).toString() : n.contains(".") && (n = iu.GetConvertedNumber(n, dotFormatter).toString()), t = n != "" ? n : t) : (n.contains("−") && !n.contains(".") ? n = (-1 * iu.GetConvertedNumber(n, dotFormatter)).toString() : n.contains("−") && n.contains(".") ? n = (-1 * iu.GetConvertedNumber(n, dotFormatter)).toString() : n.contains(",") && (n = iu.GetConvertedNumber(n, dotFormatter).toString()), t = n != "" ? n : t), parseFloat(t).toFixed(v) } function ef(n, i, r, u) { var f = VIS.Utility.Util.getValueOfInt(n), e, o; if (f == 0) { u(n); return } e = VIS.Utility.Util.getValueOfDecimal(i); o = VIS.Utility.Util.getValueOfInt(r); t.ajax({ url: VIS.Application.contextUrl + "VA012/BankStatement/CalculateSurcharge", type: "GET", contentType: "application/json; charset=utf-8", data: { _tax_ID: f, _chargeAmt: e, _stdPrecision: o }, success: function (n) { u(n) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) } function of(n, t) { return t.indexOf(n) > -1 } function pt(n, i, r) { if (vu = t("<div class='vis-apanel-busy va012-busy-bank-statement'>"), vu.css({ position: r, width: "95%", height: "95%", "text-align": "center", visibility: "hidden" }), i) vu.css({ visibility: "visible" }); else { n.find(".va012-busy-bank-statement").remove(); return } n.append(vu) } var c, iu, h, g, u; this.windowNo; $self = this; c = t("<div/>"); this.frame; var vu = null, hi = null, l = null, yu = null, at = null, sf = null, hf = null, vt = null, ut = null, ht = null, ti = null, pu = null, ii = "", br = null, kr = null, ru = null, re = null, vi = !1, wt = [], b = [], oi = [], st = [], yr = [], pr = [], cf = null, lf = null, af = null, wu = null, bu = null, et = 0, v = 2, ri = !1, yi = !1, ci = 1, ae = 1, fi = 1, vf = 50, ue = 50, ku = 0, du = 0, fe = null, a = null, gu = null, kt = null, yf = null, hr = null, di = null, d = null, gi = null, rt = null, bi = null, nr = null, dr = null, p = null, i = null, s = null, w = null, ot = null, uu = null, cr = null, tr = null, k = null, nt = null, yt = null, gr = null, fu = null, lr = null, eu = null, ou = null, su = null, hu = null, nu = null, pf = null, li = null, nf = null, ct = null, wf = null, bf = null, ve = null, ye = null, ir = null, ar = null, rr = null, vr = null, ui = null, ee = null, tu = null, ki = null, dt = null, kf = null, gt = null, ei = null, ur = null, fr = null, er = null, or = null, sr = null, ni = null, df = null, pi = null, oe = null, tf = null, f = null, e = null, gf = 0, rf = 0, se = null, ft = null, si = null, ne = null, lt = null, wi = null, te = null, tt = null, ai = null, pe = null, uf = null, it = null, cu = null, ie = null, bt = null, wr = null, o = null, y = null; storepaymentdata = []; iu = VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount); this.dotFormatter = VIS.Env.isDecimalPoint(); var ff = new Date, he = ff.getFullYear() + "-" + ("0" + (ff.getMonth() + 1)).slice(-2) + "-" + ("0" + ff.getDate()).slice(-2), lu, we, ce, be; this.Initialize = function () { ke(h.loadFormDesign()); s.addVetoableChangeListener(this); yt.addVetoableChangeListener(this); i.addVetoableChangeListener(this); w.addVetoableChangeListener(this) }; h = { loadFormDesign: function () { return _formDesign = t('<div class="va012-assign-content">'), divContainer = t('  <div id="VA012_mainContainer_' + $self.windowNo + '" class="va012-main-container">'), divTable = t('<table id="VA012_table_' + $self.windowNo + '" style="width: 100%;">'), tableTr = t("<tr>"), tableTd = t('<td id="VA012_tdLeft_' + $self.windowNo + '" style="width: 200px;position: relative;">   <div class="va012-left-part">              <div class="va012-left-title">                  <h4>    <i id="VA012_btnHide_' + $self.windowNo + '" class="fa fa-bars" alt="lines" style="cursor: pointer;background: rgba(var(--v-c-primary),1);"><\/i> <\/h4>              <\/div>              <div class="va012-left-content">                  <div class="va012-left-data">                      <label  id="VA012_lblBank_' + $self.windowNo + '" >' + VIS.Msg.getMsg("VA012_Bank") + '<sup style="color: red;">*<\/sup><\/label>                      <select id="VA012_cmbBank_' + $self.windowNo + '" ><\/select>                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <label  id="VA012_lblBankAccount_' + $self.windowNo + '" >' + VIS.Msg.getMsg("VA012_BankAccount") + '<sup style="color: red;">*<\/sup><\/label>                      <select id="VA012_cmbBankAccount_' + $self.windowNo + '"   ><\/select>                  <\/div>                  <!-- end of left-data -->                  <div class="va012-left-data">                      <label  id="VA012_lblStatementDate_' + $self.windowNo + '" >' + VIS.Msg.getMsg("VA012_StatementDate") + '<sup style="color: red;">*<\/sup><\/label>                      <input type="date" max="9999-12-31" id="VA012_statementDate_' + $self.windowNo + '"   >                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <a id="VA012_btnLoadStatement_' + $self.windowNo + '">' + VIS.Msg.getMsg("VA012_LoadStatement") + '<\/a>                      <a id="VA012_btnMatchStatement_' + $self.windowNo + '">' + VIS.Msg.getMsg("VA012_MatchStatement") + "<\/a>                  <\/div>                  <!-- end of left-data -->              <\/div>              <!-- end of left-content -->          <\/div>          <!-- end of left-part --> <\/td>"), tableTd1 = t('<td style="position: relative;">'), contentDiv = t('<div id="VA012_contentArea_' + $self.windowNo + '" class="va012-content-area" style="position: absolute;" >'), divMidWrap = t('<div id="VA012_middleWrap_' + $self.windowNo + '" class="va012-middle-wrap">'), divtopWrap = t('<div class="va012-mid-top-wrap" id="VA012_formBtnNewRecord_' + $self.windowNo + '">                      <div class="va012-icons-wrap">                          <span>                              <i class="va012-undo vis vis-ignore" alt="undo" title="Undo" id="VA012_btnUndo_' + $self.windowNo + '"><\/i><\/span>                          <span>                              <i class="va012-hide-show-newform vis vis-plus" activestatus="0" alt="add" title = "Expand" id="VA012_btnNewRecord_' + $self.windowNo + '"><\/i><\/span>                      <\/div>                      <!-- end of icons-wrap -->                  <\/div>'), divformWrap = t('<div class="va012-form-wrap va012-newform" id="VA012_formNewRecord_' + $self.windowNo + '" data-uid="0" style="height:55%;overflow-y:auto;width:101%;">'), divRow1 = t('<div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementNumber") + ' <sup style="color: red;">*<\/sup><\/label>                                  <input  tabindex="1" id="VA012_txtStatementNo_' + $self.windowNo + '" type="text" class="va012-input-size">                                  <i  id="VA012_btnStatementNo_' + $self.windowNo + '" class="fa fa-plus va012-add-icon"><\/i>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementPage") + '<\/label>                                  <input tabindex="2" value="1" id="VA012_txtStatementPage_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementLine") + '<\/label>                                  <input tabindex="3" value="10" id="VA012_txtStatementLine_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  '), divRow2 = t('<div class="row va012-fl-padd" style="width:102%">'), row2Col1 = t('<div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementDate") + '<sup style="color: red;">*<\/sup><\/label>                                  <input tabindex="4" id="VA012_dtStatementDate_' + $self.windowNo + '" type="date" max="9999-12-31">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->'), row2Col2 = t('<div class="col-md-4 col-sm-4 va012-padd-0">'), row2Col2divAmt = t('<div class="va012-form-group va012-form-data" >'), row2Col2Lble = t("<label>" + VIS.Msg.getMsg("VA012_Amount") + '<sup style="color: red;">*<\/sup><\/label>'), row2Col2btnIn = t('<a tabindex="5" id="VA012_btnIn_' + $self.windowNo + '" v_active="1" class="va012-inout-icon va012-active">In<\/a>'), row2Col2btnOut = t('<a tabindex="6" id="VA012_btnOut_' + $self.windowNo + '" v_active="0" class="va012-inout-icon va012-inactive">Out<\/a>'), i = new VIS.Controls.VAmountTextBox("VA012_txtAmount_" + $self.windowNo + "", !1, !1, !0, 50, 100, VIS.DisplayType.Amount, VIS.Msg.getMsg("Amount")), i.setValue(0), i.getControl().addClass("va012-input-size-amt va012-right-align va012-txtamount"), row2Col2btnIcon = t('<a id="VA012_btnAmount_' + $self.windowNo + '" class="va012-info-icon"><\/a>'), row2Col3 = t('<div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_VoucherMatch") + '<sup style="color: red;">*<\/sup><\/label>                                  <select tabindex="8" id="VA012_cmbVoucherMatch_' + $self.windowNo + '">                                  <\/select>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  '), divRow3 = t('                      <div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-8 col-sm-8 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_Description") + '<\/label>                                  <input tabindex="9" id="VA012_txtDescription_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divVoucherNo_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_VoucherNo") + '<\/label>                                  <input tabindex="9" id="VA012_txtVoucherNo_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  '), divRow4 = t('<div class="row va012-fl-padd" style="width:102%">'), divRow4Col1 = t('<div class="col-md-4 col-sm-4 va012-padd-0">'), divRow4Col1TrxAmt = t('<div id="VA012_divTrxAmt_' + $self.windowNo + '" class="va012-form-group va012-form-data">'), divRow4Col1Lbl = t("<label>" + VIS.Msg.getMsg("VA012_TrxAmt") + "<\/label>"), s = new VIS.Controls.VAmountTextBox("VA012_txtTrxAmt_" + $self.windowNo + "", !1, !0, !0, 50, 100, VIS.DisplayType.Amount, VIS.Msg.getMsg("Amount")), s.getControl().addClass("va012-right-align"), s.setValue(0..toFixed(v)), divRow4Col1TrxAmt.append(divRow4Col1Lbl).append(s.getControl()), divRow4Col1.append(divRow4Col1TrxAmt), divRow4Col2 = t('<div class="col-md-4 col-sm-4 va012-padd-0">'), divRow4Col2Diff = t('<div id="VA012_divDifference_' + $self.windowNo + '" class="va012-form-group va012-form-data">'), divRow4Col2DiffLbl = t("<label>" + VIS.Msg.getMsg("VA012_Difference") + "<\/label>"), w = new VIS.Controls.VAmountTextBox("VA012_txtDifference_" + $self.windowNo + "", !1, !0, !0, 50, 100, VIS.DisplayType.Amount, VIS.Msg.getMsg("Amount")), w.getControl().addClass("va012-right-align"), w.setValue(0), divRow4Col2Diff.append(divRow4Col2DiffLbl).append(w.getControl()), divRow4Col2.append(divRow4Col2Diff), divRow4Col3 = t('<div class="col-md-4 col-sm-4 va012-padd-0">'), divRow4Col3DiffType = t('<div id="VA012_divDifferenceType_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_DifferenceType") + '<\/label>                                  <select tabindex="9" id="VA012_cmbDifferenceType_' + $self.windowNo + '">                                  <\/select>                              <\/div>                              <!-- end of form-group -->'), divRow4Col3.append(divRow4Col3DiffType), divRow4.append(divRow4Col1).append(divRow4Col2).append(divRow4Col3), divRow5 = t('<div class="row va012-fl-padd" style="width:102%">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divContraType_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_ContraType") + '<\/label>                                      <select tabindex="10" id="VA012_cmbContraType_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCashBook_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_CashBook") + '<\/label>                                      <select tabindex="10" id="VA012_cmbCashBook_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <div id="VA012_divCtrlCashLine_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_CashJournalLine") + '<\/label>                                      <div id="VA012_ctrlCashLine_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCheckNo_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_CheckNo") + '<\/label>                                      <input  disabled tabindex="12" id="VA012_txtCheckNo_' + $self.windowNo + '" type="text">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->  '), divRow6 = t('<div class="row va012-fl-padd" style="width:102%">'), divRow6Col1 = t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCharge_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_Charge") + '<\/label>                                      <div style=" position: relative; float: left; width: 100%; ">                                      <input tabindex="10" chargeid="" type="text" id="VA012_txtCharge_' + $self.windowNo + '" style=" width: 100%; ">                                      <img id="VA012_btnCharge_' + $self.windowNo + '" class="VA012-img-combo" alt="">                                     <\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->'), divRow6Col2 = t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divTaxRate_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_TaxRate") + '<\/label>                                      <select tabindex="11" id="VA012_cmbTaxRate_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->'), divRow6Col3 = t('<div class="col-md-4 col-sm-4 va012-padd-0">'), divRow6Col3divTax = t('<div id="VA012_divTaxAmount_' + $self.windowNo + '" class="va012-form-group va012-form-data">'), divRow6Col3divTaxLbl = t("<label>" + VIS.Msg.getMsg("VA012_TaxAmount") + "<\/label>"), yt = new VIS.Controls.VAmountTextBox("VA012_txtTaxAmount_" + $self.windowNo + "", !1, !0, !0, 50, 100, VIS.DisplayType.Amount, VIS.Msg.getMsg("Amount")), yt.setValue(0), yt.getControl().addClass("va012-right-align"), divRow6Col3divTax.append(divRow6Col3divTaxLbl).append(yt.getControl()), divRow6Col3.append(divRow6Col3divTax), divRow6.append(divRow6Col1).append(divRow6Col2).append(divRow6Col3), divRow7 = t('<div class="row va012-fl-padd" style="width:102%">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlPayment_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_Payment") + '<\/label>                                      <div id="VA012_ctrlPayment_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlInvoice_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_Invoice") + '<\/label>                                      <div id="VA012_ctrlInvoice_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlBusinessPartner_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_BusinessPartner") + '<\/label>                                      <div id="VA012_ctrlBusinessPartner_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->  '), divRow8 = t('<div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPaymentSchedule_' + $self.windowNo + '" class="va012-form-data" >                              <label>' + VIS.Msg.getMsg("VA012_PaymentSchedules") + '<\/label>                              <input disabled id="VA012_txtPaymentSchedule_' + $self.windowNo + '" type="text" class="va012-input-size">                              <a tabindex="13"  id="VA012_btnPaymentSchedule_' + $self.windowNo + '" class="va012-edit-icon"><\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPrepayOrder_' + $self.windowNo + '" class="va012-form-data" >                              <label>' + VIS.Msg.getMsg("VA012_PrepayOrders") + '<\/label>                              <div id="VA012_ctrlOrder_' + $self.windowNo + '" ><\/div>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  '), divRow9 = t('<div class="row va012-fl-padd" style="width:102%">                       <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-check">                                  <input tabindex="13" id="VA012_chkUseNextTime_' + $self.windowNo + '" type="checkbox">                                  <label style="position: absolute;">' + VIS.Msg.getMsg("VA012_UseNextTime") + '<\/label>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-2 col-sm-2 va012-padd-0" >                              <div class="va012-form-data" id="VA012_divMore_' + $self.windowNo + '">                                  <a tabindex="14" visiblestatus="0" class="va012-more" id="VA012_btnMore_' + $self.windowNo + '" href="#">' + VIS.Msg.getMsg("VA012_More") + '<\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-6 col-sm-6 va012-padd-0" >                          <div style="float:right;">                              <a tabindex="15" title="Save Record" id="VA012_btnSave_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" style=" float: left;">' + VIS.Msg.getMsg("VA012_SaveandNew") + "<\/a>                          <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->"), divRow10 = t('<div class="row va012-fl-padd" style="width:102%">'), divRow10Col1 = t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCurrency_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_Currency") + '<\/label>                                      <select tabindex="10" id="VA012_txtCurrency_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->'), divRow10Col2 = t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divConversionType_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_ConversionType") + '<\/label>                                      <select tabindex="11" id="VA012_txtConversionType_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->'), divRow10.append(divRow10Col1).append(divRow10Col2), payHeaderWrap = t('<div id="VA012_paymentHeaderWrap_' + $self.windowNo + '" class="va012-payment-header-wrap">                          <div class="pull-left">                              <a class="va012-frm-btn va012-btn-gray" style="cursor: default;">' + VIS.Msg.getMsg("VA012_UpcomingTransactions") + '<\/a>                          <\/div>                      <div style=" float: right; width: 60%; ">                           <div class="va012-width-30" style=" float: left; width: 49%; ">                              <select id="VA012_cmbTransactionType_' + $self.windowNo + '">                             <option value="PY">' + VIS.Msg.getMsg("VA012_Payments") + '<\/option>                             <option value="PO">' + VIS.Msg.getMsg("VA012_PrepayOrders") + '<\/option>                              <option value="IS">' + VIS.Msg.getMsg("VA012_InvoiceSchedule") + '<\/option>                              <option value="CO">' + VIS.Msg.getMsg("VA012_Contra") + '<\/option>                              <\/select>                          <\/div>                          <div class="va012-width-30" style=" float: right; width: 49%; ">                              <select id="VA012_cmbSearchPaymentMethod_' + $self.windowNo + '">                              <\/select>                          <\/div>                          <\/div>                      <\/div>                      <!-- end of payment-header-wrap -->                  <div id="VA012_paymentList_' + $self.windowNo + '" class="va012-payment-list">                                           <div class="va012-payment-content" id="VA012_lstPayments_' + $self.windowNo + '">                   <\/div>                  <\/div>                  <!-- end of payment-list -->                <\/div>'), rightWrap = t('<div id="VA012_rightWrap_' + $self.windowNo + '" class="va012-right-wrap">                  <div id="VA012_rightTop_' + $self.windowNo + '" class="va012-right-top">                      <div class="row">                          <div class="col-md-3 col-sm-3" style=" padding-right: 5px; ">                              <div class="va012-pay-text" id="VA012_secReconciled_' + $self.windowNo + '" >                                <p>' + VIS.Msg.getMsg("VA012_Reconciled") + '<\/p>                                <p style="margin-top: 4px;">' + VIS.Msg.getMsg("VA012_Unreconciled") + '<\/p>                              <\/div>                          <\/div>                          <!-- end of col -->                          <div class="col-md-9 col-sm-9" style=" padding-left: 5px; ">                              <div class="va012-pay-text" id="VA012_secUnreconciled_' + $self.windowNo + '">                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-green"><span class="va012-base-curr"><\/span> 0<\/span>                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-red"><span class="va012-base-curr"><\/span> 0<\/span>                              <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                      <div class="row">                          <div class="col-md-12 col-sm-12" style=" padding-left: 5px; ">                      <div style=" /* float: right; */ padding-left: 10px;">                               <a id="VA012_btnUnmatch_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" title="Show Unmatched Record" style=" float: left; ">' + VIS.Msg.getMsg("VA012_Unmatch") + '<\/a>                              <a id="VA012_btnProcess_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" title="Clear Matched Record" style=" float: left; margin-left: 5px; ">' + VIS.Msg.getMsg("VA012_Process") + '<\/a>                             <a id="VA012_btnDelete_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" title="Delete Selected Record" style=" float: left; margin-left: 5px; ">' + VIS.Msg.getMsg("VA012_Delete") + '<\/a>                       <\/div>                           <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <div class="row">                          <div class="col-md-12 col-sm-12" style=" padding-right: 5px; ">                           <div class="va012-right-search">                            <div class="va012-search-wrap">                               <input id="VA012_txtSearch_' + $self.windowNo + '" value="" placeholder="' + VIS.Msg.getMsg("VA012_Search") + '..." type="text">                               <a id="VA012_btnSearch_' + $self.windowNo + '" class="va012-search-icon"><span class="glyphicon glyphicon-search"><\/span><\/a>                          <\/div>                      <!-- end of search-wrap -->                         <\/div>                  <!-- end of right-search -->                        <\/div>                       <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <\/div>                  <!-- end of right-top -->                    <div class="va012-right-content" id="VA012_lstStatement_' + $self.windowNo + '">                  <\/div>                  <!-- end of right-content -->              <\/div>'), row2Col2divAmt.append(row2Col2Lble).append(row2Col2btnIn).append(row2Col2btnOut).append(i.getControl()).append(row2Col2btnIcon), row2Col2.append(row2Col2divAmt), divRow2.append(row2Col1).append(row2Col2).append(row2Col3), divformWrap.append(divRow1).append(divRow2).append(divRow10).append(divRow3).append(divRow4).append(divRow5).append(divRow6).append(divRow7).append(divRow8).append(divRow9), divMidWrap.append(divtopWrap).append(divformWrap).append(payHeaderWrap), contentDiv.append(divMidWrap).append(rightWrap), tableTd1.append(contentDiv), tableTr.append(tableTd).append(tableTd1), lu = t('<div  id="VA012_gridMatchStatePopUp_' + $self.windowNo + '"" style="display:block;width:auto;height:auto"><div  style="    width: 50%;float: left;" ><label>' + VIS.Msg.getMsg("VA012_ChargeType") + '<\/label><div  id="VA012_ChargeSrch_' + $self.windowNo + '"><\/div><\/div><div ><label>' + VIS.Msg.getMsg("VA012_Taxrate") + '<\/label><select  id="VA012_cmbTaxRate_' + $self.windowNo + '"><\/select><\/div><div style="width:auto;height:270px" id="VA012_gridMatchState_' + $self.windowNo + '""><\/div><\/div>'), we = lu.find("#VA012_gridMatchState_" + $self.windowNo), ce = lu.find("#VA012_ChargeSrch_" + $self.windowNo), be = lu.find("#VA012_cmbTaxRate_" + $self.windowNo), _ChargeLookUp = VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(), $self.windowNo, 3787, VIS.DisplayType.Search), $ChargeControl = new VIS.Controls.VTextBoxButton("C_Charge_ID", !0, !1, !0, VIS.DisplayType.Search, _ChargeLookUp), ce.append($ChargeControl.getControl().css("width", "93%")).append($ChargeControl.getBtn(0).css("width", "30px").css("height", "30px").css("padding", "0px").css("border-color", "#BBBBBB")), divTable.append(tableTr), _formDesign.append(divContainer).append(divTable), _formDesign }, setBankAndAccount: function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/SetBankAndAccount", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n != null && (du = n.Table[0].C_BANK_ID, ku = n.Table[0].C_BANKACCOUNT_ID)); h.loadBank() } }) }, addEffect: function (n, t, i) { var r = { to: t, className: "wsp-ui-effects-transfer" }; n.effect("transfer", r, 600, i) }, setInvoiceAndBPartner: function (n, i) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/SetInvoiceAndBPartner", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _paymentID: n, _cmbTransactionType: i }, success: function (n) { if (n != null && n != "") if (n = t.parseJSON(t.parseJSON(n)), i == "PY") { n._invoiceID > 0 ? bt.setValue(n._invoiceID, !1, !0) : bt.setValue(); n._bPartnerID > 0 ? it.setValue(n._bPartnerID, !1, !0) : it.setValue(); var r = VIS.DB.executeScalar("SELECT COUNT(*) FROM AD_ModuleInfo WHERE Prefix='VA034_' AND IsActive='Y'"); r == 1 && n.VA034_DepositSlipNo != "" && cr.val(n.VA034_DepositSlipNo) } else i == "PO" ? it.value || it.setValue(n._bPartnerID, !1, !0) : i == "IS" && (it.value || it.setValue(n._bPartnerID, !1, !0)) } }) }, setBPartner: function (n) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/SetBPartner", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _invoiceID: n }, success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n > 0 ? it.setValue(n, !1, !0) : it.setValue()) } }) }, getMaxStatement: function (n) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/MaxStatement", type: "GET", datatype: "json", data: { _bankAccount: l.val() == null ? 0 : l.val(), _origin: n }, contentType: "application/json; charset=utf-8", success: function (n) { n != null && n != "" && (n = t.parseJSON(t.parseJSON(n)), kt.val(n.statementNo), hr.val(n.pageno), di.val(n.lineno)) } }) }, getOverUnderPayment: function (n) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/getOverUnderPayment", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _paymentID: n }, success: function (n) { n != null && n != "" && (n = t.parseJSON(t.parseJSON(n)), n._difference != 0 && (w.setValue(VIS.Utility.Util.getValueOfDecimal(Math.abs(n._difference))), ki.find("*").prop("disabled", !1), ot.val(n._differenceType).prop("selected", !0), w.getControl().attr("vchangable", "N"), p.val() == "M" && s.setValue(VIS.Utility.Util.getValueOfDecimal(n._payamt.toFixed(v))))) } }) }, getControls: function () { hi = c.find("#VA012_cmbBank_" + $self.windowNo); l = c.find("#VA012_cmbBankAccount_" + $self.windowNo); yu = c.find("#VA012_STAT_cmbBankAccountClassName_" + $self.windowNo); at = c.find("#VA012_statementDate_" + $self.windowNo); fe = c.find("#VA012_BankChargeDiv" + $self.windowNo); vt = c.find("#VA012_cmbSearchPaymentMethod_" + $self.windowNo); ut = c.find("#VA012_cmbTransactionType_" + $self.windowNo); sf = c.find("#VA012_btnLoadStatement_" + $self.windowNo); hf = c.find("#VA012_btnMatchStatement_" + $self.windowNo); ht = c.find("#VA012_lstStatement_" + $self.windowNo); ti = c.find("#VA012_lstPayments_" + $self.windowNo); pu = c.find("#VA012_paymentList_" + $self.windowNo); br = c.find("#VA012_secReconciled_" + $self.windowNo); kr = c.find("#VA012_secUnreconciled_" + $self.windowNo); ni = c.find("#VA012_txtSearch_" + $self.windowNo); df = c.find("#VA012_btnSearch_" + $self.windowNo); cf = c.find("#VA012_btnUnmatch_" + $self.windowNo); lf = c.find("#VA012_btnProcess_" + $self.windowNo); af = c.find("#VA012_btnHide_" + $self.windowNo); wu = c.find("#VA012_tdLeft_" + $self.windowNo); bu = c.find("#VA012_table_" + $self.windowNo); pi = c.find("#VA012_btnMore_" + $self.windowNo); oe = c.find("#VA012_divMore_" + $self.windowNo); ir = c.find("#VA012_divContraType_" + $self.windowNo); ar = c.find("#VA012_divCashBook_" + $self.windowNo); _divCtrlCashLine = c.find("#VA012_divCtrlCashLine_" + $self.windowNo); rr = c.find("#VA012_divTransferType_" + $self.windowNo); vr = c.find("#VA012_divCheckNo_" + $self.windowNo); ui = c.find("#VA012_divVoucherNo_" + $self.windowNo); ee = c.find("#VA012_divTrxAmt_" + $self.windowNo); tu = c.find("#VA012_divDifference_" + $self.windowNo); ki = c.find("#VA012_divDifferenceType_" + $self.windowNo); dt = c.find("#VA012_divCharge_" + $self.windowNo); kf = c.find("#VA012_btnCharge_" + $self.windowNo); gt = c.find("#VA012_divTaxRate_" + $self.windowNo); ei = c.find("#VA012_divTaxAmount_" + $self.windowNo); ur = c.find("#VA012_divCtrlPayment_" + $self.windowNo); fr = c.find("#VA012_divCtrlInvoice_" + $self.windowNo); er = c.find("#VA012_divCtrlBusinessPartner_" + $self.windowNo); or = c.find("#VA012_divPrepayOrder_" + $self.windowNo); sr = c.find("#VA012_divPaymentSchedule_" + $self.windowNo) }, getBaseCurrency: function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetBaseCurrency", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", success: function (n) { n != null && n != "" && (n = t.parseJSON(t.parseJSON(n)), ru = n._code, re = n._id, t(".va012-base-curr").text(ru)) } }) }, loadBank: function () { function n(n) { if (hi.html(""), hi.append("<option value=0 ><\/option>"), n != null) for (var t = 0; t < n.length; t++)hi.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].Value) + ">" + n[t].Name + "<\/option>"); hi.prop("selectedIndex", 0); du > 0 && (hi.val(du).prop("selected", !0), du = 0); h.loadBankAccount() } t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetBank", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", success: function (i) { i != null && i != "" && (_ds = t.parseJSON(i), n(_ds)) } }) }, loadBankAccount: function () { function t(t) { if (l.html(""), l.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)l.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_bankaccount_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.accountno) + "<\/option>"); t.dispose(); t = null; n = null; l.prop("selectedIndex", 0); ku > 0 && (l.val(ku).prop("selected", !0), ku = 0); h.getMaxStatement("LO"); h.loadSearchPaymentMethod() } var n = "SELECT ACCOUNTNO,C_BANKACCOUNT_ID FROM C_BANKACCOUNT WHERE ISACTIVE='Y' AND C_BANK_ID=" + hi.val(), i = VIS.DB.executeDataSet(n.toString(), null, t) }, LoadPaymentsPages: function (n, i, r) { vi = ni.val() != null && ni.val() != "" ? !0 : !1; t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadPaymentsPages", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _accountID: n, _paymentPageNo: ci, _PAGESIZE: ue, _paymentMethodID: i, _transactionType: r }, success: function (n) { n != null && n != "" && (rf = JSON.parse(n)) } }) }, loadPayments: function (n, i, r, u) { function f(n) { var u, i, f, e, o; if (n = t.parseJSON(n), n.length > 0 && (storepaymentdata = storepaymentdata.concat(n)), n = storepaymentdata, u = "", ti.html(""), n != null && n.length > 0) for (i = 0; i < n.length; i++)f = new Date(n[i].DateAcct).toLocaleDateString(), e = "va012-red-color", e = n[i].c_bankstatementline_id == null || n[i].c_bankstatementline_id == "0" || n[i].c_bankstatementline_id == 0 ? "va012-red-color" : "va012-green-color", u = "", u = '<div class="drag-no-drag"><div draggable="true" class="va012-mid-data-wrap ', (r == "PY" || r == "CO") && (u += e), u += ' " paymentdata="' + VIS.Utility.encodeText(new Date(n[i].DueDate).toLocaleDateString()) + "_" + VIS.Utility.encodeText(n[i].DueAmt) + '" data-uid="' + n[i].c_payment_id, u += ' " paymentamount = " ' + VIS.Utility.Util.getValueOfDecimal(n[i].convertedamount, "N") + '"><div class="va012-payment-wrap" ><div class="row"> <div class="col-md-3 col-sm-3">    <div class="va012-form-check">        <input type="checkbox" data-uid="' + n[i].c_payment_id + '"  >    <div title="' + VIS.Msg.getMsg("VA012_PaymentAmount") + '" class="va012-inside-form-check" style=" float: left; width: 85%; ">      <label style=" width: 100%; ">' + n[i].currency + " " + parseFloat(n[i].paymentamount).toLocaleString(navigator.language, { minimumFractionDigits: v, maximumFractionDigits: v }) + "<\/label>", n[i].isconverted == "Y" && (u += "      <span>" + n[i].basecurrency + " " + parseFloat(n[i].convertedamount).toLocaleString(navigator.language, { minimumFractionDigits: v, maximumFractionDigits: v }) + "<\/span>"), u += '   <\/div><\/div>    <!-- end of form-group -->  <\/div>  <!-- end of col -->  <div class="col-md-4 col-sm-4">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Business Partner">' + VIS.Utility.encodeText(n[i].businesspartner) + '<\/p>         <span title="' + VIS.Msg.getMsg("VA012_InvReference") + '">' + VIS.Utility.encodeText(n[i].bpgroup) + '<\/span>       <span title="Document No.">' + VIS.Utility.encodeText(n[i].paymentno) + '<\/span>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col --> <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text"><p title="Payment Type">' + VIS.Utility.encodeText(n[i].paymenttype) + "<\/p><\/div><\/div><!-- end of form-group --><\/div><!-- end of col -->", o = VIS.Utility.Util.getValueOfInt(VIS.DB.executeScalar("SELECT Count(AD_ModuleInfo_ID) FROM AD_ModuleInfo WHERE PREFIX='VA034_' AND IsActive = 'Y'")), u += r == "PY" && o > 0 ? '  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Deposit Slip No">' + VIS.Utility.encodeText(n[i].depositslipno) + '<\/p>           <p title="Authentication Code">' + VIS.Utility.encodeText(n[i].authcode) + '<\/p>           <p title="Account Date">' + f + '<\/p>           <p title="Payment Method">' + n[i].PaymentMethod + "<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->" : '  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Authentication Code">' + VIS.Utility.encodeText(n[i].authcode) + '<\/p>           <p title="Account Date">' + f + '<\/p>           <p title="Payment Method">' + n[i].PaymentMethod + "<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->", u += "<\/div><!-- end of row --><\/div> <!-- end of payment-wrap --><\/div> <!-- end of mid-data-wrap -->", ti.append(u); _sql = null; h.setPaymentListHeight(); h.dragPayments() } pt(t(pu), !0, "inherit"); window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadPayments", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _accountID: n, _paymentPageNo: ci, _PAGESIZE: vf, _paymentMethodID: i, _transactionType: r, statementDate: u == null || u == "" ? new Date : u }, success: function (n) { n != null && n != "" && (f(n), pt(t(pu), !1, "inherit")) }, error: function () { pt(t(pu), !1, "inherit") } }) }, 2) }, setPaymentListHeight: function () { var n; clearTimeout(n); n = setTimeout(function () { t("#VA012-content-area" + $self.windowNo).height(t("#VA012_mainContainer_" + $self.windowNo).height() - 20); ct.attr("activestatus") == "1" ? t("#VA012_paymentList_" + $self.windowNo).height(t("#VA012_middleWrap_" + $self.windowNo).height() - t("#VA012_formBtnNewRecord_" + $self.windowNo).height() - t("#VA012_formNewRecord_" + $self.windowNo).height() - t("#VA012_paymentHeaderWrap_" + $self.windowNo).height() - 42) : t("#VA012_paymentList_" + $self.windowNo).height(t("#VA012_middleWrap_" + $self.windowNo).height() - t("#VA012_formBtnNewRecord_" + $self.windowNo).height() - t("#VA012_paymentHeaderWrap_" + $self.windowNo).height() - 27) }, 2) }, loadSearchPaymentMethod: function () { function i(t) { if (vt.html(""), vt.append("<option value=0 >" + VIS.Msg.getMsg("VA012_SelectPaymentMethod") + "<\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)vt.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.va009_paymentmethod_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.va009_name) + "<\/option>"); t.dispose(); t = null; n = null; vt.prop("selectedIndex", 0); l.trigger("change") } var n = "SELECT VA009_NAME,VA009_PAYMENTMETHOD_ID FROM VA009_PAYMENTMETHOD WHERE ISACTIVE='Y' AND VA009_PAYMENTBASETYPE!='B' AND AD_CLIENT_ID=" + VIS.Env.getCtx().getAD_Client_ID(), t; VIS.Env.getCtx().getAD_Org_ID() != 0 && (n += " AND AD_ORG_ID IN( " + VIS.Env.getCtx().getAD_Org_ID() + ",0)"); t = VIS.DB.executeDataSet(n.toString(), null, i) }, paymentScroll: function () { rf = 0; t(this).scrollTop() + t(this).innerHeight() + 2 >= this.scrollHeight && (h.LoadPaymentsPages(l.val(), vt.val(), ut.val()), ci < rf && (ci++, h.loadPayments(l.val(), vt.val(), ut.val(), at.val()))) }, statementScroll: function () { gf = 0; t(this).scrollTop() > 0 && t(this).scrollTop() + t(this).innerHeight() + 1 >= this.scrollHeight && (g.LoadStatementsPages(), fi < gf && (fi++, g.loadStatement(ii))) }, dragPayments: function () { ti.find(".va012-mid-data-wrap").draggable({ start: function (n, t) { t.helper.addClass("va012-dragging") }, drag: function () { }, stop: function (n, t) { t.helper.removeClass("va012-dragging") }, cursor: "move", cursorAt: { left: 5 }, revert: "invalid", helper: "clone" }) }, dropPayments: function () { ht.find(".va012-right-data-wrap").droppable({ hoverClass: "va012-dropping", drop: function (n, o) { var w, it, l, p, k, nt, c; if (t(o.draggable).data("uid") > 0 && t(this).data("uid") > 0) { if (ut.val() == "PY") { if (w = t(o.draggable).data("uid"), t(o.draggable).hasClass("va012-green-color")) { VIS.ADialog.info("VA012_PaymentAlreadyMatchedOthrStatement", null, "", ""); return } c = t(this).data("uid"); h.checkPaymentCondition(t(o.draggable).data("uid"), t(this).data("uid"), r(i.getControl().val())) && (g.statementOpenEdit(t(this).data("uid"), w), window.setTimeout(function () { if (r(s.getControl().val()) == 0) { var n = d.val(); u.refreshForm(); d.val(n); VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } d.attr("readonly", !0); ri = !0; tt.setValue(w, !1, !0); y.attr("disabled", !0); h.setInvoiceAndBPartner(t(o.draggable).data("uid"), "PY"); ri = !1 }, 500)) } else if (ut.val() == "IS") { if (it = t(o.draggable).data("uid"), parseInt(a.attr("data-uid")) != t(this).data("uid") && u.scheduleRefresh(), h.checkScheduleCondition(t(o.draggable).data("uid"), t(this).data("uid"), b.toString(), r(i.getControl().val()))) { if (of(parseInt(t(o.draggable).data("uid")), b)) VIS.ADialog.info("VA012_AlreadySelected", null, "", ""); else if (b.push(parseInt(t(o.draggable).data("uid"))), oi.push(t(o.draggable).attr("paymentdata")), st.push(t(o.draggable).attr("paymentamount")), Number(st[0]) == "0") { for (l = 0, p = 0; p < st.length; p++)l += VIS.Utility.Util.getValueOfDecimal(st[p]); l < 0 ? (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), f.removeClass("va012-active"), f.addClass("va012-inactive"), f.attr("v_active", "0")) : (f.removeClass("va012-inactive"), f.addClass("va012-active"), f.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")); i.setValue(VIS.Utility.Util.getValueOfDecimal(l.toFixed(v))) } ri = !0; g.statementOpenEdit(t(this).data("uid"), it); h.setInvoiceAndBPartner(t(o.draggable).data("uid"), "IS"); li.val(oi.toString()); window.setTimeout(function () { if (r(s.getControl().val()) == 0) { var n = d.val(); u.refreshForm(); u.scheduleRefresh(); d.val(n); VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } d.attr("readonly", !0); st.length == 1 && (st[0] = VIS.Utility.Util.getValueOfString(r(s.getControl().val()))); s.getControl().trigger("blur", [r(i.getControl().val()), r(s.getControl().val())]) }, 500) } } else if (ut.val() == "PO") if (k = t(o.draggable).data("uid"), parseInt(a.attr("data-uid")) != t(this).data("uid") && u.prepayRefresh(), h.checkPrepayCondition(t(o.draggable).data("uid"), t(this).data("uid"), yr.toString(), r(i.getControl().val()))) g.statementOpenEdit(t(this).data("uid"), k), window.setTimeout(function () { if (r(s.getControl().val()) == 0) { var n = d.val(); u.refreshForm(); u.prepayRefresh(); d.val(n); VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } d.attr("readonly", !0); ri = !0; ft.setValue(k, !1, !0); h.setInvoiceAndBPartner(t(o.draggable).data("uid"), "PO"); ri = !1 }, 500); else if (VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) == 0) { VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } if (ut.val() == "CO") { if (nt = t(o.draggable).data("uid"), t(o.draggable).hasClass("va012-green-color")) { VIS.ADialog.info("VA012_CashLineAlreadyMatchedOthrStmt", null, "", ""); return } if (c = t(this).data("uid"), h.checkContraCondition(t(o.draggable).data("uid"), t(this).data("uid"), r(i.getControl().val()))) g.statementOpenEdit(c, nt), window.setTimeout(function () { if (r(s.getControl().val()) == 0) { var n = d.val(); u.refreshForm(); d.val(n); VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } d.attr("readonly", !0); ri = !0; lt.setValue(nt, !1, !0); ri = !1 }, 500); else if (VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) == 0) { VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } } } } }); a.droppable({ hoverClass: "va012-dropping", drop: function (n, u) { var c, o, a, y; if (t(u.draggable).data("uid") > 0) { if (ut.val() == "CO") if (p.val() == "C") { if (rt.val() != "CB") { VIS.ADialog.info("VA012_ContraSelectCashToBank", null, "", ""); return } } else { VIS.ADialog.info("VA012_SelectVoucherContra", null, "", ""); return } else if (p.val() != "M") { VIS.ADialog.info("VA012_SelectVoucherPayment", null, "", ""); return } if (ut.val() == "PY") { if (t(u.draggable).hasClass("va012-green-color")) { VIS.ADialog.info("VA012_PaymentAlreadyMatchedOthrStatement", null, "", ""); return } if (t(u.draggable).data("uid") > 0) if (VIS.Utility.Util.getValueOfInt(ai) == 0) tt.setValue(t(u.draggable).data("uid"), !1, !0); else { VIS.Utility.Util.getValueOfInt(ai) == VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid")) ? VIS.ADialog.info("VA012_AlreadySelected", null, "", "") : VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord", null, "", ""); return } } if (ut.val() == "IS" && h.checkScheduleCondition(t(u.draggable).data("uid"), t(this).attr("data-uid"), b.toString(), r(i.getControl().val()))) { if (o = 0, of(parseInt(t(u.draggable).data("uid")), b)) { VIS.ADialog.info("VA012_AlreadySelected", null, "", ""); return } if (c = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetConvtAmount", { recordID: parseInt(t(u.draggable).data("uid")), bnkAct_Id: l.val(), transcType: ut.val(), stmtDate: d.val() }), c.length == 0 || c[0].DueAmount == 0) { VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } if (b.push(parseInt(t(u.draggable).data("uid"))), oi.push(t(u.draggable).attr("paymentdata")), st.push(c[0].DueAmount), o = 0, Number(st.length) > 0) for (a = 0; a < st.length; a++)o += VIS.Utility.Util.getValueOfDecimal(st[a]); o < 0 ? (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), f.removeClass("va012-active"), f.addClass("va012-inactive"), f.attr("v_active", "0")) : (f.removeClass("va012-inactive"), f.addClass("va012-active"), f.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0"), o > 0 && i.getControl().removeClass("va012-mandatory")); i.setValue(VIS.Utility.Util.getValueOfDecimal(o.toFixed(v))); h.setInvoiceAndBPartner(t(u.draggable).data("uid"), "IS"); li.val(oi.toString()); s.setValue(VIS.Utility.Util.getValueOfDecimal(o.toFixed(v))); s.getControl().trigger("blur", [r(i.getControl().val()), r(s.getControl().val())]); y = b != null ? b.toString() : null; au(y) } if (ut.val() == "PO") { if (VIS.Utility.Util.getValueOfInt(si) != 0) { VIS.Utility.Util.getValueOfInt(si) == VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid")) ? VIS.ADialog.info("VA012_AlreadySelected", null, "", "") : VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord", null, "", ""); return } ft.setValue(t(u.draggable).data("uid"), !1, !0) } if (ut.val() == "CO" && t(u.draggable).data("uid") > 0) { if (t(u.draggable).hasClass("va012-green-color")) { VIS.ADialog.info("VA012_CashLineAlreadyMatchedOthrStmt", null, "", ""); return } if (VIS.Utility.Util.getValueOfInt(wi) != 0) { VIS.Utility.Util.getValueOfInt(wi) == VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid")) ? VIS.ADialog.info("VA012_AlreadySelected", null, "", "") : VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord", null, "", ""); return } if (h.checkContraCondition(t(u.draggable).data("uid"), t(this).attr("data-uid"), r(i.getControl().val()))) { if (VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) == 0) { VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } s.setValue(r(i.getControl().val())); i.getControl().trigger("blur", [r(i.getControl().val()), r(s.getControl().val())]); lt.setValue(t(u.draggable).data("uid"), !1, !0) } else if (VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) == 0) { VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } } } ri = !1 } }) }, checkFormPaymentCondition: function (n, u) { var o = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckFormPaymentCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _paymentID: n, _amount: u }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (o = !0, n._amount != null && n._amount != 0 && (i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(v))), r(i.getControl().val()) < 0 ? (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), f.removeClass("va012-active"), f.addClass("va012-inactive"), f.attr("v_active", "0")) : (f.removeClass("va012-inactive"), f.addClass("va012-active"), f.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")))) : (VIS.ADialog.info(n._status, null, "", ""), o = !1) }, error: function () { VIS.ADialog.info("error", null, "", ""); o = !1 } }), o }, checkFormPrepayCondition: function (n, u) { var s = 0, o; return it.value && (s = it.value), o = !1, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckFormPrepayCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _orderID: n, _amount: u, _currencyId: et, _formBPartnerID: s }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (o = !0, n._amount > 0 && (i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(v))), r(i.getControl().val()) < 0 ? (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), f.removeClass("va012-active"), f.addClass("va012-inactive"), f.attr("v_active", "0")) : (f.removeClass("va012-inactive"), f.addClass("va012-active"), f.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")))) : (VIS.ADialog.info(n._status, null, "", ""), o = !1) }, error: function () { VIS.ADialog.info("error", null, "", ""); o = !1 } }), o }, checkInvoiceCondition: function (n, i) { var r = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckInvoiceCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _invoiceID: n, _amount: i }, success: function (n) { n = t.parseJSON(n); n == "Success" ? r = !0 : (VIS.ADialog.info(n, null, "", ""), r = !1) }, error: function () { VIS.ADialog.info("error", null, "", ""); r = !1 } }), r }, checkPaymentCondition: function (n, h, c) { var a = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckPaymentCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: h, _amount: c, statmtDate: d.val(), accountID: l.val() }, success: function (n) { if (n = t.parseJSON(n), n._status == "Success") if (a = !0, n._amount != null && n._amount != 0) { if (i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(v))), r(i.getControl().val()) < 0 ? (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), f.removeClass("va012-active"), f.addClass("va012-inactive"), f.attr("v_active", "0")) : (f.removeClass("va012-inactive"), f.addClass("va012-active"), f.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")), s.setValue(VIS.Utility.Util.getValueOfDecimal(n._trxamount.toFixed(v))), n._currency_Id != 0 && VIS.Utility.Util.getValueOfString(tt.value) != null) { o.val(et).prop("selected", !0); for (var c = 0; o[0].length > c; c++)VIS.Utility.Util.getValueOfInt(o[0][c].value) == et ? t(o[0][c]).show() : t(o[0][c]).hide(); o.removeClass("va012-mandatory"); o.attr("disabled", !1); t(y[0][0]).hide(); y.val(n._conversionType_Id).prop("selected", !0); y.attr("disabled", !0) } else o.val(et).prop("selected", !0), o.attr("disabled", !0), o.removeClass("va012-mandatory"), y.val(n._conversionType_Id).prop("selected", !0); y.trigger("change") } else h == 0 && (u.refreshForm(), VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""), a = !1); else VIS.ADialog.info(n._status, null, "", ""), a = !1 }, error: function () { VIS.ADialog.info("error", null, "", ""); a = !1 } }), a }, checkScheduleCondition: function (n, i, r, u) { var e, f; if (et == null || et == 0) { VIS.ADialog.info("VA012_SelectBankAccountFirst", null, "", ""); return } return e = 0, it.value && (e = it.value), f = !1, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckScheduleCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: i, _listToCheck: r, _amount: u, _currencyId: et, _formBPartnerID: e }, success: function (n) { n = t.parseJSON(n); n == "Success" ? f = !0 : (VIS.ADialog.info(n, null, "", ""), f = !1) }, error: function () { VIS.ADialog.info("error", null, "", ""); f = !1 } }), f }, checkScheduleTotal: function (n, i, r) { var u = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckScheduleTotal", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _listToCheck: n, _amount: i, _currencyId: et, _destinationID: r }, success: function (n) { n = t.parseJSON(n); n == "Success" ? u = !0 : (VIS.ADialog.info(n, null, "", ""), u = !1) }, error: function () { VIS.ADialog.info("error", null, "", ""); u = !1 } }), u }, checkPrepayCondition: function (n, u, s, h) { var l = 0, c; return it.value && (l = it.value), c = !1, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckPrepayCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: u, _listToCheck: s, _amount: h, _currencyId: et, _formBPartnerID: l, stateDate: d.val() }, success: function (n) { if (n = t.parseJSON(n), n._status == "Success") if (c = !0, n._amount != 0) { if (i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(v))), r(i.getControl().val()) < 0 ? (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), f.removeClass("va012-active"), f.addClass("va012-inactive"), f.attr("v_active", "0")) : (f.removeClass("va012-inactive"), f.addClass("va012-active"), f.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0"), r(i.getControl().val()) > 0 && i.getControl().removeClass("va012-mandatory")), n._currency_Id != 0 && VIS.Utility.Util.getValueOfString(ft.value) != null) { o.val(n._currency_Id).prop("selected", !0); for (var u = 0; o[0].length > u; u++)VIS.Utility.Util.getValueOfInt(o[0][u].value) == n._currency_Id || VIS.Utility.Util.getValueOfInt(o[0][u].value) == et ? t(o[0][u]).show() : t(o[0][u]).hide(); o.removeClass("va012-mandatory"); o.attr("disabled", !1); t(y[0][0]).hide(); y.val(n._conversionType_Id).prop("selected", !0); y.attr("disabled", !1) } else o.val(et).prop("selected", !0), o.attr("disabled", !0), o.removeClass("va012-mandatory"), y.val(n._conversionType_Id).prop("selected", !0); y.trigger("change") } else c = !1; else VIS.ADialog.info(n._status, null, "", ""), c = !1 }, error: function () { VIS.ADialog.info("error", null, "", ""); c = !1 } }), c }, checkContraCondition: function (n, u, s) { var c = 0, h; return it.value && (c = it.value), h = !1, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckContraCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: u, _amount: s, _currencyId: et, _formBPartnerID: c, stateDate: d.val() }, success: function (n) { if (n = t.parseJSON(n), n._status == "Success") if (h = !0, i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(v))), r(i.getControl().val()) < 0 ? (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), f.removeClass("va012-active"), f.addClass("va012-inactive"), f.attr("v_active", "0")) : (f.removeClass("va012-inactive"), f.addClass("va012-active"), f.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0"), r(i.getControl().val()) > 0 && i.getControl().removeClass("va012-mandatory")), n._amount != 0 && VIS.Utility.Util.getValueOfString(lt.value) != null) { o.val(et).prop("selected", !0); for (var u = 0; o[0].length > u; u++)VIS.Utility.Util.getValueOfInt(o[0][u].value) == et ? t(o[0][u]).show() : t(o[0][u]).hide(); o.removeClass("va012-mandatory"); o.attr("disabled", !1); y.val(n._conversionType_Id).prop("selected", !0); y.removeClass("va012-mandatory"); y.attr("disabled", !0) } else h = !1; else VIS.ADialog.info(n._status, null, "", ""), h = !1 }, error: function () { VIS.ADialog.info("error", null, "", ""); h = !1 } }), h }, matchByDrag: function (n, u) { var o = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/MatchByDrag", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragPaymentID: n, _dragStatementID: u }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (o = !0, n._amount != null && n._amount != 0 && (i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(v))), r(i.getControl().val()) < 0 ? (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), f.removeClass("va012-active"), f.addClass("va012-inactive"), f.attr("v_active", "0")) : (f.removeClass("va012-inactive"), f.addClass("va012-active"), f.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")), k.trigger("focus"))) : (VIS.ADialog.info(n._status, null, "", ""), o = !1) }, error: function () { VIS.ADialog.info("error", null, "", ""); o = !1 } }), o } }; this.vetoablechange = function (n) { if (n.propertyName == "VA012_txtDifference_" + $self.windowNo + "") w.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(v))); else if (n.propertyName == "VA012_txtTaxAmount_" + $self.windowNo + "") yt.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(v))); else if (n.propertyName == "VA012_txtTrxAmt_" + $self.windowNo + "") s.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(v))); else if (n.propertyName == "VA012_txtAmount_" + $self.windowNo + "") { var t = r(i.getControl().val()); i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(t).toFixed(v))) } }; g = { statementDialog: function () { function p() { s = $statement.find("#VA012_STAT_cmbBank_" + $self.windowNo); r = $statement.find("#VA012_STAT_cmbBankAccount_" + $self.windowNo); e = $statement.find("#VA012_STAT_cmbBankAccountClassName_" + $self.windowNo); v = $statement.find("#VA012_STAT_statementDate_" + $self.windowNo); h = $statement.find("#VA012_STAT_txtStatementNo_" + $self.windowNo); o = $statement.find("#VA012_ctrlLoadFile_" + $self.windowNo); STAT_ctrlLoadFileTxt = $statement.find("#VA012_ctrlLoadFileTxt_" + $self.windowNo); _tabFile = $statement.find("#VA012_STAT_tabFile_" + $self.windowNo); _tabSchedule = $statement.find("#VA012_STAT_tabSchedule_" + $self.windowNo); yu = $statement.find("#VA012_STAT_cmbBankAccountClassName_" + $self.windowNo) } function w() { s.html(""); s.append("<option value=" + hi.val() + ">" + hi.children()[hi[0].selectedIndex].text + "<\/option>"); s.prop("selectedIndex", 0) } function b() { r.html(""); r.append("<option value=" + l.val() + ">" + l.children()[l[0].selectedIndex].text + "<\/option>"); r.prop("selectedIndex", 0) } function k() { function t(t) { var i, r; if (e.html(""), e.append("<option value=0 ><\/option>"), t != null) for (i = 0; i < t.tables[0].rows.length; i++)r = t.tables[0].rows[i].cells.va012_bankstatementclass_id, e.append("<option value=" + r + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null; e.prop("selectedIndex", 0) } var n = " SELECT BSC.VA012_BANKSTATEMENTCLASSNAME AS NAME, CONCAT(CONCAT(SC.NAME,'_'),VA012_BANKSTATEMENTCLASS_ID) AS VA012_BANKSTATEMENTCLASS_ID FROM VA012_BANKSTATEMENTCLASS BSC INNER JOIN VA012_STATEMENTCLASS SC ON BSC.VA012_STATEMENTCLASS_ID=SC.VA012_STATEMENTCLASS_ID WHERE C_BANKACCOUNT_ID = " + l.val(), i = VIS.DB.executeDataSet(n.toString(), null, t) } function d() { function t(t) { if (t != null) for (var i = 0; i < t.tables[0].rows.length; i++)y = VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_charge_id); t.dispose(); t = null; n = null } var n = "SELECT C_CHARGE_ID, NAME FROM C_CHARGE WHERE ISACTIVE = 'Y' AND AD_CLIENT_ID = " + VIS.Env.getCtx().getAD_Client_ID() + " AND ROWNUM = 1 ORDER BY NAME  ", i = VIS.DB.executeDataSet(n.toString(), null, t) } function nt() { a = null; $statement = null; s = null; r = null; h = null; o = null; STAT_ctrlLoadFileTxt = null; _tabSchedule = null; _tabFile = null; i = null } var s = null, r = null, e = null, v = null, y = null, h = null, o = null, i = null, a, f; $statement = t("<div class='va012-popform-content'>"); a = ""; a = "<div><div class='va012-left-btn'><a id='VA012_STAT_tabFile_" + $self.windowNo + "' class='btn va012-blueBtn' activestatus='1'>" + VIS.Msg.getMsg("VA012_File") + "<\/a><\/div><\/div><div style='border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left;'><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_Bank") + "<\/label><select id='VA012_STAT_cmbBank_" + $self.windowNo + "' class='vis-ev-col-readonly' disabled><\/select><\/div> <div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_BankAccount") + "<\/label><select id='VA012_STAT_cmbBankAccount_" + $self.windowNo + "' class='vis-ev-col-readonly' disabled><\/select><\/div><div class=va012-popform-data><label id=VA012_STAT_lblStatementDate_" + $self.windowNo + ">" + VIS.Msg.getMsg("VA012_StatementDate") + '<\/label><input type=date max="9999-12-31" class=vis-ev-col-readonly disabled id=VA012_STAT_statementDate_' + $self.windowNo + "><\/div><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_ClassName") + '<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_STAT_cmbBankAccountClassName_' + $self.windowNo + "'><\/select><\/div><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_StatementNumber") + "<sup style=\"color: red;\">*<\/sup><\/label><input type='text' id='VA012_STAT_txtStatementNo_" + $self.windowNo + "' /> <\/div><div class='va012-popform-data va012-pop-file'><label>" + VIS.Msg.getMsg("VA012_SelectFile") + "<sup style=\"color: red;\">*<\/sup><\/label><input type='text' id='VA012_ctrlLoadFileTxt_" + $self.windowNo + "' disabled><div class='va012-file-upload'><label for='file-input' class='va012-file-label'>" + VIS.Msg.getMsg("VA012_Browse") + "<\/label><input id='VA012_ctrlLoadFile_" + $self.windowNo + "' type='file' accept='.csv,text/plain,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel'/><\/div><\/div><\/div>"; $statement.append(a); p(); w(); b(); k(); v.val(Globalize.format(new Date(at.val()), "yyyy-MM-dd")); d(); f = new VIS.ChildDialog; f.setContent($statement); f.setTitle(VIS.Msg.getMsg("VA012_LoadStatement")); f.setWidth("500px"); f.setEnableResize(!1); f.setModal(!0); f.show(); o.on("change", function () { var u = this; r.val() != null && r.val() > 0 ? (i = t.parseJSON(n.UploadExcel(u, null, null)), STAT_ctrlLoadFileTxt.val(i._orgfilename)) : (o = null, VIS.ADialog.info("VA012_SelectBankAccountFirst", null, "", "")) }); f.onOkClick = function () { if (ni.val(""), _tabFile.attr("activestatus") == "1") { if (r.val() == null || r.val() == "" || r.val() == "0") return VIS.ADialog.info("VA012_SelectBankAccountFirst", null, "", ""), !1; if (e.val() == null || e.val() == "" || e.val() == "0") return VIS.ADialog.info("VA012_PleaseSelectClassFirst", null, "", ""), !1; if (h.val() == null || h.val() == "") return VIS.ADialog.info("VA012_PleaseEnterStatementNo", null, "", ""), !1; if (o.val() == "" == null || o.val() == "") return VIS.ADialog.info("VA012_SelectFileFirst", null, "", ""), !1; if (i != null) { if (i._filename == null || i._filename == "" || i._path == null || i._path == "") { VIS.ADialog.info("VA012_ErrorInGettingFile", null, "", ""); return } if (i._error != null && i._error != "") { VIS.ADialog.info(i._error, null, "", ""); return } var n = i._path, f = i._filename, s = r.val(), l = h.val(), w = $statement, a = e.val(), p = y; pt(c, !0, "absolute"); window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/ImportStatement", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _path: n, _filename: f, _bankaccount: s, _bankAccountCurrency: et, _statementno: l, _statementClassName: a, _statementCharges: p, statementDate: v.val() }, success: function (n) { ii = n._statementID; ii != null && ii != "" ? (wt = [], ht.html(""), fi = 1, pt(c, !1, "absolute"), g.loadStatement(ii), u.refreshForm()) : n._error != null && n._error != "" && (pt(c, !1, "absolute"), VIS.ADialog.info(n._error, null, "", "")) }, error: function () { pt(c, !1, "absolute"); VIS.ADialog.info("error", null, "", "") } }) }, 2) } } if (_tabSchedule.attr("activestatus") == "1") return alert("Schedule"), !1 }; f.onCancelClick = function () { }; f.onClose = function () { nt() }; _tabFile.on(VIS.Events.onTouchStartOrClick, function () { _tabFile.removeClass("va012-grayBtn"); _tabFile.addClass("va012-blueBtn"); _tabFile.attr("activestatus", "1"); _tabSchedule.removeClass("va012-blueBtn"); _tabSchedule.addClass("va012-grayBtn"); _tabSchedule.attr("activestatus", "0") }); _tabSchedule.on(VIS.Events.onTouchStartOrClick, function () { _tabSchedule.removeClass("va012-grayBtn"); _tabSchedule.addClass("va012-blueBtn"); _tabSchedule.attr("activestatus", "1"); _tabFile.removeClass("va012-blueBtn"); _tabFile.addClass("va012-grayBtn"); _tabFile.attr("activestatus", "0") }) }, LoadStatementsPages: function () { vi = ni.val() != null && ni.val() != "" ? !0 : !1; t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadStatementsPages", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _cmbBankAccount: l.val(), _txtSearch: ni.val(), _statementPageNo: fi, _PAGESIZE: vf, _SEARCHREQUEST: vi }, success: function (n) { n != null && n != "" && (gf = JSON.parse(n)) } }) }, loadStatement: function () { function i(n) { n != null && n.length > 0 ? (kr.html(""), br.html(""), br.append("<p>" + VIS.Msg.getMsg("VA012_Reconciled") + "<\/p><p style='margin-top: 4px;'>" + VIS.Msg.getMsg("VA012_Unreconciled") + "<\/p>"), kr.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>" + n[0].basecurrency + "<\/span> " + parseFloat(n[0].reconciled).toLocaleString(navigator.language, { minimumFractionDigits: v, maximumFractionDigits: v }) + "<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'> <span class='va012-base-curr'>" + n[0].basecurrency + "<\/span> " + parseFloat(n[0].unreconciled).toLocaleString(navigator.language, { minimumFractionDigits: v, maximumFractionDigits: v }) + "<\/span>")) : (kr.html(""), br.html(""), br.append("<p>" + VIS.Msg.getMsg("VA012_Reconciled") + "<\/p><p style='margin-top: 4px;'>" + VIS.Msg.getMsg("VA012_Unreconciled") + "<\/p>"), kr.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>" + ru + "<\/span> 0<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'><span class='va012-base-curr'>" + ru + "<\/span> 0<\/span>")); g.setStatementListHeight() } function r(i) { var u, r; if (i = t.parseJSON(i), u = "", i != null && i.length > 0) for (r = 0; r < i.length; r++)u = "", n = i[r].docstatus == "CO" || i[r].docstatus == "CL" || i[r].docstatus == "RE" ? "va012-gray-color" : i[r].c_payment_id == null || i[r].c_payment_id == "0" || i[r].c_payment_id == 0 ? i[r].c_cashline_id != null && i[r].c_cashline_id != "0" && i[r].c_cashline_id != 0 ? "va012-green-color" : i[r].c_charge_id != null && i[r].c_charge_id != "0" && i[r].c_charge_id != 0 ? i[r].STMTAMT == i[r].trxamount ? "va012-green-color" : "va012-red-color" : (i[r].c_charge_id == null || i[r].c_charge_id == "") && (i[r].trxno == null || i[r].trxno == "") ? "va012-red-color" : "va012-red-color" : "va012-green-color", u = '<div  data-uid="' + i[r].c_bankstatementline_id + '" class="va012-right-data-wrap ' + n + '"><div class="va012-statement-wrap"><div class="va012-fl-padd"><div class="col-md-4 col-sm-4 va012-padd-0"><div class="va012-form-check"> <input type="checkbox" data-uid="' + i[r].c_bankstatementline_id + '" > <div class="va012-form-text"> <span style="background: rgba(var(--v-c-on-secondary), .4);color: rgba(var(--v-c-on-primary), 1); padding: 3px;margin-left: 2px;">' + i[r].statementno + "/" + i[r].page + "/" + i[r].line + "<\/span><label>" + new Date(i[r].stmtLineDate).toLocaleDateString() + "<\/label><label>" + i[r].currency + " " + parseFloat(i[r].trxamount).toLocaleString(navigator.language, { minimumFractionDigits: v, maximumFractionDigits: v }) + "<\/label>", u += i[r].trxno == "" || i[r].trxno == null ? '<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p>' + VIS.Utility.encodeText(i[r].description) + "<\/p><span>" + VIS.Utility.encodeText(i[r].invoiceno) + '<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="' + i[r].c_bankstatementline_id + '" class="glyphicon glyphicon-edit" title=' + VIS.Msg.getMsg("EditRecord") + '><\/span> <span data-uid="' + i[r].c_bankstatement_id + '" class="glyphicon glyphicon-zoom-in" title=' + VIS.Msg.getMsg("ZoomToRecord") + '><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0 va012-width-xs"><div class="va012-form-data">' : '<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p>' + VIS.Utility.encodeText(i[r].description) + "<\/p> <span>" + VIS.Utility.encodeText(i[r].bpgroup) + "<\/span><span>" + VIS.Utility.encodeText(i[r].invoiceno) + '<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p>' + VIS.Utility.encodeText(i[r].trxno) + '<\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="' + i[r].c_bankstatementline_id + '" class="glyphicon glyphicon-edit"><\/span> <span data-uid="' + i[r].c_bankstatement_id + '" class="glyphicon glyphicon-zoom-in"><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0 va012-width-xs"><div class="va012-form-data">', u += " <\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <\/div> <!-- end of row --><\/div><!-- end of payment-wrap --><\/div><!-- end of right-data-wrap -->", ht.append(u); _sql = null; g.setStatementListHeight(); h.dropPayments() } vi = ni.val() != null && ni.val() != "" ? !0 : !1; pt(t(ht), !0, "inherit"); window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadConciledOrUnConciledStatements", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _cmbBankAccount: l.val(), _txtSearch: ni.val(), _currencyID: et != null ? et : 0, _searchRequest: vi }, success: function (n) { var r = t.parseJSON(n); i(r); pt(t(ht), !1, "inherit") }, error: function () { pt(t(ht), !1, "inherit") } }) }, 2); var n = "va012-red-color"; window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadStatements", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _cmbBankAccount: l.val(), _txtSearch: ni.val(), _statementPageNo: fi, _PAGESIZE: vf, _SEARCHREQUEST: vi }, success: function (n) { n != null && n != "" && (r(n), pt(t(ht), !1, "inherit")) }, error: function () { pt(t(ht), !1, "inherit") } }) }, 2) }, setStatementListHeight: function () { t("#VA012_contentArea_" + $self.windowNo).height(t("#VA012_mainContainer_" + $self.windowNo).height() - 20); t("#VA012_lstStatement_" + $self.windowNo).height(t("#VA012_rightWrap_" + $self.windowNo).height() - t("#VA012_rightTop_" + $self.windowNo).height() - 18) }, statementOpenEdit: function (n, t) { return ct.attr("activestatus", "1"), ct.attr("src", "Areas/VA012/Images/hide.png"), ct.attr("title", "Collapse"), ct.removeClass("vis vis-plus"), ct.addClass("fa fa-minus"), a.show(), h.setPaymentListHeight(), g.statementListRecordEdit(n, t), n = 0, !0 }, statementListEdit: function (n) { var i = t(n.target), r = 0; i.hasClass("glyphicon-edit") && (r = i.data("uid"), ct.attr("activestatus", "1"), ct.attr("src", "Areas/VA012/Images/hide.png"), ct.attr("title", "Collapse"), a.show(), ct.removeClass("vis vis-plus"), ct.addClass("fa fa-minus"), h.setPaymentListHeight(), u.scheduleRefresh(), u.prepayRefresh(), yi = !0, g.statementListRecordEdit(r, 0), r = 0, h.addEffect(i, a)) }, openStatement: function (n) { var e = t(n.target), f = 0, o, i, r, u; if (e.hasClass("glyphicon glyphicon-zoom-in")) { f = e.data("uid"); o = "select ad_window_id from ad_window where name = 'Bank Statement'"; i = 0; try { r = VIS.DB.executeDataReader(o); r.read() && (i = r.getInt(0)); r.dispose(); i > 0 && (u = new VIS.Query, u.addRestriction("C_BankStatement_ID", VIS.Query.prototype.EQUAL, f), u.setRecordCount(1), VIS.viewManager.startWindow(i, u)) } catch (n) { console.log(n) } f = 0 } }, selectedStatementLinesList: function (n) { var i = t(n.target); n.target.type == "checkbox" && (i.is(":checked") && (_bankStatementLineID = parseInt(i.data("uid")), wt.push(_bankStatementLineID), _bankStatementLineID = 0), i.is(":checked") || (_bankStatementLineID = parseInt(i.data("uid")), wt.splice(wt.indexOf(_bankStatementLineID), 1), _bankStatementLineID = 0)) }, statementListRecordEdit: function (n, t) { VIS.Utility.Util.getValueOfInt(t) == 0 && u.refreshForm(); g.getStatementLineForEdit(n, t, g.afterRecordGet) }, selectedScheduleList: function (n) { var i = t(n.target); n.target.type == "checkbox" && (i.is(":checked"), !i.is(":checked")) }, getStatementLineForEdit: function (n, i, r) { t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/GetStatementLine", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _bankStatementLineID: n, trxType: ut.val(), payment_ID: i != null ? i : 0 }), success: function (n) { r(n) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) }, afterRecordGet: function (n) { var u, c, l, h; if (n != null && n != "") { if (u = t.parseJSON(n), a.attr("data-uid", u._bankStatementLineID), kt.val(u._txtStatementNo), hr.val(u._txtStatementPage), di.val(u._txtStatementLine), d.val(Globalize.format(new Date(u._dtStatementDate), "yyyy-MM-dd")), gi.val(u._cmbPaymentMethod).prop("selected", !0), u._cmbVoucherMatch != null && u._cmbVoucherMatch != "" ? p.val(u._cmbVoucherMatch).prop("selected", !0) : p.prop("selectedIndex", 0), ut.val() == "CO" && p.val("C").prop("selected", !0), p.trigger("change"), u._cmbContraType != null && u._cmbContraType != "" ? rt.val(u._cmbContraType).prop("selected", !0) : rt.prop("selectedIndex", 0), p.val() != null && p.val() != "" && rt.val() != "" && rt.val() != "" && rt.val("CB").prop("selected", !0), rt.trigger("change"), bi.val(u._cmbCashBook).prop("selected", !0), dr.val(u._txtCheckNo), i.setValue(VIS.Utility.Util.getValueOfDecimal(u._txtAmount.toFixed(v))), s.setValue(VIS.Utility.Util.getValueOfDecimal(u._txtTrxAmt.toFixed(v))), r(i.getControl().val()) <= 0 ? i.getControl().addClass("va012-mandatory") : i.getControl().removeClass("va012-mandatory"), r(s.getControl().val()) <= 0 ? s.getControl().addClass("va012-mandatory") : s.getControl().removeClass("va012-mandatory"), (p.val() == "M" || p.val() == "C") && r(s.getControl().val()) != 0 && (c = VIS.Utility.Util.getValueOfDecimal(u._txtDifference.toFixed(v)), w.setValue(c), r(w.getControl().val()) <= 0 ? w.getControl().addClass("va012-mandatory") : w.getControl().removeClass("va012-mandatory"), p.val() == "C" && p.trigger("change")), u._cmbDifferenceType != null && u._cmbDifferenceType != "" ? (ki.find("*").prop("disabled", !1), ot.val(u._cmbDifferenceType).prop("selected", !0)) : ot.prop("selectedIndex", 0), ot.trigger("change"), r(i.getControl().val()) < 0 ? (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), f.removeClass("va012-active"), f.addClass("va012-inactive"), f.attr("v_active", "0")) : (f.removeClass("va012-inactive"), f.addClass("va012-active"), f.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")), cr.val(u._txtVoucherNo), uu.val(u._txtDescription), tr.val(u._cmbCharge).prop("selected", !0), k.val(u._txtCharge), k.attr("chargeid", u._cmbCharge), nt.val(u._cmbTaxRate).prop("selected", !0), yt.setValue(VIS.Utility.Util.getValueOfDecimal(u._txtTaxAmount.toFixed(v))), su.prop("checked", u._chkUseNextTime), u._ctrlCashLine > 0 ? (lt.setValue(u._ctrlCashLine, !1, !0), yi = !1) : ri || (lt.setValue(), u._ctrlPayment <= 0 && (yi = !1)), tt && tt.value > 0 && u._ctrlPayment == 0 && (u._ctrlPayment = tt.value), u._ctrlPayment > 0 ? (tt.setValue(u._ctrlPayment, !1, !0), cr.val() == "" && (l = VIS.Utility.Util.getValueOfString(VIS.DB.executeScalar("select trxno from C_Payment where C_Payment_ID=" + u._ctrlPayment)), cr.val(l)), yi = !1) : ri || (tt.setValue(), yi = !1), u._ctrlOrder > 0 ? ft.setValue(u._ctrlOrder, !1, !0) : ri || ft.setValue(), u._ctrlBusinessPartner > 0 ? it.setValue(u._ctrlBusinessPartner, !1, !0) : ri || it.setValue(), u._ctrlInvoice > 0 ? bt.setValue(u._ctrlInvoice, !1, !0) : ri || bt.setValue(), u._txtCurrency != 0) { for (o.val(u._txtCurrency).prop("selected", !0), h = 0; o[0].length > h; h++)VIS.Utility.Util.getValueOfInt(o[0][h].value) == u._txtCurrency || VIS.Utility.Util.getValueOfInt(o[0][h].value) == et ? t(o[0][h]).show() : t(o[0][h]).hide(); o.removeClass("va012-mandatory"); o.attr("disabled", !1) } p.val() == "C" ? (y.prop("selectedIndex", 0), y.addClass("va012-mandatory"), y.attr("disabled", !1)) : (y.val(u._txtConversionType).prop("selected", !0), y.removeClass("va012-mandatory"), u._ctrlPayment > 0 ? y.attr("disabled", !0) : y.attr("disabled", !1)); k.trigger("focus") } }, matchStatementDialog: function () { function y() { function t(t) { if (f.html(""), f.append("<option value=0 >-<\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)f.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_bankstatement_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null } var n = "Select Cb.C_Bankstatement_Id, CB.NAME,Cb.Docstatus, COUNT(VA012_ISMATCHINGCONFIRMED) FROM C_BANKSTATEMENT CB INNER JOIN C_BANKSTATEMENTLINE CBL ON cbl.C_BANKSTATEMENT_ID = Cb.C_BANKSTATEMENT_ID Where Cb.Isactive = 'Y' And Cb.Ad_Client_Id = " + VIS.Env.getCtx().getAD_Client_ID() + " And Cb.C_Bankaccount_Id = " + l.val() + " And Cb.Docstatus NOT IN  ('CO','CL','VO') GROUP BY CB.C_BANKSTATEMENT_ID,Cb.Docstatus, CB.NAME", i = VIS.DB.executeDataSet(n.toString(), null, t) } function p() { function i(t) { if (e.html(""), e.append("<option value=0 >-<\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)e.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_tax_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null } var n = "SELECT Name,C_Tax_ID FROM C_Tax WHERE IsActive='Y'AND IsSurcharge='N' AND NVL(Parent_Tax_ID, 0)=0", t; n = VIS.MRole.getDefault().addAccessSQL(n, "C_Tax", !0, !1); t = VIS.DB.executeDataSet(n.toString(), null, i) } function w() { n = $match.find("#VA012_cmbMatchingBase_" + $self.windowNo); o = $match.find("#VA012_divMatchingBase_" + $self.windowNo); s = $match.find("#VA012_cmbMatchingCriteria_" + $self.windowNo); f = $match.find("#VA012_cmbStatementNo_" + $self.windowNo); v = $match.find("#VA012_ChargeSrch_" + $self.windowNo); e = $match.find("#VA012_cmbTaxRate_" + $self.windowNo); _ChargeLookUp = VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(), $self.windowNo, 3787, VIS.DisplayType.Search); c = new VIS.Controls.VTextBoxButton("C_Charge_ID", !0, !1, !0, VIS.DisplayType.Search, _ChargeLookUp); v.append(c.getControl().css("width", "93%")).append(c.getBtn(0).css("width", "30px").css("height", "30px").css("padding", "0px").css("border-color", "#BBBBBB")) } function b(n) { var r = t(n.target); r.hasClass("glyphicon-remove") && (i.splice(i.indexOf(r.data("uid")), 1), r.parent().parent().remove()) } function k() { n = null; o = null; i = []; s = null; w2ui["VA012_gridPayment_" + $self.windowNo] != null && w2ui["VA012_gridPayment_" + $self.windowNo].destroy() } var n = null, o = null, i = [], s = null, f = null, v = null, c = null, e = null, a, r; $match = t("<div class='va012-popform-content'>"); a = ""; a = "<div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_StatementNo") + '<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbStatementNo_' + $self.windowNo + "'><\/select><\/div> <div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_MatchingBase") + '<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbMatchingBase_' + $self.windowNo + "'><\/select><\/div> <div id='VA012_divMatchingBase_" + $self.windowNo + "' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_MatchingCriteria") + '<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbMatchingCriteria_' + $self.windowNo + "'><option value='0'><\/option><option value='AT'>" + VIS.Msg.getMsg("VA012_MatchAnyTwo") + "<\/option><option value='AR'>" + VIS.Msg.getMsg("VA012_MatchAnyThree") + "<\/option><option value='AL'>" + VIS.Msg.getMsg("VA012_MatchAll") + "<\/option><\/select><\/div> <div class='va012-popform-data'><label title = '" + VIS.Msg.getMsg("VA012_SetChargeType") + "' > " + VIS.Msg.getMsg("VA012_Charge") + '<sup style="color: red;">*<\/sup><\/label><div id=\'VA012_ChargeSrch_' + $self.windowNo + "'><\/div><\/div> <div class='va012-popform-data'><label title =' " + VIS.Msg.getMsg("VA012_SetTaxRate") + "' >" + VIS.Msg.getMsg("VA012_TaxRate") + '<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbTaxRate_' + $self.windowNo + "'><\/select><\/div> <\/div>"; $match.append(a); w(); ge(n); y(); p(); r = new VIS.ChildDialog; r.setContent($match); r.setTitle(VIS.Msg.getMsg("VA012_MatchStatement")); r.setWidth(700); r.setHeight(600); r.setEnableResize(!1); r.setModal(!0); r.show(); r.onOkClick = function () { if (i.length > 0) { if (f.val() == null || f.val() == "" || f.val() == "0") return VIS.ADialog.info("VA012_NoLinesFoundToMatch", null, "", ""), !1; if (l.val() == null || l.val() == "" || l.val() == "0") return VIS.ADialog.info("VA012_SelectBankAccountFirst", null, "", ""), !1; if (s.val() == null || s.val() == "" || s.val() == "0") return VIS.ADialog.info("VA012_SelectMatchingCriteria", null, "", ""), !1; if (s.val() == "AT" && i.length < 2) return VIS.ADialog.info("VA012_SelectMin2MatchingBase", null, "", ""), !1; if (s.val() == "AR" && i.length < 3) return VIS.ADialog.info("VA012_SelectMin3MatchingBase", null, "", ""), !1; if (c.value == null || VIS.Utility.Util.getValueOfInt(c.value) == 0) return VIS.ADialog.info("VA012_NoChargeSelected", null, "", ""), !1; if (e.val() == null || e.val() == "" || e.val() == "0") return VIS.ADialog.info("VA012_NoTaxRateSelected", null, "", ""), !1; pt($match, !0, "absolute"); window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/MatchStatementGridData", type: "GET", dataType: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _matchingBaseItemList: i.toString(), _cmbMatchingCriteria: s.val(), _BankAccount: l.val(), _StatementNo: f.val(), _BankCharges: VIS.Utility.Util.getValueOfInt(c.value), _TaxRate: e.val() }, success: function (r) { if (r != null && r != "") { r = t.parseJSON(r); n.prop("selectedIndex", 0); f.prop("selectedIndex", 0); c.value = null; e.prop("selectedIndex", 0); i = []; var s = ""; o.html(""); r.length > 0 ? (le(o, r), _statementlineslist = [], ht.html(""), fi = 1, g.loadStatement(ii), ti.html(""), u.scheduleRefresh(), u.prepayRefresh(), ci = 1, h.loadPayments(l.val(), vt.val(), ut.val(), at.val())) : (s = "<div> <p> <b>" + VIS.Msg.getMsg("va012_norecordmatched") + "<\/b> <\/div>", o.append(s)); pt($match, !1, "absolute") } else pt($match, !1, "absolute"), VIS.ADialog.info(r.toString(), null, "", "") }, error: function () { pt($match, !1, "absolute"); VIS.ADialog.info("error", null, "", "") } }) }, 2) } else return VIS.ADialog.info("VA012_NoMatchingBaseSelected", null, "", ""), !1; return !1 }; r.onCancelClick = function () { w2ui["VA012_gridPayment_" + $self.windowNo] != null && w2ui["VA012_gridPayment_" + $self.windowNo].destroy() }; r.onClose = function () { k() }; n.on("change", function () { if (i.length <= 0 && o.html(""), !of(n.val(), i) && n.val() != "0" && n.val() != "") { i.push(n.val()); var t = "<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='" + n.val() + "'class='glyphicon glyphicon-remove'><\/span><\/a> <span>" + n.children()[n[0].selectedIndex].text; o.append(t) } }); o.on(VIS.Events.onTouchStartOrClick, b) }, matchStatementGridDialog: function () { var n = new VIS.ChildDialog; n.setContent(lu); n.setTitle(VIS.Msg.getMsg("VA012_MatchStatementGrid")); n.setWidth("780px"); n.setHeight(450); n.setEnableResize(!0); n.setModal(!0); n.show(); le() }, paymentScheduleDialog: function () { function ut() { var u = "", t = 0, n; for ($_divPaymentSchedules.html(""), n = 0; n < b.length; n++)u = "<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='" + b[n] + "'  data-udata='" + oi[n] + "' class='glyphicon glyphicon-remove'><\/span><\/a> <span>" + oi[n] + "<\/span> <\/div>", $_divPaymentSchedules.append(u), st.length > 0 && (t += VIS.Utility.Util.getValueOfDecimal(st[n])); i.setValue(VIS.Utility.Util.getValueOfDecimal(t.toFixed(v))); s.setValue(VIS.Utility.Util.getValueOfDecimal(t.toFixed(v))); r(i.getControl().val()) < 0 && f.attr("v_active", "0"); i.getControl().trigger("blur", [r(i.getControl().val()), r(s.getControl().val())]); b != null && b.length > 0 ? au(b.toString()) : au(null) } function et(n) { var h = t(n.target), u, o; if (h.hasClass("glyphicon-remove")) { if (st != null && st.length > 0) { if (st.length > b.length ? st.splice(b.indexOf(h.data("uid")) + 1, 1) : st.length == b.length && st.splice(b.indexOf(h.data("uid")), 1), u = 0, Number(st.length) > 0) for (o = 0; o < st.length; o++)u += VIS.Utility.Util.getValueOfDecimal(st[o]); u < 0 ? (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), f.removeClass("va012-active"), f.addClass("va012-inactive"), f.attr("v_active", "0")) : (f.removeClass("va012-inactive"), f.addClass("va012-active"), f.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")); i.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(v))) } for (b.splice(b.indexOf(h.data("uid")), 1), oi.splice(oi.indexOf(h.data("udata")), 1), h.parent().parent().remove(), li.val(oi.toString()), u = 0, o = 0; o < st.length; o++)u += VIS.Utility.Util.getValueOfDecimal(st[o]); i.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(v))); s.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(v))); i.getControl().trigger("blur", [r(i.getControl().val()), r(s.getControl().val())]); u == 0 && it.setValue(); b != null && b.length > 0 ? au(b.toString()) : au(null) } } function ot() { $_divPaymentSchedules = $paymentSchedule.find("#VA012_divPaymentSchedules_" + $self.windowNo); p = $paymentSchedule.find("#VA012_ctrlPSInvoice_" + $self.windowNo); w = $paymentSchedule.find("#VA012_ctrlPSBP_" + $self.windowNo); n = $paymentSchedule.find("#VA012_cmbPaymentSchedule_" + $self.windowNo) } function ft() { nt = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 3484, VIS.DisplayType.MultiKey, "C_Invoice_ID", 0, !1, "DocStatus IN ('CO','CL') AND C_BPartner_ID=" + tt); o = new VIS.Controls.VTextBoxButton("C_Invoice_ID", !1, !1, !0, VIS.DisplayType.MultiKey, nt); o.isMultiKeyTextBox = !0; o.getControl().addClass("va012-input-size-2"); p.append(o.getControl()); p.append(o.getBtn(0)); p.append(o.getBtn(1)); o.fireValueChanged = function () { g = null; g = o.value; n.html(""); ct() } } function ht() { rt = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 2893, VIS.DisplayType.Search, "C_BPartner_ID", 0, !1, null); c = new VIS.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, VIS.DisplayType.Search, uf); c.getControl().addClass("va012-input-size-2"); w.append(c.getControl()); w.append(c.getBtn(0)); w.append(c.getBtn(1)); c.fireValueChanged = function () { tt = 0; tt = c.value; nt = null; o = null; p.html(""); g = null; ft() } } function ct() { function i(t) { if (n.html(""), n.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.length; i++) { if (t[i].DueAmount == 0) { VIS.ADialog.info("VA012_ConversionRateNotFound", null, " " + VIS.Msg.getMsg("VA012_InvoiceSchedule") + ": " + VIS.Utility.Util.getValueOfString(t[i].c_invoicepayschedule_id), ""); return } n.append("<option paymentamount=" + t[i].DueAmount + " paymentdata='" + VIS.Utility.encodeText(new Date(t[i].DueDate).toLocaleDateString()) + "_" + VIS.Utility.encodeText(t[i].DueAmt) + "' value=" + VIS.Utility.Util.getValueOfInt(t[i].c_invoicepayschedule_id) + ">" + VIS.Utility.encodeText(new Date(t[i].DueDate).toLocaleDateString() + "_" + t[i].DueAmt) + "<\/option>") } n.prop("selectedIndex", 0) } t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetInvPaySchedule", dataType: "json", data: { seltdInvoice: g, accountID: l.val(), statemtDate: d.val() }, success: function (n) { var t = JSON.parse(n); (t != null || t != "") && i(t) } }) } function lt() { nt = null; o = null; g = null; p = null; rt = null; c = null; tt = null; w = null; n = null } var k, y; if (b.length == 0 && oi.length == 0) var nt = null, o = null, g = null, p = null, rt = null, c = null, tt = null, w = null, n = null; $paymentSchedule = t("<div class='va012-popform-content'>"); k = ""; k = "<div> <label>" + VIS.Msg.getMsg("VA012_BusinessPartner") + "<\/label> <div id='VA012_ctrlPSBP_" + $self.windowNo + "' ><\/div> <\/div>"; k += "<div> <label>" + VIS.Msg.getMsg("VA012_Invoice") + "<\/label> <div id='VA012_ctrlPSInvoice_" + $self.windowNo + "' ><\/div> <\/div>"; k += "<div> <label>" + VIS.Msg.getMsg("VA012_PaymentSchedules") + "<\/label> <select id='VA012_cmbPaymentSchedule_" + $self.windowNo + "'  style=' width: 100%; ' ><\/select> <\/div>"; k += "<div id='VA012_divPaymentSchedules_" + $self.windowNo + "' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px;margin-top: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>"; $paymentSchedule.append(k); ot(); y = new VIS.ChildDialog; y.setContent($paymentSchedule); y.setTitle(VIS.Msg.getMsg("VA012_PaymentSchedules")); y.setWidth("500px"); ut(); y.setEnableResize(!1); y.setModal(!0); y.show(); ht(); ft(); it.value && (c.setValue(it.value, !1, !0), w.find("*").prop("disabled", !0)); bt.value && (o.setValue(bt.value, !1, !0), p.find("*").prop("disabled", !0)); n.on("change", function () { n.val() > 0 && h.checkScheduleCondition(n.val(), parseInt(a.attr("data-uid")), b.toString(), r(i.getControl().val())) && (of(parseInt(n.val()), b) ? VIS.ADialog.info("VA012_AlreadySelected", null, "", "") : (b.push(parseInt(n.val())), oi.push(this.options[this.selectedIndex].getAttribute("paymentdata")), st.push(this.options[this.selectedIndex].getAttribute("paymentamount")), ut(), h.setInvoiceAndBPartner(n.val(), "IS")), li.val(oi.toString())) }); $_divPaymentSchedules.on(VIS.Events.onTouchStartOrClick, et); y.onOkClick = function () { }; y.onCancelClick = function () { u.scheduleRefresh(); u.refreshForm(); lt() } }, prepayOrderDialog: function () { function r() { var t = "", n; for ($_divPrepayOrders.html(""), n = 0; n < yr.length; n++)t = "<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='" + yr[n] + "'  data-udata='" + pr[n] + "' class='glyphicon glyphicon-remove'><\/span><\/a> <span>" + pr[n] + "<\/span> <\/div>", $_divPrepayOrders.append(t) } function u(n) { var i = t(n.target); i.hasClass("glyphicon-remove") && (yr.splice(yr.indexOf(i.data("uid")), 1), pr.splice(pr.indexOf(i.data("udata")), 1), i.parent().parent().remove(), nf.val(pr.toString())) } function f() { $_divPrepayOrders = $prepayOrder.find("#VA012_divPrepayOrders_" + $self.windowNo) } var i, n; $prepayOrder = t("<div class='va012-popform-content'>"); i = ""; i = "<div id='VA012_divPrepayOrders_" + $self.windowNo + "' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>"; $prepayOrder.append(i); f(); n = new VIS.ChildDialog; n.setContent($prepayOrder); n.setTitle(VIS.Msg.getMsg("VA012_PrepayOrders")); n.setWidth("500px"); r(); n.setEnableResize(!1); n.setModal(!0); n.show(); $_divPrepayOrders.on(VIS.Events.onTouchStartOrClick, u) } }; u = { newRecord: function () { function g(n) { datasource = []; for (var t = 0; t < n.length; t++)datasource.push({ label: n[t].name, value: n[t].name, ids: n[t].chargeID }); k.autocomplete("option", "source", datasource); k.autocomplete("search", ""); k.trigger("focus") } function ut(n, i) { k.attr("chargeid", 0); t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetCharge", dataType: "json", data: { searchText: n }, success: function (n) { var r = JSON.parse(n); datasource = []; i(t.map(r, function (n) { return { label: n.name, value: n.name, ids: n.chargeID } })); t(self.div).autocomplete("search", ""); t(self.div).trigger("focus") } }) } function n() { p.val() == "V" ? (o.val(et).prop("selected", !0), o.removeClass("va012-mandatory"), o.attr("disabled", !0)) : (t(o[0]).siblings().show(), o.val(0).prop("selected", !0), o.addClass("va012-mandatory"), o.attr("disabled", !1)) } a = c.find("#VA012_formNewRecord_" + $self.windowNo); gu = c.find("#VA012_formBtnNewRecord_" + $self.windowNo); u.getNewRecordDesign(); u.getNewRecordControls(); u.loadCurrency(); u.loadPaymentMethod(); u.loadVoucherMatch(); u.loadContraType(); u.loadCashBook(); u.loadDifferenceType(); u.loadTransferType(); u.loadNewFormCurrency(); u.loadConversionTypes(); u.loadCharge(); u.loadTaxRate(); u.loadPayment(); u.loadOrder(); u.loadBusinessPartner(); u.loadInvoice(); u.loadCashLine(); r(i.getControl().val()) <= 0 && i.getControl().addClass("va012-mandatory"); kt.val() != "" && kt.removeClass("va012-mandatory"); d.val() != "" && d.removeClass("va012-mandatory"); k.on("blur", function () { (k.val() == "" || k.val() == null) && k.attr("chargeid", 0) }); kf.on(VIS.Events.onTouchStartOrClick, function () { VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetCharge", { searchText: "" }, g) }); k.autocomplete({ minLength: 0, scroll: !0, source: function (n, t) { n.term.trim().length != 0 && ut(n.term, t) }, select: function (n, i) { t(this).val(i.item.ids); t(this).attr("chargeid", i.item.ids); parseInt(t(this).val()) && k.removeClass("va012-mandatory") } }); ct.on(VIS.Events.onTouchStartOrClick, function () { ct.attr("activestatus") == "0" ? (a.show(), ct.attr("activestatus", "1"), ct.removeClass("vis vis-plus"), ct.addClass("fa fa-minus"), ct.attr("title", "Collapse")) : (a.hide(), ct.attr("activestatus", "0"), ct.addClass("vis vis-plus"), ct.removeClass("fa fa-minus"), ct.attr("title", "Expand")); r(i.getControl().val()) <= 0 && i.getControl().addClass("va012-mandatory"); kt.val() != "" && kt.removeClass("va012-mandatory"); d.val() != "" && d.removeClass("va012-mandatory"); u.scheduleRefresh(); u.prepayRefresh(); u.refreshForm(); o.trigger("change"); h.setPaymentListHeight() }); wf.on(VIS.Events.onTouchStartOrClick, function () { u.scheduleRefresh(); u.prepayRefresh(); u.refreshForm(); o.trigger("change") }); a.hide(); p.on("change", function () { if (p.val() == "M") { _divCtrlCashLine.find("*").prop("disabled", !0); _divCtrlCashLine.hide(); ir.find("*").prop("disabled", !0); ar.find("*").prop("disabled", !0); rr.find("*").prop("disabled", !0); vr.find("*").prop("disabled", !0); ir.hide(); ar.hide(); rr.hide(); vr.hide(); var t = VIS.Utility.Util.getValueOfInt(VIS.DB.executeScalar("SELECT Count(AD_ModuleInfo_ID) FROM AD_ModuleInfo WHERE PREFIX='VA034_' AND IsActive = 'Y'")); t > 0 ? (ui.show(), ui.find("*").prop("disabled", !1)) : (ui.find("*").prop("disabled", !0), ui.hide()); dt.find("*").prop("disabled", !0); gt.find("*").prop("disabled", !0); ei.find("*").prop("disabled", !0); ot.val() != "CH" && (dt.hide(), gt.hide(), ei.hide()); divRow4Col1TrxAmt.show(); tu.show(); ki.show(); ur.show(); fr.show(); er.show(); or.show(); sr.show(); ur.find("*").prop("disabled", !1); fr.find("*").prop("disabled", !1); er.find("*").prop("disabled", !1); or.find("*").prop("disabled", !1); sr.find("*").prop("disabled", !1); li.prop("disabled", !0); nu.css("pointer-events", "auto"); nt.removeClass("va012-mandatory"); k.removeClass("va012-mandatory"); ot.val() != "CH" && (rt.prop("selectedIndex", 0), k.attr("chargeid", 0), k.val(""), nt.prop("selectedIndex", 0), yt.setValue(0)); n() } else p.val() == "V" ? (_divCtrlCashLine.find("*").prop("disabled", !0), _divCtrlCashLine.hide(), ir.find("*").prop("disabled", !0), ar.find("*").prop("disabled", !0), rr.find("*").prop("disabled", !0), vr.find("*").prop("disabled", !0), ir.hide(), rt.prop("selectedIndex", 0), ar.hide(), rr.hide(), vr.hide(), ui.show(), dt.show(), gt.show(), ei.show(), ui.find("*").prop("disabled", !1), dt.find("*").prop("disabled", !1), gt.find("*").prop("disabled", !1), VIS.Utility.Util.getValueOfInt(k.attr("chargeid")) == 0 && k.addClass("va012-mandatory"), VIS.Utility.Util.getValueOfInt(nt.val()) == 0 && nt.addClass("va012-mandatory"), ur.find("*").prop("disabled", !0), fr.find("*").prop("disabled", !0), er.find("*").prop("disabled", !1), or.find("*").prop("disabled", !0), sr.find("*").prop("disabled", !0), nu.css("pointer-events", "none"), divRow4Col1TrxAmt.hide(), tu.hide(), ki.hide(), ur.hide(), fr.hide(), er.hide(), or.hide(), sr.hide(), n()) : p.val() == "C" && (ir.show(), rr.show(), ir.find("*").prop("disabled", !1), rr.find("*").prop("disabled", !1), divRow4Col1TrxAmt.show(), tu.show(), ki.show(), r(w.getControl().val()) == 0 && (ui.find("*").prop("disabled", !0), dt.find("*").prop("disabled", !0), gt.find("*").prop("disabled", !0), ei.find("*").prop("disabled", !0), ui.hide(), dt.hide(), gt.hide(), ei.hide()), ur.find("*").prop("disabled", !0), fr.find("*").prop("disabled", !0), er.find("*").prop("disabled", !0), or.find("*").prop("disabled", !0), sr.find("*").prop("disabled", !0), nu.css("pointer-events", "none"), ur.hide(), fr.hide(), er.hide(), or.hide(), sr.hide(), (rt.val() == null || rt.val() == "" || rt.val() == 0) && rt.addClass("va012-mandatory"), nt.removeClass("va012-mandatory"), k.removeClass("va012-mandatory"), n()); pi.text(VIS.Msg.getMsg("VA012_More")); h.setPaymentListHeight() }); ot.on("change", function () { ot.val() == "CH" ? (ui.show(), dt.show(), gt.show(), ei.show(), ui.find("*").prop("disabled", !1), dt.find("*").prop("disabled", !1), gt.find("*").prop("disabled", !1), (k.val() == null || k.val() == "") && k.addClass("va012-mandatory"), nt.val() == 0 && nt.addClass("va012-mandatory")) : p.val() == "M" && (dt.find("*").prop("disabled", !0), gt.find("*").prop("disabled", !0), ei.find("*").prop("disabled", !0), dt.hide(), gt.hide(), ei.hide(), tr.prop("selectedIndex", 0), k.attr("chargeid", 0), k.val(""), nt.prop("selectedIndex", 0), yt.setValue(0), k.removeClass("va012-mandatory"), nt.removeClass("va012-mandatory")); h.setPaymentListHeight() }); rt.on("change", function () { rt.val() != null && rt.val() != "" && rt.val() != 0 ? rt.removeClass("va012-mandatory") : rt.addClass("va012-mandatory"); rt.val() == "CB" ? (ar.find("*").prop("disabled", !1), vr.find("*").prop("disabled", !1)) : (bi.prop("selectedIndex", 0), dr.val(""), ar.find("*").prop("disabled", !0), vr.find("*").prop("disabled", !0)); rt.val() == "BB" ? (_divCtrlCashLine.find("*").prop("disabled", !0), _divCtrlCashLine.hide(), ui.show(), dt.show(), gt.show(), ei.show(), ui.find("*").prop("disabled", !1), dt.find("*").prop("disabled", !1), gt.find("*").prop("disabled", !1), k.addClass("va012-mandatory"), nt.addClass("va012-mandatory")) : p.val() == "C" && (_divCtrlCashLine.show(), _divCtrlCashLine.find("*").prop("disabled", !1), ui.find("*").prop("disabled", !0), r(w.getControl().val()) == 0 && (dt.find("*").prop("disabled", !0), gt.find("*").prop("disabled", !0), ei.find("*").prop("disabled", !0), dt.hide(), gt.hide(), ei.hide()), ei.hide()); h.setPaymentListHeight() }); o.on("change", function () { VIS.Utility.Util.getValueOfInt(o.val()) > 0 ? o.removeClass("va012-mandatory") : o.addClass("va012-mandatory") }); y.on("change", function () { if (VIS.Utility.Util.getValueOfInt(y.val()) > 0) { var n = null; b != null && b.length > 0 && (n = b.toString()); n != null || ft.value != 0 ? t.ajax({ type: "POST", url: VIS.Application.contextUrl + "BankStatement/GetConvertedAmount", contentType: "application/json; charset=utf-8", data: JSON.stringify({ currency: et, conversionType: y.val(), stmtDate: d.val(), _schedules: n, _accountId: l.val(), orderId: si }), success: function (n) { n = JSON.parse(n); n != null && (n._convertedAmt == 0 ? n.schedule_Ids != null && n.schedule_Ids.length > 0 && (i.setValue(), s.setValue(), VIS.ADialog.info("VA012_ConversionRateNotFound", null, " - DocNo: " + n.schedule_Ids.toString(), "")) : (i.setValue(n._convertedAmt), si == 0 && (s.setValue(n._convertedAmt), i.getControl().trigger("blur", [r(i.getControl().val()), r(s.getControl().val())])))); t(y[0][0]).hide(); y.removeClass("va012-mandatory") }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) : y.removeClass("va012-mandatory") } else y.addClass("va012-mandatory") }); nt.on("change", function () { if (yt.setValue(0), nt.val() > 0) { var n = 0; if (n = r(w.getControl().val()) != 0 && p.val() != "V" ? r(w.getControl().val()) : r(i.getControl().val()), n != 0) { ef(nt.val(), n, v, t); function t(n) { n = JSON.parse(n); n != null && (yt.setValue(VIS.Utility.Util.getValueOfDecimal(n.TaxAmt)), nt.removeClass("va012-mandatory"), s.getControl().trigger("blur")) } } } else nt.addClass("va012-mandatory"), s.getControl().trigger("blur") }); pi.on(VIS.Events.onTouchStartOrClick, function () { pi.attr("visiblestatus") == "0" ? (pi.attr("visiblestatus", "1"), pi.text(VIS.Msg.getMsg("VA012_Hide")), ir.show(), rr.show(), _divCtrlCashLine.show(), ui.show(), dt.show(), gt.show(), ei.show(), divRow4Col1TrxAmt.show(), tu.show(), ki.show(), ur.show(), fr.show(), er.show(), or.show(), sr.show()) : (pi.attr("visiblestatus", "0"), pi.text(VIS.Msg.getMsg("VA012_More")), p.trigger("change")); h.setPaymentListHeight() }); a.on("keyup", function (n) { n.which == 32 && (f.is(":focus") && f.trigger("click"), e.is(":focus") && e.trigger("click"), pi.is(":focus") && pi.trigger("click")); n.which == 13 && hu.is(":focus") && hu.trigger("click") }); hu.on(VIS.Events.onTouchStartOrClick, function () { var n = u.getFormData(), f, t; if (n[0]._cmbBankAccount == null || n[0]._cmbBankAccount == "" || n[0]._cmbBankAccount == "0") { VIS.ADialog.info("VA012_SelectBankAccountFirst", null, "", ""); return } if (n[0]._txtStatementNo == null || n[0]._txtStatementNo == "" || n[0]._txtStatementNo == "0") { VIS.ADialog.info("VA012_PleaseEnterStatementNo", null, "", ""); return } if (n[0]._dtStatementDate == null || n[0]._dtStatementDate == "" || n[0]._dtStatementDate == "0") { VIS.ADialog.info("VA012_PleaseEnterStatementDate", null, "", ""); return } if (VIS.Utility.Util.getValueOfInt(n[0]._txtCurrency) == 0) { VIS.ADialog.info("VA012_PleaseSelectCurrency", null, "", ""); return } if (VIS.Utility.Util.getValueOfInt(n[0]._txtConversionType) == 0) { VIS.ADialog.info("VA012_PleaseSelectConversionType", null, "", ""); return } if (n[0]._txtAmount == null || n[0]._txtAmount == "" || n[0]._txtAmount == "0" || n[0]._txtAmount == "0.00") { VIS.ADialog.info("VA012_PleaseEnterAmount", null, "", ""); return } if (!(n[0]._ctrlInvoice == null || n[0]._ctrlInvoice == "" || n[0]._ctrlInvoice == "0") && !(n[0]._ctrlBusinessPartner == null || n[0]._ctrlBusinessPartner == "" || n[0]._ctrlBusinessPartner == "0") && (n[0]._ctrlPayment == null || n[0]._ctrlPayment == "" || n[0]._ctrlPayment == "0") && (n[0]._scheduleList == null || n[0]._scheduleList == "")) { VIS.ADialog.info("VA012_PleaseSelectPaySchedule", null, "", ""); return } if (!(n[0]._ctrlBusinessPartner == null || n[0]._ctrlBusinessPartner == "" || n[0]._ctrlBusinessPartner == "0") && (n[0]._ctrlInvoice == null || n[0]._ctrlInvoice == "" || n[0]._ctrlInvoice == "0") && (n[0]._ctrlPayment == null || n[0]._ctrlPayment == "" || n[0]._ctrlPayment == "0") && (n[0]._scheduleList == null || n[0]._scheduleList == "") && (n[0]._ctrlOrder == null || n[0]._ctrlOrder == "" || n[0]._ctrlOrder == "0") && (n[0]._cmbCharge == null || n[0]._cmbCharge == "" || n[0]._cmbCharge == "0")) { VIS.ADialog.info("VA012_PleaseSelectAnyOne", null, "", ""); return } if (n[0]._cmbVoucherMatch == "C") if (n[0]._cmbContraType == "BB") { if (n[0]._cmbCharge == null || n[0]._cmbCharge == "" || n[0]._cmbCharge == "0") { VIS.ADialog.info("VA012_PleaseSelectCharge", null, "", ""); k.addClass("va012-mandatory"); return } if (n[0]._cmbTaxRate == null || n[0]._cmbTaxRate == "" || n[0]._cmbTaxRate == "0") { VIS.ADialog.info("VA012_PleaseSelectTaxRate", null, "", ""); nt.addClass("va012-mandatory"); return } } else if (n[0]._cmbContraType == "CB") { if (n[0]._ctrlCashLine == null || n[0]._ctrlCashLine == "" || n[0]._ctrlCashLine == "0") { VIS.ADialog.info("VA012_PleaseSelectCashJournalLine", null, "", ""); return } } else { VIS.ADialog.info("VA012_PleaseSelectContraType", null, "", ""); return } if (n[0]._cmbVoucherMatch == "V") { if (n[0]._cmbCharge == null || n[0]._cmbCharge == "" || n[0]._cmbCharge == "0") { VIS.ADialog.info("VA012_PleaseSelectCharge", null, "", ""); k.addClass("va012-mandatory"); return } if (n[0]._cmbTaxRate == null || n[0]._cmbTaxRate == "" || n[0]._cmbTaxRate == "0") { VIS.ADialog.info("VA012_PleaseSelectTaxRate", null, "", ""); nt.addClass("va012-mandatory"); return } } if (parseFloat(n[0]._txtDifference) != 0 && n[0]._cmbVoucherMatch == "M" && (n[0]._cmbDifferenceType == null || n[0]._cmbDifferenceType == "" || n[0]._cmbDifferenceType == "0")) { VIS.ADialog.info("VA012_PleaseSelectDifferenceType", null, "", ""); return } if (parseFloat(n[0]._txtDifference) != 0 && n[0]._cmbDifferenceType == "CH") { if (n[0]._cmbCharge == null || n[0]._cmbCharge == "" || n[0]._cmbCharge == "0") { VIS.ADialog.info("VA012_PleaseSelectCharge", null, "", ""); k.addClass("va012-mandatory"); return } if (n[0]._cmbTaxRate == null || n[0]._cmbTaxRate == "" || n[0]._cmbTaxRate == "0") { VIS.ADialog.info("VA012_PleaseSelectTaxRate", null, "", ""); nt.addClass("va012-mandatory"); return } } if (parseFloat(n[0]._txtDifference) != 0 && VIS.Utility.Util.getValueOfInt(n[0]._ctrlPayment) != 0 && n[0]._cmbDifferenceType != "CH") { VIS.ADialog.info("VA012_PlsSelectDiffTypeCharge", null, "", ""); return } if (VIS.Utility.Util.getValueOfDecimal(n[0]._txtDifference) != 0 && VIS.Utility.Util.getValueOfInt(n[0]._scheduleList.length) > 0 && Math.abs(r(i.getControl().val())) > Math.abs(r(s.getControl().val())) && n[0]._cmbDifferenceType != "CH") { VIS.ADialog.info("MoreScheduleAmount", null, "", ""); return } if (VIS.Utility.Util.getValueOfString(n[0]._cmbDifferenceType) == "CH" || VIS.Utility.Util.getValueOfString(n[0]._cmbVoucherMatch) == "V") { if (f = VIS.Utility.Util.getValueOfInt(n[0]._cmbTaxRate), t = 0, t = VIS.Utility.Util.getValueOfString(n[0]._cmbDifferenceType) == "CH" ? VIS.Utility.Util.getValueOfDecimal(n[0]._txtDifference) : VIS.Utility.Util.getValueOfDecimal(n[0]._txtAmount), f > 0) { ef(n[0]._cmbTaxRate, t, v, e); function e(t) { t = JSON.parse(t); t != null && (n[0]._surChargeAmt = t.SurchargeAmt, n[0]._txtTaxAmount = t.TaxAmt, pt(c, !0, "absolute"), u.insertNewRecord(n, u.afterInsertion)) } } } else pt(c, !0, "absolute"), u.insertNewRecord(n, u.afterInsertion) }); kt.on("keypress", function () { hr.val("1"); di.val("10") }); kt.on("change", function () { kt.val() == "" ? kt.addClass("va012-mandatory") : kt.removeClass("va012-mandatory") }); di.on("keypress", function (n) { if (n.which != 8 && n.which != 0 && (n.which < 48 || n.which > 57)) return !1 }); hr.on("keypress", function (n) { if (n.which != 8 && n.which != 0 && (n.which < 48 || n.which > 57)) return !1; di.val("10") }); yf.on(VIS.Events.onTouchStartOrClick, function () { u.scheduleRefresh(); u.prepayRefresh(); u.refreshForm(); (kt.val() == "" || kt.val() == null) && kt.val("0"); h.getMaxStatement("BT"); a.attr("data-uid", 0); hr.val("1"); di.val("10") }); yt.getControl().on("change", function () { r(yt.getControl().val()) == 0 || r(yt.getControl().val()) == null ? yt.setValue(0) : yt.setValue(VIS.Utility.Util.getValueOfDecimal(r(yt.getControl().val()))) }); s.getControl().on("blur", function (n, t, u) { if (p.val() != "V") if (VIS.Utility.Util.getValueOfDecimal(t) != 0 && (i.setValue(), i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(t).toFixed(v)))), VIS.Utility.Util.getValueOfDecimal(u) != 0 && (s.setValue(), s.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(u).toFixed(v)))), VIS.Utility.Util.getValueOfDecimal(r(s.getControl().val())) == 0 ? (s.setValue(0), s.getControl().addClass("va012-mandatory")) : VIS.Utility.Util.getValueOfDecimal(r(s.getControl().val())) < 0 ? s.getControl().addClass("va012-mandatory") : (s.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(r(s.getControl().val())).toFixed(v))), s.getControl().removeClass("va012-mandatory")), w.getControl().attr("vchangable") == "Y" && (w.setValue(0), ki.find("*").prop("disabled", !0)), p.val() == "M" || p.val() == "C") { w.getControl().attr("vchangable") == "Y" && (w.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(r(s.getControl().val()) - r(i.getControl().val())).toFixed(v))), VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val())) != 0 && (VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val())) < 0 ? w.getControl().addClass("va012-mandatory") : w.getControl().removeClass("va012-mandatory"), ki.find("*").prop("disabled", !1))); ef(nt.val(), r(w.getControl().val()), v, f); function f(n) { n = JSON.parse(n); n != null && n != 0 && yt.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(n.TaxAmt).toFixed(v))); nt.val() > 0 && VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val())) != 0 && (VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val())) < 0 ? w.getControl().addClass("va012-mandatory") : w.getControl().removeClass("va012-mandatory")); VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val())) != 0 && VIS.Utility.Util.getValueOfInt(tt.getValue()) != 0 ? (ot.val("CH").prop("selected", !0), ot.trigger("change")) : (ot.val("0").prop("selected", !0), ot.trigger("change")) } } else VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val())) != 0 && VIS.Utility.Util.getValueOfInt(tt.getValue()) != 0 && (ot.val("CH").prop("selected", !0), ot.trigger("change")) }); i.getControl().on("blur", function (n, t) { VIS.Utility.Util.getValueOfDecimal(t) != 0 && (i.setValue(), i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(t).toFixed(v)))); VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) == 0 && (i.setValue(0), i.getControl().addClass("va012-mandatory")); var u = VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())); if (e.attr("v_active") == "1" && u > 0 && (i.setValue(), i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(-1 * u).toFixed(v)))), f.attr("v_active") == "1" && u < 0 && (i.setValue(), i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(-1 * u).toFixed(v)))), VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) < 0 ? (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), f.removeClass("va012-active"), f.addClass("va012-inactive"), f.attr("v_active", "0"), i.getControl().addClass("va012-mandatory")) : VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) > 0 && (f.removeClass("va012-inactive"), f.addClass("va012-active"), f.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0"), i.getControl().removeClass("va012-mandatory")), VIS.Utility.Util.getValueOfInt(nt.val()) > 0 && p.val() == "V") { ef(nt.val(), r(i.getControl().val()), v, o); function o(n) { n = JSON.parse(n); n != null && n != 0 && (yt.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(n.TaxAmt).toFixed(v))), nt.removeClass("va012-mandatory")); s.getControl().trigger("blur", [r(i.getControl().val()), r(s.getControl().val())]) } } else s.getControl().trigger("blur", [r(i.getControl().val()), r(s.getControl().val())]) }); tf.hover(function () { $tooltip = t('<div  class="va012-div-tooltip"><h4>' + VIS.Msg.getMsg("VA012_Information") + "<\/h4><p>" + VIS.Msg.getMsg("VA012_InformationText") + "<\/p><\/div>"); c.append($tooltip); t(".va012-div-tooltip").show() }, function () { c.find(".va012-div-tooltip").remove() }); d.on("change", function () { if (d.val() == "") d.addClass("va012-mandatory"); else { d.removeClass("va012-mandatory"); var u = 0, n = null, t = null; if (p.val() == "M" ? li.val() != 0 && (tt.getValue() == null || tt.getValue() == 0) ? b.length != 0 && (n = "IS", t = b.join()) : (li.val() == null || li.val() == 0) && tt.getValue() != null && tt.getValue() != 0 ? (n = "PY", t = tt.getValue()) : VIS.Utility.Util.getValueOfInt(ft.value) != 0 && VIS.Utility.Util.getValueOfInt(it.value) != 0 && (n = "PO", t = ft.value, i.getControl().attr("disabled", !0)) : p.val() == "C" && VIS.Utility.Util.getValueOfInt(lt.value) != 0 && VIS.Utility.Util.getValueOfInt(tt.getValue()) == 0 && VIS.Utility.Util.getValueOfInt(li.val()) == 0 && (n = "CO", t = lt.value), n != null && t != null) { VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetConvtAmount", { recordID: t, bnkAct_Id: l.val(), transcType: n, stmtDate: d.val() }, o); function o(t) { for (var o = 0; o < t.length; o++) { if (t.length == 0 || t[o].DueAmount == 0) { i.setValue(); s.setValue(); w.setValue(); i.getControl().trigger("blur", [r(i.getControl().val()), r(s.getControl().val())]); VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } u += t[o].DueAmount } if (u != 0) i.setValue(u), n != "PO" ? (s.setValue(u), i.getControl().trigger("blur", [r(i.getControl().val()), r(s.getControl().val())])) : (i.getControl().removeClass("va012-mandatory"), i.getControl().attr("disabled", !0), f.removeClass("va012-inactive"), f.addClass("va012-active"), f.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")); else { i.setValue(); s.setValue(); w.setValue(); VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } } } } }); tf.mousemove(function (n) { t(".va012-div-tooltip").css("top", n.pageY - 50).css("left", n.pageX) }); f.on(VIS.Events.onTouchStartOrClick, function () { r(s.getControl().val()) == 0 && VIS.Utility.Util.getValueOfInt(ft.value) > 0 || p.val() == "V" && (VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) < 0 && i.setValue(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) * -1), f.removeClass("va012-inactive"), f.addClass("va012-active"), f.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0"), i.getControl().trigger("blur", [r(i.getControl().val()), r(s.getControl().val())])) }); e.on(VIS.Events.onTouchStartOrClick, function () { r(s.getControl().val()) == 0 && VIS.Utility.Util.getValueOfInt(ft.value) > 0 || p.val() == "V" && (VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) > 0 && i.setValue(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) * -1), e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), f.removeClass("va012-active"), f.addClass("va012-inactive"), f.attr("v_active", "0"), i.getControl().trigger("blur", [r(i.getControl().val()), r(s.getControl().val())])) }) }, getNewRecordDesign: function () { }, getNewRecordControls: function () { kt = a.find("#VA012_txtStatementNo_" + $self.windowNo); yf = a.find("#VA012_btnStatementNo_" + $self.windowNo); hr = a.find("#VA012_txtStatementPage_" + $self.windowNo); di = a.find("#VA012_txtStatementLine_" + $self.windowNo); d = a.find("#VA012_dtStatementDate_" + $self.windowNo); gi = a.find("#VA012_cmbPaymentMethod_" + $self.windowNo); rt = a.find("#VA012_cmbContraType_" + $self.windowNo); bi = a.find("#VA012_cmbCashBook_" + $self.windowNo); nr = a.find("#VA012_cmbTransferType_" + $self.windowNo); dr = a.find("#VA012_txtCheckNo_" + $self.windowNo); p = a.find("#VA012_cmbVoucherMatch_" + $self.windowNo); i.getControl().addClass("va012-mandatory"); s.getControl().addClass("va012-mandatory"); w.getControl().addClass("va012-mandatory"); ot = a.find("#VA012_cmbDifferenceType_" + $self.windowNo); cr = a.find("#VA012_txtVoucherNo_" + $self.windowNo); uu = a.find("#VA012_txtDescription_" + $self.windowNo); tr = a.find("#VA012_cmbCharge_" + $self.windowNo); k = a.find("#VA012_txtCharge_" + $self.windowNo); nt = a.find("#VA012_cmbTaxRate_" + $self.windowNo); gr = a.find("#VA012_ctrlCashLine_" + $self.windowNo); lr = a.find("#VA012_ctrlPayment_" + $self.windowNo); fu = a.find("#VA012_ctrlOrder_" + $self.windowNo); eu = a.find("#VA012_ctrlInvoice_" + $self.windowNo); ou = a.find("#VA012_ctrlBusinessPartner_" + $self.windowNo); su = a.find("#VA012_chkUseNextTime_" + $self.windowNo); hu = a.find("#VA012_btnSave_" + $self.windowNo); nu = a.find("#VA012_btnPaymentSchedule_" + $self.windowNo); pf = a.find("#VA012_btnPrepay_" + $self.windowNo); li = a.find("#VA012_txtPaymentSchedule_" + $self.windowNo); nf = a.find("#VA012_txtPrepayOrder_" + $self.windowNo); ct = gu.find("#VA012_btnNewRecord_" + $self.windowNo); wf = gu.find("#VA012_btnUndo_" + $self.windowNo); bf = c.find("#VA012_btnDelete_" + $self.windowNo); tf = a.find("#VA012_btnAmount_" + $self.windowNo); f = a.find("#VA012_btnIn_" + $self.windowNo); e = a.find("#VA012_btnOut_" + $self.windowNo); o = a.find("#VA012_txtCurrency_" + $self.windowNo); y = a.find("#VA012_txtConversionType_" + $self.windowNo) }, loadPaymentMethod: function () { function t(t) { if (gi.html(""), gi.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)gi.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.va009_paymentmethod_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.va009_name) + "<\/option>"); t.dispose(); t = null; n = null; gi.prop("selectedIndex", 0) } var n = "SELECT VA009_NAME,VA009_PAYMENTMETHOD_ID FROM VA009_PAYMENTMETHOD WHERE ISACTIVE='Y'  AND AD_CLIENT_ID=" + VIS.Env.getCtx().getAD_Client_ID() + " AND AD_ORG_ID=" + VIS.Env.getCtx().getAD_Org_ID(), i = VIS.DB.executeDataSet(n.toString(), null, t) }, loadCurrency: function () { et = VIS.DB.executeScalar("SELECT C_CURRENCY_ID FROM C_BANKACCOUNT WHERE C_BANKACCOUNT_ID=" + l.val()); v = VIS.DB.executeScalar("SELECT STDPRECISION FROM C_CURRENCY WHERE C_CURRENCY_ID=" + et) }, loadCashBook: function () { function t(t) { if (bi.html(""), bi.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)bi.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_cashbook_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null; bi.prop("selectedIndex", 0) } var n = "SELECT NAME,C_CashBook_ID FROM C_CashBook WHERE ISACTIVE='Y'  AND AD_CLIENT_ID=" + VIS.Env.getCtx().getAD_Client_ID() + " AND AD_ORG_ID=" + VIS.Env.getCtx().getAD_Org_ID(), i = VIS.DB.executeDataSet(n.toString(), null, t) }, loadContraType: function () { rt.html(""); rt.append("<option value=0 ><\/option>"); rt.append("<option value='BB' >" + VIS.Msg.getMsg("VA012_BankToBank") + "<\/option>"); rt.append("<option value='CB' >" + VIS.Msg.getMsg("VA012_CashToBank") + "<\/option>"); rt.prop("selectedIndex", 0) }, loadTransferType: function () { nr.html(""); nr.append("<option value=0 ><\/option>"); nr.append("<option value='CH' >" + VIS.Msg.getMsg("VA012_Cash") + "<\/option>"); nr.append("<option value='CK' >" + VIS.Msg.getMsg("VA012_Check") + "<\/option>"); nr.prop("selectedIndex", 0) }, loadVoucherMatch: function () { p.html(""); p.append("<option value='M' >" + VIS.Msg.getMsg("VA012_Payment") + "<\/option>"); p.append("<option value='V' >" + VIS.Msg.getMsg("VA012_Voucher") + "<\/option>"); p.append("<option value='C' >" + VIS.Msg.getMsg("VA012_Contra") + "<\/option>"); p.prop("selectedIndex", 0) }, loadDifferenceType: function () { ot.html(""); ot.append("<option value=0 ><\/option>"); ot.append("<option value='OU' >" + VIS.Msg.getMsg("VA012_OverUnderPayment") + "<\/option>"); ot.append("<option value='DA' >" + VIS.Msg.getMsg("VA012_DiscountAmount") + "<\/option>"); ot.append("<option value='WO' >" + VIS.Msg.getMsg("VA012_WriteoffAmount") + "<\/option>"); ot.append("<option value='CH' >" + VIS.Msg.getMsg("VA012_Charge") + "<\/option>"); ot.prop("selectedIndex", 0) }, loadCharge: function () { function t(t) { if (tr.html(""), tr.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)tr.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_charge_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null; tr.prop("selectedIndex", 0) } var n = "SELECT NAME,C_CHARGE_ID FROM C_CHARGE WHERE ISACTIVE='Y' AND AD_CLIENT_ID=" + VIS.Env.getCtx().getAD_Client_ID() + " AND AD_ORG_ID=" + VIS.Env.getCtx().getAD_Org_ID(), i = VIS.DB.executeDataSet(n.toString(), null, t) }, loadTaxRate: function () { function i(t) { if (nt.html(""), nt.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.tables[0].rows.length; i++)nt.append("<option value=" + VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_tax_id) + ">" + VIS.Utility.encodeText(t.tables[0].rows[i].cells.name) + "<\/option>"); t.dispose(); t = null; n = null; nt.prop("selectedIndex", 0) } var n = "SELECT Name,C_Tax_ID FROM C_Tax WHERE IsActive='Y'AND IsSurcharge='N' AND NVL(Parent_Tax_ID, 0)=0", t; n = VIS.MRole.getDefault().addAccessSQL(n, "C_Tax", !0, !1); t = VIS.DB.executeDataSet(n.toString(), null, i) }, loadPayment: function () { lr != undefined && lr != null && lr.empty(); var n = l.val() != null ? "DocStatus IN ('CO','CL') AND C_BankAccount_ID = " + l.val() : "DocStatus IN ('CO','CL')"; te = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 5043, VIS.DisplayType.Search, "C_Payment_ID", 0, !1, n); tt = new VIS.Controls.VTextBoxButton("C_Payment_ID", !1, !1, !0, VIS.DisplayType.Search, te); tt.getControl().addClass("va012-input-size-2"); tt.getControl().attr("tabindex", "10"); lr.append(tt.getControl()); lr.append(tt.getBtn(0)); lr.append(tt.getBtn(1)); tt.fireValueChanged = function () { if (VIS.Utility.Util.getValueOfInt(tt.value) != 0 && VIS.Utility.Util.getValueOfInt(ai) != 0) { VIS.Utility.Util.getValueOfInt(ai) == tt.value ? VIS.ADialog.info("VA012_AlreadySelected", null, "", "") : (tt.setValue(ai, !1, !0), VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord", null, "", "")); return } ai = 0; ai = tt.value; tt.value || u.refreshForm(); ri || yi || tt.value && (h.checkPaymentCondition(ai, 0, r(i.getControl().val())) ? h.setInvoiceAndBPartner(ai, "PY") : tt.setValue()); yi = !1 }; yi = !1 }, loadOrder: function () { se = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 5043, VIS.DisplayType.Search, "C_Order_ID", 0, !1, "C_ORDER_ID IN (SELECT ORD.C_ORDER_ID  FROM C_ORDER ORD  LEFT JOIN C_DOCTYPE DT  ON ORD.C_DOCTYPETARGET_ID=DT.C_DOCTYPE_ID  INNER JOIN VA009_PAYMENTMETHOD PM  ON (PM.VA009_PAYMENTMETHOD_ID =ORD.VA009_PAYMENTMETHOD_ID )  WHERE DT.DOCSUBTYPESO         ='PR'   AND ORD.DOCSTATUS             ='WP'   AND ORD.ISACTIVE              ='Y'   AND PM.VA009_PAYMENTBASETYPE! ='B')"); ft = new VIS.Controls.VTextBoxButton("C_Order_ID", !1, !1, !0, VIS.DisplayType.Search, se); ft.getControl().addClass("va012-input-size-2"); ft.getControl().attr("tabindex", "13"); fu.append(ft.getControl()); fu.append(ft.getBtn(0)); fu.append(ft.getBtn(1)); ft.fireValueChanged = function () { if (VIS.Utility.Util.getValueOfInt(ft.value) != 0 && VIS.Utility.Util.getValueOfInt(si) != 0) { VIS.Utility.Util.getValueOfInt(si) == ft.value ? VIS.ADialog.info("VA012_AlreadySelected", null, "", "") : (ft.setValue(si, !1, !0), VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord", null, "", "")); return } if (si = 0, si = ft.value, ft.value || u.refreshForm(), ft.value && !ri) if (h.checkPrepayCondition(ft.value, 0, null, r(i.getControl().val()))) h.setInvoiceAndBPartner(si, "PO"), i.getControl().attr("disabled", !0); else if (si = 0, ft.setValue(), VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) == 0) { VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } } }, loadCashLine: function () { var n = " C_CASHLINE_ID IN (SELECT CSL.C_CASHLINE_ID  FROM C_CASH CS  INNER JOIN C_CASHLINE CSL  ON CS.C_CASH_ID=CSL.C_CASH_ID  INNER JOIN c_charge chrg  ON chrg.c_charge_id        =csl.c_charge_id  WHERE CS.ISACTIVE          ='Y'  AND CSL.CashType           ='C'  AND chrg.dtd001_chargetype ='CON'  AND CS.DOCSTATUS          IN ('CO','CL')  AND CSL.VA012_ISRECONCILED ='N'  AND CSL.C_BankAccount_ID =" + (l.val() == null ? 0 : l.val()) + " )"; gr.html(""); ne = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 1008317, VIS.DisplayType.Search, "C_CashLine_ID", 0, !1, n); lt = new VIS.Controls.VTextBoxButton("C_CashLine_ID", !1, !1, !0, VIS.DisplayType.Search, ne); lt.getControl().addClass("va012-input-size-2"); lt.getControl().attr("tabindex", "10"); gr.append(lt.getControl()); gr.append(lt.getBtn(0)); gr.append(lt.getBtn(1)); lt.fireValueChanged = function () { if (VIS.Utility.Util.getValueOfInt(lt.value) != 0 && VIS.Utility.Util.getValueOfInt(wi) != 0) { VIS.Utility.Util.getValueOfInt(wi) == lt.value ? VIS.ADialog.info("VA012_AlreadySelected", null, "", "") : (lt.setValue(wi, !1, !0), VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord", null, "", "")); return } wi = 0; wi = lt.value; lt.value && (ri || yi || h.checkContraCondition(lt.value, 0, r(i.getControl().val())) || (wi = 0, lt.setValue(), VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) == 0 && VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", "")), yi = !1); yi = !1 } }, loadBusinessPartner: function () { uf = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 2893, VIS.DisplayType.Search, "C_BPartner_ID", 0, !1, null); it = new VIS.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, VIS.DisplayType.Search, uf); it.getControl().addClass("va012-input-size-2"); it.getControl().attr("tabindex", "12"); ou.append(it.getControl()); ou.append(it.getBtn(0)); ou.append(it.getBtn(1)); it.fireValueChanged = function () { cu = 0; cu = it.value } }, loadInvoice: function () { ie = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 3484, VIS.DisplayType.MultiKey, "C_Invoice_ID", 0, !1, "DocStatus IN ('CO','CL')"); bt = new VIS.Controls.VTextBoxButton("C_Invoice_ID", !1, !1, !0, VIS.DisplayType.MultiKey, ie); bt.isMultiKeyTextBox = !0; bt.getControl().addClass("va012-input-size-2"); bt.getControl().attr("tabindex", "11"); eu.append(bt.getControl()); eu.append(bt.getBtn(0)); eu.append(bt.getBtn(1)); bt.fireValueChanged = function () { wr = null; wr = bt.value; bt.value && (h.checkInvoiceCondition(wr, r(i.getControl().val())) ? h.setBPartner(wr) : bt.setValue()) } }, getFormData: function () { var n = {}, t = []; return n._bankStatementLineID = a.attr("data-uid"), n._txtStatementNo = kt.val(), n._txtStatementPage = hr.val(), n._txtStatementLine = di.val(), n._dtStatementDate = d.val(), n._cmbPaymentMethod = gi.val(), n._cmbCurrency = et, n._cmbVoucherMatch = p.val(), n._txtDescription = VIS.Utility.encodeText(uu.val()), n._txtVoucherNo = VIS.Utility.encodeText(cr.val()), n._cmbCharge = k.attr("chargeid"), n._cmbTaxRate = nt.val(), n._txtTaxAmount = r(yt.getControl().val()), n._ctrlPayment = ai, n._ctrlOrder = si, n._ctrlCashLine = wi, n._ctrlInvoice = wr, n._ctrlBusinessPartner = cu, n._chkUseNextTime = su.is(":checked"), n._cmbBank = hi.val(), n._cmbBankAccount = l.val(), n._cmbBankAccountClasses = yu.val(), n._cmbTransactionType = ut.val(), n._scheduleList = b.toString(), n._cmbContraType = rt.val(), n._cmbCashBook = bi.val(), n._cmbTransferType = nr.val(), n._txtCheckNo = dr.val(), n._cmbDifferenceType = ot.val(), ot.val() == "CH" && p.val() != "C" ? (n._txtAmount = r(s.getControl().val()), n._txtTrxAmt = r(i.getControl().val())) : (n._txtAmount = r(i.getControl().val()), n._txtTrxAmt = r(s.getControl().val())), n._txtDifference = r(w.getControl().val()), n._txtConversionType = y.val(), n._txtCurrency = o.val(), t.push(n), t }, insertNewRecord: function (n, i) { t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/InsertData", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _formData: n }), success: function (n) { i(n) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) }, afterInsertion: function (n) { if (n != null && n != "") { var i = t.parseJSON(n); i == "Success" ? (pt(c, !1, "absolute"), VIS.ADialog.info("VA012_RecordSaved", null, "", ""), wt = [], ht.html(""), fi = 1, g.loadStatement(ii), ti.html(""), u.scheduleRefresh(), u.prepayRefresh(), ci = 1, storepaymentdata = [], h.loadPayments(l.val(), vt.val(), ut.val(), at.val()), u.scheduleRefresh(), u.prepayRefresh(), u.refreshForm(), o.addClass("va012-mandatory"), y.addClass("va012-mandatory")) : (pt(c, !1, "absolute"), VIS.ADialog.info(i, null, "", "")) } }, refreshForm: function () { a.attr("data-uid", 0); h.getMaxStatement("LO"); d.attr("readonly", !1); var n = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetStatementDate", { bankAcct: l.val() }); n != "" && n != null ? d.val(Globalize.format(new Date(n), "yyyy-MM-dd")) : d.val(he); gi.prop("selectedIndex", 0); p.prop("selectedIndex", 0); p.trigger("change"); i.getControl().attr("disabled", !1); i.setValue(0); s.setValue(0); w.setValue(0); w.getControl().attr("vchangable", "Y"); ot.prop("selectedIndex", 0); uu.val(""); cr.val(""); tr.prop("selectedIndex", 0); k.attr("chargeid", 0); k.val(""); nt.prop("selectedIndex", 0); yt.setValue(0); su.attr("checked", !1); tt.setValue(); ft.setValue(); lt.setValue(); it.setValue(); bt.setValue(); cu = 0; ai = 0; si = 0; wi = 0; wr = null; f.trigger("click"); u.loadCurrency(); rt.prop("selectedIndex", 0); bi.prop("selectedIndex", 0); nr.prop("selectedIndex", 0); dr.val(""); this.loadNewFormCurrency(); y.addClass("va012-mandatory"); this.loadConversionTypes(); o.addClass("va012-mandatory"); y.prop("selectedIndex", 0); y.attr("disabled", !1); o.attr("disabled", !1) }, scheduleRefresh: function () { b = []; oi = []; st = []; li.val("") }, prepayRefresh: function () { yr = []; pr = []; nf.val("") }, newRecordDispose: function () { a = null; gu = null; kt = null; yf = null; hr = null; di = null; d = null; gi = null; rt = null; bi = null; nr = null; dr = null; et = null; p = null; i = null; w = null; ot = null; tf = null; f = null; e = null; uu = null; cr = null; tr = null; k = null; nt = null; yt = null; gr = null; fu = null; lr = null; eu = null; ou = null; su = null; hu = null; nu = null; pf = null; li = null; nf = null; ct = null; wf = null; bf = null; pi = null; oe = null; te = null; ft = null; si = null; tt = null; pe = null; ai = null; lt = null; ne = null; wi = null; uf = null; it = null; cu = null; ie = null; bt = null; wr = null; he = null; ff = null; o = null; y = null }, loadNewFormCurrency: function () { var n = null, r, i; if (t(o[0]).empty(), r = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 457, VIS.DisplayType.TableDir, "C_Currency_ID", 0, !1, "IsMyCurrency='Y'"), n = r.getData(!0, !0, !1, !1), o.append('<option value="0" ><\/option>'), n != null && n != undefined && n.length > 0) { for (i = 0; i < n.length; i++)o.append("<option value=" + n[i].Key + ">" + n[i].Name + "<\/option>"); o.val(0); o.addClass("va012-mandatory") } }, loadConversionTypes: function () { var n = null, r, i; if (t(y[0]).empty(), r = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 10269, VIS.DisplayType.TableDir, "C_ConversionType_ID", 0, !1, "IsActive='Y'"), n = r.getData(!0, !0, !1, !1), y.append('<option value="0" ><\/option>'), n != null && n != undefined && n.length > 0) { for (i = 0; i < n.length; i++)y.append("<option value=" + n[i].Key + ">" + n[i].Name + "<\/option>"); y.val(0); y.addClass("va012-mandatory") } } }; t(window).resize(function () { h.setPaymentListHeight(); g.setStatementListHeight(); bu.height(t("#VA012_mainContainer_" + $self.windowNo).height()) }); this.getRoot = function () { return c }; this.setSize = function () { bu.height(t("#VA012_mainContainer_" + $self.windowNo).height()) }; this.disposeComponents = function () { $self = null; c = null; hi = null; l = null; yu = null; at = null; fe = null; vt = null; ut = null; sf = null; hf = null; ht = null; ti = null; ii = ""; br = null; kr = null; ve = null; ye = null; ir = null; ar = null; _divCtrlCashLine = null; rr = null; vr = null; ui = null; ee = null; divRow4Col1TrxAmt = null; tu = null; ki = null; dt = null; kf = null; gt = null; ei = null; ur = null; fr = null; er = null; or = null; sr = null; ni = null; df = null; cf = null; lf = null; af = null; wu = null; bu = null; ru = null; re = null; wt = []; b = []; oi = []; yr = []; pr = []; u.newRecordDispose() } } i.prototype.dispose = function () { this.disposeComponents(); this.frame && this.frame.dispose(); this.frame = null }; i.prototype.init = function (n, t) { this.windowNo = n; this.frame = t; this.Initialize(); this.frame.getContentGrid().append(this.getRoot()); this.setSize() }; n.AForms = n.AForms || {}; n.AForms.bankStatement = i }(VA012, jQuery); VA012 = window.VA012 || {}, function (n, t) { n.UploadExcel = function (i, r, u) { function ut(n) { for (u.children().remove(), j = 0; j < n.ExcelCol.length; j++)j == 1 ? u.append("<li index=" + j + " style='border:none;float:none' >" + n.ExcelCol[j] + "<\/li>") : u.append("<li index=" + j + " >" + n.ExcelCol[j] + "<\/li>") } var k = null, f = [], l = [], a = 0, o = 0, c = Date.now().toString(), s = 1048576, v = 0, h = 0, p = [], e = null, nt = i, ft = t(window).width(), et = t(window).height(), c = Date.now().toString(), ot = r; savedFileName = ""; var d = t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:40%;width: 40%;left: 32%;position:absolute;z-index:99999;'>"), w = null, b = null; this.isWait = !1; self = this; var tt = function () { var n = null, i = 0, t; for (t in f) i = parseInt(f[t].size / s), e.size % s > 0 && i++, v += i, n = {}, n.Name = f[t].name, n.Size = f[t].size, p.push(n); g() }, g = function () { var t; if (f == null || f.length == 0) { y(!1); return } if (!(o >= f.length)) { var n = new XMLHttpRequest, i = new FormData, r = f[o].name.substring(0, f[o].name.lastIndexOf(".")) + c + f[o].name.substring(f[o].name.lastIndexOf(".")); savedFileName = r; i.append("file", f[o].slice(h * s, h * s + Number(s))); n.open("POST", VIS.Application.contextUrl + "VA012/UploadExcel/SaveFileinTemp?fileName=" + r + "&folderKey=" + c + "&orgFileName=" + f[o].name, !1); n.send(i); k = n.responseText; a++; h++; t = parseInt(f[o].size / s); f[o].size % s > 0 && t++; h == t && (o++, h = 0); a <= v && rt(parseInt(a / v * 80)); window.setTimeout(function () { g() }, 2) } }, it = function (n) { for (var t = [], i, w, r, b, u = 0; u < n.files.length; u++) { if (e = n.files[u], e == undefined) return; if (e.size <= 0) return f = [], l = [], a = 0, o = 0, c = null, s = null, v = 0, h = 0, p = [], e = null, VIS.ADialog.info("VADMS_FileSizeShouldGreaterThan0KB"), y(!1), !1; if (e.name.indexOf("&") > -1 || e.name.indexOf("?") > -1 || e.name.indexOf("#") > -1 || e.name.indexOf("/") > -1 || e.name.indexOf("\\") > -1) { t.push(e.name); continue } for (i in f) if (e.name == f[i].name) { window.setTimeout(function () { y(!1); VIS.ADialog.info("fileAlreadyAttached") }, 20); return } if (l != null) for (i in l) if (e.name == l[i].Name && !l[i].IsDeleted) { window.setTimeout(function () { y(!1); VIS.ADialog.info("fileAlreadyAttached") }, 20); return } w = {}; w.Name = e.name; w.Size = e.size; f.push(e) } if (t.length > 0) { r = ""; for (b in t) r += t[b].toString() + "\n"; r += t.length == 1 ? "File has" : "Files have"; r += " invalid name. Please change the file name and try again."; y(!1); VIS.ADialog.info("", !0, r) } }, y = function (n) { if (t("body").find("#progressbar").remove(), n) { w = t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute;height: 35px;'>"); b = t("<span class='vis-ui-label'  style='position:absolute;left: 60%;top: 4px;'>").append("0%"); w.append(b); d.append(w); var i = t("<div id='progressbar' style='z-index: 999999;' class='vadms-Busy-Progress'><\/div>"); i.append(d); i.appendTo("<body>") } else t("body").find("progressbar").remove() }, rt = function (n) { w.css("width", n + "%"); b.empty(); b.append(n + "%") }; return this.getFolderKey = c, this.getSavedFileName = savedFileName, this.GetUploadedExcelColumns = function () { var t, u, i; if (o >= f.length) return t = [], u = VIS.Application.contextUrl + "VA012/UploadExcel/SaveAttachmentEntries", t.push({ Files: JSON.stringify(p) }), t.push({ FolderKey: c }), t.push({ FileName: savedFileName }), t.push({ Mapping: r }), i = n.ControllerRequestAjaxParameter1(u, t, !1), r.ExcelCol = i.ExcelCol, r.FileName = i.FileName, ut(i), i }, y(!0), it(i), tt(), k } }(VA012, jQuery); VA012 = window.VA012 || {}, function (n) { function t() { VIS.CalloutEngine.call(this, "VA012.VA012_Contra") } var r = VIS.Logging.Level, i = VIS.Utility.Util; VIS.Utility.inheritPrototype(t, VIS.CalloutEngine); t.prototype.SetContra = function (n, t, r, u, f) { if (this.isCalloutActive()) return ""; if (this.setCalloutActive(!0), f == null) r.setValue("VA012_IsContra", !1); else { var e = i.getValueOfString(VIS.DB.executeScalar("SELECT DTD001_ChargeType FROM C_Charge WHERE  C_Charge_ID=" + f.toString())); e == "CON" ? r.setValue("VA012_IsContra", !0) : r.setValue("VA012_IsContra", !1) } return this.setCalloutActive(!1), "" }; t.prototype.SetConversionType = function (n, t, i, r, u, f) { if (this.isCalloutActive() && u == null) return ""; if (this.setCalloutActive(!0), u != null && VIS.Utility.Util.getValueOfInt(u) > 0) { var o = u.toString() + "," + i.getValue("C_Currency_ID").toString() + "," + i.getValue("StatementLineDate").toString() + "," + i.getValue("AD_Org_ID").toString(), e = VIS.dataContext.getJSONRecord("Statement/GetCashDetails", o); e != null && (e.Amount != 0 ? (i.setValue("DateAcct", e.DateAcct), i.setValue("TrxAmt", e.Amount), i.setValue("C_ConversionType_ID", e.C_ConversionType_ID), VIS.Utility.Util.getValueOfDecimal(i.getValue("StmtAmt")) == 0 && i.setValue("StmtAmt", e.Amount)) : (i.setValue("TrxAmt", 0), i.setValue("C_ConversionType_ID", 0), i.setValue("C_CashLine_ID", 0), VIS.ADialog.info("VA012_ConversionRateNotFound"))) } return this.setCalloutActive(!1), n = t = i = r = u = f = null, "" }; n.Model = n.Model || {}; n.Model.VA012_Contra = t }(VA012, jQuery)
