/*Version 2.1.5.0*/
VA012 = window.VA012 || {}, function (n, t) { function i() { function ns(n) { n != null && n != "" && (l = t(n), v.getControls(), v.setBankAndAccount(), u.newRecord(), v.getBaseCurrency(), v.loadPayments("0", "0", "PY", pt.val()), ts(), v.dragPayments(), v.dropPayments(), ro = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetAD_Column_IDForPayMethod", null)) } function ts() { ue = lf("VAS_BankStatement,Bank Statement"); le.on(VIS.Events.onTouchStartOrClick, function (n) { n.stopPropagation(); var i = wf.width(); i > 50 && t(".va012-left-content").hide(); wf.animate({ width: i > 50 ? 40 : 200 }, 300, "swing", function () { i < 50 && t(".va012-left-content").show() }) }); nr.on("change", function () { s.val("0"); v.loadBankAccount() }); s.on("change", function () { VIS.Env.getCtx().setContext($self.windowNo, "BankAccount_ID", s.val()); u.loadPayment(); u.loadCashLine(); ui.html(""); u.scheduleRefresh(); u.prepayRefresh(); u.refreshForm(); vi = 1; storepaymentdata = []; v.loadPayments(s.val() == null ? 0 : s.val(), wt.val(), ct.val(), pt.val()); ti = []; yt.html(""); yi = 1; it.loadStatement(hi); v.SetBankAccountOrganizationInContext(VIS.Utility.Util.getValueOfInt(t("option:selected", s).attr("orgid"))) }); wt.on("change", function () { ui.html(""); vi = 1; storepaymentdata = []; v.loadPayments(s.val() == null ? 0 : s.val(), wt.val(), ct.val(), pt.val()) }); ct.on("change", function () { ct.val() == "CO" ? (wt.prop("selectedIndex", 0), wt.prop("disabled", !0)) : (wt.prop("selectedIndex", 0), wt.prop("disabled", !1)); ui.html(""); u.scheduleRefresh(); u.prepayRefresh(); u.refreshForm(); vi = 1; sf = 0; ve = 50; oo = 1; storepaymentdata = []; v.loadPayments(s.val() == null ? 0 : s.val(), wt.val(), ct.val(), pt.val()) }); oe.on(VIS.Events.onTouchStartOrClick, function () { pt.val() == "" ? VIS.ADialog.info("VA012_PleaseEnterStatementDate", null, "", "") : it.statementDialog() }); se.on(VIS.Events.onTouchStartOrClick, function () { it.matchStatementDialog() }); ku.on(VIS.Events.onTouchStartOrClick, function () { it.paymentScheduleDialog() }); pe.on(VIS.Events.onTouchStartOrClick, function () { it.prepayOrderDialog() }); de.on(VIS.Events.onTouchStartOrClick, function () { si.val() != null && si.val() != "" ? (rr = !0, ti = [], yt.html(""), yi = 1, it.loadStatement(hi)) : (ti = [], yt.html(""), yi = 1, it.loadStatement(hi)) }); si.keypress(function (n) { n.which == 13 && (si.val() != null && si.val() != "" ? (rr = !0, ti = [], yt.html(""), yi = 1, it.loadStatement(hi)) : (ti = [], yt.html(""), yi = 1, it.loadStatement(hi))) }); he.on(VIS.Events.onTouchStartOrClick, function () { ti.length > 0 ? (lt(l, !0, "absolute"), t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/UnmatchStatement", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _statementLinesList: ti.toString() }), success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n[0]._status == "Success" && n[0]._statementOk != null && VIS.ADialog.info("VA012_StatementsUnmatched", null, " " + n[0]._statementOk, ""), n[0]._error != null && VIS.ADialog.info(n[0]._error, null, "", ""), n[0]._statementNo != null && VIS.ADialog.info("VA012_CompletedRecord", null, " " + n[0]._statementNo, ""), n[0]._statementNoNotUpdate != null && VIS.ADialog.info("VA012_ErrorSaving", null, " " + n[0]._statementNoNotUpdate, ""), u.scheduleRefresh(), u.prepayRefresh(), u.refreshForm(), ti = [], storepaymentdata = [], yt.html(""), yi = 1, it.loadStatement(hi), ui.html(""), u.scheduleRefresh(), u.prepayRefresh(), vi = 1, v.loadPayments(s.val(), wt.val(), ct.val(), pt.val()), lt(l, !1, "absolute")) }, error: function (n) { lt(l, !1, "absolute"); VIS.ADialog.info(n, null, "", "") } })) : VIS.ADialog.info("VA012_NoRecordSelected", null, "", "") }); ce.on(VIS.Events.onTouchStartOrClick, function () { if (s.val() == null || s.val() == "" || s.val() == "0") { VIS.ADialog.info("VA012_SelectBankAccountFirst", null, "", ""); return } lt(l, !0, "absolute"); t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/ProcessStatement", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _statementLinesList: ti.toString(), _accountID: s.val() }), success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n[0]._error != null ? VIS.ADialog.info("", null, n[0]._error, "") : n[0]._statementProcessed != null ? VIS.ADialog.info("", null, n[0]._statementProcessed + " " + VIS.Msg.getMsg("VA012_StatementsProcessed"), "") : n[0]._statementNotProcessed != null ? VIS.ADialog.info("", null, n[0]._statementNotProcessed + " " + VIS.Msg.getMsg("VA012_StatementsNotProcessed"), "") : n[0]._statementUnmatchedLines != null && VIS.ADialog.info("", null, n[0]._statementUnmatchedLines + " " + VIS.Msg.getMsg("VA012_ExistsUnmatched"), ""), u.scheduleRefresh(), u.prepayRefresh(), u.refreshForm(), storepaymentdata = [], ti = [], yt.html(""), yi = 1, it.loadStatement(hi), ui.html(""), u.scheduleRefresh(), u.prepayRefresh(), vi = 1, v.loadPayments(s.val(), wt.val(), ct.val(), pt.val()), lt(l, !1, "absolute")) }, error: function (n) { lt(l, !1, "absolute"); VIS.ADialog.info(n, null, "", "") } }) }); be.on(VIS.Events.onTouchStartOrClick, function () { ti.length > 0 || parseInt(f.attr("data-uid")) > 0 ? VIS.ADialog.confirm("VA012_WantToDelete", !0, "", "Confirm", function (n) { if (n) lt(l, !0, "absolute"), t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/DeleteStatement", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _statementLinesList: ti.toString(), _statementLineID: f.attr("data-uid") }), success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n[0]._status == "Success" && n[0]._statementProcessed != null && VIS.ADialog.info(n[0]._statementProcessed + " " + VIS.Msg.getMsg("VA012_StatementsDeleted"), null, "", ""), n[0]._statementNotProcessed != null && VIS.ADialog.info(n[0]._statementNotProcessed + " " + VIS.Msg.getMsg("VA012_StatementsNotDeleted"), null, "", ""), n[0]._error != null && VIS.ADialog.info(n[0]._error, null, "", ""), u.scheduleRefresh(), u.prepayRefresh(), u.refreshForm(), ti = [], storepaymentdata = [], yt.html(""), yi = 1, it.loadStatement(hi), ui.html(""), u.scheduleRefresh(), u.prepayRefresh(), vi = 1, v.loadPayments(s.val(), wt.val(), ct.val(), pt.val()), lt(l, !1, "absolute")) }, error: function (n) { lt(l, !1, "absolute"); VIS.ADialog.info(n, null, "", "") } }); else return }) : VIS.ADialog.info("VA012_NoRecordSelected", null, "", "") }); ui.on("scroll", v.paymentScroll); yt.on("scroll", v.statementScroll); yt.on(VIS.Events.onTouchStartOrClick, it.statementListEdit); yt.on(VIS.Events.onTouchStartOrClick, it.openStatement); yt.on(VIS.Events.onTouchStartOrClick, it.selectedStatementLinesList); ui.on(VIS.Events.onTouchStartOrClick, it.selectedScheduleList); ui.on(VIS.Events.onTouchStartOrClick, function (n) { n.target.type != "checkbox" && (t(n.target).closest(".row").find(":checkbox").is(":checked") ? t(n.target).closest(".row").find(":checkbox").prop("checked", !1) : t(n.target).closest(".row").find(":checkbox").prop("checked", !0)); i.getControl().trigger("blur", [r(i.getControl().val()), r(c.getControl().val())]) }); pt.addClass("va012-mandatory"); pt.on("change", function () { if (pt.val() == "") pt.addClass("va012-mandatory"); else { if (Globalize.format(new Date(pt.val()), "yyyy-MM-dd") > Globalize.format(new Date, "yyyy-MM-dd")) return VIS.ADialog.info("VA012_StatementDateToday", null, "", ""), pt.val(""), !1; pt.removeClass("va012-mandatory") } storepaymentdata = []; v.loadPayments(s.val() == null ? 0 : s.val(), wt.val(), ct.val(), pt.val()) }); cu.fireValueChanged = v.loadDataOnBPChanged; _btnSearchPayment.on(VIS.Events.onTouchStartOrClick, function () { v.loadAndResetPaymentData() }); _txtSearchPayment.keypress(function (n) { n.which == 13 && v.loadAndResetPaymentData() }) } function is() { var t = bo.isDecimalSeparatorDot(window.navigator.language), n = _txtSearchPayment.val(); return n == "" || t || n.contains("=") || n.contains(",") && (n = n.replace(",", ".")), n } function rs(n) { t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/getMatchRecData", contentType: "application/json; charset=utf-8", success: function (t) { if (n.html(""), n.append("<option value=0 >-<\/option>"), t = JSON.parse(t), t != null && t.length > 0) for (var i = 0; i < t.length; i++)n.append("<option value=" + t[i].Value + ">" + t[i].Name + "<\/option>") }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) } function vo(n, t) { w2ui["VA012_gridPayment_" + $self.windowNo] != null && w2ui["VA012_gridPayment_" + $self.windowNo].destroy(); var i = null; i = n.w2grid({ name: "VA012_gridPayment_" + $self.windowNo, recordHeight: 25, show: { toolbar: !1, selectColumn: !1, toolbarReload: !1, toolbarColumns: !1, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1 }, records: [], columns: [{ field: "_trxDate", caption: "Tran. Date", sortable: !1, size: "80px", display: !1 }, { field: "_trxNo", caption: "Auth Code/ Trx no.", sortable: !1, size: "30%", hidden: !1 }, { field: "_salesAmt", caption: "Trx Amount", sortable: !1, size: "15%", hidden: !1, style: "text-align: right", render: function (n) { return parseFloat(n._salesAmt).toLocaleString(window.navigator.language, { minimumFractionDigits: n._StdPrecision, maximumFractionDigits: n._StdPrecision }) } }, { field: "_netAmt", caption: "Statement Amount", sortable: !1, size: "15%", hidden: !1, style: "text-align: right", render: function (n) { return parseFloat(n._netAmt).toLocaleString(window.navigator.language, { minimumFractionDigits: n._StdPrecision, maximumFractionDigits: n._StdPrecision }) } }, { field: "_difference", caption: "Difference", sortable: !1, size: "15%", hidden: !1, style: "text-align: right" }, { field: "_chargeType", caption: "Charge Type", sortable: !1, size: "80px", display: !0 }, { field: "_taxRate", caption: "Tax Rate", sortable: !1, size: "80px", display: !0 }, { field: "_taxAmt", caption: "Tax Amt", sortable: !1, size: "15%", hidden: !1, style: "text-align: right", render: function (n) { return parseFloat(n._taxAmt).toLocaleString(window.navigator.language, { minimumFractionDigits: n._StdPrecision, maximumFractionDigits: n._StdPrecision }) } },], onChange: function () { }, onClick: function () { }, onDelete: function () { }, onSubmit: function () { } }); i.add(t) } function af(n) { if (n != null && d.length > 0) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetCurrencyandConversionType", dataType: "json", data: { _invoiceSchedules: n }, success: function (n) { var t = JSON.parse(n); (t != null || t != "") && i(t) } }); function i(n) { if (n.currencyId != 0 && d != null) { h.val(at).prop("selected", !0); for (var i = 0; h[0].length > i; i++)VIS.Utility.Util.getValueOfInt(h[0][i].value) == at ? t(h[0][i]).show() : t(h[0][i]).hide(); h.removeClass("va012-mandatory"); h.attr("disabled", !1); y.val(n.conversionTypeId).prop("selected", !0) } else h.val(at).prop("selected", !0), h.attr("disabled", !0), h.removeClass("va012-mandatory"), y.val(n.conversionTypeId).prop("selected", !0); y.trigger("change") } } else h.prop("selectedIndex", 0), h.addClass("va012-mandatory"), h.attr("disabled", !1), y.prop("selectedIndex", 0), y.addClass("va012-mandatory") } function r(n) { var t = 0; return dotFormatter = $self.dotFormatter, typeof n == "string" ? n : n = n.toString(), dotFormatter ? (n = n.contains("−") ? (-1 * gu.GetConvertedNumber(n, dotFormatter)).toString() : gu.GetConvertedNumber(n, dotFormatter).toString(), t = n != "" ? n : t) : (n = n.contains("−") && !n.contains(".") ? (-1 * gu.GetConvertedNumber(n, dotFormatter)).toString() : n.contains("−") && n.contains(".") ? (-1 * gu.GetConvertedNumber(n, dotFormatter)).toString() : gu.GetConvertedNumber(n, dotFormatter).toString(), t = n != "" ? n : t), parseFloat(t).toFixed(b) } function fe(n, i, r, u) { var f = VIS.Utility.Util.getValueOfInt(n), e, o; if (f == 0) { u(n); return } e = VIS.Utility.Util.getValueOfDecimal(i); o = VIS.Utility.Util.getValueOfInt(r); t.ajax({ url: VIS.Application.contextUrl + "VA012/BankStatement/CalculateSurcharge", type: "GET", contentType: "application/json; charset=utf-8", data: { _tax_ID: f, _chargeAmt: e, _stdPrecision: o }, success: function (n) { u(n) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) } function ee(n, t) { return t.indexOf(n) > -1 } function lt(n, i, r) { if (vf = t("<div class='vis-apanel-busy va012-busy-bank-statement'>"), vf.css({ position: r, width: "95%", height: "95%", "text-align": "center", visibility: "hidden" }), i) vf.css({ visibility: "visible" }); else { n.find(".va012-busy-bank-statement").remove(); return } n.append(vf) } var l, gu, lf, v, it, u; this.windowNo; $self = this; l = t("<div/>"); this.frame; var vf = null, nr = null, s = null, yf = null, pt = null, oe = null, se = null, wt = null, ct = null, yt = null, ui = null, pf = null, hi = "", vu = null, yu = null, rf = null, eo = null, rr = !1, ti = [], d = [], bi = [], vt = [], ou = [], su = [], he = null, ce = null, le = null, wf = null, bf = null, at = 0, b = 2, ii = !1, ur = !1, vi = 1, oo = 1, yi = 1, ae = 50, ve = 50, kf = 0, df = 0, ye = !1, so = null, f = null, gf = null, ni = null, ne = null, ci = null, er = null, nt = null, ot = null, fr = null, or = null, hu = null, p = null, i = null, c = null, w = null, k = null, pu = null, ar = null, sr = null, rt = null, ut = null, bt = null, wu = null, uf = null, iu = null, ff = null, ef = null, bu = null, of = null, ku = null, pe = null, tr = null, te = null, kt = null, we = null, be = null, yo = null, po = null, vr = null, ru = null, yr = null, uu = null, li = null, ho = null, du = null, pi = null, fi = null, ke = null, ei = null, ai = null, pr = null, wr = null, br = null, kr = null, dr = null, hr = null, cr = null, si = null, de = null, ki = null, co = null, ie = null, e = null, o = null, ge = 0, sf = 0, lo = null, st = null, dt = null, no = null, et = null, oi = null, to = null, tt = null, ri = null, wo = null, re = null, ht = null, fu = null, ue = 0, io = null, gt = null, eu = null, h = null, y = null, a = null, g = null, ft = null, gr = !1; storepaymentdata = []; gu = VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount); this.dotFormatter = VIS.Env.isDecimalPoint(); var bo = new VIS.CultureSeparator, ir = new Date, hf = ir.getFullYear() + "-" + ("0" + (ir.getMonth() + 1)).slice(-2) + "-" + ("0" + ir.getDate()).slice(-2), cf, ko, ao, go, ro = null, cu = _txtSearchPayment = _btnSearchPayment = null, uo = 0, fo = null, lu = null, nu = null, nf = null, di = null, tf = null, lr = !1, wi = null, au = null, gi = null, tu = 0; this.Initialize = function () { uo = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA012/BankStatement/GetModulePrefix", { prefix: "VA034_" }); ns(v.loadFormDesign()); c.addVetoableChangeListener(this); bt.addVetoableChangeListener(this); i.addVetoableChangeListener(this); w.addVetoableChangeListener(this) }; lf = function (n) { return VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA012/BankStatement/GetWindowforzoom", { WindowName: n }, null) }; v = { loadDataOnBPChanged: function () { ui.html(""); u.scheduleRefresh(); u.prepayRefresh(); u.refreshForm(); v.loadAndResetPaymentData() }, loadFormDesign: function () { _formDesign = t('<div class="va012-assign-content">'); divContainer = t('  <div id="VA012_mainContainer_' + $self.windowNo + '" class="va012-main-container">'); divTable = t('<table id="VA012_table_' + $self.windowNo + '" style="width: 100%;">'); tableTr = t("<tr>"); tableTd = t('<td id="VA012_tdLeft_' + $self.windowNo + '" style="width: 200px;position: relative;">   <div class="va012-left-part">              <div class="va012-left-title">                  <h4>    <i id="VA012_btnHide_' + $self.windowNo + '" class="fa fa-bars" alt="lines" style="cursor: pointer;background: rgba(var(--v-c-primary),1);"><\/i> <\/h4>              <\/div>              <div class="va012-left-content">                  <div class="va012-left-data">                      <label  id="VA012_lblBank_' + $self.windowNo + '" >' + VIS.Msg.getMsg("VA012_Bank") + '<sup style="color: red;">*<\/sup><\/label>                      <select id="VA012_cmbBank_' + $self.windowNo + '" ><\/select>                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <label  id="VA012_lblBankAccount_' + $self.windowNo + '" >' + VIS.Msg.getMsg("VA012_BankAccount") + '<sup style="color: red;">*<\/sup><\/label>                      <select id="VA012_cmbBankAccount_' + $self.windowNo + '"   ><\/select>                  <\/div>                  <!-- end of left-data -->                  <div class="va012-left-data">                      <label  id="VA012_lblStatementDate_' + $self.windowNo + '" >' + VIS.Msg.getMsg("VA012_StatementDate") + '<sup style="color: red;">*<\/sup><\/label>                      <input type="date" max="9999-12-31" id="VA012_statementDate_' + $self.windowNo + '"   >                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <a id="VA012_btnLoadStatement_' + $self.windowNo + '">' + VIS.Msg.getMsg("VA012_LoadStatement") + '<\/a>                      <a id="VA012_btnMatchStatement_' + $self.windowNo + '">' + VIS.Msg.getMsg("VA012_MatchStatement") + "<\/a>                  <\/div>                  <!-- end of left-data -->              <\/div>              <!-- end of left-content -->          <\/div>          <!-- end of left-part --> <\/td>"); tableTd1 = t('<td style="position: relative;">'); contentDiv = t('<div id="VA012_contentArea_' + $self.windowNo + '" class="va012-content-area" style="position: absolute;" >'); divMidWrap = t('<div id="VA012_middleWrap_' + $self.windowNo + '" class="va012-middle-wrap">'); divtopWrap = t('<div class="va012-mid-top-wrap" id="VA012_formBtnNewRecord_' + $self.windowNo + '">                      <div class="va012-icons-wrap">                          <span>                              <i class="va012-undo vis vis-ignore" alt="undo" title="Undo" id="VA012_btnUndo_' + $self.windowNo + '"><\/i><\/span>                          <span>                              <i class="va012-hide-show-newform vis vis-plus" activestatus="0" alt="add" title = "Expand" id="VA012_btnNewRecord_' + $self.windowNo + '"><\/i><\/span>                      <\/div>                      <!-- end of icons-wrap -->                  <\/div>'); divformWrap = t('<div class="va012-form-wrap va012-newform" id="VA012_formNewRecord_' + $self.windowNo + '" data-uid="0" style="height:55%;overflow-y:auto;width:101%;">'); divRow1 = t('<div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementNumber") + ' <sup style="color: red;">*<\/sup><\/label>                                  <input  tabindex="1" id="VA012_txtStatementNo_' + $self.windowNo + '" type="text" class="va012-input-size">                                  <i  id="VA012_btnStatementNo_' + $self.windowNo + '" class="fa fa-plus va012-add-icon"><\/i>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementPage") + '<\/label>                                  <input tabindex="2" value="1" id="VA012_txtStatementPage_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementLine") + '<\/label>                                  <input tabindex="3" value="10" id="VA012_txtStatementLine_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  '); divRow2 = t('<div class="row va012-fl-padd" style="width:102%">'); row2Col1 = t('<div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_StatementDate") + '<sup style="color: red;">*<\/sup><\/label>                                  <input tabindex="4" id="VA012_dtStatementDate_' + $self.windowNo + '" type="date" max="9999-12-31">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->'); row2Col2 = t('<div class="col-md-4 col-sm-4 va012-padd-0">'); row2Col2divAmt = t('<div class="va012-form-group va012-form-data" >'); row2Col2Lble = t("<label>" + VIS.Msg.getMsg("VA012_Amount") + '<sup style="color: red;">*<\/sup><\/label>'); row2Col2btnIn = t('<a tabindex="5" id="VA012_btnIn_' + $self.windowNo + '" v_active="1" class="va012-inout-icon va012-active">In<\/a>'); row2Col2btnOut = t('<a tabindex="6" id="VA012_btnOut_' + $self.windowNo + '" v_active="0" class="va012-inout-icon va012-inactive">Out<\/a>'); i = new VIS.Controls.VAmountTextBox("VA012_txtAmount_" + $self.windowNo + "", !1, !1, !0, 50, 100, VIS.DisplayType.Amount, VIS.Msg.getMsg("Amount")); i.setValue(0); i.getControl().addClass("va012-input-size-amt va012-right-align va012-txtamount"); row2Col2btnIcon = t('<a id="VA012_btnAmount_' + $self.windowNo + '" class="va012-info-icon"><\/a>'); row2Col3 = t('<div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_VoucherMatch") + '<sup style="color: red;">*<\/sup><\/label>                                  <select tabindex="8" id="VA012_cmbVoucherMatch_' + $self.windowNo + '">                                  <\/select>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  '); divRow3 = t('                      <div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-8 col-sm-8 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_Description") + '<\/label>                                  <input tabindex="9" id="VA012_txtDescription_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divVoucherNo_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_VoucherNo") + '<\/label>                                  <input tabindex="9" id="VA012_txtVoucherNo_' + $self.windowNo + '" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  '); divRow4 = t('<div class="row va012-fl-padd" style="width:102%">'); divRow4Col1 = t('<div class="col-md-4 col-sm-4 va012-padd-0">'); divRow4Col1TrxAmt = t('<div id="VA012_divTrxAmt_' + $self.windowNo + '" class="va012-form-group va012-form-data">'); divRow4Col1Lbl = t("<label>" + VIS.Msg.getMsg("VA012_TrxAmt") + '<sup style="color: red;">*<\/sup><\/label>'); c = new VIS.Controls.VAmountTextBox("VA012_txtTrxAmt_" + $self.windowNo + "", !1, !0, !0, 50, 100, VIS.DisplayType.Amount, VIS.Msg.getMsg("Amount")); c.getControl().addClass("va012-right-align"); c.setValue(0..toFixed(b)); divRow4Col1TrxAmt.append(divRow4Col1Lbl).append(c.getControl()); divRow4Col1.append(divRow4Col1TrxAmt); divRow4Col2 = t('<div class="col-md-4 col-sm-4 va012-padd-0">'); divRow4Col2Diff = t('<div id="VA012_divDifference_' + $self.windowNo + '" class="va012-form-group va012-form-data">'); divRow4Col2DiffLbl = t("<label>" + VIS.Msg.getMsg("VA012_Difference") + '<sup id="Ast_Difference_' + $self.windowNo + '" style="color: red;">*<\/sup><\/label>'); w = new VIS.Controls.VAmountTextBox("VA012_txtDifference_" + $self.windowNo + "", !1, !0, !0, 50, 100, VIS.DisplayType.Amount, VIS.Msg.getMsg("Amount")); w.getControl().addClass("va012-right-align"); w.setValue(0); w.getControl().trigger("blur"); divRow4Col2Diff.append(divRow4Col2DiffLbl).append(w.getControl()); divRow4Col2.append(divRow4Col2Diff); divRow4Col3 = t('<div class="col-md-4 col-sm-4 va012-padd-0">'); divRow4Col3DiffType = t('<div id="VA012_divDifferenceType_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                  <label>' + VIS.Msg.getMsg("VA012_DifferenceType") + '<sup id="Ast_DifferenceType_' + $self.windowNo + '" style="color: red;">*<\/sup><\/label>                                  <select tabindex="9" id="VA012_cmbDifferenceType_' + $self.windowNo + '">                                  <\/select>                              <\/div>                              <!-- end of form-group -->'); divRow4Col3.append(divRow4Col3DiffType); divRow4.append(divRow4Col1).append(divRow4Col2).append(divRow4Col3); divRow5 = t('<div class="row va012-fl-padd" style="width:102%">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divContraType_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_ContraType") + '<sup id="Ast_ContraType_' + $self.windowNo + '" style="color: red;">*<\/sup><\/label><\/label>                                      <select tabindex="10" id="VA012_cmbContraType_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCashBook_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_CashBook") + '<\/label>                                      <select tabindex="10" id="VA012_cmbCashBook_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <div id="VA012_divCtrlCashLine_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_CashJournalLine") + '<sup id="Ast_CashJournalLine_' + $self.windowNo + '" style="color: red;">*<\/sup><\/label>                                      <div id="VA012_ctrlCashLine_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCheckNo_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_CheckNo") + '<\/label>                                      <input  disabled tabindex="12" id="VA012_txtCheckNo_' + $self.windowNo + '" type="text">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->  '); divRow6 = t('<div class="row va012-fl-padd" style="width:102%">'); divRow6Col1 = t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCharge_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_Charge") + '<sup class="astric_' + $self.windowNo + '" style="color: red;">*<\/sup><\/label>                                      <div style=" position: relative; float: left; width: 100%; ">                                      <input tabindex="10" chargeid="" type="text" id="VA012_txtCharge_' + $self.windowNo + '" style=" width: 100%; ">                                      <img id="VA012_btnCharge_' + $self.windowNo + '" class="VA012-img-combo" alt="">                                     <\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->'); divRow6Col2 = t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divTaxRate_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_TaxRate") + '<sup class="astric_' + $self.windowNo + '" style="color: red;">*<\/sup><\/label>                                      <select tabindex="11" id="VA012_cmbTaxRate_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->'); divRow6Col3 = t('<div class="col-md-4 col-sm-4 va012-padd-0">'); divRow6Col3divTax = t('<div id="VA012_divTaxAmount_' + $self.windowNo + '" class="va012-form-group va012-form-data">'); divRow6Col3divTaxLbl = t("<label>" + VIS.Msg.getMsg("VA012_TaxAmount") + "<\/label>"); bt = new VIS.Controls.VAmountTextBox("VA012_txtTaxAmount_" + $self.windowNo + "", !1, !0, !0, 50, 100, VIS.DisplayType.Amount, VIS.Msg.getMsg("Amount")); bt.setValue(0); bt.getControl().addClass("va012-right-align"); divRow6Col3divTax.append(divRow6Col3divTaxLbl).append(bt.getControl()); divRow6Col3.append(divRow6Col3divTax); divRow6.append(divRow6Col1).append(divRow6Col2).append(divRow6Col3); divRow7 = t('<div class="row va012-fl-padd" style="width:102%">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlPayment_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_Payment") + '<\/label>                                      <div id="VA012_ctrlPayment_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlInvoice_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_Invoice") + '<\/label>                                      <div id="VA012_ctrlInvoice_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlBusinessPartner_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_BusinessPartner") + '<\/label>                                      <div id="VA012_ctrlBusinessPartner_' + $self.windowNo + '" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->  '); divRow8 = t('<div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPaymentSchedule_' + $self.windowNo + '" class="va012-form-data" >                              <label>' + VIS.Msg.getMsg("VA012_PaymentSchedules") + '<\/label>                              <input disabled id="VA012_txtPaymentSchedule_' + $self.windowNo + '" type="text" class="va012-input-size">                              <a tabindex="13"  id="VA012_btnPaymentSchedule_' + $self.windowNo + '" class="va012-edit-icon"><\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPrepayOrder_' + $self.windowNo + '" class="va012-form-data" >                              <label>' + VIS.Msg.getMsg("VA012_PrepayOrders") + '<\/label>                              <div id="VA012_ctrlOrder_' + $self.windowNo + '"><\/div>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divTrxOrg_' + $self.windowNo + '" class="va012-form-data" >                              <label>' + VIS.Msg.getMsg("VA012_TrxOrg") + '<\/label>                              <div id="VA012_ctrlTrxOrg_' + $self.windowNo + '"><\/div>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  '); divRow9 = t('<div class="row va012-fl-padd" style="width:102%">                       <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-check">                                  <input tabindex="13" id="VA012_chkUseNextTime_' + $self.windowNo + '" type="checkbox">                                  <label style="position: absolute;">' + VIS.Msg.getMsg("VA012_UseNextTime") + '<\/label>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-2 col-sm-2 va012-padd-0" >                              <div class="va012-form-data" id="VA012_divMore_' + $self.windowNo + '">                                  <a tabindex="14" visiblestatus="0" class="va012-more" id="VA012_btnMore_' + $self.windowNo + '" href="#">' + VIS.Msg.getMsg("VA012_More") + '<\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-6 col-sm-6 va012-padd-0" >                          <div style="float:right;">                              <a tabindex="15" title="Save Record" id="VA012_btnSave_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" style=" float: left;">' + VIS.Msg.getMsg("VA012_SaveandNew") + "<\/a>                          <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->"); divRow10 = t('<div class="row va012-fl-padd" style="width:102%">'); divRow10Col1 = t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCurrency_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_Currency") + '<sup style="color: red;">*<\/sup><\/label>                                      <select tabindex="10" id="VA012_txtCurrency_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->'); divRow10Col2 = t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divConversionType_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_ConversionType") + '<sup style="color: red;">*<\/sup><\/label>                                      <select tabindex="11" id="VA012_txtConversionType_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->'); divRow10Col3 = t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divPaymentMethod_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_PaymentMethod") + '<sup style="color: red;">*<\/sup><\/label>                                      <select tabindex="16" id="VA012_txtPaymentMethod_' + $self.windowNo + '">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->'); divRow10.append(divRow10Col1).append(divRow10Col2).append(divRow10Col3); divRow11 = t('<div class="row va012-fl-padd" style="width:102%">'); divRow11Col1 = t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCheckNum_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_CheckNo") + '<sup style="color: red;">*<\/sup><\/label>                                      <input tabindex="17" id="VA012_txtCheckNum_' + $self.windowNo + '" type="text">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->'); divRow11Col2 = t('<div class="col-md-4 col-sm-4 va012-padd-1">                                  <div id="VA012_divCheckDate_' + $self.windowNo + '" class="va012-form-group va012-form-data">                                      <label>' + VIS.Msg.getMsg("VA012_CheckDate") + '<sup style="color: red;">*<\/sup><\/label>                                      <input tabindex="18" id="VA012_txtCheckDate_' + $self.windowNo + '" type="date" max="9999-12-31">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->'); divRow11.append(divRow11Col1).append(divRow11Col2); payHeaderWrap = t('<div id="VA012_paymentHeaderWrap_' + $self.windowNo + '" class="va012-payment-header-wrap">                      <div class="va012-headersearchfilter">                           <div class="va012-searchfilter">                              <select id="VA012_cmbTransactionType_' + $self.windowNo + '">                             <option value="PY">' + VIS.Msg.getMsg("VA012_Payments") + '<\/option>                             <option value="PO">' + VIS.Msg.getMsg("VA012_PrepayOrders") + '<\/option>                              <option value="IS">' + VIS.Msg.getMsg("VA012_InvoiceSchedule") + '<\/option>                              <option value="CO">' + VIS.Msg.getMsg("VA012_Contra") + '<\/option>                              <\/select>                          <\/div>                          <div class="va012-searchfilter">                              <select id="VA012_cmbSearchPaymentMethod_' + $self.windowNo + '">                              <\/select>                          <\/div>                       <div id=VA012_DivBusinessPartner_' + $self.windowNo + ' class="va012-searchfilter">                       <\/div>                       <div class="VA012-search-wrap va012-searchfilter">                        <input value = "" placeholder="' + VIS.Msg.getMsg("VA012_Search") + '..." type = "text" id = VA012_txtSearch_Payment_' + $self.windowNo + '>                        <a class= "va012-search-icon va012-search-icon-right" id = VA012_btnSearch_Payment_' + $self.windowNo + ' title="' + VIS.Msg.getMsg("VA012_SearchTitle") + '"> <span class="glyphicon glyphicon-search"><\/span><\/a >                       <\/div>                          <\/div>                      <\/div>                      <!-- end of payment-header-wrap -->                  <div id="VA012_paymentList_' + $self.windowNo + '" class="va012-payment-list">                                           <div class="va012-payment-content" id="VA012_lstPayments_' + $self.windowNo + '">                   <\/div>                  <\/div>                  <!-- end of payment-list -->                <\/div>'); rightWrap = t('<div id="VA012_rightWrap_' + $self.windowNo + '" class="va012-right-wrap">                  <div id="VA012_rightTop_' + $self.windowNo + '" class="va012-right-top">                      <div class="row">                          <div class="col-md-3 col-sm-3" style=" padding-right: 5px; ">                              <div class="va012-pay-text" id="VA012_secReconciled_' + $self.windowNo + '" >                                <p>' + VIS.Msg.getMsg("VA012_Reconciled") + '<\/p>                                <p style="margin-top: 4px;">' + VIS.Msg.getMsg("VA012_Unreconciled") + '<\/p>                              <\/div>                          <\/div>                          <!-- end of col -->                          <div class="col-md-9 col-sm-9" style=" padding-left: 5px; ">                              <div class="va012-pay-text" id="VA012_secUnreconciled_' + $self.windowNo + '">                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-green"><span class="va012-base-curr"><\/span> 0<\/span>                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-red"><span class="va012-base-curr"><\/span> 0<\/span>                              <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                      <div class="row">                          <div class="col-md-12 col-sm-12" style=" padding-left: 5px; ">                      <div style=" /* float: right; */ padding-left: 10px;">                               <a id="VA012_btnUnmatch_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" title="Show Unmatched Record" style=" float: left; ">' + VIS.Msg.getMsg("VA012_Unmatch") + '<\/a>                              <a id="VA012_btnProcess_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" title="Clear Matched Record" style=" float: left; margin-left: 5px; ">' + VIS.Msg.getMsg("VA012_Process") + '<\/a>                             <a id="VA012_btnDelete_' + $self.windowNo + '" class="va012-frm-btn va012-btn-blue" title="Delete Selected Record" style=" float: left; margin-left: 5px; ">' + VIS.Msg.getMsg("VA012_Delete") + '<\/a>                       <\/div>                           <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <div class="row">                          <div class="col-md-12 col-sm-12" style=" padding-right: 5px; ">                           <div class="va012-right-search">                            <div class="va012-search-wrap">                               <input id="VA012_txtSearch_' + $self.windowNo + '" value="" placeholder="' + VIS.Msg.getMsg("VA012_Search") + '..." type="text">                               <a id="VA012_btnSearch_' + $self.windowNo + '" class="va012-search-icon"><span class="glyphicon glyphicon-search"><\/span><\/a>                          <\/div>                      <!-- end of search-wrap -->                         <\/div>                  <!-- end of right-search -->                        <\/div>                       <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <\/div>                  <!-- end of right-top -->                    <div class="va012-right-content" id="VA012_lstStatement_' + $self.windowNo + '">                  <\/div>                  <!-- end of right-content -->              <\/div>'); row2Col2divAmt.append(row2Col2Lble).append(row2Col2btnIn).append(row2Col2btnOut).append(i.getControl()).append(row2Col2btnIcon); row2Col2.append(row2Col2divAmt); divRow2.append(row2Col1).append(row2Col2).append(row2Col3); divformWrap.append(divRow1).append(divRow2).append(divRow10).append(divRow11).append(divRow3).append(divRow4).append(divRow5).append(divRow6).append(divRow7).append(divRow8).append(divRow9); var n = "C_BPartner.IsActive='Y' AND C_BPartner.IsSummary ='N' AND C_BPartner.AD_Org_ID IN(0,@BankAccount_Org_ID@) AND C_BPartner.AD_Client_ID = " + VIS.context.getAD_Client_ID(), r = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 3499, VIS.DisplayType.Search, "C_BPartner_ID", 0, !1, n); return cu = new VIS.Controls.VTextBoxButton("C_BPartner_ID", !0, !1, !0, VIS.DisplayType.Search, r), divMidWrap.append(divtopWrap).append(divformWrap).append(payHeaderWrap), t(payHeaderWrap).find("#VA012_DivBusinessPartner_" + $self.windowNo).append(cu.getControl().attr("id", "C_BPartner_ID_" + $self.windowNo).addClass("BPSearchText").attr("placeholder", VIS.Msg.getMsg("VA012_BusinessPartner"))).append(cu.getBtn(0).addClass("btnBPSearch")), contentDiv.append(divMidWrap).append(rightWrap), tableTd1.append(contentDiv), tableTr.append(tableTd).append(tableTd1), cf = t('<div  id="VA012_gridMatchStatePopUp_' + $self.windowNo + '"" style="display:block;width:auto;height:auto"><div  style="    width: 50%;float: left;" ><label>' + VIS.Msg.getMsg("VA012_ChargeType") + '<\/label><div  id="VA012_ChargeSrch_' + $self.windowNo + '"><\/div><\/div><div ><label>' + VIS.Msg.getMsg("VA012_Taxrate") + '<\/label><select  id="VA012_cmbTaxRate_' + $self.windowNo + '"><\/select><\/div><div style="width:auto;height:270px" id="VA012_gridMatchState_' + $self.windowNo + '""><\/div><\/div>'), ko = cf.find("#VA012_gridMatchState_" + $self.windowNo), ao = cf.find("#VA012_ChargeSrch_" + $self.windowNo), go = cf.find("#VA012_cmbTaxRate_" + $self.windowNo), _ChargeLookUp = VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(), $self.windowNo, 3787, VIS.DisplayType.Search), $ChargeControl = new VIS.Controls.VTextBoxButton("C_Charge_ID", !0, !1, !0, VIS.DisplayType.Search, _ChargeLookUp), ao.append($ChargeControl.getControl().css("width", "93%")).append($ChargeControl.getBtn(0).css("width", "30px").css("height", "30px").css("padding", "0px").css("border-color", "#BBBBBB")), divTable.append(tableTr), _formDesign.append(divContainer).append(divTable), _formDesign }, setBankAndAccount: function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/SetBankAndAccount", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n != null && (df = n.Table[0].C_BANK_ID, kf = n.Table[0].C_BANKACCOUNT_ID)); v.loadBank() } }) }, addEffect: function (n, t, i) { var r = { to: t, className: "wsp-ui-effects-transfer" }; n.effect("transfer", r, 600, i) }, setInvoiceAndBPartner: function (n, i) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/SetInvoiceAndBPartner", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _paymentID: n, _cmbTransactionType: i }, success: function (n) { n != null && n != "" && (n = t.parseJSON(t.parseJSON(n)), i == "PY" ? (n._invoiceID > 0 ? gt.setValue(n._invoiceID, !1, !0) : gt.setValue(), n._bPartnerID > 0 ? ht.setValue(n._bPartnerID, !1, !0) : ht.setValue(), n.count == 1 && n.VA034_DepositSlipNo != "" && ar.val(n.VA034_DepositSlipNo)) : i == "PO" ? ht.value || ht.setValue(n._bPartnerID, !1, !0) : i == "IS" && (ht.value || ht.setValue(n._bPartnerID, !1, !0))) } }) }, setBPartner: function (n) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/SetBPartner", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _invoiceID: n }, success: function (n) { n != null && n != "" && (n = t.parseJSON(n), n > 0 ? ht.setValue(n, !1, !0) : ht.setValue()) } }) }, getMaxStatement: function (n) { s.val() > 0 ? t.ajax({ url: VIS.Application.contextUrl + "BankStatement/MaxStatement", type: "GET", datatype: "json", data: { _bankAccount: s.val() == null ? 0 : s.val(), _origin: n, _pageNo: 0 }, contentType: "application/json; charset=utf-8", success: function (n) { n != null && n != "" && (n = t.parseJSON(t.parseJSON(n)), ni.val(n.statementNo), ci.val(n.pageno), er.val(n.lineno)) } }) : (ni.val("0"), ci.val("0"), er.val("0")) }, getOverUnderPayment: function (n) { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/getOverUnderPayment", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _paymentID: n }, success: function (n) { n != null && n != "" && (n = t.parseJSON(t.parseJSON(n)), n._difference != 0 && (w.setValue(VIS.Utility.Util.getValueOfDecimal(Math.abs(n._difference))), pi.find("*").prop("disabled", !1), k.val(n._differenceType).prop("selected", !0), w.getControl().attr("vchangable", "N"), p.val() == "M" && c.setValue(VIS.Utility.Util.getValueOfDecimal(n._payamt.toFixed(b))))) } }) }, getControls: function () { nr = l.find("#VA012_cmbBank_" + $self.windowNo); s = l.find("#VA012_cmbBankAccount_" + $self.windowNo); yf = l.find("#VA012_STAT_cmbBankAccountClassName_" + $self.windowNo); pt = l.find("#VA012_statementDate_" + $self.windowNo); so = l.find("#VA012_BankChargeDiv" + $self.windowNo); wt = l.find("#VA012_cmbSearchPaymentMethod_" + $self.windowNo); ct = l.find("#VA012_cmbTransactionType_" + $self.windowNo); oe = l.find("#VA012_btnLoadStatement_" + $self.windowNo); se = l.find("#VA012_btnMatchStatement_" + $self.windowNo); yt = l.find("#VA012_lstStatement_" + $self.windowNo); ui = l.find("#VA012_lstPayments_" + $self.windowNo); pf = l.find("#VA012_paymentList_" + $self.windowNo); vu = l.find("#VA012_secReconciled_" + $self.windowNo); yu = l.find("#VA012_secUnreconciled_" + $self.windowNo); si = l.find("#VA012_txtSearch_" + $self.windowNo); de = l.find("#VA012_btnSearch_" + $self.windowNo); he = l.find("#VA012_btnUnmatch_" + $self.windowNo); ce = l.find("#VA012_btnProcess_" + $self.windowNo); le = l.find("#VA012_btnHide_" + $self.windowNo); wf = l.find("#VA012_tdLeft_" + $self.windowNo); bf = l.find("#VA012_table_" + $self.windowNo); ki = l.find("#VA012_btnMore_" + $self.windowNo); co = l.find("#VA012_divMore_" + $self.windowNo); vr = l.find("#VA012_divContraType_" + $self.windowNo); ru = l.find("#VA012_divCashBook_" + $self.windowNo); _divCtrlCashLine = l.find("#VA012_divCtrlCashLine_" + $self.windowNo); yr = l.find("#VA012_divTransferType_" + $self.windowNo); uu = l.find("#VA012_divCheckNo_" + $self.windowNo); li = l.find("#VA012_divVoucherNo_" + $self.windowNo); ho = l.find("#VA012_divTrxAmt_" + $self.windowNo); du = l.find("#VA012_divDifference_" + $self.windowNo); pi = l.find("#VA012_divDifferenceType_" + $self.windowNo); fi = l.find("#VA012_divCharge_" + $self.windowNo); ke = l.find("#VA012_btnCharge_" + $self.windowNo); ei = l.find("#VA012_divTaxRate_" + $self.windowNo); ai = l.find("#VA012_divTaxAmount_" + $self.windowNo); pr = l.find("#VA012_divCtrlPayment_" + $self.windowNo); wr = l.find("#VA012_divCtrlInvoice_" + $self.windowNo); br = l.find("#VA012_divCtrlBusinessPartner_" + $self.windowNo); kr = l.find("#VA012_divPrepayOrder_" + $self.windowNo); dr = l.find("#VA012_divPaymentSchedule_" + $self.windowNo); _divPaymentMethod = l.find("#VA012_divPaymentMethod_" + $self.windowNo); hr = l.find("#VA012_divCheckNum_" + $self.windowNo); cr = l.find("#VA012_divCheckDate_" + $self.windowNo); _txtSearchPayment = l.find("#VA012_txtSearch_Payment_" + $self.windowNo); _btnSearchPayment = l.find("#VA012_btnSearch_Payment_" + $self.windowNo); nu = l.find("#VA012_divTrxOrg_" + $self.windowNo) }, getBaseCurrency: function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetBaseCurrency", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", success: function (n) { n != null && n != "" && (n = t.parseJSON(t.parseJSON(n)), rf = n._code, eo = n._id, t(".va012-base-curr").text(rf)) } }) }, loadBank: function () { function n(n) { if (nr.html(""), nr.append("<option value=0 ><\/option>"), n != null) for (var t = 0; t < n.length; t++)nr.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].Value) + ">" + n[t].Name + "<\/option>"); nr.prop("selectedIndex", 0); df > 0 && (nr.val(df).prop("selected", !0), df = 0); v.loadBankAccount() } t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetBank", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", success: function (i) { i != null && i != "" && (_ds = t.parseJSON(i), n(_ds)) } }) }, loadBankAccount: function () { function n(n) { if (s.html(""), s.append("<option value=0 ><\/option>"), n != null) for (var t = 0; t < n.length; t++)s.append("<option orgid=" + VIS.Utility.Util.getValueOfInt(n[t].OrgId) + " stdprecision=" + VIS.Utility.Util.getValueOfInt(n[t].StdPrecision) + " currencyid=" + VIS.Utility.Util.getValueOfInt(n[t].CurrencyId) + " value=" + VIS.Utility.Util.getValueOfInt(n[t].BankAccountId) + " accounttype=" + VIS.Utility.Util.getValueOfString(n[t].AccountType) + ">" + VIS.Utility.encodeText(n[t].AccountNo) + "<\/option>"); s.prop("selectedIndex", 0); kf > 0 && (s.val(kf).prop("selected", !0), kf = 0); v.getMaxStatement("LO"); v.loadSearchPaymentMethod() } t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetBankAccount", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { bankId: nr.val() }, success: function (i) { i != null && i != "" && (i = t.parseJSON(i), n(i)) } }) }, SetBankAccountOrganizationInContext: function (n) { VIS.Env.getCtx().setContext($self.windowNo, "BankAccount_Org_ID", n) }, LoadPaymentsPages: function (n, i, r) { rr = si.val() != null && si.val() != "" ? !0 : !1; t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadPaymentsPages", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _accountID: n, _paymentPageNo: vi, _PAGESIZE: ve, _paymentMethodID: i, _transactionType: r, businessPartnerId: cu.value, txtSearch: _txtSearchPayment.val() }, success: function (n) { n != null && n != "" && (sf = JSON.parse(n)) } }) }, loadPayments: function (n, i, r, u) { function e(n) { var u, i, f, e; if (n = t.parseJSON(n), n.length > 0 && (storepaymentdata = storepaymentdata.concat(n)), n = storepaymentdata, u = "", ui.html(""), n != null && n.length > 0) for (i = 0; i < n.length; i++)f = new Date(n[i].DateAcct).toLocaleDateString(), e = "va012-red-color", e = n[i].c_bankstatementline_id == null || n[i].c_bankstatementline_id == "0" || n[i].c_bankstatementline_id == 0 ? "va012-red-color" : "va012-green-color", u = "", u = '<div class="drag-no-drag"><div draggable="true" class="va012-mid-data-wrap ', (r == "PY" || r == "CO") && (u += e), u += ' " paymentdata="' + VIS.Utility.encodeText(new Date(n[i].DueDate).toLocaleDateString()) + "_" + VIS.Utility.encodeText(n[i].DueAmt) + '" data-uid="' + n[i].c_payment_id, u += ' " paymentamount = " ' + VIS.Utility.Util.getValueOfDecimal(n[i].convertedamount, "N") + '" paymentmethodid="' + VIS.Utility.Util.getValueOfInt(n[i].PaymentMethodId) + '" paymentbasetype="' + VIS.Utility.Util.getValueOfString(n[i].PaymentBaseType) + '"><div class="va012-payment-wrap" ><div class="row"> <div class="col-md-3 col-sm-3">    <div class="va012-form-check">        <input type="checkbox" data-uid="' + n[i].c_payment_id + '"  >    <div title="' + VIS.Msg.getMsg("VA012_PaymentAmount") + '" class="va012-inside-form-check" style=" float: left; width: 85%; ">      <label style=" width: 100%; ">' + n[i].currency + " " + parseFloat(n[i].paymentamount).toLocaleString(navigator.language, { minimumFractionDigits: b, maximumFractionDigits: b }) + "<\/label>", n[i].isconverted == "Y" && (u += "      <span>" + n[i].basecurrency + " " + parseFloat(n[i].convertedamount).toLocaleString(navigator.language, { minimumFractionDigits: b, maximumFractionDigits: b }) + "<\/span>"), u += '   <\/div><\/div>    <!-- end of form-group -->  <\/div>  <!-- end of col -->  <div class="col-md-4 col-sm-4">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Business Partner">' + VIS.Utility.encodeText(n[i].businesspartner) + '<\/p>         <span title="' + VIS.Msg.getMsg("VA012_InvReference") + '">' + VIS.Utility.encodeText(n[i].bpgroup) + '<\/span>       <span title="Document No.">' + VIS.Utility.encodeText(n[i].paymentno) + '<\/span>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col --> <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text"><p title="Payment Type">' + VIS.Utility.encodeText(n[i].paymenttype) + "<\/p><\/div><\/div><!-- end of form-group --><\/div><!-- end of col -->", u += r == "PY" && uo > 0 ? '  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Deposit Slip No">' + VIS.Utility.encodeText(n[i].depositslipno) + '<\/p>           <p title="Authentication Code">' + VIS.Utility.encodeText(n[i].authcode) + '<\/p>           <p title="Account Date">' + f + '<\/p>           <p title="Payment Method">' + n[i].PaymentMethod + "<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->" : '  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Authentication Code">' + VIS.Utility.encodeText(n[i].authcode) + '<\/p>           <p title="Account Date">' + f + '<\/p>           <p title="Payment Method">' + n[i].PaymentMethod + "<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->", u += "<\/div><!-- end of row --><\/div> <!-- end of payment-wrap --><\/div> <!-- end of mid-data-wrap -->", ui.append(u); _sql = null; v.setPaymentListHeight(); v.dragPayments() } if (n > 0) { lt(t(pf), !0, "inherit"); var f = is(); window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadPayments", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { _accountID: n, _paymentPageNo: vi, _PAGESIZE: ae, _paymentMethodID: i, _transactionType: r, statementDate: u == null || u == "" ? new Date : u, businessPartnerId: cu.value, txtSearch: f }, success: function (n) { n != null && n != "" && (e(n), lt(t(pf), !1, "inherit")) }, error: function () { lt(t(pf), !1, "inherit") } }) }, 2) } }, setPaymentListHeight: function () { var n; clearTimeout(n); n = setTimeout(function () { t("#VA012-content-area" + $self.windowNo).height(t("#VA012_mainContainer_" + $self.windowNo).height() - 20); kt.attr("activestatus") == "1" ? t("#VA012_paymentList_" + $self.windowNo).height(t("#VA012_middleWrap_" + $self.windowNo).height() - t("#VA012_formBtnNewRecord_" + $self.windowNo).height() - t("#VA012_formNewRecord_" + $self.windowNo).height() - t("#VA012_paymentHeaderWrap_" + $self.windowNo).height() - 42) : t("#VA012_paymentList_" + $self.windowNo).height(t("#VA012_middleWrap_" + $self.windowNo).height() - t("#VA012_formBtnNewRecord_" + $self.windowNo).height() - t("#VA012_paymentHeaderWrap_" + $self.windowNo).height() - 27) }, 2) }, loadSearchPaymentMethod: function () { function n(n) { if (lu = n, wt.html(""), wt.append("<option value=0 >" + VIS.Msg.getMsg("VA012_SelectPaymentMethod") + "<\/option>"), n != null) for (var t = 0; t < n.length; t++)wt.append("<option value=" + n[t].chargeID + ">" + VIS.Utility.encodeText(n[t].name) + "<\/option>"); wt.prop("selectedIndex", 0); s.trigger("change") } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetPaymentMethods", null, n) }, paymentScroll: function () { sf = 0; t(this).scrollTop() + t(this).innerHeight() + 2 >= this.scrollHeight && (v.LoadPaymentsPages(s.val(), wt.val(), ct.val()), vi < sf && (ye && vi != 1 ? (vi = 1, ye = !1) : vi++, v.loadPayments(s.val(), wt.val(), ct.val(), pt.val()))) }, statementScroll: function () { ge = 0; t(this).scrollTop() > 0 && t(this).scrollTop() + t(this).innerHeight() + 1 >= this.scrollHeight && (it.LoadStatementsPages(), yi < ge && (yi++, it.loadStatement(hi))) }, dragPayments: function () { ui.find(".va012-mid-data-wrap").draggable({ start: function (n, t) { t.helper.addClass("va012-dragging") }, drag: function () { }, stop: function (n, t) { t.helper.removeClass("va012-dragging") }, cursor: "move", cursorAt: { left: 5 }, revert: "invalid", helper: "clone" }) }, dropPayments: function () { yt.find(".va012-right-data-wrap").droppable({ hoverClass: "va012-dropping", drop: function (n, s) { var a, g, h, l, w, k, p; if (t(s.draggable).data("uid") > 0 && t(this).data("uid") > 0) { if (ct.val() == "PY") { if (a = t(s.draggable).data("uid"), t(s.draggable).hasClass("va012-green-color")) { VIS.ADialog.info("VA012_PaymentAlreadyMatchedOthrStatement", null, "", ""); return } gi = VIS.Utility.Util.getValueOfString(t(s.draggable).attr("paymentbasetype")); tu = VIS.Utility.Util.getValueOfInt(t(s.draggable).attr("paymentmethodid")); p = t(this).data("uid"); v.checkPaymentCondition(t(s.draggable).data("uid"), t(this).data("uid"), r(i.getControl().val())) && (it.statementOpenEdit(t(this).data("uid"), a), window.setTimeout(function () { if (r(c.getControl().val()) == 0) { var n = nt.val(); u.refreshForm(); nt.val(n); VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } nt.attr("readonly", !0); ii = !0; tt.setValue(a, !1, !0); y.val() > 0 ? y.attr("disabled", !0) : y.attr("disabled", !1); v.setInvoiceAndBPartner(t(s.draggable).data("uid"), "PY"); ii = !1 }, 500)) } else if (ct.val() == "IS") { if (g = t(s.draggable).data("uid"), parseInt(f.attr("data-uid")) != t(this).data("uid") && u.scheduleRefresh(), gi = VIS.Utility.Util.getValueOfString(t(s.draggable).attr("paymentbasetype")), tu = VIS.Utility.Util.getValueOfInt(t(s.draggable).attr("paymentmethodid")), v.checkScheduleCondition(t(s.draggable).data("uid"), t(this).data("uid"), d.toString(), r(i.getControl().val()))) { if (ee(parseInt(t(s.draggable).data("uid")), d)) VIS.ADialog.info("VA012_AlreadySelected", null, "", ""); else if (d.push(parseInt(t(s.draggable).data("uid"))), bi.push(t(s.draggable).attr("paymentdata")), vt.push(t(s.draggable).attr("paymentamount")), Number(vt[0]) == "0") { for (h = 0, l = 0; l < vt.length; l++)h += VIS.Utility.Util.getValueOfDecimal(vt[l]); h < 0 ? (o.removeClass("va012-inactive"), o.addClass("va012-active"), o.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")) : (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), o.removeClass("va012-active"), o.addClass("va012-inactive"), o.attr("v_active", "0")); i.setValue(VIS.Utility.Util.getValueOfDecimal(h.toFixed(b))) } ii = !0; it.statementOpenEdit(t(this).data("uid"), g); tr.val(bi.toString()); window.setTimeout(function () { if (r(c.getControl().val()) == 0) { var n = nt.val(); u.refreshForm(); u.scheduleRefresh(); nt.val(n); VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } v.setInvoiceAndBPartner(t(s.draggable).data("uid"), "IS"); nt.attr("readonly", !0); vt.length == 1 && (vt[0] = VIS.Utility.Util.getValueOfString(r(c.getControl().val()))); c.getControl().trigger("blur", [r(i.getControl().val()), r(c.getControl().val())]) }, 500) } } else ct.val() == "PO" && (w = t(s.draggable).data("uid"), parseInt(f.attr("data-uid")) != t(this).data("uid") && u.prepayRefresh(), gi = VIS.Utility.Util.getValueOfString(t(s.draggable).attr("paymentbasetype")), tu = VIS.Utility.Util.getValueOfInt(t(s.draggable).attr("paymentmethodid")), v.checkPrepayCondition(t(s.draggable).data("uid"), t(this).data("uid"), ou.toString(), r(i.getControl().val())) && (it.statementOpenEdit(t(this).data("uid"), w), window.setTimeout(function () { if (r(c.getControl().val()) == 0) { var n = nt.val(); u.refreshForm(); u.prepayRefresh(); nt.val(n); VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } nt.attr("readonly", !0); ii = !0; st.setValue(w, !1, !0); ii = !1; v.setInvoiceAndBPartner(t(s.draggable).data("uid"), "PO") }, 500))); if (ct.val() == "CO") { if (k = t(s.draggable).data("uid"), t(s.draggable).hasClass("va012-green-color")) { VIS.ADialog.info("VA012_CashLineAlreadyMatchedOthrStmt", null, "", ""); return } gi = VIS.Utility.Util.getValueOfString(t(s.draggable).attr("paymentbasetype")); tu = VIS.Utility.Util.getValueOfInt(t(s.draggable).attr("paymentmethodid")); p = t(this).data("uid"); v.checkContraCondition(t(s.draggable).data("uid"), t(this).data("uid"), r(i.getControl().val())) && (it.statementOpenEdit(p, k), window.setTimeout(function () { if (r(c.getControl().val()) == 0) { var n = nt.val(); u.refreshForm(); nt.val(n); VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } nt.attr("readonly", !0); ii = !0; et.setValue(k, !1, !0); ii = !1 }, 500)) } } } }); f.droppable({ hoverClass: "va012-dropping", drop: function (n, u) { var f, w, h, l, k, y, g; if (t(u.draggable).data("uid") > 0) { if (gi = VIS.Utility.Util.getValueOfString(t(u.draggable).attr("paymentbasetype")), tu = VIS.Utility.Util.getValueOfInt(t(u.draggable).attr("paymentmethodid")), ct.val() == "CO") if (p.val() == "C") { if (ot.val() != "CB") { VIS.ADialog.info("VA012_ContraSelectCashToBank", null, "", ""); return } } else { VIS.ADialog.info("VA012_SelectVoucherContra", null, "", ""); return } else if (p.val() != "M") { VIS.ADialog.info("VA012_SelectVoucherPayment", null, "", ""); return } if (ct.val() == "PY") { if (t(u.draggable).hasClass("va012-green-color")) { VIS.ADialog.info("VA012_PaymentAlreadyMatchedOthrStatement", null, "", ""); return } if (t(u.draggable).data("uid") > 0) if (VIS.Utility.Util.getValueOfInt(ri) == 0) tt.setValue(t(u.draggable).data("uid"), !1, !0); else { VIS.Utility.Util.getValueOfInt(ri) == VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid")) ? VIS.ADialog.info("VA012_AlreadySelected", null, "", "") : VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord", null, "", ""); return } } if (ct.val() == "IS" && v.checkScheduleCondition(t(u.draggable).data("uid"), t(this).attr("data-uid"), "", r(i.getControl().val()))) { if (h = 0, ee(parseInt(t(u.draggable).data("uid")), d)) { VIS.ADialog.info("VA012_AlreadySelected", null, "", ""); return } if (f = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetConvtAmount", { recordID: parseInt(t(u.draggable).data("uid")), bnkAct_Id: s.val(), transcType: ct.val(), stmtDate: nt.val() }), f.length == 0 || f[0].DueAmount == 0) { VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } if (w = t(this).attr("data-uid"), d.push(parseInt(t(u.draggable).data("uid"))), bi.push(t(u.draggable).attr("paymentdata")), vt.push(f[0].DueAmount), h = 0, Number(vt.length) > 0) for (l = 0; l < vt.length; l++)h += VIS.Utility.Util.getValueOfDecimal(vt[l]); h < 0 ? (o.removeClass("va012-inactive"), o.addClass("va012-active"), o.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")) : (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), o.removeClass("va012-active"), o.addClass("va012-inactive"), o.attr("v_active", "0"), h > 0 && i.getControl().removeClass("va012-mandatory")); w == 0 ? i.setValue(VIS.Utility.Util.getValueOfDecimal(h.toFixed(b))) : nt.attr("readonly", !0); v.setInvoiceAndBPartner(t(u.draggable).data("uid"), "IS"); !gr && wi ? (t(a[0]).children("option").each(function () { t(this).attr("paymentbasetype") == "S" ? t(this).show() : t(this).hide() }), k = a.val(), k == "0" ? gi == "S" && (a.val(f[0]._paymentMethod_Id).prop("selected", !0), a.removeClass("va012-mandatory")) : (y = VIS.Utility.Util.getValueOfString(t("option:selected", a).attr("paymentbasetype")), y == "S" ? gi == y && (a.val(f[0]._paymentMethod_Id).prop("selected", !0), a.removeClass("va012-mandatory")) : (a.val(0).prop("selected", !0), a.attr("disabled", !1), a.addClass("va012-mandatory")))) : f[0]._paymentMethod_Id ? a.val(f[0]._paymentMethod_Id).prop("selected", !0) : a.val(0).prop("selected", !0); wi || a.trigger("change"); tr.val(bi.toString()); c.setValue(VIS.Utility.Util.getValueOfDecimal(h.toFixed(b))); c.getControl().trigger("blur", [r(i.getControl().val()), r(c.getControl().val())]); g = d != null ? d.toString() : null; af(g) } if (ct.val() == "PO") { if (VIS.Utility.Util.getValueOfInt(dt) != 0) { VIS.Utility.Util.getValueOfInt(dt) == VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid")) ? VIS.ADialog.info("VA012_AlreadySelected", null, "", "") : VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord", null, "", ""); return } st.setValue(t(u.draggable).data("uid"), !1, !0) } if (ct.val() == "CO" && t(u.draggable).data("uid") > 0) { if (t(u.draggable).hasClass("va012-green-color")) { VIS.ADialog.info("VA012_CashLineAlreadyMatchedOthrStmt", null, "", ""); return } if (VIS.Utility.Util.getValueOfInt(oi) != 0) { VIS.Utility.Util.getValueOfInt(oi) == VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid")) ? VIS.ADialog.info("VA012_AlreadySelected", null, "", "") : VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord", null, "", ""); return } if (v.checkContraCondition(t(u.draggable).data("uid"), t(this).attr("data-uid"), r(i.getControl().val()))) { if (VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) == 0) { VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } c.setValue(r(i.getControl().val())); i.getControl().trigger("blur", [r(i.getControl().val()), r(c.getControl().val())]); et.setValue(t(u.draggable).data("uid"), !1, !0) } } } ii = !1 } }) }, checkFormPaymentCondition: function (n, u) { var f = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckFormPaymentCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _paymentID: n, _amount: u }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (f = !0, n._amount != null && n._amount != 0 && (i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(b))), r(i.getControl().val()) < 0 ? (o.removeClass("va012-inactive"), o.addClass("va012-active"), o.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")) : (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), o.removeClass("va012-active"), o.addClass("va012-inactive"), o.attr("v_active", "0")))) : (VIS.ADialog.info(n._status, null, "", ""), f = !1) }, error: function () { VIS.ADialog.info("error", null, "", ""); f = !1 } }), f }, checkFormPrepayCondition: function (n, u) { var s = 0, f; return ht.value && (s = ht.value), f = !1, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckFormPrepayCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _orderID: n, _amount: u, _currencyId: at, _formBPartnerID: s }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (f = !0, n._amount > 0 && (i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(b))), r(i.getControl().val()) < 0 ? (o.removeClass("va012-inactive"), o.addClass("va012-active"), o.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")) : (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), o.removeClass("va012-active"), o.addClass("va012-inactive"), o.attr("v_active", "0")))) : (VIS.ADialog.info(n._status, null, "", ""), f = !1) }, error: function () { VIS.ADialog.info("error", null, "", ""); f = !1 } }), f }, checkInvoiceCondition: function (n, i) { var r = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckInvoiceCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _invoiceID: n, _amount: i }, success: function (n) { n = t.parseJSON(n); n == "Success" ? r = !0 : (VIS.ADialog.info(n, null, "", ""), r = !1) }, error: function () { VIS.ADialog.info("error", null, "", ""); r = !1 } }), r }, checkPaymentCondition: function (n, l, v) { var p = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckPaymentCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: l, _amount: v, statmtDate: nt.val(), accountID: s.val() }, success: function (n) { if (n = t.parseJSON(n), n._status == "Success") if (p = !0, n._amount != null && n._amount != 0) { if (i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(b))), r(i.getControl().val()) < 0 ? (o.removeClass("va012-inactive"), o.addClass("va012-active"), o.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0"), i.getControl().addClass("va012-mandatory"), c.getControl().addClass("va012-mandatory")) : (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), o.removeClass("va012-active"), o.addClass("va012-inactive"), o.attr("v_active", "0"), i.getControl().removeClass("va012-mandatory"), c.getControl().removeClass("va012-mandatory")), c.setValue(VIS.Utility.Util.getValueOfDecimal(n._trxamount.toFixed(b))), n._currency_Id != 0 && VIS.Utility.Util.getValueOfString(tt.value) != null) { h.val(at).prop("selected", !0); for (var s = 0; h[0].length > s; s++)VIS.Utility.Util.getValueOfInt(h[0][s].value) == at ? t(h[0][s]).show() : t(h[0][s]).hide(); h.removeClass("va012-mandatory"); h.attr("disabled", !1); t(y[0][0]).hide(); y.val(n._conversionType_Id).prop("selected", !0); y.attr("disabled", !0) } else h.val(at).prop("selected", !0), h.attr("disabled", !0), h.removeClass("va012-mandatory"), y.val(n._conversionType_Id).prop("selected", !0); y.trigger("change"); n._paymentMethod_Id ? (a.val(n._paymentMethod_Id).prop("selected", !0), a.attr("disabled", !0), a.removeClass("va012-mandatory")) : a.addClass("va012-mandatory"); n._checkNo && (hr.show(), g.val(n._checkNo), g.attr("disabled", !0), g.removeClass("va012-mandatory")); n._checkDate && (cr.show(), ft.val(Globalize.format(new Date(n._checkDate), "yyyy-MM-dd")), ft.attr("disabled", !0), ft.removeClass("va012-mandatory")) } else if (n._checkNo && VIS.Utility.Util.getValueOfString(g.val()).equals("") && (hr.show(), g.val(n._checkNo), g.attr("disabled", !1), g.removeClass("va012-mandatory")), l == 0 && v != 0) { if (f[0].attributes["data-uid"].value > 0 && (l = f[0].attributes["data-uid"].value), tt != null && tt.value > 0 && l > 0) return it.statementListRecordEdit(l, tt.value, !0), nt.attr("readonly", !0), p = !0 } else l == 0 && (u.refreshForm(), VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""), p = !1); else VIS.ADialog.info(n._status, null, "", ""), p = !1 }, error: function () { VIS.ADialog.info("error", null, "", ""); p = !1 } }), p }, checkScheduleCondition: function (n, i, r, u) { var e, f; if (at == null || at == 0) { VIS.ADialog.info("VA012_SelectBankAccountFirst", null, "", ""); return } return e = 0, ht.value && (e = ht.value), f = !1, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckScheduleCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: i, _listToCheck: r, _amount: u, _currencyId: at, _formBPartnerID: e }, success: function (n) { n = t.parseJSON(n); n == "Success" ? f = !0 : (VIS.ADialog.info(n, null, "", ""), f = !1) }, error: function () { VIS.ADialog.info("error", null, "", ""); f = !1 } }), f }, checkScheduleTotal: function (n, i, r) { var u = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckScheduleTotal", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _listToCheck: n, _amount: i, _currencyId: at, _destinationID: r }, success: function (n) { n = t.parseJSON(n); n == "Success" ? u = !0 : (VIS.ADialog.info(n, null, "", ""), u = !1) }, error: function () { VIS.ADialog.info("error", null, "", ""); u = !1 } }), u }, checkPrepayCondition: function (n, u, s, c) { var v = 0, l, p; return ht.value && (v = ht.value), l = !1, p = u, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckPrepayCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: u, _listToCheck: s, _amount: c, _currencyId: at, _formBPartnerID: v, stateDate: nt.val() }, success: function (s) { if (s = t.parseJSON(s), s._status == "Success") if (l = !0, s._amount != 0) { if (i.setValue(VIS.Utility.Util.getValueOfDecimal(s._amount.toFixed(b))), r(i.getControl().val()) < 0 ? (o.removeClass("va012-inactive"), o.addClass("va012-active"), o.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")) : (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), o.removeClass("va012-active"), o.addClass("va012-inactive"), o.attr("v_active", "0"), r(i.getControl().val()) > 0 && i.getControl().removeClass("va012-mandatory")), s._currency_Id != 0 && VIS.Utility.Util.getValueOfString(st.value) != null) { h.val(at).prop("selected", !0); for (var v = 0; h[0].length > v; v++)VIS.Utility.Util.getValueOfInt(h[0][v].value) == at ? t(h[0][v]).show() : t(h[0][v]).hide(); h.removeClass("va012-mandatory"); h.attr("disabled", !1); t(y[0][0]).hide(); y.val(s._conversionType_Id).prop("selected", !0); y.attr("disabled", !1) } else h.val(at).prop("selected", !0), h.attr("disabled", !0), h.removeClass("va012-mandatory"), y.val(s._conversionType_Id).prop("selected", !0); y.trigger("change"); s._paymentMethod_Id ? (a.val(s._paymentMethod_Id).prop("selected", !0), a.attr("disabled", !1)) : (a.val(0).prop("selected", !0), a.attr("disabled", !1)); a.trigger("change") } else { if (u == 0 && c != 0 && (f[0].attributes["data-uid"].value > 0 && (u = f[0].attributes["data-uid"].value), n > 0 && u > 0)) return it.statementListRecordEdit(u, n, !0), nt.attr("readonly", !0), l = !0; l = p > 0 ? !0 : !1 } else VIS.ADialog.info(s._status, null, "", ""), l = !1 }, error: function () { VIS.ADialog.info("error", null, "", ""); l = !1 } }), l }, checkContraCondition: function (n, u, s) { var l = 0, c; return ht.value && (l = ht.value), c = !1, t.ajax({ url: VIS.Application.contextUrl + "BankStatement/CheckContraCondition", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragSourceID: n, _dragDestinationID: u, _amount: s, _currencyId: at, _formBPartnerID: l, stateDate: nt.val() }, success: function (l) { if (l = t.parseJSON(l), l._status == "Success") if (c = !0, i.setValue(VIS.Utility.Util.getValueOfDecimal(l._amount.toFixed(b))), r(i.getControl().val()) < 0 ? (o.removeClass("va012-inactive"), o.addClass("va012-active"), o.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")) : (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), o.removeClass("va012-active"), o.addClass("va012-inactive"), o.attr("v_active", "0"), r(i.getControl().val()) > 0 && i.getControl().removeClass("va012-mandatory")), l._amount != 0 && VIS.Utility.Util.getValueOfString(et.value) != null) { h.val(at).prop("selected", !0); for (var a = 0; h[0].length > a; a++)VIS.Utility.Util.getValueOfInt(h[0][a].value) == at ? t(h[0][a]).show() : t(h[0][a]).hide(); if (h.removeClass("va012-mandatory"), h.attr("disabled", !1), t(y[0][0]).hide(), y.val(l._conversionType_Id).prop("selected", !0), y.removeClass("va012-mandatory"), y.attr("disabled", !0), u == 0 && s != 0 && (f[0].attributes["data-uid"].value > 0 && (u = f[0].attributes["data-uid"].value), n > 0 && u > 0)) return it.statementOpenEdit(u, n), nt.attr("readonly", !0), c = !0 } else VIS.Utility.Util.getValueOfInt(u) > 0 ? c = !0 : (VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""), c = !1); else VIS.ADialog.info(l._status, null, "", ""), c = !1 }, error: function () { VIS.ADialog.info("error", null, "", ""); c = !1 } }), c }, matchByDrag: function (n, u) { var f = !1; return t.ajax({ url: VIS.Application.contextUrl + "BankStatement/MatchByDrag", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _dragPaymentID: n, _dragStatementID: u }, success: function (n) { n = t.parseJSON(n); n._status == "Success" ? (f = !0, n._amount != null && n._amount != 0 && (i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(b))), r(i.getControl().val()) < 0 ? (o.removeClass("va012-inactive"), o.addClass("va012-active"), o.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")) : (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), o.removeClass("va012-active"), o.addClass("va012-inactive"), o.attr("v_active", "0")), rt.trigger("focus"))) : (VIS.ADialog.info(n._status, null, "", ""), f = !1) }, error: function () { VIS.ADialog.info("error", null, "", ""); f = !1 } }), f }, loadAndResetPaymentData: function () { ui.html(""); vi = 1; sf = 0; ve = 50; oo = 1; storepaymentdata = []; v.loadPayments(s.val() == null ? 0 : s.val(), wt.val(), ct.val(), pt.val()) } }; this.vetoablechange = function (n) { if (n.propertyName == "VA012_txtDifference_" + $self.windowNo + "") w.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(b))); else if (n.propertyName == "VA012_txtTaxAmount_" + $self.windowNo + "") bt.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(b))); else if (n.propertyName == "VA012_txtTrxAmt_" + $self.windowNo + "") c.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(b))); else if (n.propertyName == "VA012_txtAmount_" + $self.windowNo + "") { var t = r(i.getControl().val()); i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(t).toFixed(b))) } }; it = { statementDialog: function () { function b() { h = $statement.find("#VA012_STAT_cmbBank_" + $self.windowNo); r = $statement.find("#VA012_STAT_cmbBankAccount_" + $self.windowNo); e = $statement.find("#VA012_STAT_cmbBankAccountClassName_" + $self.windowNo); v = $statement.find("#VA012_STAT_statementDate_" + $self.windowNo); y = $statement.find("#VA012_CheckBox_" + $self.windowNo); c = $statement.find("#VA012_STAT_txtStatementNo_" + $self.windowNo); o = $statement.find("#VA012_ctrlLoadFile_" + $self.windowNo); STAT_ctrlLoadFileTxt = $statement.find("#VA012_ctrlLoadFileTxt_" + $self.windowNo); _tabFile = $statement.find("#VA012_STAT_tabFile_" + $self.windowNo); _tabSchedule = $statement.find("#VA012_STAT_tabSchedule_" + $self.windowNo); yf = $statement.find("#VA012_STAT_cmbBankAccountClassName_" + $self.windowNo) } function k() { h.html(""); h.append("<option value=" + nr.val() + ">" + nr.children()[nr[0].selectedIndex].text + "<\/option>"); h.prop("selectedIndex", 0) } function d() { r.html(""); r.append("<option value=" + s.val() + ">" + s.children()[s[0].selectedIndex].text + "<\/option>"); r.prop("selectedIndex", 0) } function g() { function n(n) { if (e.html(""), e.append("<option value=0 ><\/option>"), n != null) for (var t = 0; t < n.length; t++)e.append("<option value=" + n[t].Value + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"); e.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetBankAccountClasses", { _cmbBankAccount: s.val() }, n) } function nt() { function n(n) { n != null && (p = VIS.Utility.Util.getValueOfInt(n[0].chargeID)) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetBankCharge", null, n) } function tt() { a = null; $statement = null; h = null; r = null; c = null; o = null; STAT_ctrlLoadFileTxt = null; _tabSchedule = null; _tabFile = null; i = null } var h = null, r = null, e = null, v = null, y = null, p = null, w = s.children()[s[0].selectedIndex].getAttribute("accounttype"), c = null, o = null, i = null, a, f; $statement = t("<div class='va012-popform-content'>"); a = ""; a = "<div><div class='va012-left-btn'><a id='VA012_STAT_tabFile_" + $self.windowNo + "' class='btn va012-blueBtn' activestatus='1'>" + VIS.Msg.getMsg("VA012_File") + "<\/a><\/div><\/div><div style='border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left;'><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_Bank") + "<\/label><select id='VA012_STAT_cmbBank_" + $self.windowNo + "' class='vis-ev-col-readonly' disabled><\/select><\/div> <div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_BankAccount") + "<\/label><select id='VA012_STAT_cmbBankAccount_" + $self.windowNo + "' class='vis-ev-col-readonly' disabled><\/select><\/div><div class=va012-popform-data><label id=VA012_STAT_lblStatementDate_" + $self.windowNo + ">" + VIS.Msg.getMsg("VA012_StatementDate") + '<\/label><input type=date max="9999-12-31" class=vis-ev-col-readonly disabled id=VA012_STAT_statementDate_' + $self.windowNo + "><\/div><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_ClassName") + '<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_STAT_cmbBankAccountClassName_' + $self.windowNo + "'><\/select><\/div><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_StatementNumber") + "<sup style=\"color: red;\">*<\/sup><\/label><input type='text' id='VA012_STAT_txtStatementNo_" + $self.windowNo + "' /> <\/div><div class='va012-popform-data va012-pop-file'><label>" + VIS.Msg.getMsg("VA012_SelectFile") + "<sup style=\"color: red;\">*<\/sup><\/label><input type='text' id='VA012_ctrlLoadFileTxt_" + $self.windowNo + "' disabled><div class='va012-file-upload'><label for='file-input' class='va012-file-label'>" + VIS.Msg.getMsg("VA012_Browse") + "<\/label><input id='VA012_ctrlLoadFile_" + $self.windowNo + "' type='file' accept='.csv,text/plain,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel'/><\/div><\/div><div class='VA012-checkbox-div " + w + "'> <input type='checkbox' value='checked' id='VA012_CheckBox_" + $self.windowNo + "'><label class='VA012-StatementDateAsAccountDate'>" + VIS.Msg.getMsg("VA012_StatementDateAsAccountDate") + "<\/label><\/div><\/div>"; $statement.append(a); b(); k(); d(); g(); v.val(Globalize.format(pt.val(), "yyyy-MM-dd")); nt(); f = new VIS.ChildDialog; f.setContent($statement); f.setTitle(VIS.Msg.getMsg("VA012_LoadStatement")); f.setWidth("500px"); f.setEnableResize(!1); f.setModal(!0); f.show(); o.on("change", function () { var u = this; r.val() != null && r.val() > 0 ? (i = t.parseJSON(n.UploadExcel(u, null, null)), STAT_ctrlLoadFileTxt.val(i._orgfilename)) : (o = null, VIS.ADialog.info("VA012_SelectBankAccountFirst", null, "", "")) }); f.onOkClick = function () { if (si.val(""), _tabFile.attr("activestatus") == "1") { if (r.val() == null || r.val() == "" || r.val() == "0") return VIS.ADialog.info("VA012_SelectBankAccountFirst", null, "", ""), !1; if (e.val() == null || e.val() == "" || e.val() == "0") return VIS.ADialog.info("VA012_PleaseSelectClassFirst", null, "", ""), !1; if (c.val() == null || c.val() == "") return VIS.ADialog.info("VA012_PleaseEnterStatementNo", null, "", ""), !1; if (o.val() == "" == null || o.val() == "") return VIS.ADialog.info("VA012_SelectFileFirst", null, "", ""), !1; if (i != null) { if (i._filename == null || i._filename == "" || i._path == null || i._path == "") { VIS.ADialog.info("VA012_ErrorInGettingFile", null, "", ""); return } if (i._error != null && i._error != "") { VIS.ADialog.info(i._error, null, "", ""); return } var n = i._path, f = i._filename, s = r.val(), h = c.val(), k = $statement, a = y.is(":checked"), w = e.val(), b = p; lt(l, !0, "absolute"); window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/ImportStatement", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _path: n, _filename: f, _bankaccount: s, _bankAccountCurrency: at, _statementno: h, _statementClassName: w, _statementCharges: b, statementDate: v.val(), IsStatementDateAsAccountDate: a }, success: function (n) { hi = n._statementID; hi != null && hi != "" ? (ti = [], yt.html(""), yi = 1, lt(l, !1, "absolute"), it.loadStatement(hi), u.refreshForm()) : n._error != null && n._error != "" && (lt(l, !1, "absolute"), VIS.ADialog.info(n._error, null, "", "")) }, error: function () { lt(l, !1, "absolute"); VIS.ADialog.info("error", null, "", "") } }) }, 2) } } if (_tabSchedule.attr("activestatus") == "1") return alert("Schedule"), !1 }; f.onCancelClick = function () { }; f.onClose = function () { tt() }; _tabFile.on(VIS.Events.onTouchStartOrClick, function () { _tabFile.removeClass("va012-grayBtn"); _tabFile.addClass("va012-blueBtn"); _tabFile.attr("activestatus", "1"); _tabSchedule.removeClass("va012-blueBtn"); _tabSchedule.addClass("va012-grayBtn"); _tabSchedule.attr("activestatus", "0") }); _tabSchedule.on(VIS.Events.onTouchStartOrClick, function () { _tabSchedule.removeClass("va012-grayBtn"); _tabSchedule.addClass("va012-blueBtn"); _tabSchedule.attr("activestatus", "1"); _tabFile.removeClass("va012-blueBtn"); _tabFile.addClass("va012-grayBtn"); _tabFile.attr("activestatus", "0") }) }, LoadStatementsPages: function () { rr = si.val() != null && si.val() != "" ? !0 : !1; t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadStatementsPages", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _cmbBankAccount: s.val(), _txtSearch: si.val(), _statementPageNo: yi, _PAGESIZE: ae, _SEARCHREQUEST: rr }, success: function (n) { n != null && n != "" && (ge = JSON.parse(n)) } }) }, loadStatement: function () { if (rr = si.val() != null && si.val() != "" ? !0 : !1, s.val() > 0) { lt(t(yt), !0, "inherit"); window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadConciledOrUnConciledStatements", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _cmbBankAccount: s.val(), _txtSearch: si.val(), _currencyID: at != null ? at : 0, _searchRequest: rr }, success: function (n) { var r = t.parseJSON(n); i(r); lt(t(yt), !1, "inherit") }, error: function () { lt(t(yt), !1, "inherit") } }) }, 2); function i(n) { n != null && n.length > 0 ? (yu.html(""), vu.html(""), vu.append("<p>" + VIS.Msg.getMsg("VA012_Reconciled") + "<\/p><p style='margin-top: 4px;'>" + VIS.Msg.getMsg("VA012_Unreconciled") + "<\/p>"), yu.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>" + n[0].basecurrency + "<\/span> " + parseFloat(n[0].reconciled).toLocaleString(navigator.language, { minimumFractionDigits: b, maximumFractionDigits: b }) + "<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'> <span class='va012-base-curr'>" + n[0].basecurrency + "<\/span> " + parseFloat(n[0].unreconciled).toLocaleString(navigator.language, { minimumFractionDigits: b, maximumFractionDigits: b }) + "<\/span>")) : (yu.html(""), vu.html(""), vu.append("<p>" + VIS.Msg.getMsg("VA012_Reconciled") + "<\/p><p style='margin-top: 4px;'>" + VIS.Msg.getMsg("VA012_Unreconciled") + "<\/p>"), yu.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>" + rf + "<\/span> 0<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'><span class='va012-base-curr'>" + rf + "<\/span> 0<\/span>")); it.setStatementListHeight() } var n = "va012-red-color"; window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/LoadStatements", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _cmbBankAccount: s.val(), _txtSearch: si.val(), _statementPageNo: yi, _PAGESIZE: ae, _SEARCHREQUEST: rr }, success: function (n) { n != null && n != "" && (r(n), lt(t(yt), !1, "inherit")) }, error: function () { lt(t(yt), !1, "inherit") } }) }, 2); function r(i) { var u, r; if (i = t.parseJSON(i), u = "", i != null && i.length > 0) for (r = 0; r < i.length; r++)u = "", n = i[r].docstatus == "CO" || i[r].docstatus == "CL" || i[r].docstatus == "RE" ? "va012-gray-color" : i[r].c_payment_id == null || i[r].c_payment_id == "0" || i[r].c_payment_id == 0 ? i[r].c_cashline_id != null && i[r].c_cashline_id != "0" && i[r].c_cashline_id != 0 ? "va012-green-color" : i[r].c_charge_id != null && i[r].c_charge_id != "0" && i[r].c_charge_id != 0 ? i[r].STMTAMT == i[r].trxamount ? "va012-green-color" : "va012-red-color" : (i[r].c_charge_id == null || i[r].c_charge_id == "") && (i[r].trxno == null || i[r].trxno == "") ? "va012-red-color" : "va012-red-color" : "va012-green-color", u = '<div  data-uid="' + i[r].c_bankstatementline_id + '" class="va012-right-data-wrap ' + n + '"><div class="va012-statement-wrap"><div class="va012-fl-padd"><div class="col-md-4 col-sm-4 va012-padd-0"><div class="va012-form-check"> <input type="checkbox" data-uid="' + i[r].c_bankstatementline_id + '" > <div class="va012-form-text"> <span style="background: rgba(var(--v-c-on-secondary), .4);color: rgba(var(--v-c-on-primary), 1); padding: 3px;margin-left: 2px;">' + i[r].statementno + "/" + i[r].page + "/" + i[r].line + "<\/span><label>" + new Date(i[r].stmtLineDate).toLocaleDateString() + "<\/label><label>" + i[r].currency + " " + parseFloat(i[r].trxamount).toLocaleString(navigator.language, { minimumFractionDigits: b, maximumFractionDigits: b }) + "<\/label>", u += i[r].trxno == "" || i[r].trxno == null ? '<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p>' + VIS.Utility.encodeText(i[r].description) + '<\/p> <span title="' + VIS.Msg.getMsg("VA012_CheckNo") + '">' + VIS.Utility.encodeText(i[r].EftCheckNo) + '<\/span><span title="' + VIS.Msg.getMsg("DocumentNo") + '">' + VIS.Utility.encodeText(i[r].invoiceno) + '<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="' + i[r].c_bankstatementline_id + '" class="glyphicon glyphicon-edit" title=' + VIS.Msg.getMsg("EditRecord") + '><\/span> <span data-uid="' + i[r].c_bankstatementline_id + '" class="glyphicon glyphicon-zoom-in" title=' + VIS.Msg.getMsg("ZoomToRecord") + '><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0 va012-width-xs"><div class="va012-form-data">' : '<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p>' + VIS.Utility.encodeText(i[r].description) + "<\/p> <span>" + VIS.Utility.encodeText(i[r].bpgroup) + "<\/span><span>" + VIS.Utility.encodeText(i[r].invoiceno) + '<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p>' + VIS.Utility.encodeText(i[r].trxno) + '<\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="' + i[r].c_bankstatementline_id + '" class="glyphicon glyphicon-edit"><\/span> <span data-uid="' + i[r].c_bankstatementline_id + '" class="glyphicon glyphicon-zoom-in"><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0 va012-width-xs"><div class="va012-form-data">', u += " <\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <\/div> <!-- end of row --><\/div><!-- end of payment-wrap --><\/div><!-- end of right-data-wrap -->", yt.append(u); _sql = null; it.setStatementListHeight(); v.dropPayments() } } }, setStatementListHeight: function () { var n = t("#VA012_mainContainer_" + $self.windowNo).height(); n == 0 && (n = window.innerHeight - 107); t("#VA012_contentArea_" + $self.windowNo).height(n - 20); t("#VA012_lstStatement_" + $self.windowNo).height(t("#VA012_rightWrap_" + $self.windowNo).height() - t("#VA012_rightTop_" + $self.windowNo).height() - 18) }, statementOpenEdit: function (n, t) { return kt.attr("activestatus", "1"), kt.attr("src", "Areas/VA012/Images/hide.png"), kt.attr("title", "Collapse"), kt.removeClass("vis vis-plus"), kt.addClass("fa fa-minus"), f.show(), v.setPaymentListHeight(), it.statementListRecordEdit(n, t, !0), n = 0, !0 }, statementListEdit: function (n) { var i = t(n.target), r = 0; i.hasClass("glyphicon-edit") && (r = i.data("uid"), kt.attr("activestatus", "1"), kt.attr("src", "Areas/VA012/Images/hide.png"), kt.attr("title", "Collapse"), f.show(), kt.removeClass("vis vis-plus"), kt.addClass("fa fa-minus"), v.setPaymentListHeight(), u.scheduleRefresh(), u.prepayRefresh(), ur = !0, it.statementListRecordEdit(r, 0, !0), r = 0, v.addEffect(i, f)) }, openStatement: function (n) { var u = t(n.target), r = 0, i; if (u.hasClass("glyphicon glyphicon-zoom-in")) { r = u.data("uid"); try { ue > 0 && (i = new VIS.Query, i.addRestriction("C_BankStatementLine_ID", VIS.Query.prototype.EQUAL, r), i.setRecordCount(1), VIS.viewManager.startWindow(ue, i)) } catch (n) { console.log(n) } r = 0 } }, selectedStatementLinesList: function (n) { var i = t(n.target); n.target.type == "checkbox" && (i.is(":checked") && (_bankStatementLineID = parseInt(i.data("uid")), ti.push(_bankStatementLineID), _bankStatementLineID = 0), i.is(":checked") || (_bankStatementLineID = parseInt(i.data("uid")), ti.splice(ti.indexOf(_bankStatementLineID), 1), _bankStatementLineID = 0)) }, statementListRecordEdit: function (n, t, i) { VIS.Utility.Util.getValueOfInt(t) == 0 && u.refreshForm(i); it.getStatementLineForEdit(n, t, it.afterRecordGet, i) }, selectedScheduleList: function (n) { var i = t(n.target); n.target.type == "checkbox" && (i.is(":checked"), !i.is(":checked")) }, getStatementLineForEdit: function (n, i, r, u) { t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/GetStatementLine", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _bankStatementLineID: n, trxType: ct.val(), payment_ID: i != null ? i : 0 }), success: function (n) { r(n, u) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) }, afterRecordGet: function (n, u) { var s, it, lt, l, vt, v; if (n != null && n != "") { if (s = t.parseJSON(n), f.attr("data-uid", s._bankStatementLineID), ni.val(s._txtStatementNo), ci.val(s._txtStatementPage), er.val(s._txtStatementLine), nt.val(Globalize.format(new Date(s._dtStatementDate), "yyyy-MM-dd")), s._cmbVoucherMatch != null && s._cmbVoucherMatch != "" ? p.val(s._cmbVoucherMatch).prop("selected", !0) : p.prop("selectedIndex", 0), ct.val() == "CO" && p.val("C").prop("selected", !0), p.trigger("change"), s._cmbContraType != null && s._cmbContraType != "" ? ot.val(s._cmbContraType).prop("selected", !0) : ot.prop("selectedIndex", 0), p.val() != null && p.val() != "" && ot.val() != null && ot.val() != "" && (ot.val("CB").prop("selected", !0), ot.trigger("change")), fr.val(s._cmbCashBook).prop("selected", !0), hu.val(s._txtCheckNo), i.setValue(VIS.Utility.Util.getValueOfDecimal(s._txtAmount.toFixed(b))), c.setValue(VIS.Utility.Util.getValueOfDecimal(s._txtTrxAmt.toFixed(b))), r(i.getControl().val()) <= 0 ? i.getControl().addClass("va012-mandatory") : i.getControl().removeClass("va012-mandatory"), s._reconciled && (i.getControl().attr("disabled", !0), gr = s._reconciled), r(c.getControl().val()) <= 0 ? c.getControl().addClass("va012-mandatory") : c.getControl().removeClass("va012-mandatory"), (p.val() == "M" || p.val() == "C") && r(c.getControl().val()) != 0 && (it = VIS.Utility.Util.getValueOfDecimal(s._txtDifference.toFixed(b)), w.setValue(it), w.getControl().trigger("blur"), s._txtDifference < 0 ? (w.getControl().addClass("va012-mandatory"), t("#Ast_Difference_" + $self.windowNo).show()) : (w.getControl().removeClass("va012-mandatory"), t("#Ast_Difference_" + $self.windowNo).hide()), p.val() == "C" && p.trigger("change")), s._cmbDifferenceType != null && s._cmbDifferenceType != "" ? (pi.find("*").prop("disabled", !1), k.val(s._cmbDifferenceType).prop("selected", !0)) : k.prop("selectedIndex", 0), k.trigger("change"), r(i.getControl().val()) < 0 ? (o.removeClass("va012-inactive"), o.addClass("va012-active"), o.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")) : (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), o.removeClass("va012-active"), o.addClass("va012-inactive"), o.attr("v_active", "0")), ar.val(s._txtVoucherNo), pu.val(s._txtDescription), sr.val(s._cmbCharge).prop("selected", !0), rt.val(s._txtCharge), rt.attr("chargeid", s._cmbCharge), VIS.Utility.Util.getValueOfInt(s._cmbCharge) == 0 && s._cmbDifferenceType != "" && s._cmbDifferenceType != null ? rt.addClass("va012-mandatory") : rt.removeClass("va012-mandatory"), ut.val(s._cmbTaxRate).prop("selected", !0), VIS.Utility.Util.getValueOfInt(s._cmbTaxRate) == 0 && s._cmbDifferenceType != "" && s._cmbDifferenceType != null ? ut.addClass("va012-mandatory") : ut.removeClass("va012-mandatory"), bt.setValue(VIS.Utility.Util.getValueOfDecimal(s._txtTaxAmount.toFixed(b))), bu.prop("checked", s._chkUseNextTime), s._ctrlCashLine > 0 ? (et.setValue(s._ctrlCashLine, !1, !0), ur = !1) : ii || (et.setValue(), s._ctrlPayment <= 0 && (ur = !1)), tt && tt.value > 0 && s._ctrlPayment == 0 && (s._ctrlPayment = tt.value), s._ctrlPayment > 0 ? (tt.setValue(s._ctrlPayment, !1, !0), ar.val() == "" && (lt = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetTrxNoforVoucher", { _ctrlPayment: s._ctrlPayment }), ar.val(lt)), ur = !1) : ii || (tt.setValue(), ur = !1), s._ctrlOrder > 0 ? (ii = !0, st.setValue(s._ctrlOrder, !1, !0), ii = !1) : ii || st.setValue(), s._ctrlBusinessPartner > 0 ? ht.setValue(s._ctrlBusinessPartner, !1, !0) : ii || ht.setValue(), s._ctrlTrxOrg > 0 ? di.setValue(s._ctrlTrxOrg, !1, !0) : ii || di.setValue(), s._ctrlInvoice > 0 ? gt.setValue(s._ctrlInvoice, !1, !0) : !ii && u && gt.setValue(), s._txtCurrency != 0) { for (h.val(at).prop("selected", !0), l = 0; h[0].length > l; l++)VIS.Utility.Util.getValueOfInt(h[0][l].value) == at ? t(h[0][l]).show() : t(h[0][l]).hide(); h.removeClass("va012-mandatory"); h.attr("disabled", !1) } s._txtConversionType == 0 ? y.attr("disabled", !1) : (y.val(s._txtConversionType).prop("selected", !0), y.removeClass("va012-mandatory"), s._ctrlPayment > 0 ? y.attr("disabled", !0) : s._ctrlCashLine > 0 ? y.attr("disabled", !0) : (y.attr("disabled", !1), t(y[0][0]).hide())); VIS.Utility.Util.getValueOfDecimal(s._txtDifference.toFixed(b)) != 0 && (d.length == 0 || d.length > 0 && f.attr("data-uid") != 0 && Math.abs(r(c.getControl().val())) < Math.abs(r(i.getControl().val()))) && (VIS.Utility.Util.getValueOfInt(st.value) == 0 && f.attr("data-uid") == 0 || f.attr("data-uid") != 0) && (k.find("option[value=0]").prop("disabled", !0), k.find("option[value=OU]").prop("disabled", !0), k.find("option[value=DA]").prop("disabled", !0), k.find("option[value=WO]").prop("disabled", !0)); rt.trigger("focus"); s._txtPaymentMethod ? gr || s._autoCheckControlled || !s._txtCheckNum ? (t(a[0]).find("option").show(), a.val(s._txtPaymentMethod).prop("selected", !0), a.removeClass("va012-mandatory"), s._ctrlPayment ? a.attr("disabled", !0) : a.attr("disabled", !1)) : (t(a[0]).children("option").each(function () { t(this).attr("paymentbasetype") == "S" ? t(this).show() : t(this).hide() }), vt = a.val(), vt == "0" ? (gi == "S" || gi == null) && (a.val(s._txtPaymentMethod).prop("selected", !0), a.removeClass("va012-mandatory"), s._ctrlPayment ? a.attr("disabled", !0) : a.attr("disabled", !1)) : (v = VIS.Utility.Util.getValueOfString(t("option:selected", a).attr("paymentbasetype")), v == "S" ? gi == v && (a.val(s._txtPaymentMethod).prop("selected", !0), a.removeClass("va012-mandatory"), s._ctrlPayment ? a.attr("disabled", !0) : a.attr("disabled", !1)) : (a.val(0).prop("selected", !0), a.attr("disabled", !1), a.addClass("va012-mandatory")))) : (t(a[0]).find("option").show(), a.val(0).prop("selected", !0), a.attr("disabled", !1), a.addClass("va012-mandatory")); s._txtCheckDate ? (ft.val(Globalize.format(new Date(s._txtCheckDate), "yyyy-MM-dd")), ft.removeClass("va012-mandatory"), gr || s._autoCheckControlled ? (au = null, ft.attr("disabled", !1)) : (au = ft.val(), ft.attr("disabled", !0))) : (au = null, ft.val(s._txtCheckDate), ft.addClass("va012-mandatory"), ft.attr("disabled", !1)); g.val(s._txtCheckNum); s._txtCheckNum ? (hr.show(), g.attr("disabled", !0), g.removeClass("va012-mandatory"), cr.show(), fo = s._txtCheckNum, gr || s._autoCheckControlled ? (lr = !1, wi = null) : (lr = !0, wi = s._txtCheckNum)) : (lr = !1, wi = null, a.trigger("change")) } }, matchStatementDialog: function () { function p() { function n(n) { if (e.html(""), e.append("<option value=0 >-<\/option>"), n != null) for (var t = 0; t < n.length; t++)e.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].Value) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>") } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/LoadStatementNo", { _cmbBankAccount: s.val() }, n) } function w() { function n(n) { if (o.html(""), o.append("<option value=0 >-<\/option>"), n != null) for (var t = 0; t < n.length; t++)o.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_Tax_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>") } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/LoadTaxRate", null, n) } function b() { n = $match.find("#VA012_cmbMatchingBase_" + $self.windowNo); i = $match.find("#VA012_divMatchingBase_" + $self.windowNo); h = $match.find("#VA012_cmbMatchingCriteria_" + $self.windowNo); e = $match.find("#VA012_cmbStatementNo_" + $self.windowNo); a = $match.find("#VA012_ChargeSrch_" + $self.windowNo); o = $match.find("#VA012_cmbTaxRate_" + $self.windowNo); y = $match.find("#VA012_accept_" + $self.windowNo); _ChargeLookUp = VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(), $self.windowNo, 3787, VIS.DisplayType.Search); c = new VIS.Controls.VTextBoxButton("C_Charge_ID", !0, !1, !0, VIS.DisplayType.Search, _ChargeLookUp); a.append(c.getControl().css("width", "93%")).append(c.getBtn(0).css("width", "30px").css("height", "30px").css("padding", "0px").css("border-color", "#BBBBBB")) } function k(n) { var i = t(n.target); i.hasClass("glyphicon-remove") && (r.splice(r.indexOf(i.data("uid")), 1), i.parent().parent().remove()) } function d() { n = null; i = null; r = []; h = null; w2ui["VA012_gridPayment_" + $self.windowNo] != null && w2ui["VA012_gridPayment_" + $self.windowNo].destroy() } var n = null, i = null, r = [], h = null, e = null, a = null, c = null, o = null, y = null, l, f; $match = t("<div class='va012-popform-content'>"); l = ""; l = "<div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_StatementNo") + '<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbStatementNo_' + $self.windowNo + "'><\/select><\/div> <div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_MatchingBase") + '<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbMatchingBase_' + $self.windowNo + "'><\/select><\/div> <div id='VA012_divMatchingBase_" + $self.windowNo + "' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div><div class='va012-popform-data'><label>" + VIS.Msg.getMsg("VA012_MatchingCriteria") + '<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbMatchingCriteria_' + $self.windowNo + "'><option value='0'><\/option><option value='AT'>" + VIS.Msg.getMsg("VA012_MatchAnyTwo") + "<\/option><option value='AR'>" + VIS.Msg.getMsg("VA012_MatchAnyThree") + "<\/option><option value='AL'>" + VIS.Msg.getMsg("VA012_MatchAll") + "<\/option><\/select><\/div> <div class='va012-popform-data'><label title = '" + VIS.Msg.getMsg("VA012_SetChargeType") + "' > " + VIS.Msg.getMsg("VA012_Charge") + '<sup style="color: red;">*<\/sup><\/label><div id=\'VA012_ChargeSrch_' + $self.windowNo + "'><\/div><\/div> <div class='va012-popform-data'><label title =' " + VIS.Msg.getMsg("VA012_SetTaxRate") + "' >" + VIS.Msg.getMsg("VA012_TaxRate") + '<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbTaxRate_' + $self.windowNo + "'><\/select><\/div> <div class='va012-frm-btn va012-btn-blue' style='float: right;'><label style='font-weight: normal;' id ='VA012_accept_" + $self.windowNo + "'>" + VIS.Msg.getMsg("VA012_Accept") + "<\/label><\/div> <\/div>"; $match.append(l); b(); rs(n); p(); w(); f = new VIS.ChildDialog; f.setContent($match); f.setTitle(VIS.Msg.getMsg("VA012_MatchStatement")); f.setWidth(700); f.setHeight(650); f.setEnableResize(!1); f.setModal(!0); f.show(); f.hideButtons(); y.click(function () { if (r.length > 0) { if (e.val() == null || e.val() == "" || e.val() == "0") return VIS.ADialog.info("VA012_NoLinesFoundToMatch", null, "", ""), !1; if (s.val() == null || s.val() == "" || s.val() == "0") return VIS.ADialog.info("VA012_SelectBankAccountFirst", null, "", ""), !1; if (h.val() == null || h.val() == "" || h.val() == "0") return VIS.ADialog.info("VA012_SelectMatchingCriteria", null, "", ""), !1; if (h.val() == "AT" && r.length < 2) return VIS.ADialog.info("VA012_SelectMin2MatchingBase", null, "", ""), !1; if (h.val() == "AR" && r.length < 3) return VIS.ADialog.info("VA012_SelectMin3MatchingBase", null, "", ""), !1; if (c.value == null || VIS.Utility.Util.getValueOfInt(c.value) == 0) return VIS.ADialog.info("VA012_NoChargeSelected", null, "", ""), !1; if (o.val() == null || o.val() == "" || o.val() == "0") return VIS.ADialog.info("VA012_NoTaxRateSelected", null, "", ""), !1; lt($match, !0, "absolute"); window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "BankStatement/MatchStatementGridData", type: "GET", dataType: "json", contentType: "application/json; charset=utf-8", async: !1, data: { _matchingBaseItemList: r.toString(), _cmbMatchingCriteria: h.val(), _BankAccount: s.val(), _StatementNo: e.val(), _BankCharges: VIS.Utility.Util.getValueOfInt(c.value), _TaxRate: o.val() }, success: function (f) { if (f != null && f != "") { f = t.parseJSON(f); n.prop("selectedIndex", 0); e.prop("selectedIndex", 0); c.value = null; o.prop("selectedIndex", 0); r = []; var h = ""; i.html(""); f.length > 0 ? (vo(i, f), _statementlineslist = [], storepaymentdata = [], yt.html(""), yi = 1, it.loadStatement(hi), ui.html(""), u.scheduleRefresh(), u.prepayRefresh(), vi = 1, v.loadPayments(s.val(), wt.val(), ct.val(), pt.val())) : (h = "<div> <p> <b>" + VIS.Msg.getMsg("va012_norecordmatched") + "<\/b> <\/div>", i.append(h)); lt($match, !1, "absolute") } else lt($match, !1, "absolute"), VIS.ADialog.info(f.toString(), null, "", "") }, error: function () { lt($match, !1, "absolute"); VIS.ADialog.info("error", null, "", "") } }) }, 2) } else return VIS.ADialog.info("VA012_NoMatchingBaseSelected", null, "", ""), !1; return !1 }); f.onCancelClick = function () { w2ui["VA012_gridPayment_" + $self.windowNo] != null && w2ui["VA012_gridPayment_" + $self.windowNo].destroy() }; f.onClose = function () { d() }; n.on("change", function () { if (r.length <= 0 && i.html(""), !ee(n.val(), r) && n.val() != "0" && n.val() != "") { r.push(n.val()); var u = "<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='" + n.val() + "'class='glyphicon glyphicon-remove'><\/span><\/a> <span>" + n.children()[n[0].selectedIndex].text; t(i)[0] != undefined && t(i)[0].classList.contains("w2ui-reset", "w2ui-grid") && i.removeClass("w2ui-reset w2ui-grid"); i.append(u) } }); i.on(VIS.Events.onTouchStartOrClick, k) }, matchStatementGridDialog: function () { var n = new VIS.ChildDialog; n.setContent(cf); n.setTitle(VIS.Msg.getMsg("VA012_MatchStatementGrid")); n.setWidth("780px"); n.setHeight(450); n.setEnableResize(!0); n.setModal(!0); n.show(); vo() }, paymentScheduleDialog: function () { function ot() { var u = "", t = 0, n; for ($_divPaymentSchedules.html(""), n = 0; n < d.length; n++)u = "<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='" + d[n] + "'  data-udata='" + bi[n] + "' class='glyphicon glyphicon-remove'><\/span><\/a> <span>" + bi[n] + "<\/span> <\/div>", $_divPaymentSchedules.append(u), vt.length > 0 && (t += VIS.Utility.Util.getValueOfDecimal(vt[n])); f[0].attributes["data-uid"].value == 0 && i.setValue(VIS.Utility.Util.getValueOfDecimal(t.toFixed(b))); c.setValue(VIS.Utility.Util.getValueOfDecimal(t.toFixed(b))); r(i.getControl().val()) < 0 && e.attr("v_active", "0"); i.getControl().trigger("blur", [r(i.getControl().val()), r(c.getControl().val())]); d != null && d.length > 0 ? af(d.toString()) : af(null) } function ct() { if (d.length > 0 && !wi) { var n = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetAutoCheckNo", { bnkAct_Id: s.val(), _PayMethod: 0, _InvSchdleList: d, voucherMatch: p.val() }); n && (a.val(n._paymentMethod_Id).prop("selected", !0), n._checkNo ? g.val(n._checkNo) : g.val(""), a.trigger("change")) } } function lt(n) { var l = t(n.target), u, h, v; if (l.hasClass("glyphicon-remove")) { if (vt != null && vt.length > 0) { if (vt.length > d.length ? vt.splice(d.indexOf(l.data("uid")) + 1, 1) : vt.length == d.length && vt.splice(d.indexOf(l.data("uid")), 1), u = 0, Number(vt.length) > 0) for (h = 0; h < vt.length; h++)u += VIS.Utility.Util.getValueOfDecimal(vt[h]); u < 0 ? (o.removeClass("va012-inactive"), o.addClass("va012-active"), o.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0")) : (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), o.removeClass("va012-active"), o.addClass("va012-inactive"), o.attr("v_active", "0")); f[0].attributes["data-uid"].value == 0 && i.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(b))) } for (d.splice(d.indexOf(l.data("uid")), 1), bi.splice(bi.indexOf(l.data("udata")), 1), d.length == 0 && f[0].attributes["data-uid"].value > 0 && it.statementListRecordEdit(f[0].attributes["data-uid"].value, 0, !1), l.parent().parent().remove(), tr.val(bi.toString()), u = 0, h = 0; h < vt.length; h++)u += VIS.Utility.Util.getValueOfDecimal(vt[h]); f[0].attributes["data-uid"].value == 0 && i.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(b))); c.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(b))); i.getControl().trigger("blur", [r(i.getControl().val()), r(c.getControl().val())]); u == 0 && ht.setValue(); d != null && d.length > 0 ? af(d.toString()) : af(null); d.length > 0 ? (v = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetAutoCheckNo", { bnkAct_Id: s.val(), _PayMethod: 0, _InvSchdleList: d, voucherMatch: p.val() }), v && (a.val(v._paymentMethod_Id).prop("selected", !0), v._checkNo ? g.val(v._checkNo) : g.val(""))) : a.val(0).prop("selected", !0); a.trigger("change") } } function at() { $_divPaymentSchedules = $paymentSchedule.find("#VA012_divPaymentSchedules_" + $self.windowNo); w = $paymentSchedule.find("#VA012_ctrlPSInvoice_" + $self.windowNo); k = $paymentSchedule.find("#VA012_ctrlPSBP_" + $self.windowNo); n = $paymentSchedule.find("#VA012_cmbPaymentSchedule_" + $self.windowNo) } function st() { ut = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 3484, VIS.DisplayType.MultiKey, "C_Invoice_ID", 0, !1, "DocStatus IN ('CO','CL') AND C_Invoice.C_BPartner_ID=" + ft); h = new VIS.Controls.VTextBoxButton("C_Invoice_ID", !1, !1, !0, VIS.DisplayType.MultiKey, ut); h.isMultiKeyTextBox = !0; h.getControl().addClass("va012-input-size-2"); w.append(h.getControl()); w.append(h.getBtn(0)); w.append(h.getBtn(1)); h.fireValueChanged = function () { rt = null; rt = h.value; n.html(""); pt() } } function yt() { et = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 2893, VIS.DisplayType.Search, "C_BPartner_ID", 0, !1, null); l = new VIS.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, VIS.DisplayType.Search, re); l.getControl().addClass("va012-input-size-2"); k.append(l.getControl()); k.append(l.getBtn(0)); k.append(l.getBtn(1)); l.fireValueChanged = function () { ft = 0; ft = l.value; ut = null; h = null; w.html(""); rt = null; st() } } function pt() { function i(t) { if (n.html(""), n.append("<option value=0 ><\/option>"), t != null) for (var i = 0; i < t.length; i++) { if (t[i].DueAmount == 0) { VIS.ADialog.info("VA012_ConversionRateNotFound", null, " " + VIS.Msg.getMsg("VA012_InvoiceSchedule") + ": " + VIS.Utility.Util.getValueOfString(t[i].c_invoicepayschedule_id), ""); return } n.append("<option paymentamount=" + t[i].DueAmount + " paymentdata='" + VIS.Utility.encodeText(new Date(t[i].DueDate).toLocaleDateString()) + "_" + VIS.Utility.encodeText(t[i].DueAmt) + "' value=" + VIS.Utility.Util.getValueOfInt(t[i].c_invoicepayschedule_id) + ">" + VIS.Utility.encodeText(new Date(t[i].DueDate).toLocaleDateString() + "_" + t[i].DueAmt) + "<\/option>") } n.prop("selectedIndex", 0) } t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetInvPaySchedule", dataType: "json", data: { seltdInvoice: rt, accountID: s.val(), statemtDate: nt.val() }, success: function (n) { var t = JSON.parse(n); (t != null || t != "") && i(t) } }) } function wt() { ut = null; h = null; rt = null; w = null; et = null; l = null; ft = null; k = null; n = null } var tt, y; if (d.length == 0 && bi.length == 0) var ut = null, h = null, rt = null, w = null, et = null, l = null, ft = null, k = null, n = null; $paymentSchedule = t("<div class='va012-popform-content'>"); tt = ""; tt = "<div> <label>" + VIS.Msg.getMsg("VA012_BusinessPartner") + "<\/label> <div id='VA012_ctrlPSBP_" + $self.windowNo + "' ><\/div> <\/div>"; tt += "<div> <label>" + VIS.Msg.getMsg("VA012_Invoice") + "<\/label> <div id='VA012_ctrlPSInvoice_" + $self.windowNo + "' ><\/div> <\/div>"; tt += "<div> <label>" + VIS.Msg.getMsg("VA012_PaymentSchedules") + "<\/label> <select id='VA012_cmbPaymentSchedule_" + $self.windowNo + "'  style=' width: 100%; ' ><\/select> <\/div>"; tt += "<div id='VA012_divPaymentSchedules_" + $self.windowNo + "' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px;margin-top: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>"; $paymentSchedule.append(tt); at(); y = new VIS.ChildDialog; y.setContent($paymentSchedule); y.setTitle(VIS.Msg.getMsg("VA012_PaymentSchedules")); y.setWidth("500px"); ot(); y.setEnableResize(!1); y.setModal(!0); y.show(); yt(); st(); ht.value && (l.setValue(ht.value, !1, !0), k.find("*").prop("disabled", !0)); gt.value && (h.setValue(gt.value, !1, !0), w.find("*").prop("disabled", !0)); n.on("change", function () { n.val() > 0 && v.checkScheduleCondition(n.val(), parseInt(f.attr("data-uid")), "", r(i.getControl().val())) && (ee(parseInt(n.val()), d) ? VIS.ADialog.info("VA012_AlreadySelected", null, "", "") : (d.push(parseInt(n.val())), bi.push(this.options[this.selectedIndex].getAttribute("paymentdata")), vt.push(this.options[this.selectedIndex].getAttribute("paymentamount")), ot(), ct(), v.setInvoiceAndBPartner(n.val(), "IS")), tr.val(bi.toString())) }); $_divPaymentSchedules.on(VIS.Events.onTouchStartOrClick, lt); y.onOkClick = function () { }; y.onCancelClick = function () { u.scheduleRefresh(); wt(); f[0].attributes["data-uid"].value > 0 ? it.statementListRecordEdit(f[0].attributes["data-uid"].value, 0, !1) : u.refreshForm(!1) } }, prepayOrderDialog: function () { function r() { var t = "", n; for ($_divPrepayOrders.html(""), n = 0; n < ou.length; n++)t = "<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='" + ou[n] + "'  data-udata='" + su[n] + "' class='glyphicon glyphicon-remove'><\/span><\/a> <span>" + su[n] + "<\/span> <\/div>", $_divPrepayOrders.append(t) } function u(n) { var i = t(n.target); i.hasClass("glyphicon-remove") && (ou.splice(ou.indexOf(i.data("uid")), 1), su.splice(su.indexOf(i.data("udata")), 1), i.parent().parent().remove(), te.val(su.toString())) } function f() { $_divPrepayOrders = $prepayOrder.find("#VA012_divPrepayOrders_" + $self.windowNo) } var i, n; $prepayOrder = t("<div class='va012-popform-content'>"); i = ""; i = "<div id='VA012_divPrepayOrders_" + $self.windowNo + "' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>"; $prepayOrder.append(i); f(); n = new VIS.ChildDialog; n.setContent($prepayOrder); n.setTitle(VIS.Msg.getMsg("VA012_PrepayOrders")); n.setWidth("500px"); r(); n.setEnableResize(!1); n.setModal(!0); n.show(); $_divPrepayOrders.on(VIS.Events.onTouchStartOrClick, u) } }; u = { newRecord: function () { function it(n) { datasource = []; for (var t = 0; t < n.length; t++)datasource.push({ label: n[t].name, value: n[t].name, ids: n[t].chargeID }); rt.autocomplete("option", "source", datasource); rt.autocomplete("search", ""); rt.trigger("focus") } function ct(n, i) { rt.attr("chargeid", 0); t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetCharge", dataType: "json", data: { searchText: n, voucherType: p.val() != null ? p.val() : "", bankAcct: s.val() != null ? s.val() : 0 }, success: function (n) { var r = JSON.parse(n); datasource = []; i(t.map(r, function (n) { return { label: n.name, value: n.name, ids: n.chargeID } })); t(self.div).autocomplete("search", ""); t(self.div).trigger("focus") } }) } function n() { p.val() == "V" ? (h.val(at).prop("selected", !0), h.removeClass("va012-mandatory"), h.attr("disabled", !0)) : (t(h[0]).siblings().show(), h.val(0).prop("selected", !0), h.addClass("va012-mandatory"), h.attr("disabled", !1)) } f = l.find("#VA012_formNewRecord_" + $self.windowNo); gf = l.find("#VA012_formBtnNewRecord_" + $self.windowNo); u.getNewRecordDesign(); u.getNewRecordControls(); u.loadCurrency(); u.loadVoucherMatch(); u.loadContraType(); u.loadCashBook(); u.loadDifferenceType(); u.loadTransferType(); u.loadNewFormCurrency(); u.loadConversionTypes(); u.loadPaymentMethods(); u.loadCharge(); u.loadTaxRate(); u.loadPayment(); u.loadOrder(); u.loadBusinessPartner(); u.loadTrxOrg(); u.loadInvoice(); u.loadCashLine(); r(i.getControl().val()) <= 0 && i.getControl().addClass("va012-mandatory"); ni.val() != "" && ni.removeClass("va012-mandatory"); nt.val() != "" && nt.removeClass("va012-mandatory"); rt.on("blur", function () { (rt.val() == "" || rt.val() == null) && rt.attr("chargeid", 0) }); ke.on(VIS.Events.onTouchStartOrClick, function () { VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetCharge", { searchText: "", voucherType: p.val() != null ? p.val() : "", bankAcct: s.val() != null ? s.val() : 0 }, it) }); rt.autocomplete({ minLength: 0, scroll: !0, source: function (n, t) { n.term.trim().length != 0 && ct(n.term, t) }, select: function (n, i) { t(this).val(i.item.ids); t(this).attr("chargeid", i.item.ids); parseInt(t(this).val()) && rt.removeClass("va012-mandatory") } }); kt.on(VIS.Events.onTouchStartOrClick, function () { kt.attr("activestatus") == "0" ? (f.show(), kt.attr("activestatus", "1"), kt.removeClass("vis vis-plus"), kt.addClass("fa fa-minus"), kt.attr("title", "Collapse")) : (f.hide(), kt.attr("activestatus", "0"), kt.addClass("vis vis-plus"), kt.removeClass("fa fa-minus"), kt.attr("title", "Expand")); r(i.getControl().val()) <= 0 && i.getControl().addClass("va012-mandatory"); ni.val() != "" && ni.removeClass("va012-mandatory"); nt.val() != "" && nt.removeClass("va012-mandatory"); u.scheduleRefresh(); u.prepayRefresh(); u.refreshForm(); h.trigger("change"); v.setPaymentListHeight() }); we.on(VIS.Events.onTouchStartOrClick, function () { u.scheduleRefresh(); u.prepayRefresh(); u.refreshForm(); h.trigger("change") }); f.hide(); p.on("change", function () { p.val() == "M" ? (VIS.Utility.Util.getValueOfInt(oi) != 0 && event != null && event.currentTarget.className != ki[0].className && (u.refreshSelectedValues(), n()), _divCtrlCashLine.find("*").prop("disabled", !0), _divCtrlCashLine.hide(), vr.find("*").prop("disabled", !0), ru.find("*").prop("disabled", !0), yr.find("*").prop("disabled", !0), uu.find("*").prop("disabled", !0), vr.hide(), ru.hide(), yr.hide(), uu.hide(), _divPaymentMethod.show(), uo > 0 ? (li.show(), li.find("*").prop("disabled", !1)) : (li.find("*").prop("disabled", !0), li.hide()), k.val() == "CH" ? (u.loadCharge(), fi.find("*").prop("disabled", !1), ei.find("*").prop("disabled", !1), ai.find("*").prop("disabled", !1)) : (fi.hide(), ei.hide(), ai.hide(), fi.find("*").prop("disabled", !0), ei.find("*").prop("disabled", !0), ai.find("*").prop("disabled", !0)), divRow4Col1TrxAmt.show(), du.show(), pi.show(), pr.show(), wr.show(), br.show(), kr.show(), dr.show(), pr.find("*").prop("disabled", !1), wr.find("*").prop("disabled", !1), br.find("*").prop("disabled", !1), kr.find("*").prop("disabled", !1), dr.find("*").prop("disabled", !1), tr.prop("disabled", !0), ku.css("pointer-events", "auto"), ut.removeClass("va012-mandatory"), rt.removeClass("va012-mandatory"), k.val() != "CH" && (ot.prop("selectedIndex", 0), rt.attr("chargeid", 0), rt.val(""), ut.prop("selectedIndex", 0), bt.setValue(0)), ot.removeClass("va012-mandatory"), t(".astric_" + $self.windowNo).hide(), t("#Ast_ContraType_" + $self.windowNo).hide(), t("#Ast_DifferenceType_" + $self.windowNo).hide(), t("#Ast_Difference_" + $self.windowNo).hide()) : p.val() == "V" ? ((oi != 0 || ri != 0 || d.length > 0 || dt != 0 && event != null && event.currentTarget.className != ki[0].className) && (u.refreshSelectedValues(), n()), u.loadCharge(), _divCtrlCashLine.find("*").prop("disabled", !0), _divCtrlCashLine.hide(), vr.find("*").prop("disabled", !0), ru.find("*").prop("disabled", !0), yr.find("*").prop("disabled", !0), uu.find("*").prop("disabled", !0), vr.hide(), ot.prop("selectedIndex", 0), ru.hide(), yr.hide(), uu.hide(), li.show(), fi.show(), ei.show(), ai.show(), li.find("*").prop("disabled", !1), fi.find("*").prop("disabled", !1), ei.find("*").prop("disabled", !1), _divPaymentMethod.show(), VIS.Utility.Util.getValueOfInt(rt.attr("chargeid")) == 0 && rt.addClass("va012-mandatory"), VIS.Utility.Util.getValueOfInt(ut.val()) == 0 && ut.addClass("va012-mandatory"), pr.find("*").prop("disabled", !0), wr.find("*").prop("disabled", !0), br.find("*").prop("disabled", !1), kr.find("*").prop("disabled", !0), dr.find("*").prop("disabled", !0), ku.css("pointer-events", "none"), divRow4Col1TrxAmt.hide(), c.setValue(0), du.hide(), w.setValue(0), w.getControl().removeClass("va012-mandatory"), pi.hide(), pi.find("*").prop("disabled", !0), k.removeClass("va012-mandatory"), pr.hide(), wr.hide(), br.hide(), kr.hide(), dr.hide(), ot.removeClass("va012-mandatory"), t(".astric_" + $self.windowNo).show(), t("#Ast_ContraType_" + $self.windowNo).hide(), et.getControl().removeClass("va012-mandatory"), t("#Ast_CashJournalLine_" + $self.windowNo).hide()) : p.val() == "C" && ((ri != 0 || d.length > 0 || dt != 0 && event != null && event.currentTarget.className != ki[0].className) && (u.refreshSelectedValues(), n()), u.loadCharge(), vr.show(), yr.show(), vr.find("*").prop("disabled", !1), yr.find("*").prop("disabled", !1), divRow4Col1TrxAmt.show(), du.show(), pi.show(), _divPaymentMethod.hide(), r(w.getControl().val()) == 0 && (li.find("*").prop("disabled", !0), fi.find("*").prop("disabled", !0), ei.find("*").prop("disabled", !0), ai.find("*").prop("disabled", !0), li.hide(), fi.hide(), ei.hide(), ai.hide()), pr.find("*").prop("disabled", !0), wr.find("*").prop("disabled", !0), br.find("*").prop("disabled", !0), kr.find("*").prop("disabled", !0), dr.find("*").prop("disabled", !0), ku.css("pointer-events", "none"), pr.hide(), wr.hide(), br.hide(), kr.hide(), dr.hide(), (ot.val() == null || ot.val() == "" || ot.val() == 0) && ot.addClass("va012-mandatory"), ut.removeClass("va012-mandatory"), rt.removeClass("va012-mandatory"), t(".astric_" + $self.windowNo).hide(), t("#Ast_ContraType_" + $self.windowNo).show()); nu.hide(); nu.find("*").prop("disabled", !0); ki.text(VIS.Msg.getMsg("VA012_More")); v.setPaymentListHeight() }); k.on("change", function () { k.val() == "CH" ? (li.show(), fi.show(), ei.show(), ai.show(), li.find("*").prop("disabled", !1), fi.find("*").prop("disabled", !1), ei.find("*").prop("disabled", !1), (rt.val() == null || rt.val() == "") && rt.addClass("va012-mandatory"), ut.val() == 0 && ut.addClass("va012-mandatory"), t(".astric_" + $self.windowNo).show()) : (p.val() == "M" || p.val() == "C") && (fi.find("*").prop("disabled", !0), ei.find("*").prop("disabled", !0), ai.find("*").prop("disabled", !0), fi.hide(), ei.hide(), ai.hide(), sr.prop("selectedIndex", 0), rt.attr("chargeid", 0), rt.val(""), ut.prop("selectedIndex", 0), bt.setValue(0), rt.removeClass("va012-mandatory"), ut.removeClass("va012-mandatory")); k.val() <= 0 && r(w.getControl().val()) != 0 ? (k.addClass("va012-mandatory"), t("#Ast_DifferenceType_" + $self.windowNo).show()) : k.removeClass("va012-mandatory"); v.setPaymentListHeight() }); ot.on("change", function () { ot.val() != null && ot.val() != "" && ot.val() != 0 ? ot.removeClass("va012-mandatory") : ot.addClass("va012-mandatory"); ot.val() == "CB" ? (ru.find("*").prop("disabled", !1), uu.find("*").prop("disabled", !1), t(".astric_" + $self.windowNo).hide(), et.getControl().addClass("va012-mandatory"), t("#Ast_CashJournalLine_" + $self.windowNo).show()) : (fr.prop("selectedIndex", 0), hu.val(""), ru.find("*").prop("disabled", !0), uu.find("*").prop("disabled", !0), t(".astric_" + $self.windowNo).hide(), et.getControl().removeClass("va012-mandatory"), t("#Ast_CashJournalLine_" + $self.windowNo).hide()); ot.val() == "BB" ? (_divCtrlCashLine.find("*").prop("disabled", !0), _divCtrlCashLine.hide(), t(".astric_" + $self.windowNo).show(), li.show(), fi.show(), ei.show(), ai.show(), li.find("*").prop("disabled", !1), fi.find("*").prop("disabled", !1), ei.find("*").prop("disabled", !1), rt.addClass("va012-mandatory"), ut.addClass("va012-mandatory"), et.getControl().removeClass("va012-mandatory"), t("#Ast_CashJournalLine_" + $self.windowNo).hide()) : p.val() == "C" && (_divCtrlCashLine.show(), _divCtrlCashLine.find("*").prop("disabled", !1), li.find("*").prop("disabled", !0), r(w.getControl().val()) == 0 && (fi.find("*").prop("disabled", !0), ei.find("*").prop("disabled", !0), ai.find("*").prop("disabled", !0), fi.hide(), ei.hide(), ai.hide(), rt.removeClass("va012-mandatory"), ut.removeClass("va012-mandatory")), ai.hide()); v.setPaymentListHeight() }); h.on("change", function () { VIS.Utility.Util.getValueOfInt(h.val()) > 0 ? h.removeClass("va012-mandatory") : h.addClass("va012-mandatory") }); a.on("change", function () { if (VIS.Utility.Util.getValueOfInt(a.val()) > 0) { var n = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetAutoCheckNo", { bnkAct_Id: s.val(), _PayMethod: a.val(), _InvSchdleList: d, voucherMatch: p.val() }); if (n._paymentBaseType == "S") { if (hr.show(), wi) { g.val() || (g.val(wi), g.attr("disabled", !0), g.removeClass("va012-mandatory"), cr.show(), ft.val(au), ft.removeClass("va012-mandatory"), a.removeClass("va012-mandatory")); return } (d.length > 0 || p.val() == "V") && n && (n._checkNo ? (g.val(n._checkNo), g.attr("disabled", !0), g.removeClass("va012-mandatory")) : (g.val(""), g.attr("disabled", !1), g.addClass("va012-mandatory")), n._status && (g.val(""), VIS.ADialog.info("", null, n._status, ""))); g.val() ? (g.attr("disabled", !0), g.removeClass("va012-mandatory"), lr = !1, wi = null) : (g.attr("disabled", !1), g.addClass("va012-mandatory"), lr = !0, wi = null); cr.show(); ft.val() ? (ft.attr("disabled", !0), ft.removeClass("va012-mandatory"), au = null) : (ft.attr("disabled", !1), ft.addClass("va012-mandatory"), au = null) } else hr.hide(), g.val(""), g.removeClass("va012-mandatory"), cr.hide(), ft.val(""), ft.removeClass("va012-mandatory"); a.removeClass("va012-mandatory") } else a.attr("disabled", !1), a.addClass("va012-mandatory"), g.val(""), hr.hide(), g.removeClass("va012-mandatory"), ft.val(""), cr.hide(), ft.removeClass("va012-mandatory") }); g.on("change", function () { g.val() ? (g.removeClass("va012-mandatory"), lr = !0, wi = g.val()) : (g.addClass("va012-mandatory"), lr = !1, wi = null) }); ft.on("change", function () { ft.val() ? (tt.value || ft.val() > nt.val() && (ft.val(""), VIS.ADialog.info("VA012_ChkDateCantbeGratrStmtDate", null, "", "")), ft.removeClass("va012-mandatory")) : ft.addClass("va012-mandatory") }); y.on("change", function () { if (VIS.Utility.Util.getValueOfInt(y.val()) > 0) { var n = null; d != null && d.length > 0 && (n = d.toString()); n != null || VIS.Utility.Util.getValueOfInt(st.value) != 0 || VIS.Utility.Util.getValueOfInt(tt.value) != 0 || VIS.Utility.Util.getValueOfInt(et.value) != 0 ? t.ajax({ type: "POST", url: VIS.Application.contextUrl + "BankStatement/GetConvertedAmount", contentType: "application/json; charset=utf-8", data: JSON.stringify({ currency: at, conversionType: y.val(), stmtDate: nt.val(), _schedules: n, _accountId: s.val(), orderId: dt, paymentId: ri, cashLineId: oi }), success: function (n) { n = JSON.parse(n); n != null && (n._convertedAmt == 0 ? n.schedule_Ids != null && n.schedule_Ids.length > 0 && (VIS.Utility.Util.getValueOfInt(f.attr("data-uid")) == 0 && i.setValue(), c.setValue(), i.getControl().addClass("va012-mandatory"), c.getControl().addClass("va012-mandatory"), VIS.ADialog.info("VA012_ConversionRateNotFound", null, " - DocNo: " + n.schedule_Ids.toString(), "")) : (VIS.Utility.Util.getValueOfInt(f.attr("data-uid")) == 0 ? (i.setValue(n._convertedAmt), n._convertedAmt > 0 ? i.getControl().removeClass("va012-mandatory") : i.getControl().addClass("va012-mandatory")) : (c.setValue(n._convertedAmt), i.getControl().trigger("blur", [r(i.getControl().val()), r(c.getControl().val())])), dt == 0 && VIS.Utility.Util.getValueOfInt(f.attr("data-uid")) == 0 && (c.setValue(n._convertedAmt), i.getControl().trigger("blur", [r(i.getControl().val()), r(c.getControl().val())])))); t(y[0][0]).hide(); y.removeClass("va012-mandatory") }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) : y.removeClass("va012-mandatory") } else y.addClass("va012-mandatory") }); ut.on("change", function () { if (bt.setValue(0), ut.val() > 0) { var n = 0; if (n = r(w.getControl().val()) != 0 && p.val() != "V" ? r(w.getControl().val()) : r(i.getControl().val()), n != 0) { fe(ut.val(), n, b, t); function t(n) { n = JSON.parse(n); n != null && (bt.setValue(VIS.Utility.Util.getValueOfDecimal(n.TaxAmt)), ut.removeClass("va012-mandatory")) } } } else ut.addClass("va012-mandatory") }); ki.on(VIS.Events.onTouchStartOrClick, function () { ki.text() == VIS.Msg.getMsg("VA012_More") ? (ki.attr("visiblestatus", "1"), ki.text(VIS.Msg.getMsg("VA012_Hide")), vr.show(), yr.show(), _divCtrlCashLine.show(), li.show(), fi.show(), ei.show(), ai.show(), divRow4Col1TrxAmt.show(), du.show(), pi.show(), pr.show(), wr.show(), br.show(), kr.show(), dr.show(), p.val() == "V" && (nu.show(), fu > 0 ? nu.find("*").prop("disabled", !0) : nu.find("*").prop("disabled", !1))) : (ki.attr("visiblestatus", "0"), ki.text(VIS.Msg.getMsg("VA012_More")), p.trigger("change")); v.setPaymentListHeight() }); f.on("keyup", function (n) { n.which == 32 && (e.is(":focus") && e.trigger("click"), o.is(":focus") && o.trigger("click"), ki.is(":focus") && ki.trigger("click")); n.which == 13 && of.is(":focus") && of.trigger("click") }); of.on(VIS.Events.onTouchStartOrClick, function () { var n = u.getFormData(), f, t; if (gr) { VIS.ADialog.info("VA012_BSLAlreadyReconciled", null, "", ""); return } if (n[0]._cmbBankAccount == null || n[0]._cmbBankAccount == "" || n[0]._cmbBankAccount == "0") { VIS.ADialog.info("VA012_SelectBankAccountFirst", null, "", ""); return } if (n[0]._txtStatementNo == null || n[0]._txtStatementNo == "" || n[0]._txtStatementNo == "0") { VIS.ADialog.info("VA012_PleaseEnterStatementNo", null, "", ""); return } if (n[0]._dtStatementDate == null || n[0]._dtStatementDate == "" || n[0]._dtStatementDate == "0") { VIS.ADialog.info("VA012_PleaseEnterStatementDate", null, "", ""); return } if (VIS.Utility.Util.getValueOfInt(n[0]._txtCurrency) == 0) { VIS.ADialog.info("VA012_PleaseSelectCurrency", null, "", ""); return } if (VIS.Utility.Util.getValueOfInt(n[0]._txtConversionType) == 0) { VIS.ADialog.info("VA012_PleaseSelectConversionType", null, "", ""); return } if (VIS.Utility.Util.getValueOfInt(n[0]._txtPaymentMethod) <= 0 && VIS.Utility.Util.getValueOfInt(n[0]._ctrlCashLine) <= 0 && n[0]._cmbVoucherMatch != "C") { VIS.ADialog.info("VA012_PleaseSelectPayMethod", null, "", ""); return } if (!n[0]._ctrlPayment && g.hasClass("va012-mandatory") && (n[0]._txtCheckNum == null || n[0]._txtCheckNum == "")) { VIS.ADialog.info("VA012_PleaseEnterCheckNo", null, "", ""); return } if (!n[0]._ctrlPayment && ft.hasClass("va012-mandatory") && !n[0]._txtCheckDate) { VIS.ADialog.info("VA012_PleaseSelectCheckDate", null, "", ""); return } if (!(n[0]._ctrlInvoice == null || n[0]._ctrlInvoice == "" || n[0]._ctrlInvoice == "0") && !(n[0]._ctrlBusinessPartner == null || n[0]._ctrlBusinessPartner == "" || n[0]._ctrlBusinessPartner == "0") && (n[0]._ctrlPayment == null || n[0]._ctrlPayment == "" || n[0]._ctrlPayment == "0") && (n[0]._scheduleList == null || n[0]._scheduleList == "")) { VIS.ADialog.info("VA012_PleaseSelectPaySchedule", null, "", ""); return } if (!(n[0]._ctrlBusinessPartner == null || n[0]._ctrlBusinessPartner == "" || n[0]._ctrlBusinessPartner == "0") && (n[0]._ctrlInvoice == null || n[0]._ctrlInvoice == "" || n[0]._ctrlInvoice == "0") && (n[0]._ctrlPayment == null || n[0]._ctrlPayment == "" || n[0]._ctrlPayment == "0") && (n[0]._scheduleList == null || n[0]._scheduleList == "") && (n[0]._ctrlOrder == null || n[0]._ctrlOrder == "" || n[0]._ctrlOrder == "0") && (n[0]._cmbCharge == null || n[0]._cmbCharge == "" || n[0]._cmbCharge == "0")) { VIS.ADialog.info("VA012_PleaseSelectAnyOne", null, "", ""); return } if (n[0]._cmbVoucherMatch == "M" && (n[0]._ctrlInvoice == null || n[0]._ctrlInvoice == "" || n[0]._ctrlInvoice == "0") && (n[0]._ctrlPayment == null || n[0]._ctrlPayment == "" || n[0]._ctrlPayment == "0") && (n[0]._scheduleList == null || n[0]._scheduleList == "") && (n[0]._ctrlOrder == null || n[0]._ctrlOrder == "" || n[0]._ctrlOrder == "0") && (n[0]._cmbCharge == null || n[0]._cmbCharge == "" || n[0]._cmbCharge == "0")) { VIS.ADialog.info("VA012_PleaseSelectAnyOne", null, "", ""); return } if (n[0]._txtAmount == null || n[0]._txtAmount == "" || n[0]._txtAmount == "0" || n[0]._txtAmount == "0.00") { VIS.ADialog.info("VA012_PleaseEnterAmount", null, "", ""); return } if (n[0]._cmbVoucherMatch == "C") if (n[0]._cmbContraType == "BB") { if (n[0]._cmbCharge == null || n[0]._cmbCharge == "" || n[0]._cmbCharge == "0") { VIS.ADialog.info("VA012_PleaseSelectCharge", null, "", ""); rt.addClass("va012-mandatory"); return } if (n[0]._cmbTaxRate == null || n[0]._cmbTaxRate == "" || n[0]._cmbTaxRate == "0") { VIS.ADialog.info("VA012_PleaseSelectTaxRate", null, "", ""); ut.addClass("va012-mandatory"); return } } else if (n[0]._cmbContraType == "CB") { if (n[0]._ctrlCashLine == null || n[0]._ctrlCashLine == "" || n[0]._ctrlCashLine == "0") { VIS.ADialog.info("VA012_PleaseSelectCashJournalLine", null, "", ""); return } } else { VIS.ADialog.info("VA012_PleaseSelectContraType", null, "", ""); return } if (n[0]._cmbVoucherMatch == "V") { if (n[0]._cmbCharge == null || n[0]._cmbCharge == "" || n[0]._cmbCharge == "0") { VIS.ADialog.info("VA012_PleaseSelectCharge", null, "", ""); rt.addClass("va012-mandatory"); return } if (n[0]._cmbTaxRate == null || n[0]._cmbTaxRate == "" || n[0]._cmbTaxRate == "0") { VIS.ADialog.info("VA012_PleaseSelectTaxRate", null, "", ""); ut.addClass("va012-mandatory"); return } } if (parseFloat(n[0]._txtDifference) != 0 && n[0]._cmbVoucherMatch == "M" && (n[0]._cmbDifferenceType == null || n[0]._cmbDifferenceType == "" || n[0]._cmbDifferenceType == "0")) { VIS.ADialog.info("VA012_PleaseSelectDifferenceType", null, "", ""); return } if (parseFloat(n[0]._txtDifference) != 0 && n[0]._cmbDifferenceType == "CH") { if (n[0]._cmbCharge == null || n[0]._cmbCharge == "" || n[0]._cmbCharge == "0") { VIS.ADialog.info("VA012_PleaseSelectCharge", null, "", ""); rt.addClass("va012-mandatory"); return } if (n[0]._cmbTaxRate == null || n[0]._cmbTaxRate == "" || n[0]._cmbTaxRate == "0") { VIS.ADialog.info("VA012_PleaseSelectTaxRate", null, "", ""); ut.addClass("va012-mandatory"); return } } if (parseFloat(n[0]._txtDifference) != 0 && VIS.Utility.Util.getValueOfInt(n[0]._ctrlPayment) != 0 && n[0]._cmbDifferenceType != "CH") { VIS.ADialog.info("VA012_PlsSelectDiffTypeCharge", null, "", ""); return } if (VIS.Utility.Util.getValueOfDecimal(n[0]._txtDifference) != 0 && VIS.Utility.Util.getValueOfInt(n[0]._scheduleList.length) > 0 && Math.abs(r(i.getControl().val())) > Math.abs(r(c.getControl().val())) && n[0]._cmbDifferenceType != "CH") { VIS.ADialog.info("MoreScheduleAmount", null, "", ""); return } if (VIS.Utility.Util.getValueOfString(n[0]._scheduleList) == "" && VIS.Utility.Util.getValueOfInt(n[0]._ctrlPayment) == 0 && VIS.Utility.Util.getValueOfInt(n[0]._ctrlOrder) == 0 && VIS.Utility.Util.getValueOfInt(n[0]._ctrlCashLine) == 0 && VIS.Utility.Util.getValueOfInt(n[0]._cmbCharge) == 0) { VIS.ADialog.info("VA012_PleaseSelectAnyOne", null, "", ""); return } if (VIS.Utility.Util.getValueOfString(n[0]._cmbDifferenceType) == "CH" || VIS.Utility.Util.getValueOfString(n[0]._cmbVoucherMatch) == "V") { if (f = VIS.Utility.Util.getValueOfInt(n[0]._cmbTaxRate), t = 0, t = VIS.Utility.Util.getValueOfString(n[0]._cmbDifferenceType) == "CH" ? VIS.Utility.Util.getValueOfDecimal(n[0]._txtDifference) : VIS.Utility.Util.getValueOfDecimal(n[0]._txtAmount), f > 0 && t != 0) { fe(n[0]._cmbTaxRate, t, b, i); function i(t) { t = JSON.parse(t); t != null && (n[0]._surChargeAmt = t.SurchargeAmt, n[0]._txtTaxAmount = t.TaxAmt, lt(l, !0, "absolute"), u.insertNewRecord(n, u.afterInsertion)) } } } else lt(l, !0, "absolute"), u.insertNewRecord(n, u.afterInsertion) }); ni.on("keypress", function () { ci.val("1"); er.val("10") }); ni.on("change", function () { ni.val() == "" ? ni.addClass("va012-mandatory") : ni.removeClass("va012-mandatory") }); er.on("keypress", function (n) { if (n.which != 8 && n.which != 0 && (n.which < 48 || n.which > 57)) return !1 }); ci.on("keypress", function (n) { if (n.which != 8 && n.which != 0 && (n.which < 48 || n.which > 57)) return !1 }); ci.on("change", function () { _origin = "LO"; t.ajax({ url: VIS.Application.contextUrl + "BankStatement/MaxStatement", type: "GET", datatype: "json", data: { _bankAccount: s.val() == null ? 0 : s.val(), _origin: _origin, _pageNo: ci.val() <= 0 ? 0 : ci.val() }, contentType: "application/json; charset=utf-8", success: function (n) { n != null && n != "" && (n = t.parseJSON(t.parseJSON(n)), ci.val() <= 0 && ni.val() == n.statementNo ? (er.val(n.lineno), ci.val(n.pageno), VIS.ADialog.info("VA012_NotAcceptZero", null, "", "")) : ci.val() > 0 && ni.val() == n.statementNo ? er.val(n.lineno) : ci.val() <= 0 && (ci.val("1"), VIS.ADialog.info("VA012_NotAcceptZero", null, "", ""))) } }) }); ne.on(VIS.Events.onTouchStartOrClick, function () { u.scheduleRefresh(); u.prepayRefresh(); u.refreshForm(); (ni.val() == "" || ni.val() == null) && ni.val("0"); v.getMaxStatement("BT"); f.attr("data-uid", 0) }); bt.getControl().on("change", function () { r(bt.getControl().val()) == 0 || r(bt.getControl().val()) == null ? bt.setValue(0) : bt.setValue(VIS.Utility.Util.getValueOfDecimal(r(bt.getControl().val()))) }); c.getControl().on("blur", function (n, u, e) { if (p.val() != "V") if (VIS.Utility.Util.getValueOfDecimal(u) != 0 && (i.setValue(), i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(u).toFixed(b)))), VIS.Utility.Util.getValueOfDecimal(e) != 0 && (c.setValue(), c.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(e).toFixed(b)))), VIS.Utility.Util.getValueOfDecimal(r(c.getControl().val())) == 0 ? (c.setValue(0), c.getControl().addClass("va012-mandatory")) : VIS.Utility.Util.getValueOfDecimal(r(c.getControl().val())) < 0 ? c.getControl().addClass("va012-mandatory") : (c.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(r(c.getControl().val())).toFixed(b))), c.getControl().removeClass("va012-mandatory")), w.getControl().attr("vchangable") == "Y" && (w.setValue(0), pi.find("*").prop("disabled", !0)), p.val() == "M" || p.val() == "C") { if (w.getControl().attr("vchangable") == "Y" && (w.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(r(c.getControl().val()) - r(i.getControl().val())).toFixed(b))), VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val())) != 0 ? (VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val())) < 0 ? (w.getControl().addClass("va012-mandatory"), t("#Ast_Difference_" + $self.windowNo).show()) : w.getControl().removeClass("va012-mandatory"), r(c.getControl().val()) == 0 ? (pi.find("*").prop("disabled", !0), k.val("0")) : pi.find("*").prop("disabled", !1), (d.length == 0 || d.length > 0 && f.attr("data-uid") != 0 && Math.abs(r(c.getControl().val())) < Math.abs(r(i.getControl().val()))) && (VIS.Utility.Util.getValueOfInt(st.value) == 0 && f.attr("data-uid") == 0 || f.attr("data-uid") != 0) && (k.find("option[value=0]").prop("disabled", !0), k.find("option[value=OU]").prop("disabled", !0), k.find("option[value=DA]").prop("disabled", !0), k.find("option[value=WO]").prop("disabled", !0), k.val() != "CH" && k.val("0").prop("selected", !0)), k.val() <= 0 && r(c.getControl().val()) != 0 ? (k.addClass("va012-mandatory"), t("#Ast_DifferenceType_" + $self.windowNo).show()) : k.removeClass("va012-mandatory")) : (pi.find("*").prop("disabled", !0), k.val("0").prop("selected", !0), k.trigger("change"), k.removeClass("va012-mandatory"), t("#Ast_DifferenceType_" + $self.windowNo).hide())), VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val())) != 0 && ut.val() > 0) { fe(ut.val(), r(w.getControl().val()), b, n); function n(n) { n = JSON.parse(n); n != null && n != 0 && bt.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(n.TaxAmt).toFixed(b))); ut.val() > 0 && VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val())) != 0 && (VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val())) < 0 ? w.getControl().addClass("va012-mandatory") : w.getControl().removeClass("va012-mandatory")); VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val())) != 0 && (VIS.Utility.Util.getValueOfInt(tt.getValue()) != 0 || VIS.Utility.Util.getValueOfInt(et.getValue()) != 0) ? (k.val("CH").prop("selected", !0), k.trigger("change")) : VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val())) != 0 && d.toString() != "" || (k.val("0").prop("selected", !0), k.trigger("change")) } } } else VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val())) != 0 && VIS.Utility.Util.getValueOfInt(tt.getValue()) != 0 && (k.val("CH").prop("selected", !0), k.trigger("change")) }); w.getControl().on("blur", function () { r(w.getControl().val()) == 0 || r(w.getControl().val()) == null ? pi.find("*").prop("disabled", !0) : pi.find("*").prop("disabled", !1) }); i.getControl().on("blur", function (n, t) { VIS.Utility.Util.getValueOfDecimal(t) != 0 && (i.setValue(), i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(t).toFixed(b)))); VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) == 0 && (i.setValue(0), i.getControl().addClass("va012-mandatory")); var u = VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())); if (o.attr("v_active") == "1" && u > 0 && (i.setValue(), i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(-1 * u).toFixed(b)))), e.attr("v_active") == "1" && u < 0 && (i.setValue(), i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(-1 * u).toFixed(b)))), VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) < 0 ? (o.removeClass("va012-inactive"), o.addClass("va012-active"), o.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0"), i.getControl().addClass("va012-mandatory")) : VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) > 0 && (e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), o.removeClass("va012-active"), o.addClass("va012-inactive"), o.attr("v_active", "0"), i.getControl().removeClass("va012-mandatory")), VIS.Utility.Util.getValueOfInt(ut.val()) > 0 && r(i.getControl().val()) != 0 && p.val() == "V") { fe(ut.val(), r(i.getControl().val()), b, n); function n(n) { n = JSON.parse(n); n != null && n != 0 && (bt.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(n.TaxAmt).toFixed(b))), ut.removeClass("va012-mandatory")); c.getControl().trigger("blur", [r(i.getControl().val()), r(c.getControl().val())]) } } else c.getControl().trigger("blur", [r(i.getControl().val()), r(c.getControl().val())]) }); ie.hover(function () { $tooltip = t('<div  class="va012-div-tooltip"><h4>' + VIS.Msg.getMsg("VA012_Information") + "<\/h4><p>" + VIS.Msg.getMsg("VA012_InformationText") + "<\/p><\/div>"); l.append($tooltip); t(".va012-div-tooltip").show() }, function () { l.find(".va012-div-tooltip").remove() }); nt.on("blur", function () { if (nt.val() == "") nt.addClass("va012-mandatory"); else if (!(f[0].attributes["data-uid"].value > 0) || !(tt.getValue() > 0 || et.getValue() > 0 || gt.getValue() > 0 || st.getValue() > 0 || d.length > 0)) { nt.removeClass("va012-mandatory"); var u = 0, n = null, t = null; if (p.val() == "M" ? tr.val() != 0 && (tt.getValue() == null || tt.getValue() == 0) ? d.length != 0 && (n = "IS", t = d.join()) : (tr.val() == null || tr.val() == 0) && tt.getValue() != null && tt.getValue() != 0 ? (n = "PY", t = tt.getValue()) : VIS.Utility.Util.getValueOfInt(st.value) != 0 && VIS.Utility.Util.getValueOfInt(ht.value) != 0 && (n = "PO", t = st.value, i.getControl().attr("disabled", !0)) : p.val() == "C" && VIS.Utility.Util.getValueOfInt(et.value) != 0 && VIS.Utility.Util.getValueOfInt(tt.getValue()) == 0 && VIS.Utility.Util.getValueOfInt(tr.val()) == 0 && (n = "CO", t = et.value), n != null && t != null) { VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetConvtAmount", { recordID: t, bnkAct_Id: s.val(), transcType: n, stmtDate: nt.val() }, f); function f(t) { for (var f = 0; f < t.length; f++) { if (t.length == 0 || t[f].DueAmount == 0) { i.setValue(); c.setValue(); w.setValue(); w.getControl().trigger("blur"); i.getControl().trigger("blur", [r(i.getControl().val()), r(c.getControl().val())]); VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } u += t[f].DueAmount } if (u != 0) i.setValue(u), n != "PO" ? (c.setValue(u), i.getControl().trigger("blur", [r(i.getControl().val()), r(c.getControl().val())])) : (i.getControl().removeClass("va012-mandatory"), i.getControl().attr("disabled", !0), e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), o.removeClass("va012-active"), o.addClass("va012-inactive"), o.attr("v_active", "0")); else { i.setValue(); c.setValue(); w.setValue(); w.getControl().trigger("blur"); VIS.ADialog.info("VA012_ConversionRateNotFound", null, "", ""); return } } } } }); ie.mousemove(function (n) { t(".va012-div-tooltip").css("top", n.pageY - 50).css("left", n.pageX) }); e.on(VIS.Events.onTouchStartOrClick, function () { r(c.getControl().val()) == 0 && VIS.Utility.Util.getValueOfInt(st.value) > 0 || p.val() != "M" && (VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) < 0 && i.setValue(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) * -1), e.removeClass("va012-inactive"), e.addClass("va012-active"), e.attr("v_active", "1"), o.removeClass("va012-active"), o.addClass("va012-inactive"), o.attr("v_active", "0"), i.getControl().trigger("blur", [r(i.getControl().val()), r(c.getControl().val())])) }); o.on(VIS.Events.onTouchStartOrClick, function () { r(c.getControl().val()) == 0 && VIS.Utility.Util.getValueOfInt(st.value) > 0 || p.val() != "M" && (VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) > 0 && i.setValue(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val())) * -1), o.removeClass("va012-inactive"), o.addClass("va012-active"), o.attr("v_active", "1"), e.removeClass("va012-active"), e.addClass("va012-inactive"), e.attr("v_active", "0"), i.getControl().trigger("blur", [r(i.getControl().val()), r(c.getControl().val())])) }) }, getNewRecordDesign: function () { }, getNewRecordControls: function () { ni = f.find("#VA012_txtStatementNo_" + $self.windowNo); ne = f.find("#VA012_btnStatementNo_" + $self.windowNo); ci = f.find("#VA012_txtStatementPage_" + $self.windowNo); er = f.find("#VA012_txtStatementLine_" + $self.windowNo); nt = f.find("#VA012_dtStatementDate_" + $self.windowNo); ot = f.find("#VA012_cmbContraType_" + $self.windowNo); fr = f.find("#VA012_cmbCashBook_" + $self.windowNo); or = f.find("#VA012_cmbTransferType_" + $self.windowNo); hu = f.find("#VA012_txtCheckNo_" + $self.windowNo); p = f.find("#VA012_cmbVoucherMatch_" + $self.windowNo); i.getControl().addClass("va012-mandatory"); c.getControl().addClass("va012-mandatory"); k = f.find("#VA012_cmbDifferenceType_" + $self.windowNo); ar = f.find("#VA012_txtVoucherNo_" + $self.windowNo); pu = f.find("#VA012_txtDescription_" + $self.windowNo); sr = f.find("#VA012_cmbCharge_" + $self.windowNo); rt = f.find("#VA012_txtCharge_" + $self.windowNo); ut = f.find("#VA012_cmbTaxRate_" + $self.windowNo); wu = f.find("#VA012_ctrlCashLine_" + $self.windowNo); iu = f.find("#VA012_ctrlPayment_" + $self.windowNo); uf = f.find("#VA012_ctrlOrder_" + $self.windowNo); ff = f.find("#VA012_ctrlInvoice_" + $self.windowNo); ef = f.find("#VA012_ctrlBusinessPartner_" + $self.windowNo); bu = f.find("#VA012_chkUseNextTime_" + $self.windowNo); of = f.find("#VA012_btnSave_" + $self.windowNo); ku = f.find("#VA012_btnPaymentSchedule_" + $self.windowNo); pe = f.find("#VA012_btnPrepay_" + $self.windowNo); tr = f.find("#VA012_txtPaymentSchedule_" + $self.windowNo); te = f.find("#VA012_txtPrepayOrder_" + $self.windowNo); kt = gf.find("#VA012_btnNewRecord_" + $self.windowNo); we = gf.find("#VA012_btnUndo_" + $self.windowNo); be = l.find("#VA012_btnDelete_" + $self.windowNo); ie = f.find("#VA012_btnAmount_" + $self.windowNo); e = f.find("#VA012_btnIn_" + $self.windowNo); o = f.find("#VA012_btnOut_" + $self.windowNo); h = f.find("#VA012_txtCurrency_" + $self.windowNo); y = f.find("#VA012_txtConversionType_" + $self.windowNo); a = f.find("#VA012_txtPaymentMethod_" + $self.windowNo); g = f.find("#VA012_txtCheckNum_" + $self.windowNo); ft = f.find("#VA012_txtCheckDate_" + $self.windowNo); nf = f.find("#VA012_ctrlTrxOrg_" + $self.windowNo) }, loadPaymentMethod: function () { function n(n) { if (_cmbPaymentMethod.html(""), _cmbPaymentMethod.append("<option value=0 ><\/option>"), n != null) for (var t = 0; t < n.length; t++)_cmbPaymentMethod.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].Value) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"); _cmbPaymentMethod.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/LoadPaymentMethod", { AD_Client: VIS.Env.getCtx().getAD_Client_ID(), AD_Org: VIS.Env.getCtx().getAD_Org_ID() }, n) }, loadCurrency: function () { var n = VIS.Utility.Util.getValueOfInt(t("option:selected", s).attr("currencyid")), i = VIS.Utility.Util.getValueOfInt(t("option:selected", s).attr("stdprecision")); n > 0 ? at = n : n = null; b = i > 0 ? i : null }, loadCashBook: function () { function n(n) { if (fr.html(""), fr.append("<option value=0 ><\/option>"), n != null) for (var t = 0; t < n.length; t++)fr.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].Value) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"); fr.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/LoadCashbook", null, n) }, loadContraType: function () { ot.html(""); ot.append("<option value=0 ><\/option>"); ot.append("<option value='BB' >" + VIS.Msg.getMsg("VA012_BankToBank") + "<\/option>"); ot.append("<option value='CB' >" + VIS.Msg.getMsg("VA012_CashToBank") + "<\/option>"); ot.prop("selectedIndex", 0) }, loadTransferType: function () { or.html(""); or.append("<option value=0 ><\/option>"); or.append("<option value='CH' >" + VIS.Msg.getMsg("VA012_Cash") + "<\/option>"); or.append("<option value='CK' >" + VIS.Msg.getMsg("VA012_Check") + "<\/option>"); or.prop("selectedIndex", 0) }, loadVoucherMatch: function () { p.html(""); p.append("<option value='M' >" + VIS.Msg.getMsg("VA012_Payment") + "<\/option>"); p.append("<option value='V' >" + VIS.Msg.getMsg("VA012_Voucher") + "<\/option>"); p.append("<option value='C' >" + VIS.Msg.getMsg("VA012_Contra") + "<\/option>"); p.prop("selectedIndex", 0) }, loadDifferenceType: function () { k.html(""); k.append("<option value=0 ><\/option>"); k.append("<option value='OU' >" + VIS.Msg.getMsg("VA012_OverUnderPayment") + "<\/option>"); k.append("<option value='DA' >" + VIS.Msg.getMsg("VA012_DiscountAmount") + "<\/option>"); k.append("<option value='WO' >" + VIS.Msg.getMsg("VA012_WriteoffAmount") + "<\/option>"); k.append("<option value='CH' >" + VIS.Msg.getMsg("VA012_Charge") + "<\/option>"); k.prop("selectedIndex", 0) }, loadCharge: function () { function n(n) { if (sr.html(""), sr.append("<option value=0 ><\/option>"), n != null) for (var t = 0; t < n.length; t++)sr.append("<option value=" + n[t].chargeID + ">" + VIS.Utility.encodeText(n[t].name) + "<\/option>"); sr.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetChargeData", { voucherType: p.val() != null ? p.val() : "", bankAcct: s.val() != null ? s.val() : 0 }, n) }, loadTaxRate: function () { function n(n) { if (ut.html(""), ut.append("<option value=0 ><\/option>"), n != null) for (var t = 0; t < n.length; t++)ut.append("<option value=" + n[t].C_Tax_ID + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"); ut.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/LoadTaxRate", null, n) }, loadPayment: function () { iu != undefined && iu != null && iu.empty(); var n = VIS.Utility.Util.getValueOfInt(s.val()) != 0 ? "C_Payment.DocStatus IN ('CO','CL') AND C_Payment.IsReconciled = 'N' AND C_Payment.C_BankAccount_ID = @BankAccount_ID@" : "C_Payment.DocStatus IN ('CO','CL') AND C_Payment.IsReconciled = 'N' "; to = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 0, VIS.DisplayType.Search, "C_Payment_ID", 0, !1, n); tt = new VIS.Controls.VTextBoxButton("C_Payment_ID", !1, !1, !0, VIS.DisplayType.Search, to); tt.getControl().addClass("va012-input-size-2"); tt.getControl().attr("tabindex", "10"); iu.append(tt.getControl()); iu.append(tt.getBtn(0)); iu.append(tt.getBtn(1)); tt.fireValueChanged = function () { if (VIS.Utility.Util.getValueOfInt(tt.value) != 0 && VIS.Utility.Util.getValueOfInt(ri) != 0) { VIS.Utility.Util.getValueOfInt(ri) == tt.value ? VIS.ADialog.info("VA012_AlreadySelected", null, "", "") : (tt.setValue(ri, !1, !0), VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord", null, "", "")); return } if (ri = 0, ri = tt.value, ii || ur || tt.value && (v.checkPaymentCondition(ri, 0, r(i.getControl().val())) ? v.setInvoiceAndBPartner(ri, "PY") : tt.setValue()), ur = !1, !tt.value && ri == null && tt.value == null) { var n = f[0].attributes["data-uid"].value; f[0].attributes["data-uid"].value != 0 || ri != null || tt.value || u.refreshForm(); n > 0 && ri == null && tt.value == null && it.statementListRecordEdit(n, 0, !0) } }; ur = !1 }, loadOrder: function () { lo = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 5043, VIS.DisplayType.Search, "C_Order_ID", 0, !1, "C_ORDER_ID IN (SELECT ORD.C_ORDER_ID  FROM C_Order ORD  LEFT JOIN C_DocType DT  ON (ORD.C_DOCTYPETARGET_ID=DT.C_DOCTYPE_ID)  INNER JOIN VA009_PaymentMethod PM  ON (PM.VA009_PAYMENTMETHOD_ID =ORD.VA009_PAYMENTMETHOD_ID )  WHERE DT.DOCSUBTYPESO         ='PR'   AND ORD.DOCSTATUS             ='WP'   AND ORD.ISACTIVE              ='Y'   AND PM.VA009_PAYMENTBASETYPE !='B')"); st = new VIS.Controls.VTextBoxButton("C_Order_ID", !1, !1, !0, VIS.DisplayType.Search, lo, lf("VAS_SalesOrder,Sales Order")); st.getControl().addClass("va012-input-size-2"); st.getControl().attr("tabindex", "13"); uf.append(st.getControl()); uf.append(st.getBtn(0)); uf.append(st.getBtn(1)); st.fireValueChanged = function () { if (VIS.Utility.Util.getValueOfInt(st.value) != 0 && VIS.Utility.Util.getValueOfInt(dt) != 0) { VIS.Utility.Util.getValueOfInt(dt) == st.value ? VIS.ADialog.info("VA012_AlreadySelected", null, "", "") : (st.setValue(dt, !1, !0), VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord", null, "", "")); return } if (dt = 0, dt = st.value, st.value && (ii || (v.checkPrepayCondition(st.value, 0, null, r(i.getControl().val())) ? (v.setInvoiceAndBPartner(dt, "PO"), (f[0].attributes["data-uid"].value > 0 && !dt || f[0].attributes["data-uid"].value == 0 && dt) && i.getControl().attr("disabled", !0)) : (dt = 0, st.setValue()))), !dt && !st.value) { var n = f[0].attributes["data-uid"].value; f[0].attributes["data-uid"].value != 0 || dt != null || st.value || u.refreshForm(); n > 0 && dt == null && !st.value && it.statementListRecordEdit(n, 0, !0) } } }, loadCashLine: function () { var n = " C_CASHLINE_ID IN (SELECT CSL.C_CASHLINE_ID  FROM C_Cash CS  INNER JOIN C_CashLine CSL  ON (CS.C_CASH_ID=CSL.C_CASH_ID)  INNER JOIN C_Charge chrg  ON (chrg.c_charge_id =csl.c_charge_id)  WHERE CS.ISACTIVE          ='Y'  AND CSL.CashType           ='C'  AND chrg.dtd001_chargetype ='CON'  AND CS.DOCSTATUS          IN ('CO','CL')  AND CSL.VA012_ISRECONCILED ='N'  AND CSL.C_BankAccount_ID =" + (s.val() == null ? 0 : s.val()) + " )"; wu.html(""); no = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 1008317, VIS.DisplayType.Search, "C_CashLine_ID", 0, !1, n); et = new VIS.Controls.VTextBoxButton("C_CashLine_ID", !1, !1, !0, VIS.DisplayType.Search, no); et.getControl().addClass("va012-input-size-2"); et.getControl().attr("tabindex", "10"); wu.append(et.getControl()); wu.append(et.getBtn(0)); wu.append(et.getBtn(1)); et.fireValueChanged = function () { if (VIS.Utility.Util.getValueOfInt(et.value) != 0 && VIS.Utility.Util.getValueOfInt(oi) != 0) { VIS.Utility.Util.getValueOfInt(oi) == et.value ? VIS.ADialog.info("VA012_AlreadySelected", null, "", "") : (et.setValue(oi, !1, !0), VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord", null, "", "")); return } if (oi = 0, oi = et.value, et.value && (ii || ur || v.checkContraCondition(et.value, 0, r(i.getControl().val())) || (oi = 0, et.setValue()), ur = !1), ur = !1, oi == null && et.value == null) { var n = f[0].attributes["data-uid"].value; f[0].attributes["data-uid"].value != 0 || oi != null || et.value || u.refreshForm(); n > 0 && oi == null && et.value == null && it.statementListRecordEdit(n, 0, !0) } } }, loadBusinessPartner: function () { re = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 2893, VIS.DisplayType.Search, "C_BPartner_ID", 0, !1, null); ht = new VIS.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, VIS.DisplayType.Search, re, lf("VAS_BusinessPartner,Business Partner")); ht.getControl().addClass("va012-input-size-2"); ht.getControl().attr("tabindex", "12"); ef.append(ht.getControl()); ef.append(ht.getBtn(0)); ef.append(ht.getBtn(1)); ht.fireValueChanged = function () { fu = 0; fu = ht.value; fu > 0 ? (nu.find("*").prop("disabled", !0), tf = 0, di.setValue()) : (nu.find("*").prop("disabled", !1), tf = 0) } }, loadTrxOrg: function () { var n = "AD_Org.IsActive='Y' AND AD_Org.IsSummary ='N' AND (AD_Org.IsCostCenter='Y' OR AD_Org.IsProfitCenter='Y') AND CAST(AD_Org.LegalEntityOrg AS int) IN(0,@BankAccount_Org_ID@) AND AD_Org.AD_Client_ID = " + VIS.context.getAD_Client_ID(), t = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 0, VIS.DisplayType.Search, "AD_Org_ID", 0, !1, n); di = new VIS.Controls.VTextBoxButton("AD_Org_ID", !1, !1, !0, VIS.DisplayType.Search, t, lf("Organization Units")); di.getControl().addClass("va012-input-size-2"); di.getControl().attr("tabindex", "13"); nf.append(di.getControl()); nf.append(di.getBtn(0)); nf.append(di.getBtn(1)); di.fireValueChanged = function () { tf = 0; tf = di.value } }, loadInvoice: function () { io = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 3484, VIS.DisplayType.MultiKey, "C_Invoice_ID", 0, !1, "DocStatus IN ('CO','CL')"); gt = new VIS.Controls.VTextBoxButton("C_Invoice_ID", !1, !1, !0, VIS.DisplayType.MultiKey, io); gt.isMultiKeyTextBox = !0; gt.getControl().addClass("va012-input-size-2"); gt.getControl().attr("tabindex", "11"); ff.append(gt.getControl()); ff.append(gt.getBtn(0)); ff.append(gt.getBtn(1)); gt.fireValueChanged = function () { eu = null; eu = gt.value; gt.value && (v.checkInvoiceCondition(eu, r(i.getControl().val())) ? v.setBPartner(eu) : gt.setValue()) } }, getFormData: function () { var n = {}, t = []; return n._bankStatementLineID = f.attr("data-uid"), n._txtStatementNo = ni.val(), n._txtStatementPage = ci.val(), n._txtStatementLine = er.val(), n._dtStatementDate = nt.val(), n._cmbCurrency = at, n._cmbVoucherMatch = p.val(), n._txtDescription = VIS.Utility.encodeText(pu.val()), n._txtVoucherNo = VIS.Utility.encodeText(ar.val()), n._cmbCharge = rt.attr("chargeid"), n._cmbTaxRate = ut.val(), n._txtTaxAmount = r(bt.getControl().val()), n._ctrlPayment = ri, n._ctrlOrder = dt, n._ctrlCashLine = oi, n._ctrlInvoice = eu, n._ctrlBusinessPartner = fu, n._chkUseNextTime = bu.is(":checked"), n._cmbBank = nr.val(), n._cmbBankAccount = s.val(), n._cmbBankAccountClasses = yf.val(), n._cmbTransactionType = ct.val(), n._scheduleList = d.toString(), n._cmbContraType = ot.val(), n._cmbCashBook = fr.val(), n._cmbTransferType = or.val(), n._txtCheckNo = hu.val(), n._cmbDifferenceType = k.val(), k.val() == "CH" && p.val() != "C" ? (n._txtAmount = r(c.getControl().val()), n._txtTrxAmt = r(i.getControl().val())) : (n._txtAmount = r(i.getControl().val()), n._txtTrxAmt = r(c.getControl().val())), n._txtDifference = r(w.getControl().val()), n._txtConversionType = y.val(), n._txtCurrency = h.val(), n._txtPaymentMethod = a.val(), n._txtCheckNum = g.val(), n._txtCheckDate = ft.val(), n._ctrlTrxOrg = tf, n._EftOrManualCheckNo = wi, n._OverrideAutoCheck = lr, t.push(n), t }, insertNewRecord: function (n, i) { var r = s.children()[s[0].selectedIndex].getAttribute("stdprecision"); t.ajax({ type: "POST", url: VIS.Application.contextUrl + "VA012/BankStatement/InsertData", contentType: "application/json; charset=utf-8", data: JSON.stringify({ _formData: n, stdprecision: r }), success: function (n) { i(n) }, error: function (n) { VIS.ADialog.info(n, null, "", "") } }) }, afterInsertion: function (n) { if (n != null && n != "") { var i = t.parseJSON(n); i == "Success" ? (lt(l, !1, "absolute"), VIS.ADialog.info("VA012_RecordSaved", null, "", ""), ti = [], yt.html(""), yi = 1, it.loadStatement(hi), ui.html(""), u.scheduleRefresh(), u.prepayRefresh(), ye = !0, vi = 1, storepaymentdata = [], v.loadPayments(s.val(), wt.val(), ct.val(), pt.val()), u.scheduleRefresh(), u.prepayRefresh(), u.refreshForm(), h.addClass("va012-mandatory"), y.addClass("va012-mandatory")) : (lt(l, !1, "absolute"), i.contains(" ") ? VIS.ADialog.info("", null, i, "") : VIS.ADialog.info(i, null, "", "")) } }, refreshForm: function (n) { f.attr("data-uid", 0); (event == undefined || event.currentTarget.id != ne[0].id) && v.getMaxStatement("LO"); nt.attr("readonly", !1); var r = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetStatementDate", { bankAcct: s.val() }); r != "" && r != null ? nt.val(Globalize.format(new Date(r), "yyyy-MM-dd")) : (ir = new Date, hf = ir.getFullYear() + "-" + ("0" + (ir.getMonth() + 1)).slice(-2) + "-" + ("0" + ir.getDate()).slice(-2), nt.val(hf)); p.prop("selectedIndex", 0); p.trigger("change"); i.getControl().attr("disabled", !1); i.setValue(0); c.setValue(0); w.setValue(0); w.getControl().trigger("blur"); w.getControl().attr("vchangable", "Y"); k.prop("selectedIndex", 0); k.removeClass("va012-mandatory"); w.getControl().removeClass("va012-mandatory"); t("#Ast_DifferenceType_" + $self.windowNo).hide(); t("#Ast_Difference_" + $self.windowNo).hide(); t("#Ast_CashJournalLine_" + $self.windowNo).hide(); et.getControl().removeClass("va012-mandatory"); pu.val(""); ar.val(""); sr.prop("selectedIndex", 0); rt.attr("chargeid", 0); rt.val(""); ut.prop("selectedIndex", 0); bt.setValue(0); bu.attr("checked", !1); tt.setValue(); st.setValue(); et.setValue(); ht.setValue(); n == undefined && gt.setValue(); fu = 0; ri = 0; dt = 0; oi = 0; eu = null; e.trigger("click"); u.loadCurrency(); ot.prop("selectedIndex", 0); fr.prop("selectedIndex", 0); or.prop("selectedIndex", 0); hu.val(""); this.setNewFormDefaultCurrency(); t(h[0]).find("option").show(); this.setNewFormDefaultConversionType(); a.attr("disabled", !1); t(".astric_" + $self.windowNo).hide(); a.addClass("va012-mandatory"); this.loadPaymentMethods(); y.attr("disabled", !1); h.attr("disabled", !1); gr = !1; g.val(""); hr.hide(); g.removeClass("va012-mandatory"); ft.val(""); cr.hide(); ft.removeClass("va012-mandatory"); fo = null; lr = !1; wi = null; gi = null; tu = 0; di.setValue() }, scheduleRefresh: function () { d = []; bi = []; vt = []; tr.val(""); gi = null; tu = 0 }, prepayRefresh: function () { ou = []; su = []; te.val(""); gi = null; tu = 0 }, refreshSelectedValues: function () { f.attr("data-uid", 0); v.getMaxStatement("LO"); nt.attr("readonly", !1); var n = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetStatementDate", { bankAcct: s.val() }); n != "" && n != null ? nt.val(Globalize.format(new Date(n), "yyyy-MM-dd")) : (ir = new Date, hf = ir.getFullYear() + "-" + ("0" + (ir.getMonth() + 1)).slice(-2) + "-" + ("0" + ir.getDate()).slice(-2), nt.val(hf)); i.getControl().attr("disabled", !1); i.setValue(0); c.setValue(0); w.setValue(0); w.getControl().trigger("blur"); w.getControl().attr("vchangable", "Y"); k.prop("selectedIndex", 0); k.removeClass("va012-mandatory"); t("#Ast_DifferenceType_" + $self.windowNo).hide(); pu.val(""); ar.val(""); sr.prop("selectedIndex", 0); rt.attr("chargeid", 0); rt.val(""); ut.prop("selectedIndex", 0); bt.setValue(0); bu.attr("checked", !1); tt.setValue(); st.setValue(); et.setValue(); ht.setValue(); gt.setValue(); fu = 0; ri = 0; dt = 0; oi = 0; eu = null; u.scheduleRefresh(); e.trigger("click"); ot.prop("selectedIndex", 0); fr.prop("selectedIndex", 0); or.prop("selectedIndex", 0); hu.val(""); this.loadNewFormCurrency(); y.addClass("va012-mandatory"); this.loadConversionTypes(); this.loadPaymentMethods(); a.attr("disabled", !1); a.addClass("va012-mandatory"); h.addClass("va012-mandatory"); y.prop("selectedIndex", 0); y.attr("disabled", !1); h.attr("disabled", !1); gr = !1; g.val(""); hr.hide(); g.removeClass("va012-mandatory"); ft.val(""); cr.hide(); ft.removeClass("va012-mandatory") }, newRecordDispose: function () { f = null; gf = null; ni = null; ne = null; ci = null; er = null; nt = null; ot = null; fr = null; or = null; hu = null; at = null; p = null; i = null; w = null; k = null; ie = null; e = null; o = null; pu = null; ar = null; sr = null; rt = null; ut = null; bt = null; wu = null; uf = null; iu = null; ff = null; ef = null; bu = null; of = null; ku = null; pe = null; tr = null; te = null; kt = null; we = null; be = null; ki = null; co = null; to = null; st = null; dt = null; tt = null; wo = null; ri = null; et = null; no = null; oi = null; re = null; ht = null; fu = null; io = null; gt = null; eu = null; hf = null; ir = null; h = null; y = null; gr = null; a = null; ft = null; g = null; nf = null; di = null; tf = null }, loadNewFormCurrency: function () { var n = null, u, i, r; if (t(h[0]).empty(), u = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 457, VIS.DisplayType.TableDir, "C_Currency_ID", 0, !1, "IsMyCurrency='Y'"), n = u.getData(!0, !0, !1, !1), h.append('<option value="0" ><\/option>'), n != null && n != undefined && n.length > 0) { for (i = 0; i < n.length; i++)h.append("<option value=" + n[i].Key + ">" + n[i].Name + "<\/option>"); r = VIS.Utility.Util.getValueOfInt(t("option:selected", s).attr("currencyid")); h.val(r); r <= 0 ? h.addClass("va012-mandatory") : h.removeClass("va012-mandatory") } }, loadConversionTypes: function () { var n = null, u, i, r; if (t(y[0]).empty(), u = VIS.MLookupFactory.get(VIS.Env.getCtx(), $self.windowNo, 10269, VIS.DisplayType.TableDir, "C_ConversionType_ID", 0, !1, "IsActive='Y'"), n = u.getData(!0, !0, !1, !1), y.append('<option value="0" ><\/option>'), n != null && n != undefined && n.length > 0) { for (i = 0; i < n.length; i++)y.append("<option value=" + n[i].Key + ">" + n[i].Name + "<\/option>"); r = VIS.Env.getCtx().getContextAsInt("#C_ConversionType_ID"); r != 0 ? (y.val(r), y.removeClass("va012-mandatory")) : (y.val(0), y.addClass("va012-mandatory")) } }, loadPaymentMethods: function () { if (t(a[0]).empty(), ro && (a.append('<option value="0" ><\/option>'), lu != null && lu.length > 0)) { for (var n = 0; n < lu.length; n++)a.append("<option paymentbasetype=" + lu[n].PaymentBaseType + " value=" + lu[n].chargeID + ">" + VIS.Utility.encodeText(lu[n].name) + "<\/option>"); a.val(0); a.addClass("va012-mandatory"); hr.hide(); g.removeClass("va012-mandatory"); cr.hide(); ft.removeClass("va012-mandatory") } }, setNewFormDefaultCurrency: function () { var n = VIS.Utility.Util.getValueOfInt(t("option:selected", s).attr("currencyid")); h.val(n); n <= 0 ? h.addClass("va012-mandatory") : h.removeClass("va012-mandatory") }, setNewFormDefaultConversionType: function () { var n = VIS.Env.getCtx().getContextAsInt("#C_ConversionType_ID"); n != 0 ? (y.val(n), y.removeClass("va012-mandatory")) : (y.val(0), y.addClass("va012-mandatory")) } }; t(window).resize(function () { v.setPaymentListHeight(); it.setStatementListHeight(); bf.height(t("#VA012_mainContainer_" + $self.windowNo).height()) }); this.getRoot = function () { return l }; this.setSize = function () { var n = t("#VA012_mainContainer_" + $self.windowNo).height(); n == 0 && (n = window.innerHeight - 107); bf.height(n); v.setPaymentListHeight(); it.setStatementListHeight() }; this.disposeComponents = function () { $self = null; l = null; nr = null; s = null; yf = null; pt = null; so = null; wt = null; ct = null; oe = null; se = null; yt = null; ui = null; hi = ""; vu = null; yu = null; yo = null; po = null; vr = null; ru = null; _divCtrlCashLine = null; yr = null; uu = null; li = null; ho = null; divRow4Col1TrxAmt = null; du = null; pi = null; fi = null; ke = null; ei = null; ai = null; pr = null; wr = null; br = null; kr = null; dr = null; si = null; de = null; he = null; ce = null; le = null; wf = null; bf = null; rf = null; eo = null; ti = []; d = []; bi = []; ou = []; su = []; u.newRecordDispose(); ro = null; cu = _txtSearchPayment = _btnSearchPayment = null; fo = null; nu = null; nf = null; di = null; lr = !1; wi = null; au = null; gi = null; tu = 0; ue = 0 } } i.prototype.sizeChanged = function (n) { _table.height(n) }; i.prototype.refresh = function () { this.setSize() }; i.prototype.dispose = function () { this.disposeComponents(); this.frame && this.frame.dispose(); this.frame = null }; i.prototype.init = function (n, t) { this.windowNo = n; this.frame = t; this.Initialize(); this.frame.getContentGrid().append(this.getRoot()); this.setSize() }; n.AForms = n.AForms || {}; n.AForms.bankStatement = i }(VA012, jQuery); VA012 = window.VA012 || {}, function (n, t) { n.VA012_BankConnectWidget = function () { function y() { o = r.find("#VA012-bnkcnt-Create_" + widgetID); s = r.find("#VA012-bnkcnt-Connect_" + widgetID) } function p() { o.on("click", function () { u.widgetFirevalueChanged({ TabLayout: "Y", IsTabInNewMode: !0, TabIndex: "0" }) }); s.on("click", function () { i.css("visibility", "visible"); window.setTimeout(function () { w() }, 200) }) } function w() { var u, r; n = t("<div class='va012-popform-content'>"); u = '<div class="VA012_bankCnt-container"><div class="VA012-bankCnt-selection" id="VA012-bnkcnt-Selection_' + widgetID + '"><div class="input-group vis-input-wrap" id="VA012-bnkcnt-Country_' + widgetID + '"><\/div><div class="input-group vis-input-wrap" id="VA012-bnkcnt-ConnectVia_' + widgetID + '"><\/div><\/div><div class="VA012_bankCnt-header"><h2>' + VIS.Msg.getMsg("VA012_BankFeed") + "<\/h2><button>" + VIS.Msg.getMsg("VA012_ConnectNow") + "<\/button><\/div><p>" + VIS.Msg.getMsg("VA012_BankConnectDesc") + '<\/p><div class="VA012_bankCnt-banks-grid"><div class="VA012_bankCnt-bank-card" id="VA012-bnkcnt-iciciSelected_' + widgetID + '"><img src="Areas/VA012/Images/icici.jpg" alt="ICICI Bank"><span>' + VIS.Msg.getMsg("VA012_ICICIBank") + '<\/span><\/div><div class="VA012_bankCnt-bank-card" id="VA012-bnkcnt-hdfcSelected_' + widgetID + '"><img src="Areas/VA012/Images/hdfc.jpg" alt="HDFC Bank"><span>' + VIS.Msg.getMsg("VA012_HDFCBank") + '<\/span><\/div><div class="VA012_bankCnt-bank-card" id="VA012-bnkcnt-sbiSelected_' + widgetID + '"><img src="Areas/VA012/Images/sbi.jpg" alt="State Bank of India"><span>' + VIS.Msg.getMsg("VA012_SBIBank") + '<\/span><\/div><div class="VA012_bankCnt-bank-card" id="VA012-bnkcnt-kotakSelected_' + widgetID + '"><img src="Areas/VA012/Images/kotak.png" alt="Kotak Mahindra Bank"><span>' + VIS.Msg.getMsg("VA012_KotakBank") + '<\/span><\/div><div class="VA012_bankCnt-bank-card" id="VA012-bnkcnt-axisSelected_' + widgetID + '"><img src="Areas/VA012/Images/axis.jpg" alt="Axis Bank"><span>' + VIS.Msg.getMsg("VA012_AxisBank") + '<\/span><\/div><div class="VA012_bankCnt-bank-card" id="VA012-bnkcnt-hsbcSelected_' + widgetID + '"><img src="Areas/VA012/Images/hsbc.jpg" alt="HDFC Bank Credit"><span>' + VIS.Msg.getMsg("VA012_HSBC-CreditBank") + '<\/span><\/div><div class="VA012_bankCnt-bank-card" id="VA012-bnkcnt-otherSelected_' + widgetID + '"><img src="Areas/VA012/Images/OtherBank.png" alt="Other Bank"><span>' + VIS.Msg.getMsg("VA012_OtherBank") + "<\/span><\/div><\/div><\/div>"; n.append(u); b(); k(); d(); r = new VIS.ChildDialog; r.setContent(n); r.setTitle(VIS.Msg.getMsg("VA012_ConnectBank")); r.setWidth("780px"); r.setEnableResize(!1); r.setModal(!0); r.show(); r.hidebuttons(); i.css("visibility", "hidden") } function b() { v = n.find("#VA012-bnkcnt-Selection_" + widgetID); h = n.find("#VA012-bnkcnt-Country_" + widgetID); c = n.find("#VA012-bnkcnt-ConnectVia_" + widgetID) } function k() { var s = new VIS.Controls.VLabel(VIS.Msg.getMsg("VA012_Country_ID"), "C_Country_ID", !1, !0), v = t('<div class="input-group vis-input-wrap">'), n = t('<div class="vis-control-wrap">'), r = t('<div class="input-group-append">'); l = VIS.MLookupFactory.get(VIS.Env.getCtx(), u.windowNo, 866, VIS.DisplayType.Table, "C_Country_ID", 0, !1, ""); f = new VIS.Controls.VComboBox("C_Country_ID", !0, !1, !0, l); f.setMandatory(!0); n.append(f.getControl()).append(s.getControl()); r.append(f.getBtn(0)); v.append(n); h.append(n).append(r); var y = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "Widget/GetReference"), p = new VIS.Controls.VLabel(VIS.Msg.getMsg("VA012_ConnectVia"), "VA012_ConnectVia", !1, !0), w = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'); a = VIS.MLookupFactory.get(VIS.Env.getCtx(), u.windowNo, 0, VIS.DisplayType.List, "VA012_ConnectVia", VIS.Utility.Util.getValueOfInt(y.BankConnectVia_Reference_ID), !1, ""); e = new VIS.Controls.VComboBox("VA012_ConnectVia", !0, !1, !0, a, 50); e.setValue("01"); i.append(e.getControl()).append(p.getControl()); o.append(e.getBtn(0)); w.append(i); c.append(i).append(o) } function d() { n.on("click", "#VA012-bnkcnt-iciciSelected_" + widgetID, function () { n.find(".VA012_bankCnt-banks-grid div").removeClass("VA012-bankCnt-bnkselected"); t(this).addClass("VA012-bankCnt-bnkselected") }); n.on("click", "#VA012-bnkcnt-hdfcSelected_" + widgetID, function () { n.find(".VA012_bankCnt-banks-grid div").removeClass("VA012-bankCnt-bnkselected"); t(this).addClass("VA012-bankCnt-bnkselected") }); n.on("click", "#VA012-bnkcnt-sbiSelected_" + widgetID, function () { n.find(".VA012_bankCnt-banks-grid div").removeClass("VA012-bankCnt-bnkselected"); t(this).addClass("VA012-bankCnt-bnkselected") }); n.on("click", "#VA012-bnkcnt-kotakSelected_" + widgetID, function () { n.find(".VA012_bankCnt-banks-grid div").removeClass("VA012-bankCnt-bnkselected"); t(this).addClass("VA012-bankCnt-bnkselected") }); n.on("click", "#VA012-bnkcnt-axisSelected_" + widgetID, function () { n.find(".VA012_bankCnt-banks-grid div").removeClass("VA012-bankCnt-bnkselected"); t(this).addClass("VA012-bankCnt-bnkselected") }); n.on("click", "#VA012-bnkcnt-hsbcSelected_" + widgetID, function () { n.find(".VA012_bankCnt-banks-grid div").removeClass("VA012-bankCnt-bnkselected"); t(this).addClass("VA012-bankCnt-bnkselected") }); n.on("click", "#VA012-bnkcnt-otherSelected_" + widgetID, function () { n.find(".VA012_bankCnt-banks-grid div").removeClass("VA012-bankCnt-bnkselected"); t(this).addClass("VA012-bankCnt-bnkselected") }) } function g() { i = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis_widgetloader"><\/i><\/div><\/div>'); r.append(i) } this.frame; this.windowNo; this.widgetInfo; var i, u = this, r = t('<div class="h-100 w-100">'), o = null, s = null, n = null, v = null, h = null, c = null, l = null, f = null, a = null, e = null; this.initalize = function () { widgetID = this.widgetInfo.AD_UserHomeWidgetID; var n = '<div class="vis-dynamicWidget-main" style="background-color: #e1f0fa; padding-top: 25px;"><div class="vis-add-row"><button id="VA012-bnkcnt-Create_' + widgetID + '" class="vis-widget-field VA012_bankCnt-NewBtn" index="0">' + VIS.Msg.getMsg("VA012_CreateBank") + '<\/button><\/div> <div class="vis-add-row"><button id="VA012-bnkcnt-Connect_' + widgetID + '" class="vis-widget-field VA012_bankCnt-NewBtn" index="1">' + VIS.Msg.getMsg("VA012_ConnectBank") + "<\/button><\/div><\/div> "; g(); r.append(n) }; this.intialLoad = function () { i.css("visibility", "visible"); y(); p(); i.css("visibility", "hidden") }; this.getRoot = function () { return r }; this.refreshWidget = function () { u.intialLoad() } }; n.VA012_BankConnectWidget.prototype.init = function (n, t) { this.frame = t; this.widgetInfo = t.widgetInfo; this.windowNo = n; this.initalize(); this.frame.getContentGrid().append(this.getRoot()); var i = this; window.setTimeout(function () { i.intialLoad() }, 50) }; n.VA012_BankConnectWidget.prototype.widgetFirevalueChanged = function (n) { this.listener && this.listener.widgetFirevalueChanged(n) }; n.VA012_BankConnectWidget.prototype.addChangeListener = function (n) { this.listener = n }; n.VA012_BankConnectWidget.prototype.widgetSizeChange = function (n) { this.widgetInfo = n }; n.VA012_BankConnectWidget.prototype.refreshWidget = function () { this.refreshWidget() }; n.VA012_BankConnectWidget.prototype.dispose = function () { this.frame = null; this.windowNo = null; $bsyDiv = null; $self = null; $root = null; createBank = null; connectBank = null } }(VA012, jQuery); VA012 = window.VA012 || {}, function (n, t) { n.VA012_BankingJournal = function () { function gt() { r = t('<div id="busyDivId_' + i + '" class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class= "vis_widgetloader"><\/i><\/div><\/div>').css({ width: "calc(100% - 40px)" }).hide(); y.append(r) } function ni() { u = t('<div class="VA012-bank-panel VA012-WidgetContainer"><div class="VA012-panel-heading"><h6 class="VA012-headerPanelLbl">' + VIS.Msg.getMsg("VA012_BankingJournal") + '<\/h6><\/div><div class="VA012-fader-div VA012-folderFader d-none" id="VA012-folderFader_' + i + '"><div class="p-2 VA012-folderContainer VA012-folderContainer_' + i + '"><h6>' + VIS.Msg.getMsg("VA012_SelectFolder") + '<\/h6><div class="VA012-folTreeArea" id="VA012-folTreeArea_' + i + '"><\/div><div class="VA012-folTreeFooter"><input type="submit" value="' + VIS.Msg.getMsg("VA012_Back") + '" class="btn ui-button ui-corner-all ui-widget VA012-treeCancelBtn" id="VA012-treeCancelBtn_' + i + '"><input type="submit" value="' + VIS.Msg.getMsg("VA012_Next") + '" disabled class="btn ui-button ui-corner-all ui-widget VA012-treeUploadBtn" id="VA012-treeUploadBtn_' + i + '"><\/div > <\/div><\/div><div class="VA012-widgetContentArea"><div class="VA012-shadow bg-white"><div class="VA012-upload-col"><input id="VA012-uploadFile_' + i + '" class="VA012-input-file-field VA012-uploadFileWidget_' + i + '" type="file" accept=".csv, .xls, .xlsx"><label for="VA012-uploadFile_' + i + '" class="VA012-files-label"><i class="fa fa-cloud-upload VA012-uploadImg" id="VA012-uploadImg_' + i + '" style="" aria-hidden="true"><\/i><div class="VA012-labelTxt">' + VIS.Msg.getMsg("VA012_DragFiles") + '<span class="VA012-browse-link">' + VIS.Msg.getMsg("VA012_Browse") + '<\/span><span class="VA012-FileNamelbl VA012-fileSize" id="VA012-FileNamelbl_' + i + '"><\/span><\/div><\/label><\/div><\/div><div class="VA012-links"><div class="VA012-DMS-folder"><div class="VA012-folder-link text-center"><i id="VA012-OpenDMSIcon_' + i + '" class="fa fa-folder-open VA012-OpenDMS" aria-hidden="true"><\/i><a class="VA012-OpenDMS_' + i + '" href="javascript:void(0)">' + VIS.Msg.getMsg("VA012_OpenDMS") + '<\/a><\/div><div class="VA012-folder-link text-center"><input type="submit" value="' + VIS.Msg.getMsg("VA012_Next") + '" id="VA012_NextBtn_' + i + '" class="btn ui-button ui-corner-all ui-widget VA012-NextBtn"><\/div><\/div><\/div><\/div><\/div>'); y.append(u); a = y.find(".VA012-widgetContentArea"); pt = u.find("#VA012-uploadFile_" + i); dt = u.find("#VA012-uploadImg_" + i); h = u.find("#VA012_NextBtn_" + i); selectedFileName = u.find("#VA012-selectedFileName_" + i); w = u.find("#VA012-FileNamelbl_" + i); rt = u.find("#VA012-OpenDMSIcon_" + i); b = u.find("#VA012-folTreeArea_" + i); k = u.find("#VA012-folderFader_" + i); tt = u.find("#VA012-treeUploadBtn_" + i); ct = u.find("#VA012-treeCancelBtn_" + i); ht == null ? h.attr("disabled", !0) : (h.attr("disabled", !1), h.css("opacity", 1)); var n = VIS.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VADMS_"); n == null ? rt.css("display", "none") : rt.css("display", "block"); ti() } function ti() { u.on("dragover", function (n) { n.preventDefault(); n.stopPropagation() }); u.on("drop", function (n) { n.stopPropagation(); n.preventDefault(); v = !1; files = n.originalEvent.dataTransfer.files; var r = t(u.find(".VA012-uploadFileWidget_" + i)[0]); const f = files[0], e = new FileReader; e.onload = function (n) { const i = n.target.result, u = new Blob([i], { type: f.type }), o = n.target.result, e = new File([u], files[0].name, { type: files[0].type, lastModified: files[0].lastModified }), t = new DataTransfer; t.items.add(e); r[0].files = t.files; ht = files; files.length > 0 && wt(files, r[0]) }; e.readAsArrayBuffer(f) }); u.find(".VA012-uploadFileWidget_" + i).on("click", function () { this.value = null }); u.find(".VA012-uploadFileWidget_" + i).on("change", function (n) { n.stopPropagation(); n.preventDefault(); v = !1; var t = n.target.files; ht = t; t.length > 0 && wt(t, this) }); h.on("click", function () { c == null ? vt() : (c.show(), p.show()); a.hide() }); rt.on("click", function () { r.show(); v = !0; var n = ui(); r.hide() }); ct.on("click", function () { k.addClass("d-none"); d = ""; a.show(); r.hide(); v = !1; tt.attr("disabled", !0) }); tt.on("click", function (n) { n.stopPropagation(); w.text(""); h.attr("disabled", !0); r.show(); t.ajax({ url: VIS.Application.contextUrl + "VA012_BankJournalWidget/GetMetaData", type: "GET", async: !0, dataType: "json", contentType: "application/json; charset=utf-8", data: { documentID: y.find(".VA012-selDoc").attr("data-documentid") }, success: function (n) { n != null && n != "" && (o = JSON.parse(n), k.addClass("d-none"), v = !0, c == null ? (a.hide(), vt()) : (a.hide(), c.show(), p.show())); r.hide() }, error: function (n) { return r.hide(), VIS.ADialog.error(n.statusText), !1 } }) }) } function wt(i, r) { for (var h, s, v, y, g, b, f = ".xlsx,.xls,.csv", l = !1, e = [], k = null, d = null, u = 0; u < i.length; u++) { if (i[u].size > 209715200 && (k = !0, d += i[u].name + ","), h = i[u].name.substr(0, i[u].name.lastIndexOf(".")), s = i[u].name.substr(i[u].name.lastIndexOf(".")).toLowerCase(), f != null && f.length > 0 && (Array.isArray(f) || (f = f.split(",")), t.each(f, function (n, t) { f[n] = t.toLowerCase().replace(/\s+/g, "") }), f.indexOf(s) == -1 && (l = !0, e.push(i[u].name))), l && e.length > 0) { v = ""; for (y in e) v += e[y].toString() + ", "; g = "" + (e.length == 1 ? "FileInvalidExtension" : "FilesInvalidExtension"); return } i.length > 0 && (w.text(h + "" + s), w.val(h + "" + s), b = r, o = t.parseJSON(n.UploadExcel(b, null, null)), c == null ? vt() : (c.show(), p.show()), a.hide()) } } function vt() { l = t('<div class="VA012_paramMainDiv" id="VA012_paramMainDiv_' + i + '"><div class= "VA012-form-data"><div class="input-group vis-input-wrap VA012-paramdiv"><div class="vis-control-wrap VA012-controls"><select class="VA012-select" id="VA012_STAT_cmbBank_' + i + '"><\/select><label class="VA012-labels">' + VIS.Msg.getMsg("VA012_Bank") + '<sup style="color: red;">*<\/sup><\/label><\/div><\/div><\/div><div class= "VA012-form-data"><div class="input-group vis-input-wrap VA012-paramdiv"><div class="vis-control-wrap VA012-controls"><select class="VA012-select" id="VA012_STAT_cmbBankAccount_' + i + '"><\/select><label class="VA012-labels">' + VIS.Msg.getMsg("VA012_BankAccount") + '<sup style="color: red;">*<\/sup><\/label><\/div><\/div><\/div > <div class=VA012-form-data><div class="input-group vis-input-wrap VA012-paramdiv VA012-margin-B0"><div class="vis-control-wrap VA012-controls"><input class="VA012-select VA012-Date" type="date" max="9999-12-31" id=VA012_STAT_statementDate_' + i + '><label class="VA012-labels" id="VA012_STAT_lblStatementDate_' + i + '">' + VIS.Msg.getMsg("VA012_StatementDate") + '<sup style="color: red;">*<\/sup><\/label><\/div><\/div><\/div><div class="VA012-form-data"><div class="input-group vis-input-wrap VA012-paramdiv"><div class="vis-control-wrap VA012-controls"><select class="VA012-select" id="VA012_STAT_cmbBankAccountClassName_' + i + '"><\/select><label class="VA012-labels">' + VIS.Msg.getMsg("VA012_ClassName") + '<sup style="color: red;">*<\/sup><\/label><\/div><\/div><\/div><div class="VA012-form-data"><div class="input-group vis-input-wrap VA012-paramdiv"><div class="vis-control-wrap VA012-controls"><input class="VA012-select" type="text" id="VA012_STAT_txtStatementNo_' + i + '" placeholder=" " data-placeholder=""><label class="VA012-nameLbl">' + VIS.Msg.getMsg("VA012_StatementNumber") + '<sup style="color: red;">*<\/sup><\/label><\/div><\/div><\/div><div class="VA012-form-data"><div class="input-group vis-input-wrap VA012-paramdiv"><div class="vis-control-wrap VA012-controls"><input type="checkbox" value="checked" id="VA012_CheckBox_' + i + '"><label class="VA012-StatementDateAsAccountDate">' + VIS.Msg.getMsg("VA012_StatementDateAsAccountDate") + '<\/label><\/div><\/div><\/div><\/div><div class="VA012-paramFooterDiv" id="VA012-paramFooterDiv_' + i + '"><input type="submit" value="' + VIS.Msg.getMsg("VA012_Back") + '" class="btn ui-button ui-corner-all VA012-CancelBtn"><input type="submit" value="' + VIS.Msg.getMsg("VA012_Upload") + '" class="btn ui-button ui-corner-all VA012-UploadBtn"><\/div><\/div>'); u.append(l); ii(); it.loadBank(); it.loadBankAccountCharges(); e.on("click", function () { if (e.val() != "null") it.loadBankAccount(); else return "VA012_NoBankSelected" }); f.on("click", function () { if (f.val() != "null") it.loadCurrency(), ri(); else return "VA012_NoBankAccountSelected" }); ut.on("click", function () { c.hide(); p.hide(); d = ""; v ? k.removeClass("d-none") : (a.show(), h.attr("disabled", !1)) }); ft.on("click", function () { if (r.show(), e.val() == null || e.val() == "" || e.val() == "0") return r.hide(), VIS.ADialog.info("VA012_SelectBankFirst", null, "", ""), !1; if (f.val() == null || f.val() == "" || f.val() == "0") return r.hide(), VIS.ADialog.info("VA012_SelectBankAccountFirst", null, "", ""), !1; if (s.val() == null || s.val() == "" || s.val() == "0") return r.hide(), VIS.ADialog.info("VA012_PleaseSelectClassFirst", null, "", ""), !1; if (nt.val() == null || nt.val() == "") return r.hide(), VIS.ADialog.info("VA012_PleaseEnterStatementNo", null, "", ""), !1; if (g.val() == null || g.val() == "") return r.hide(), VIS.ADialog.info("VA012_PleaseEnterStatementDate", null, "", ""), !1; if (o != null) { if (o._filename == null || o._filename == "" || o._path == null || o._path == "") { r.hide(); VIS.ADialog.info("VA012_ErrorInGettingFile", null, "", ""); return } if (o._error != null && o._error != "") { r.hide(); VIS.ADialog.info(o._error, null, "", ""); return } var n = o._path, l = o._filename, y = f.val(), b = nt.val(), k = st.is(":checked"), tt = s.val(), it = at; t.ajax({ url: VIS.Application.contextUrl + "BankStatement/ImportStatement", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: { _path: n, _filename: l, _bankaccount: y, _bankAccountCurrency: lt, _statementno: b, _statementClassName: tt, _statementCharges: it, statementDate: g.val(), IsStatementDateAsAccountDate: k }, success: function (n) { return (_statementID = n._statementID, _statementID != null && _statementID != "") ? (r.hide(), bt(), c.hide(), p.hide(), a.show(), u.find(".VA012-uploadFileWidget_" + i).val(null), w.text(""), h.attr("disabled", !0), v = !1, d = "", VIS.ADialog.info("VA012_StatementUploadDone", null, "", ""), !0) : n._error != null && n._error != "" ? (r.hide(), VIS.ADialog.info(n._error, null, "", ""), !1) : void 0 }, error: function () { return r.hide(), VIS.ADialog.info("error", null, "", "") } }) } else { r.hide(); VIS.ADialog.info("VA012_ErrorInGettingFile", null, "", ""); return } }) } function bt() { e.prop("selectedIndex", 0); f.prop("selectedIndex", 0); s.prop("selectedIndex", 0); g.val(""); nt.val(""); st.prop("checked", !1) } function ii() { e = l.find("#VA012_STAT_cmbBank_" + i); f = l.find("#VA012_STAT_cmbBankAccount_" + i); s = l.find("#VA012_STAT_cmbBankAccountClassName_" + i); c = u.find("#VA012_paramMainDiv_" + i); ut = l.find(".VA012-CancelBtn"); ft = l.find(".VA012-UploadBtn"); p = u.find("#VA012-paramFooterDiv_" + i); g = l.find("#VA012_STAT_statementDate_" + i); nt = l.find("#VA012_STAT_txtStatementNo_" + i); st = l.find("#VA012_CheckBox_" + i) } function ri() { function n(n) { if (s.html(""), s.append("<option value=0 ><\/option>"), n != null) for (var t = 0; t < n.length; t++)s.append("<option value=" + n[t].Value + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"); s.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetBankAccountClasses", { _cmbBankAccount: f.val() }, n) } function ui() { var u = null; t.ajax({ url: VIS.Application.contextUrl + "VA012_BankJournalWidget/GetFolders", type: "GET", async: !0, dataType: "json", contentType: "application/json; charset=utf-8", data: { UserID: VIS.context.getAD_User_ID(), roleID: VIS.context.getAD_Role_ID(), clientID: VIS.context.getAD_Client_ID(), orgID: VIS.context.getAD_Org_ID(), orderBy: "NA" }, success: function (f) { var o, e, s; if (f != null && f != "") { if (u = JSON.parse(f), k.removeClass("d-none"), u.length > 0) { o = t('<ul id="folderUL_' + i + '" class="list-unstyled w-100"><\/ul>'); a = ""; var h = [], v = "", c = "", l = "", a = ""; for (e = 0; e < u.length; e++)(h = [], l = "", c = u[e].FolderName, u[e].FolderName.length > 25 && (c = u[e].FolderName.substring(0, 25) + "..."), a.contains(u[e].FolderID)) || (s = null, u[e].ParentFolderID == 0 && (u[e].FolderType == 1 || u[e].FolderType == 2 || u[e].FolderType == 5 || u[e].FolderType == 6 || u[e].FolderType == 7 || u[e].FolderType == 8 || (v = u[e].PublicAccess > 10 ? "<i class='vis vis-folder-globe'><\/i>" : u[e].Sharecount > 2 || u[e].RoleSharecount > 0 ? "<i class='vis vis-folder-share'><\/i>" : "<i class='fa fa-folder-o'><\/i>", s = t('<li id="' + u[e].FolderID + '" folderName="' + VIS.Utility.encodeText(u[e].FolderName) + '" parentID="' + u[e].ParentFolderID + '" useraccess="' + u[e].UserAccessOnFolder + '" roleaccess="' + u[e].RoleAccessOnFolder + '" createdBy="' + u[e].CreateUser + '" inputType="' + u[e].InputType + '" folType="' + u[e].FolderType + '" IsSubscribe="' + u[e].IsSubscribedFolder + '" InitialCharacter="' + "".toUpperCase() + '"><div class="VA012-leftTreeNode" title="' + u[e].FolderName + '"><a id="a_' + u[e].FolderID + '" href="javascript:void(0);" val="' + VIS.Utility.encodeText(u[e].FolderPath) + '">' + v + "<span>" + VIS.Utility.encodeText(c) + "<\/span><\/a><\/div><\/li>")), h.push({ row: u[e], root: s }), a += u[e].FolderID + ",", l = u[e].FolderName, kt(h, u, 20, l), o.append(s))); o.on("click", "li a", function (u) { r.show(); u.stopPropagation(); var f = t(this).closest("li"), e = t(u.currentTarget); t.ajax({ url: VIS.Application.contextUrl + "VA012_BankJournalWidget/CheckFolderAccess", type: "GET", async: !0, dataType: "json", contentType: "application/json; charset=utf-8", data: { folderID: f.attr("id") }, success: function (u) { var e, o; u != null && u != "" && (u == n.Common.Full_Access || u == n.Common.RWD_Access || u == n.Common.RW_Access ? (t("#folderUL_" + i).find(".VA012-selected").removeClass("VA012-selected"), t("#folderUL_" + i).find(".VA012-selectedTreeNode").css("background-color", "inherit"), f.find("div").eq(0).find("a span").addClass("VA012-selected"), f.find("div").eq(0).hasClass("VA012-selectedTreeNode") ? f.find("div").eq(0).hasClass("VA012-selectedTreeNode") ? f.find("div").eq(0).addClass("VA012-selectedTreeNode").css("background-color", "rgba(var(--v-c-primary), .1)") : f.children("ul").length > 0 && f.find("div").eq(0).removeClass("VA012-selectedTreeNode") : f.find("div").eq(0).addClass("VA012-selectedTreeNode").css("background-color", "rgba(var(--v-c-primary), .1)"), e = [], e.push("Updated"), _scrollpage = 1, _searchDocName = "", r.hide(), o = fi(e, n.Common.UpdatedDesc, _scrollpage, !1, f.attr("id"), b.find("#" + f.attr("id"))), r.hide()) : (r.hide(), VIS.ADialog.info("VA012_ReqWPermOnFol"))) }, error: function (n) { return r.hide(), VIS.ADialog.error(n.statusText), !1 } }) }); return b.html("").append(o), o } return VIS.ADialog.info("VA012_NoFolderFound"), VIS.Msg.getMsg("VA012_NoFolderFound") } return VIS.ADialog.info("VA012_NoFolderFound"), VIS.Msg.getMsg("VA012_NoFolderFound") }, error: function (n) { return r.hide(), VIS.ADialog.error(n.statusText), !1 } }) } function kt(n, i, r, u) { for (var h, f, o = null, s = [], c = "", l = "", a = "", e = 0; e < n.length; e++) { for (o = null, h = t('<ul class="list-unstyled VA012-leftSideSubTreeUl {"><\/ul>'), f = 0; f < i.length; f++)if (l = i[f].FolderName.length > 25 ? i[f].FolderName.substring(0, 25) + "..." : i[f].FolderName, a = l.substring(0, 1).trim(), i[f].ParentFolderID == n[e].row.FolderID) { if (d.contains(i[f].FolderID)) continue; c = i[f].PublicAccess > 10 ? "<i class='vis vis-folder-globe'><\/i>" : i[f].Sharecount > 2 || i[f].RoleSharecount > 0 ? "<i class='vis vis-folder-share'><\/i>" : "<i class='fa fa-folder-o'><\/i>"; o = t('<li id="' + i[f].FolderID + '" folderName="' + VIS.Utility.encodeText(i[f].FolderName) + '" parentID="' + i[f].ParentFolderID + '" useraccess="' + i[f].UserAccessOnFolder + '" roleaccess="' + i[f].RoleAccessOnFolder + '" createdBy="' + i[f].CreateUser + '" inputType="' + i[f].InputType + '" folType="' + i[f].FolderType + '" IsSubscribe="' + i[f].IsSubscribedFolder + '" InitialCharacter="' + VIS.Utility.encodeText(a.toUpperCase()) + '"><div class="VA012-leftTreeNode" title="' + VIS.Utility.encodeText(i[f].FolderPath) + '"><a id=a_"' + i[f].FolderID + '" href="javascript:void(0);">' + c + "<span>" + VIS.Utility.encodeText(i[f].FolderName) + "<\/span><\/a><\/div><\/li>"); s.push({ row: i[f], root: o }); d += i[f].FolderID + ","; u += "\\" + i[f].FolderName; h.append(o) } o != null ? (n[e].root.append(h), n[e].root.find("a span i").length <= 0 && t(n[e].root.find("a span")[0]).append('<i class="vis vis-arrow-right VA012-arrow-right"><\/i>')) : n[e].row.HasChild > 0 && n[e].root.find("a span").append('<i class="vis vis-arrow-right VA012-arrow-right"><\/i>') } s.length > 0 && kt(s, i, r + 10, u) } function fi(u, f, e, o, s, h) { var a, l, v, c; r.show(); a = b.find("[data-parentfolderid= '" + s + "']"); l = null; a.length > 0 && a.remove(); v = 50; c = []; c.push(s); c.push(1); c.push(""); c.push(0); c.push(0); c.push(!1); c.push(!1); c.push(!1); c.push("0"); c.push(v); c.push(0); c.push("UD"); t.ajax({ url: VIS.Application.contextUrl + "VA012_BankJournalWidget/GetDocument", type: "POST", async: !0, dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify(c), success: function (u) { var f, v; if (u !== null && (u = JSON.parse(u), u = u[0].LstDocument, u != null && u.length > 0)) { for (f = 0; f < u.length; f++) { var e = u[f].DocumentID, w = u[f].DocumentName, o = u[f].FileType, k = u[f].FolderID, p = u[f].VersionNo, c = "vis-doc-blank", a = "rgba(var(--v-c-primary), 1)"; (o == n.Common.XLS || o == n.Common.XLSX || o == n.Common.CSV) && (c = "vis-doc-excel", a = "#39b54a", v = t('<li class="VA012-docTreeNode VA012-folderDocs" data-documentid="' + e + '" data-versionNo="' + p + '" data-parentfolderid="' + s + '" id="VA012-doclistingpanel_' + e + '"><div class="VA012-leftTreeNode"><a id="a_' + u[f].FolderID + '" href="javascript:void(0);" val="' + VIS.Utility.encodeText(u[f].DocumentName) + '"><i class="vis ' + c + '" aria-hidden="true" style="color:' + a + '"><\/i><span class="VA012-documentName" id="VA012_documentName_' + e + '">' + VIS.Utility.encodeText(u[f].DocumentName) + "" + VIS.Utility.encodeText(u[f].FileType) + "<\/span><\/a><\/div><\/li>"), v.insertAfter(h)) } r.hide(); b.find(".VA012-docTreeNode").on("click", function (n) { n.stopPropagation(); tt.removeAttr("disabled"); l = t(this).closest("li"); t("#folderUL_" + i).find(".VA012-selected").removeClass("VA012-selected"); t("#folderUL_" + i).find(".VA012-selectedTreeNode").css("background-color", "inherit"); b.find("#VA012-doclistingpanel_" + l.data("documentid")).find(".VA012-selected").removeClass("VA012-selected"); b.find("#VA012-doclistingpanel_" + l.data("documentid")).find(".VA012-selectedTreeNode").css("background-color", "inherit"); l.find("div").eq(0).find("a i span").addClass("VA012-selected"); l.find("div").eq(0).hasClass("VA012-selectedTreeNode") ? l.find("div").eq(0).hasClass("VA012-selectedTreeNode") ? l.find("div").eq(0).addClass("VA012-selectedTreeNode").css("background-color", "rgba(var(--v-c-primary), .1)") : l.children("ul").length > 0 && l.find("div").eq(0).removeClass("VA012-selectedTreeNode") : l.find("div").eq(0).addClass("VA012-selectedTreeNode").css("background-color", "rgba(var(--v-c-primary), .1)"); y.find(".VA012-folderDocs").removeClass("VA012-selDoc"); t(l[0]).addClass("VA012-selDoc") }) } }, error: function (n) { return r.hide(), VIS.ADialog.error(n.statusText), !1 } }) } var it; this.frame = null; this.windowNo = 0; this.widgetInfo = null; var yt = this, y = null, i = null, u = null, pt = null, dt = null, ut = null, ft = null, h = null, a = null, c = null, p = null, w = null, rt = null, r = null, e = null, f = null, s = null, et = 0, ot = 0, g = null, nt = null, st = null, l = null, lt = null, ht = null, o = null, at = null, b = null, tt = null, ct = null, k = null, d = "", v = !1; n.Common = { IPadWidth: 1024, MimWidth: 1e3, None_Access: 10, R_Access: 20, RW_Access: 30, RWD_Access: 40, Full_Access: 99, XLS: ".xls", XLSX: ".xlsx", CSV: ".csv", UpdatedAsc: "UA", UpdatedDesc: "UD" }; this.log = VIS.Logging.VLogger.getVLogger("BankJournalWidget"); this.getRoot = function () { return gt(), y }; this.setBusy = function (n) { n ? r.show() : r.hide() }; this.initialize = function () { i = this.widgetInfo.AD_UserHomeWidgetID; i = i + "_" + VIS.Env.getWindowNo(); i == 0 && (i = yt.windowNo); y = t("<div id='WidMainRoot_" + i + "' class='VA012_root'><\/div>"); ni() }; it = { loadBank: function () { function n(n) { if (e.html(""), e.append("<option value=0 ><\/option>"), n != null) for (var t = 0; t < n.length; t++)e.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].Value) + ">" + n[t].Name + "<\/option>"); e.prop("selectedIndex", 0); et > 0 && (e.val(et).prop("selected", !0), et = 0); it.loadBankAccount() } t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetBank", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", success: function (i) { i != null && i != "" && (_ds = t.parseJSON(i), n(_ds)) }, error: function (n) { console.log(n) } }) }, loadBankAccount: function () { function n(n) { if (f.html(""), f.append("<option value=0 ><\/option>"), n != null) for (var t = 0; t < n.length; t++)f.append("<option orgid=" + VIS.Utility.Util.getValueOfInt(n[t].OrgId) + " stdprecision=" + VIS.Utility.Util.getValueOfInt(n[t].StdPrecision) + " currencyid=" + VIS.Utility.Util.getValueOfInt(n[t].CurrencyId) + " value=" + VIS.Utility.Util.getValueOfInt(n[t].BankAccountId) + " accounttype=" + VIS.Utility.Util.getValueOfString(n[t].AccountType) + ">" + VIS.Utility.encodeText(n[t].AccountNo) + "<\/option>"); f.prop("selectedIndex", 0); ot > 0 && (f.val(ot).prop("selected", !0), ot = 0) } t.ajax({ url: VIS.Application.contextUrl + "BankStatement/GetBankAccount", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { bankId: e.val() }, success: function (i) { i != null && i != "" && (i = t.parseJSON(i), n(i)) }, error: function (n) { console.log(n) } }) }, loadCurrency: function () { var n = VIS.Utility.Util.getValueOfInt(t("option:selected", f).attr("currencyid")), i = VIS.Utility.Util.getValueOfInt(t("option:selected", f).attr("stdprecision")); n > 0 ? lt = n : n = null; _stdPrecision = i > 0 ? i : null }, loadBankAccountCharges: function () { function n(n) { n != null && (at = VIS.Utility.Util.getValueOfInt(n[0].chargeID)) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "BankStatement/GetBankCharge", null, n) } }; this.refreshWidget = function () { r.hide(); v ? k.addClass("d-none") : bt(); c.hide(); p.hide(); a.show(); u.find(".VA012-uploadFileWidget_" + i).val(null); w.text(""); w.val(""); h.attr("disabled", !0); d = "" }; this.disposeComponents = function () { yt = null; y = null; this.frame = null; this.windowNo = 0; this.widgetInfo = null; u = null; pt = null; ut = null; ft = null; h = null; a = null; c = null; p = null; selectedFileName = null; e = null; f = null; s = null; et = 0; ot = 0; g = null; nt = null; st = null; l = null; _file = null; lstLatestFiles = []; oldFiles = []; currentchunk = 0; currentFile = 0; folder = Date.now().toString(); chunkSize = 1048576; totalChunks = 0; currentFileChunkNo = 0; filesInfo = []; ht = null; lt = null; o = null; at = null; w.text(""); b = null; tt = null; ct = null; k = null; d = ""; v = !1; e.off("click"); f.off("click"); s.off("click"); u.off("click"); ut.off("click"); ft.off("click"); h.off("click"); rt.off("click"); ct.off("click"); tt.off("click") } }; n.VA012_BankingJournal.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.widgetInfo = t.widgetInfo; this.initialize(); this.frame.getContentGrid().append(this.getRoot) }; n.VA012_BankingJournal.prototype.widgetSizeChange = function (n) { var t = n }; n.VA012_BankingJournal.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.VA012_BankingJournal.prototype.refreshWidget = function () { this.refreshWidget() }; n.VA012_BankingJournal.prototype.addChangeListener = function (n) { this.listener = n }; n.VA012_BankingJournal.prototype.widgetFirevalueChanged = function (n) { this.listener && this.listener.widgetFirevalueChanged(n) } }(VA012, jQuery); VA012 = window.VA012 || {}, function (n, t) { n.UploadExcel = function (i, r, u) { function ut(n) { for (u.children().remove(), j = 0; j < n.ExcelCol.length; j++)j == 1 ? u.append("<li index=" + j + " style='border:none;float:none' >" + n.ExcelCol[j] + "<\/li>") : u.append("<li index=" + j + " >" + n.ExcelCol[j] + "<\/li>") } var k = null, f = [], c = [], l = 0, o = 0, a = Date.now().toString(), s = 1048576, v = 0, h = 0, p = [], e = null, nt = i, ft = t(window).width(), et = t(window).height(), a = Date.now().toString(), ot = r; savedFileName = ""; var d = t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:40%;width: 40%;left: 32%;position:absolute;z-index:99999;'>"), w = null, b = null; this.isWait = !1; self = this; var tt = function () { var n = null, t = 0; for (var i in f) t = parseInt(f[i].size / s), e.size % s > 0 && t++, v += t, n = {}, n.Name = f[i].name, n.Size = f[i].size, p.push(n); g() }, g = function () { var t; if (f == null || f.length == 0) { y(!1); return } if (!(o >= f.length)) { var n = new XMLHttpRequest, i = new FormData, r = f[o].name.substring(0, f[o].name.lastIndexOf(".")) + a + f[o].name.substring(f[o].name.lastIndexOf(".")); savedFileName = r; i.append("file", f[o].slice(h * s, h * s + Number(s))); n.open("POST", VIS.Application.contextUrl + "VA012/UploadExcel/SaveFileinTemp?fileName=" + r + "&folderKey=" + a + "&orgFileName=" + f[o].name, !1); n.send(i); k = n.responseText; l++; h++; t = parseInt(f[o].size / s); f[o].size % s > 0 && t++; h == t && (o++, h = 0); l <= v && rt(parseInt(l / v * 80)); window.setTimeout(function () { g() }, 2) } }, it = function (n) { for (var i, w, r, b, t = [], u = 0; u < n.files.length; u++) { if (e = n.files[u], e == undefined) return; if (e.size <= 0) return f = [], c = [], l = 0, o = 0, a = null, s = null, v = 0, h = 0, p = [], e = null, VIS.ADialog.info("VADMS_FileSizeShouldGreaterThan0KB"), y(!1), !1; if (e.name.indexOf("&") > -1 || e.name.indexOf("?") > -1 || e.name.indexOf("#") > -1 || e.name.indexOf("/") > -1 || e.name.indexOf("\\") > -1) { t.push(e.name); continue } for (i in f) if (e.name == f[i].name) { window.setTimeout(function () { y(!1); VIS.ADialog.info("fileAlreadyAttached") }, 20); return } if (c != null) for (i in c) if (e.name == c[i].Name && !c[i].IsDeleted) { window.setTimeout(function () { y(!1); VIS.ADialog.info("fileAlreadyAttached") }, 20); return } w = {}; w.Name = e.name; w.Size = e.size; f.push(e) } if (t.length > 0) { r = ""; for (b in t) r += t[b].toString() + "\n"; r += t.length == 1 ? "File has" : "Files have"; r += " invalid name. Please change the file name and try again."; y(!1); VIS.ADialog.info("", !0, r) } }, y = function (n) { if (t("body").find("#progressbar").remove(), n) { w = t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute;height: 35px;'>"); b = t("<span class='vis-ui-label'  style='position:absolute;left: 60%;top: 4px;'>").append("0%"); w.append(b); d.append(w); var i = t("<div id='progressbar' style='z-index: 999999;' class='vadms-Busy-Progress'><\/div>"); i.append(d); i.appendTo("<body>") } else t("body").find("progressbar").remove() }, rt = function (n) { w.css("width", n + "%"); b.empty(); b.append(n + "%") }; return this.getFolderKey = a, this.getSavedFileName = savedFileName, this.GetUploadedExcelColumns = function () { var t, u, i; if (o >= f.length) return t = [], u = VIS.Application.contextUrl + "VA012/UploadExcel/SaveAttachmentEntries", t.push({ Files: JSON.stringify(p) }), t.push({ FolderKey: a }), t.push({ FileName: savedFileName }), t.push({ Mapping: r }), i = n.ControllerRequestAjaxParameter1(u, t, !1), r.ExcelCol = i.ExcelCol, r.FileName = i.FileName, ut(i), i }, y(!0), it(i), tt(), k } }(VA012, jQuery); VA012 = window.VA012 || {}, function (n) { function t() { VIS.CalloutEngine.call(this, "VA012.VA012_Contra") } var r = VIS.Logging.Level, i = VIS.Utility.Util; VIS.Utility.inheritPrototype(t, VIS.CalloutEngine); t.prototype.SetContra = function (n, t, r, u, f) { if (this.isCalloutActive()) return ""; if (this.setCalloutActive(!0), f == null) r.setValue("VA012_IsContra", !1); else { var e = VIS.dataContext.getJSONRecord("VA012/Statement/GetChargeType", i.getValueOfInt(f)); e == "CON" ? r.setValue("VA012_IsContra", !0) : r.setValue("VA012_IsContra", !1) } return this.setCalloutActive(!1), "" }; t.prototype.SetConversionType = function (n, t, i, r, u, f) { var o, h, e; if (this.isCalloutActive() || u == null || u.toString() == "") return i.setValue("StmtAmt", 0), i.setValue("TrxAmt", 0), i.setValue("ChargeAmt", 0), i.setValue("C_ConversionType_ID", 0), ""; if (this.setCalloutActive(!0), VIS.Utility.Util.getValueOfInt(i.getValue("C_CashLine_ID")) > 0) { if (o = i.getValue("DateAcct"), o == null) return i.setValue("C_CashLine_ID", 0), this.setCalloutActive(!1), "PlzSelectStmtDate"; if (h = i.getValue("C_CashLine_ID").toString() + "," + i.getValue("C_Currency_ID").toString() + "," + o.toString() + "," + i.getValue("AD_Org_ID").toString(), e = VIS.dataContext.getJSONRecord("VA012/Statement/GetCashDetails", h), e != null) { e.Amount != 0 ? (i.setValue("StmtAmt", e.Amount), i.setValue("TrxAmt", e.Amount), i.setValue("C_ConversionType_ID", e.C_ConversionType_ID)) : (i.setValue("StmtAmt", 0), i.setValue("TrxAmt", 0), i.setValue("C_ConversionType_ID", 0), i.setValue("C_CashLine_ID", 0), VIS.ADialog.info("VA012_ConversionRateNotFound")); var c = VIS.Utility.Util.getValueOfDecimal(i.getValue("StmtAmt")), l = VIS.Utility.Util.getValueOfDecimal(i.getValue("TrxAmt")), s = c - l, a = VIS.Utility.Util.getValueOfDecimal(i.getValue("InterestAmt")); s = s - a; i.setValue("ChargeAmt", s) } } else i.getValue("C_Payment_ID") <= 0 && i.setValue("C_ConversionType_ID", 0); return this.setCalloutActive(!1), n = t = i = r = u = f = null, "" }; t.prototype.SetTenderType = function (n, t, r, u, f, e) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); var o = VIS.dataContext.getJSONRecord("VA012/Statement/GetPaymentRule", i.getValueOfInt(f)); return o != null && o != "" && (o == "D" ? r.setValue("TenderType", "D") : o == "K" ? r.setValue("TenderType", "C") : o == "S" ? r.setValue("TenderType", "K") : o == "T" ? r.setValue("TenderType", "A") : o == "L" ? r.setValue("TenderType", "L") : r.setValue("TenderType", "A")), this.setCalloutActive(!1), n = t = r = u = f = e = null, "" }; t.prototype.SetPaymentMethod = function (n, t, r, u, f, e) { var s, o; return this.isCalloutActive() || f == null || f.toString() == "" ? "" : (this.setCalloutActive(!0), s = "1", u.getColumnName() == "C_Invoice_ID" && (s = "1"), u.getColumnName() == "C_Order_ID" && (s = "2"), o = VIS.dataContext.getJSONRecord("VA012/Statement/GetPaymentMethod", i.getValueOfInt(f) + "," + s), this.setCalloutActive(!1), o != null && o != "" && (r.setValue("VA009_PaymentMethod_ID", o.VA009_PaymentMethod_ID), r.setValue("C_ConversionType_ID", o.C_ConversionType_ID)), n = t = r = u = f = e = null, "") }; n.Model = n.Model || {}; n.Model.VA012_Contra = t }(VA012, jQuery)
