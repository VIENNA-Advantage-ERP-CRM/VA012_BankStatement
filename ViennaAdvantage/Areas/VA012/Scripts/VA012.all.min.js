/*Version 1.0.33.0*/VA012=window.VA012||{},function(n,t){function i(){function eo(n){n!=null&&n!=""&&(a=t(n),l.getControls(),l.setBankAndAccount(),u.newRecord(),l.getBaseCurrency(),l.loadPayments("0","0","PY",at.val()),oo(),l.dragPayments(),l.dropPayments(),wf=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetAD_Column_IDForPayMethod",null))}function oo(){ie.on(VIS.Events.onTouchStartOrClick,function(n){n.stopPropagation();var i=ff.width();i>50&&t(".va012-left-content").hide();ff.animate({width:i>50?40:200},300,"swing",function(){i<50&&t(".va012-left-content").show()})});bi.on("change",function(){h.val("0");l.loadBankAccount()});h.on("change",function(){u.loadPayment();u.loadCurrency();u.loadCashLine();ti.html("");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();vi=1;storepaymentdata=[];l.loadPayments(h.val()==null?0:h.val(),vt.val(),ot.val(),at.val());ii=[];pt.html("");yi=1;tt.loadStatement(hi)});vt.on("change",function(){ti.html("");vi=1;storepaymentdata=[];l.loadPayments(h.val()==null?0:h.val(),vt.val(),ot.val(),at.val())});ot.on("change",function(){ot.val()=="CO"?(vt.prop("selectedIndex",0),vt.prop("disabled",!0)):(vt.prop("selectedIndex",0),vt.prop("disabled",!1));ti.html("");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();vi=1;iu=0;yu=50;of=1;storepaymentdata=[];l.loadPayments(h.val()==null?0:h.val(),vt.val(),ot.val(),at.val())});df.on(VIS.Events.onTouchStartOrClick,function(){at.val()==""?VIS.ADialog.info("VA012_PleaseEnterStatementDate",null,"",""):tt.statementDialog()});gf.on(VIS.Events.onTouchStartOrClick,function(){tt.matchStatementDialog()});hu.on(VIS.Events.onTouchStartOrClick,function(){tt.paymentScheduleDialog()});ue.on(VIS.Events.onTouchStartOrClick,function(){tt.prepayOrderDialog()});se.on(VIS.Events.onTouchStartOrClick,function(){si.val()!=null&&si.val()!=""?(gi=!0,ii=[],pt.html(""),yi=1,tt.loadStatement(hi)):(ii=[],pt.html(""),yi=1,tt.loadStatement(hi))});si.keypress(function(n){n.which==13&&(si.val()!=null&&si.val()!=""?(gi=!0,ii=[],pt.html(""),yi=1,tt.loadStatement(hi)):(ii=[],pt.html(""),yi=1,tt.loadStatement(hi)))});ne.on(VIS.Events.onTouchStartOrClick,function(){ii.length>0?t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/UnmatchStatement",contentType:"application/json; charset=utf-8",data:JSON.stringify({_statementLinesList:ii.toString()}),success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n[0]._status=="Success"&&n[0]._statementOk!=null&&VIS.ADialog.info("VA012_StatementsUnmatched",null," "+n[0]._statementOk,""),n[0]._error!=null&&VIS.ADialog.info(n[0]._error,null,"",""),n[0]._statementNo!=null&&VIS.ADialog.info("VA012_CompletedRecord",null," "+n[0]._statementNo,""),n[0]._statementNoNotUpdate!=null&&VIS.ADialog.info("VA012_ErrorSaving",null," "+n[0]._statementNoNotUpdate,""),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),ii=[],storepaymentdata=[],pt.html(""),yi=1,tt.loadStatement(hi),ti.html(""),u.scheduleRefresh(),u.prepayRefresh(),vi=1,l.loadPayments(h.val(),vt.val(),ot.val(),at.val()))},error:function(n){VIS.ADialog.info(n,null,"","")}}):VIS.ADialog.info("VA012_NoRecordSelected",null,"","")});te.on(VIS.Events.onTouchStartOrClick,function(){if(h.val()==null||h.val()==""||h.val()=="0"){VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"","");return}t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/ProcessStatement",contentType:"application/json; charset=utf-8",data:JSON.stringify({_statementLinesList:ii.toString(),_accountID:h.val()}),success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n[0]._error!=null?VIS.ADialog.info("",null,n[0]._error,""):n[0]._statementProcessed!=null?VIS.ADialog.info("",null,n[0]._statementProcessed+" "+VIS.Msg.getMsg("VA012_StatementsProcessed"),""):n[0]._statementNotProcessed!=null?VIS.ADialog.info("",null,n[0]._statementNotProcessed+" "+VIS.Msg.getMsg("VA012_StatementsNotProcessed"),""):n[0]._statementUnmatchedLines!=null&&VIS.ADialog.info("",null,n[0]._statementUnmatchedLines+" "+VIS.Msg.getMsg("VA012_ExistsUnmatched"),""),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),storepaymentdata=[],ii=[],pt.html(""),yi=1,tt.loadStatement(hi),ti.html(""),u.scheduleRefresh(),u.prepayRefresh(),vi=1,l.loadPayments(h.val(),vt.val(),ot.val(),at.val()))},error:function(n){VIS.ADialog.info(n,null,"","")}})});ee.on(VIS.Events.onTouchStartOrClick,function(){ii.length>0||parseInt(f.attr("data-uid"))>0?VIS.ADialog.ask(VIS.Msg.getMsg("VA012_WantToDelete"))&&t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/DeleteStatement",contentType:"application/json; charset=utf-8",data:JSON.stringify({_statementLinesList:ii.toString(),_statementLineID:f.attr("data-uid")}),success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n[0]._status=="Success"&&n[0]._statementProcessed!=null&&VIS.ADialog.info(n[0]._statementProcessed+" "+VIS.Msg.getMsg("VA012_StatementsDeleted"),null,"",""),n[0]._statementNotProcessed!=null&&VIS.ADialog.info(n[0]._statementNotProcessed+" "+VIS.Msg.getMsg("VA012_StatementsNotDeleted"),null,"",""),n[0]._error!=null&&VIS.ADialog.info(n[0]._error,null,"",""),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),ii=[],storepaymentdata=[],pt.html(""),yi=1,tt.loadStatement(hi),ti.html(""),u.scheduleRefresh(),u.prepayRefresh(),vi=1,l.loadPayments(h.val(),vt.val(),ot.val(),at.val()))},error:function(n){VIS.ADialog.info(n,null,"","")}}):VIS.ADialog.info("VA012_NoRecordSelected",null,"","")});ti.on("scroll",l.paymentScroll);pt.on("scroll",l.statementScroll);pt.on(VIS.Events.onTouchStartOrClick,tt.statementListEdit);pt.on(VIS.Events.onTouchStartOrClick,tt.openStatement);pt.on(VIS.Events.onTouchStartOrClick,tt.selectedStatementLinesList);ti.on(VIS.Events.onTouchStartOrClick,tt.selectedScheduleList);ti.on(VIS.Events.onTouchStartOrClick,function(n){n.target.type!="checkbox"&&(t(n.target).closest(".row").find(":checkbox").is(":checked")?t(n.target).closest(".row").find(":checkbox").prop("checked",!1):t(n.target).closest(".row").find(":checkbox").prop("checked",!0));i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())])});at.addClass("va012-mandatory");at.on("change",function(){if(at.val()=="")at.addClass("va012-mandatory");else{if(new Date(at.val())>new Date)return VIS.ADialog.info("VA012_StatementDateToday",null,"",""),at.val(""),!1;at.removeClass("va012-mandatory")}storepaymentdata=[];l.loadPayments(h.val()==null?0:h.val(),vt.val(),ot.val(),at.val())});ru.fireValueChanged=l.loadDataOnBPChanged;_btnSearchPayment.on(VIS.Events.onTouchStartOrClick,function(){ti.html("");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();vi=1;iu=0;yu=50;of=1;storepaymentdata=[];l.loadPayments(h.val()==null?0:h.val(),vt.val(),ot.val(),at.val())});_txtSearchPayment.keypress(function(n){n.which==13&&(ti.html(""),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),vi=1,iu=0,yu=50,of=1,storepaymentdata=[],l.loadPayments(h.val()==null?0:h.val(),vt.val(),ot.val(),at.val()))})}function so(n){t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/getMatchRecData",contentType:"application/json; charset=utf-8",success:function(t){if(n.html(""),n.append("<option value=0 >-<\/option>"),t=JSON.parse(t),t!=null&&t.length>0)for(var i=0;i<t.length;i++)n.append("<option value="+t[i].Value+">"+t[i].Name+"<\/option>")},error:function(n){VIS.ADialog.info(n,null,"","")}})}function no(n,t){w2ui["VA012_gridPayment_"+$self.windowNo]!=null&&w2ui["VA012_gridPayment_"+$self.windowNo].destroy();var i=null;i=n.w2grid({name:"VA012_gridPayment_"+$self.windowNo,recordHeight:25,show:{toolbar:!1,selectColumn:!1,toolbarReload:!1,toolbarColumns:!1,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1},records:[],columns:[{field:"_trxDate",caption:"Tran. Date",sortable:!1,size:"80px",display:!1},{field:"_trxNo",caption:"Auth Code/ Trx no.",sortable:!1,size:"30%",hidden:!1},{field:"_salesAmt",caption:"Trx Amount",sortable:!1,size:"15%",hidden:!1,style:"text-align: right"},{field:"_netAmt",caption:"Statement Amount",sortable:!1,size:"15%",hidden:!1,style:"text-align: right"},{field:"_difference",caption:"Difference",sortable:!1,size:"15%",hidden:!1,style:"text-align: right"},{field:"_chargeType",caption:"Charge Type",sortable:!1,size:"80px",display:!0},{field:"_taxRate",caption:"Tax Rate",sortable:!1,size:"80px",display:!0},{field:"_taxAmt",caption:"Tax Amt",sortable:!1,size:"15%",hidden:!1,style:"text-align: right"},],onChange:function(){},onClick:function(){},onDelete:function(){},onSubmit:function(){}});i.add(t)}function nf(n){if(n!=null&&y.length>0){t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetCurrencyandConversionType",dataType:"json",data:{_invoiceSchedules:n},success:function(n){var t=JSON.parse(n);(t!=null||t!="")&&i(t)}});function i(n){if(n.currencyId!=0&&y!=null){s.val(n.currencyId).prop("selected",!0);for(var i=0;s[0].length>i;i++)VIS.Utility.Util.getValueOfInt(s[0][i].value)==n.currencyId||VIS.Utility.Util.getValueOfInt(s[0][i].value)==lt?t(s[0][i]).show():t(s[0][i]).hide();s.removeClass("va012-mandatory");s.attr("disabled",!1);v.val(n.conversionTypeId).prop("selected",!0)}else s.val(lt).prop("selected",!0),s.attr("disabled",!0),s.removeClass("va012-mandatory"),v.val(n.conversionTypeId).prop("selected",!0);v.trigger("change")}}else s.prop("selectedIndex",0),s.addClass("va012-mandatory"),s.attr("disabled",!1),v.prop("selectedIndex",0),v.addClass("va012-mandatory")}function r(n){var t=0;return dotFormatter=$self.dotFormatter,typeof n=="string"?n:n=n.toString(),dotFormatter?(n=n.contains("−")?(-1*au.GetConvertedNumber(n,dotFormatter)).toString():au.GetConvertedNumber(n,dotFormatter).toString(),t=n!=""?n:t):(n.contains("−")&&!n.contains(".")?n=(-1*au.GetConvertedNumber(n,dotFormatter)).toString():n.contains("−")&&n.contains(".")?n=(-1*au.GetConvertedNumber(n,dotFormatter)).toString():n.contains(",")&&(n=au.GetConvertedNumber(n,dotFormatter).toString()),t=n!=""?n:t),parseFloat(t).toFixed(p)}function bf(n,i,r,u){var f=VIS.Utility.Util.getValueOfInt(n),e,o;if(f==0){u(n);return}e=VIS.Utility.Util.getValueOfDecimal(i);o=VIS.Utility.Util.getValueOfInt(r);t.ajax({url:VIS.Application.contextUrl+"VA012/BankStatement/CalculateSurcharge",type:"GET",contentType:"application/json; charset=utf-8",data:{_tax_ID:f,_chargeAmt:e,_stdPrecision:o},success:function(n){u(n)},error:function(n){VIS.ADialog.info(n,null,"","")}})}function kf(n,t){return t.indexOf(n)>-1}function ni(n,i,r){if(tf=t("<div class='vis-apanel-busy va012-busy-bank-statement'>"),tf.css({position:r,width:"95%",height:"95%","text-align":"center",visibility:"hidden"}),i)tf.css({visibility:"visible"});else{n.find(".va012-busy-bank-statement").remove();return}n.append(tf)}var a,au,l,tt,u;this.windowNo;$self=this;a=t("<div/>");this.frame;var tf=null,bi=null,h=null,rf=null,at=null,df=null,gf=null,vt=null,ot=null,pt=null,ti=null,uf=null,hi="",uu=null,fu=null,vu=null,pe=null,gi=!1,ii=[],y=[],pi=[],yt=[],gr=[],nu=[],ne=null,te=null,ie=null,ff=null,ef=null,lt=0,p=2,ui=!1,nr=!1,vi=1,of=1,yi=1,re=50,yu=50,sf=0,hf=0,we=null,f=null,cf=null,gt=null,lf=null,ci=null,ir=null,d=null,rr=null,st=null,tr=null,ur=null,tu=null,b=null,i=null,c=null,w=null,k=null,eu=null,er=null,fr=null,it=null,ut=null,wt=null,ou=null,pu=null,wr=null,wu=null,bu=null,su=null,ku=null,hu=null,ue=null,di=null,af=null,bt=null,fe=null,ee=null,to=null,io=null,or=null,br=null,sr=null,kr=null,li=null,be=null,cu=null,ki=null,fi=null,oe=null,ei=null,ai=null,hr=null,cr=null,lr=null,ar=null,vr=null,yr=null,pr=null,si=null,se=null,wi=null,ke=null,vf=null,e=null,o=null,he=0,iu=0,de=null,ft=null,kt=null,ce=null,ht=null,oi=null,le=null,g=null,ri=null,ro=null,yf=null,et=null,lu=null,ae=null,dt=null,dr=null,s=null,v=null,nt=null,rt=null,ct=null,du=!1;storepaymentdata=[];au=VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount);this.dotFormatter=VIS.Env.isDecimalPoint();var pf=new Date,ve=pf.getFullYear()+"-"+("0"+(pf.getMonth()+1)).slice(-2)+"-"+("0"+pf.getDate()).slice(-2),gu,uo,ge,fo,wf=null,ru=_txtSearchPayment=_btnSearchPayment=null,ye=0;this.Initialize=function(){ye=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA012/BankStatement/GetModulePrefix",{prefix:"VA034_"});eo(l.loadFormDesign());c.addVetoableChangeListener(this);wt.addVetoableChangeListener(this);i.addVetoableChangeListener(this);w.addVetoableChangeListener(this)};l={loadDataOnBPChanged:function(){ti.html("");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();vi=1;iu=0;yu=50;of=1;storepaymentdata=[];l.loadPayments(h.val()==null?0:h.val(),vt.val(),ot.val(),at.val())},loadFormDesign:function(){_formDesign=t('<div class="va012-assign-content">');divContainer=t('  <div id="VA012_mainContainer_'+$self.windowNo+'" class="va012-main-container">');divTable=t('<table id="VA012_table_'+$self.windowNo+'" style="width: 100%;">');tableTr=t("<tr>");tableTd=t('<td id="VA012_tdLeft_'+$self.windowNo+'" style="width: 200px;position: relative;">   <div class="va012-left-part">              <div class="va012-left-title">                  <h4>    <i id="VA012_btnHide_'+$self.windowNo+'" class="fa fa-bars" alt="lines" style="cursor: pointer;background: rgba(var(--v-c-primary),1);"><\/i> <\/h4>              <\/div>              <div class="va012-left-content">                  <div class="va012-left-data">                      <label  id="VA012_lblBank_'+$self.windowNo+'" >'+VIS.Msg.getMsg("VA012_Bank")+'<sup style="color: red;">*<\/sup><\/label>                      <select id="VA012_cmbBank_'+$self.windowNo+'" ><\/select>                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <label  id="VA012_lblBankAccount_'+$self.windowNo+'" >'+VIS.Msg.getMsg("VA012_BankAccount")+'<sup style="color: red;">*<\/sup><\/label>                      <select id="VA012_cmbBankAccount_'+$self.windowNo+'"   ><\/select>                  <\/div>                  <!-- end of left-data -->                  <div class="va012-left-data">                      <label  id="VA012_lblStatementDate_'+$self.windowNo+'" >'+VIS.Msg.getMsg("VA012_StatementDate")+'<sup style="color: red;">*<\/sup><\/label>                      <input type="date" max="9999-12-31" id="VA012_statementDate_'+$self.windowNo+'"   >                  <\/div>                  <!-- end of left-data -->                    <div class="va012-left-data">                      <a id="VA012_btnLoadStatement_'+$self.windowNo+'">'+VIS.Msg.getMsg("VA012_LoadStatement")+'<\/a>                      <a id="VA012_btnMatchStatement_'+$self.windowNo+'">'+VIS.Msg.getMsg("VA012_MatchStatement")+"<\/a>                  <\/div>                  <!-- end of left-data -->              <\/div>              <!-- end of left-content -->          <\/div>          <!-- end of left-part --> <\/td>");tableTd1=t('<td style="position: relative;">');contentDiv=t('<div id="VA012_contentArea_'+$self.windowNo+'" class="va012-content-area" style="position: absolute;" >');divMidWrap=t('<div id="VA012_middleWrap_'+$self.windowNo+'" class="va012-middle-wrap">');divtopWrap=t('<div class="va012-mid-top-wrap" id="VA012_formBtnNewRecord_'+$self.windowNo+'">                      <div class="va012-icons-wrap">                          <span>                              <i class="va012-undo vis vis-ignore" alt="undo" title="Undo" id="VA012_btnUndo_'+$self.windowNo+'"><\/i><\/span>                          <span>                              <i class="va012-hide-show-newform vis vis-plus" activestatus="0" alt="add" title = "Expand" id="VA012_btnNewRecord_'+$self.windowNo+'"><\/i><\/span>                      <\/div>                      <!-- end of icons-wrap -->                  <\/div>');divformWrap=t('<div class="va012-form-wrap va012-newform" id="VA012_formNewRecord_'+$self.windowNo+'" data-uid="0" style="height:55%;overflow-y:auto;width:101%;">');divRow1=t('<div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementNumber")+' <sup style="color: red;">*<\/sup><\/label>                                  <input  tabindex="1" id="VA012_txtStatementNo_'+$self.windowNo+'" type="text" class="va012-input-size">                                  <i  id="VA012_btnStatementNo_'+$self.windowNo+'" class="fa fa-plus va012-add-icon"><\/i>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementPage")+'<\/label>                                  <input tabindex="2" value="1" id="VA012_txtStatementPage_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementLine")+'<\/label>                                  <input tabindex="3" value="10" id="VA012_txtStatementLine_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  ');divRow2=t('<div class="row va012-fl-padd" style="width:102%">');row2Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_StatementDate")+'<sup style="color: red;">*<\/sup><\/label>                                  <input tabindex="4" id="VA012_dtStatementDate_'+$self.windowNo+'" type="date" max="9999-12-31">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->');row2Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">');row2Col2divAmt=t('<div class="va012-form-group va012-form-data" >');row2Col2Lble=t("<label>"+VIS.Msg.getMsg("VA012_Amount")+'<sup style="color: red;">*<\/sup><\/label>');row2Col2btnIn=t('<a tabindex="5" id="VA012_btnIn_'+$self.windowNo+'" v_active="1" class="va012-inout-icon va012-active">In<\/a>');row2Col2btnOut=t('<a tabindex="6" id="VA012_btnOut_'+$self.windowNo+'" v_active="0" class="va012-inout-icon va012-inactive">Out<\/a>');i=new VIS.Controls.VAmountTextBox("VA012_txtAmount_"+$self.windowNo+"",!1,!1,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));i.setValue(0);i.getControl().addClass("va012-input-size-amt va012-right-align va012-txtamount");row2Col2btnIcon=t('<a id="VA012_btnAmount_'+$self.windowNo+'" class="va012-info-icon"><\/a>');row2Col3=t('<div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_VoucherMatch")+'<sup style="color: red;">*<\/sup><\/label>                                  <select tabindex="8" id="VA012_cmbVoucherMatch_'+$self.windowNo+'">                                  <\/select>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  ');divRow3=t('                      <div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-8 col-sm-8 va012-padd-0">                              <div class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_Description")+'<\/label>                                  <input tabindex="9" id="VA012_txtDescription_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divVoucherNo_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_VoucherNo")+'<\/label>                                  <input tabindex="9" id="VA012_txtVoucherNo_'+$self.windowNo+'" type="text">                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  ');divRow4=t('<div class="row va012-fl-padd" style="width:102%">');divRow4Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">');divRow4Col1TrxAmt=t('<div id="VA012_divTrxAmt_'+$self.windowNo+'" class="va012-form-group va012-form-data">');divRow4Col1Lbl=t("<label>"+VIS.Msg.getMsg("VA012_TrxAmt")+"<\/label>");c=new VIS.Controls.VAmountTextBox("VA012_txtTrxAmt_"+$self.windowNo+"",!1,!0,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));c.getControl().addClass("va012-right-align");c.setValue(0..toFixed(p));divRow4Col1TrxAmt.append(divRow4Col1Lbl).append(c.getControl());divRow4Col1.append(divRow4Col1TrxAmt);divRow4Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">');divRow4Col2Diff=t('<div id="VA012_divDifference_'+$self.windowNo+'" class="va012-form-group va012-form-data">');divRow4Col2DiffLbl=t("<label>"+VIS.Msg.getMsg("VA012_Difference")+"<\/label>");w=new VIS.Controls.VAmountTextBox("VA012_txtDifference_"+$self.windowNo+"",!1,!0,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));w.getControl().addClass("va012-right-align");w.setValue(0);w.getControl().trigger("blur");divRow4Col2Diff.append(divRow4Col2DiffLbl).append(w.getControl());divRow4Col2.append(divRow4Col2Diff);divRow4Col3=t('<div class="col-md-4 col-sm-4 va012-padd-0">');divRow4Col3DiffType=t('<div id="VA012_divDifferenceType_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                  <label>'+VIS.Msg.getMsg("VA012_DifferenceType")+'<\/label>                                  <select tabindex="9" id="VA012_cmbDifferenceType_'+$self.windowNo+'">                                  <\/select>                              <\/div>                              <!-- end of form-group -->');divRow4Col3.append(divRow4Col3DiffType);divRow4.append(divRow4Col1).append(divRow4Col2).append(divRow4Col3);divRow5=t('<div class="row va012-fl-padd" style="width:102%">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divContraType_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_ContraType")+'<\/label>                                      <select tabindex="10" id="VA012_cmbContraType_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCashBook_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CashBook")+'<\/label>                                      <select tabindex="10" id="VA012_cmbCashBook_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <div id="VA012_divCtrlCashLine_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CashJournalLine")+'<\/label>                                      <div id="VA012_ctrlCashLine_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCheckNo_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CheckNo")+'<\/label>                                      <input  disabled tabindex="12" id="VA012_txtCheckNo_'+$self.windowNo+'" type="text">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->  ');divRow6=t('<div class="row va012-fl-padd" style="width:102%">');divRow6Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCharge_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Charge")+'<\/label>                                      <div style=" position: relative; float: left; width: 100%; ">                                      <input tabindex="10" chargeid="" type="text" id="VA012_txtCharge_'+$self.windowNo+'" style=" width: 100%; ">                                      <img id="VA012_btnCharge_'+$self.windowNo+'" class="VA012-img-combo" alt="">                                     <\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow6Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divTaxRate_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_TaxRate")+'<\/label>                                      <select tabindex="11" id="VA012_cmbTaxRate_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow6Col3=t('<div class="col-md-4 col-sm-4 va012-padd-0">');divRow6Col3divTax=t('<div id="VA012_divTaxAmount_'+$self.windowNo+'" class="va012-form-group va012-form-data">');divRow6Col3divTaxLbl=t("<label>"+VIS.Msg.getMsg("VA012_TaxAmount")+"<\/label>");wt=new VIS.Controls.VAmountTextBox("VA012_txtTaxAmount_"+$self.windowNo+"",!1,!0,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));wt.setValue(0);wt.getControl().addClass("va012-right-align");divRow6Col3divTax.append(divRow6Col3divTaxLbl).append(wt.getControl());divRow6Col3.append(divRow6Col3divTax);divRow6.append(divRow6Col1).append(divRow6Col2).append(divRow6Col3);divRow7=t('<div class="row va012-fl-padd" style="width:102%">                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlPayment_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Payment")+'<\/label>                                      <div id="VA012_ctrlPayment_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlInvoice_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Invoice")+'<\/label>                                      <div id="VA012_ctrlInvoice_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                              <div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCtrlBusinessPartner_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_BusinessPartner")+'<\/label>                                      <div id="VA012_ctrlBusinessPartner_'+$self.windowNo+'" ><\/div>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->                          <\/div>                      <!-- end of row -->  ');divRow8=t('<div class="row va012-fl-padd" style="width:102%">                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPaymentSchedule_'+$self.windowNo+'" class="va012-form-data" >                              <label>'+VIS.Msg.getMsg("VA012_PaymentSchedules")+'<\/label>                              <input disabled id="VA012_txtPaymentSchedule_'+$self.windowNo+'" type="text" class="va012-input-size">                              <a tabindex="13"  id="VA012_btnPaymentSchedule_'+$self.windowNo+'" class="va012-edit-icon"><\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-4 col-sm-4 va012-padd-0">                              <div id="VA012_divPrepayOrder_'+$self.windowNo+'" class="va012-form-data" >                              <label>'+VIS.Msg.getMsg("VA012_PrepayOrders")+'<\/label>                              <div id="VA012_ctrlOrder_'+$self.windowNo+'" class="va012-div-prepay"><\/div>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->  ');divRow9=t('<div class="row va012-fl-padd" style="width:102%">                       <div class="col-md-4 col-sm-4 va012-padd-0">                              <div class="va012-form-group va012-form-check">                                  <input tabindex="13" id="VA012_chkUseNextTime_'+$self.windowNo+'" type="checkbox">                                  <label style="position: absolute;">'+VIS.Msg.getMsg("VA012_UseNextTime")+'<\/label>                              <\/div>                              <!-- end of form-group -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-2 col-sm-2 va012-padd-0" >                              <div class="va012-form-data" id="VA012_divMore_'+$self.windowNo+'">                                  <a tabindex="14" visiblestatus="0" class="va012-more" id="VA012_btnMore_'+$self.windowNo+'" href="#">'+VIS.Msg.getMsg("VA012_More")+'<\/a>                              <\/div>                              <!-- end of form-data -->                          <\/div>                          <!-- end of col -->                          <div class="col-md-6 col-sm-6 va012-padd-0" >                          <div style="float:right;">                              <a tabindex="15" title="Save Record" id="VA012_btnSave_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue" style=" float: left;">'+VIS.Msg.getMsg("VA012_SaveandNew")+"<\/a>                          <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->");divRow10=t('<div class="row va012-fl-padd" style="width:102%">');divRow10Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCurrency_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_Currency")+'<\/label>                                      <select tabindex="10" id="VA012_txtCurrency_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow10Col2=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divConversionType_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_ConversionType")+'<\/label>                                      <select tabindex="11" id="VA012_txtConversionType_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow10Col3=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divPaymentMethod_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_PaymentMethod")+'<\/label>                                      <select tabindex="16" id="VA012_txtPaymentMethod_'+$self.windowNo+'">                                      <\/select>                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow10.append(divRow10Col1).append(divRow10Col2).append(divRow10Col3);divRow11=t('<div class="row va012-fl-padd" style="width:102%">');divRow11Col1=t('<div class="col-md-4 col-sm-4 va012-padd-0">                                  <div id="VA012_divCheckNum_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CheckNo")+'<\/label>                                      <input tabindex="17" id="VA012_txtCheckNum_'+$self.windowNo+'" type="text">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow11Col2=t('<div class="col-md-4 col-sm-4 va012-padd-1">                                  <div id="VA012_divCheckDate_'+$self.windowNo+'" class="va012-form-group va012-form-data">                                      <label>'+VIS.Msg.getMsg("VA012_CheckDate")+'<\/label>                                      <input tabindex="18" id="VA012_txtCheckDate_'+$self.windowNo+'" type="date" max="9999-12-31">                                  <\/div>                                  <!-- end of form-group -->                              <\/div>                              <!-- end of col -->');divRow11.append(divRow11Col1).append(divRow11Col2);payHeaderWrap=t('<div id="VA012_paymentHeaderWrap_'+$self.windowNo+'" class="va012-payment-header-wrap">                      <div class="va012-headersearchfilter">                           <div class="va012-searchfilter">                              <select id="VA012_cmbTransactionType_'+$self.windowNo+'">                             <option value="PY">'+VIS.Msg.getMsg("VA012_Payments")+'<\/option>                             <option value="PO">'+VIS.Msg.getMsg("VA012_PrepayOrders")+'<\/option>                              <option value="IS">'+VIS.Msg.getMsg("VA012_InvoiceSchedule")+'<\/option>                              <option value="CO">'+VIS.Msg.getMsg("VA012_Contra")+'<\/option>                              <\/select>                          <\/div>                          <div class="va012-searchfilter">                              <select id="VA012_cmbSearchPaymentMethod_'+$self.windowNo+'">                              <\/select>                          <\/div>                       <div id=VA012_DivBusinessPartner_'+$self.windowNo+' class="va012-searchfilter">                       <\/div>                       <div class="VA012-search-wrap va012-searchfilter">                        <input value = "" placeholder="'+VIS.Msg.getMsg("VA012_Search")+'..." type = "text" id = VA012_txtSearch_Payment_'+$self.windowNo+'>                        <a class= "va012-search-icon va012-search-icon-right" id = VA012_btnSearch_Payment_'+$self.windowNo+' > <span class="glyphicon glyphicon-search"><\/span><\/a >                       <\/div>                          <\/div>                      <\/div>                      <!-- end of payment-header-wrap -->                  <div id="VA012_paymentList_'+$self.windowNo+'" class="va012-payment-list">                                           <div class="va012-payment-content" id="VA012_lstPayments_'+$self.windowNo+'">                   <\/div>                  <\/div>                  <!-- end of payment-list -->                <\/div>');rightWrap=t('<div id="VA012_rightWrap_'+$self.windowNo+'" class="va012-right-wrap">                  <div id="VA012_rightTop_'+$self.windowNo+'" class="va012-right-top">                      <div class="row">                          <div class="col-md-3 col-sm-3" style=" padding-right: 5px; ">                              <div class="va012-pay-text" id="VA012_secReconciled_'+$self.windowNo+'" >                                <p>'+VIS.Msg.getMsg("VA012_Reconciled")+'<\/p>                                <p style="margin-top: 4px;">'+VIS.Msg.getMsg("VA012_Unreconciled")+'<\/p>                              <\/div>                          <\/div>                          <!-- end of col -->                          <div class="col-md-9 col-sm-9" style=" padding-left: 5px; ">                              <div class="va012-pay-text" id="VA012_secUnreconciled_'+$self.windowNo+'">                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-green"><span class="va012-base-curr"><\/span> 0<\/span>                                <span style="padding-bottom: 2px;" class="va012-amount va012-font-red"><span class="va012-base-curr"><\/span> 0<\/span>                              <\/div>                          <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                      <div class="row">                          <div class="col-md-12 col-sm-12" style=" padding-left: 5px; ">                      <div style=" /* float: right; */ padding-left: 10px;">                               <a id="VA012_btnUnmatch_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue" title="Show Unmatched Record" style=" float: left; ">'+VIS.Msg.getMsg("VA012_Unmatch")+'<\/a>                              <a id="VA012_btnProcess_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue" title="Clear Matched Record" style=" float: left; margin-left: 5px; ">'+VIS.Msg.getMsg("VA012_Process")+'<\/a>                             <a id="VA012_btnDelete_'+$self.windowNo+'" class="va012-frm-btn va012-btn-blue" title="Delete Selected Record" style=" float: left; margin-left: 5px; ">'+VIS.Msg.getMsg("VA012_Delete")+'<\/a>                       <\/div>                           <\/div>                          <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <div class="row">                          <div class="col-md-12 col-sm-12" style=" padding-right: 5px; ">                           <div class="va012-right-search">                            <div class="va012-search-wrap">                               <input id="VA012_txtSearch_'+$self.windowNo+'" value="" placeholder="'+VIS.Msg.getMsg("VA012_Search")+'..." type="text">                               <a id="VA012_btnSearch_'+$self.windowNo+'" class="va012-search-icon"><span class="glyphicon glyphicon-search"><\/span><\/a>                          <\/div>                      <!-- end of search-wrap -->                         <\/div>                  <!-- end of right-search -->                        <\/div>                       <!-- end of col -->                      <\/div>                      <!-- end of row -->                     <\/div>                  <!-- end of right-top -->                    <div class="va012-right-content" id="VA012_lstStatement_'+$self.windowNo+'">                  <\/div>                  <!-- end of right-content -->              <\/div>');row2Col2divAmt.append(row2Col2Lble).append(row2Col2btnIn).append(row2Col2btnOut).append(i.getControl()).append(row2Col2btnIcon);row2Col2.append(row2Col2divAmt);divRow2.append(row2Col1).append(row2Col2).append(row2Col3);divformWrap.append(divRow1).append(divRow2).append(divRow10).append(divRow11).append(divRow3).append(divRow4).append(divRow5).append(divRow6).append(divRow7).append(divRow8).append(divRow9);var n="C_BPartner.IsActive='Y' AND C_BPartner.IsSummary ='N' AND C_BPartner.AD_Org_ID IN(0,@AD_Org_ID@) AND C_BPartner.AD_Client_ID = "+VIS.context.getAD_Client_ID(),r=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,3499,VIS.DisplayType.Search,"C_BPartner_ID",0,!1,n);return ru=new VIS.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,VIS.DisplayType.Search,r),divMidWrap.append(divtopWrap).append(divformWrap).append(payHeaderWrap),t(payHeaderWrap).find("#VA012_DivBusinessPartner_"+$self.windowNo).append(ru.getControl().attr("id","C_BPartner_ID_"+$self.windowNo).addClass("BPSearchText").attr("placeholder",VIS.Msg.getMsg("VA012_BusinessPartner"))).append(ru.getBtn(0).addClass("btnBPSearch")),contentDiv.append(divMidWrap).append(rightWrap),tableTd1.append(contentDiv),tableTr.append(tableTd).append(tableTd1),gu=t('<div  id="VA012_gridMatchStatePopUp_'+$self.windowNo+'"" style="display:block;width:auto;height:auto"><div  style="    width: 50%;float: left;" ><label>'+VIS.Msg.getMsg("VA012_ChargeType")+'<\/label><div  id="VA012_ChargeSrch_'+$self.windowNo+'"><\/div><\/div><div ><label>'+VIS.Msg.getMsg("VA012_Taxrate")+'<\/label><select  id="VA012_cmbTaxRate_'+$self.windowNo+'"><\/select><\/div><div style="width:auto;height:270px" id="VA012_gridMatchState_'+$self.windowNo+'""><\/div><\/div>'),uo=gu.find("#VA012_gridMatchState_"+$self.windowNo),ge=gu.find("#VA012_ChargeSrch_"+$self.windowNo),fo=gu.find("#VA012_cmbTaxRate_"+$self.windowNo),_ChargeLookUp=VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(),$self.windowNo,3787,VIS.DisplayType.Search),$ChargeControl=new VIS.Controls.VTextBoxButton("C_Charge_ID",!0,!1,!0,VIS.DisplayType.Search,_ChargeLookUp),ge.append($ChargeControl.getControl().css("width","93%")).append($ChargeControl.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")),divTable.append(tableTr),_formDesign.append(divContainer).append(divTable),_formDesign},setBankAndAccount:function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/SetBankAndAccount",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n!=null&&(hf=n.Table[0].C_BANK_ID,sf=n.Table[0].C_BANKACCOUNT_ID));l.loadBank()}})},addEffect:function(n,t,i){var r={to:t,className:"wsp-ui-effects-transfer"};n.effect("transfer",r,600,i)},setInvoiceAndBPartner:function(n,i){t.ajax({url:VIS.Application.contextUrl+"BankStatement/SetInvoiceAndBPartner",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_paymentID:n,_cmbTransactionType:i},success:function(n){if(n!=null&&n!="")if(n=t.parseJSON(t.parseJSON(n)),i=="PY"){n._invoiceID>0?dt.setValue(n._invoiceID,!1,!0):dt.setValue();n._bPartnerID>0?et.setValue(n._bPartnerID,!1,!0):et.setValue();var r=VIS.DB.executeScalar("SELECT COUNT(*) FROM AD_ModuleInfo WHERE Prefix='VA034_' AND IsActive='Y'");r==1&&n.VA034_DepositSlipNo!=""&&er.val(n.VA034_DepositSlipNo)}else i=="PO"?et.value||et.setValue(n._bPartnerID,!1,!0):i=="IS"&&(et.value||et.setValue(n._bPartnerID,!1,!0))}})},setBPartner:function(n){t.ajax({url:VIS.Application.contextUrl+"BankStatement/SetBPartner",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_invoiceID:n},success:function(n){n!=null&&n!=""&&(n=t.parseJSON(n),n>0?et.setValue(n,!1,!0):et.setValue())}})},getMaxStatement:function(n){h.val()>0?t.ajax({url:VIS.Application.contextUrl+"BankStatement/MaxStatement",type:"GET",datatype:"json",data:{_bankAccount:h.val()==null?0:h.val(),_origin:n,_pageNo:0},contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),gt.val(n.statementNo),ci.val(n.pageno),ir.val(n.lineno))}}):(gt.val("0"),ci.val("0"),ir.val("0"))},getOverUnderPayment:function(n){t.ajax({url:VIS.Application.contextUrl+"BankStatement/getOverUnderPayment",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_paymentID:n},success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),n._difference!=0&&(w.setValue(VIS.Utility.Util.getValueOfDecimal(Math.abs(n._difference))),ki.find("*").prop("disabled",!1),k.val(n._differenceType).prop("selected",!0),w.getControl().attr("vchangable","N"),b.val()=="M"&&c.setValue(VIS.Utility.Util.getValueOfDecimal(n._payamt.toFixed(p)))))}})},getControls:function(){bi=a.find("#VA012_cmbBank_"+$self.windowNo);h=a.find("#VA012_cmbBankAccount_"+$self.windowNo);rf=a.find("#VA012_STAT_cmbBankAccountClassName_"+$self.windowNo);at=a.find("#VA012_statementDate_"+$self.windowNo);we=a.find("#VA012_BankChargeDiv"+$self.windowNo);vt=a.find("#VA012_cmbSearchPaymentMethod_"+$self.windowNo);ot=a.find("#VA012_cmbTransactionType_"+$self.windowNo);df=a.find("#VA012_btnLoadStatement_"+$self.windowNo);gf=a.find("#VA012_btnMatchStatement_"+$self.windowNo);pt=a.find("#VA012_lstStatement_"+$self.windowNo);ti=a.find("#VA012_lstPayments_"+$self.windowNo);uf=a.find("#VA012_paymentList_"+$self.windowNo);uu=a.find("#VA012_secReconciled_"+$self.windowNo);fu=a.find("#VA012_secUnreconciled_"+$self.windowNo);si=a.find("#VA012_txtSearch_"+$self.windowNo);se=a.find("#VA012_btnSearch_"+$self.windowNo);ne=a.find("#VA012_btnUnmatch_"+$self.windowNo);te=a.find("#VA012_btnProcess_"+$self.windowNo);ie=a.find("#VA012_btnHide_"+$self.windowNo);ff=a.find("#VA012_tdLeft_"+$self.windowNo);ef=a.find("#VA012_table_"+$self.windowNo);wi=a.find("#VA012_btnMore_"+$self.windowNo);ke=a.find("#VA012_divMore_"+$self.windowNo);or=a.find("#VA012_divContraType_"+$self.windowNo);br=a.find("#VA012_divCashBook_"+$self.windowNo);_divCtrlCashLine=a.find("#VA012_divCtrlCashLine_"+$self.windowNo);sr=a.find("#VA012_divTransferType_"+$self.windowNo);kr=a.find("#VA012_divCheckNo_"+$self.windowNo);li=a.find("#VA012_divVoucherNo_"+$self.windowNo);be=a.find("#VA012_divTrxAmt_"+$self.windowNo);cu=a.find("#VA012_divDifference_"+$self.windowNo);ki=a.find("#VA012_divDifferenceType_"+$self.windowNo);fi=a.find("#VA012_divCharge_"+$self.windowNo);oe=a.find("#VA012_btnCharge_"+$self.windowNo);ei=a.find("#VA012_divTaxRate_"+$self.windowNo);ai=a.find("#VA012_divTaxAmount_"+$self.windowNo);hr=a.find("#VA012_divCtrlPayment_"+$self.windowNo);cr=a.find("#VA012_divCtrlInvoice_"+$self.windowNo);lr=a.find("#VA012_divCtrlBusinessPartner_"+$self.windowNo);ar=a.find("#VA012_divPrepayOrder_"+$self.windowNo);vr=a.find("#VA012_divPaymentSchedule_"+$self.windowNo);_divPaymentMethod=a.find("#VA012_divPaymentMethod_"+$self.windowNo);yr=a.find("#VA012_divCheckNum_"+$self.windowNo);pr=a.find("#VA012_divCheckDate_"+$self.windowNo);_txtSearchPayment=a.find("#VA012_txtSearch_Payment_"+$self.windowNo);_btnSearchPayment=a.find("#VA012_btnSearch_Payment_"+$self.windowNo)},getBaseCurrency:function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetBaseCurrency",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),vu=n._code,pe=n._id,t(".va012-base-curr").text(vu))}})},loadBank:function(){function n(n){if(bi.html(""),bi.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)bi.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].Value)+">"+n[t].Name+"<\/option>");bi.prop("selectedIndex",0);hf>0&&(bi.val(hf).prop("selected",!0),hf=0);l.loadBankAccount()}t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetBank",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",success:function(i){i!=null&&i!=""&&(_ds=t.parseJSON(i),n(_ds))}})},loadBankAccount:function(){function t(t){if(h.html(""),h.append("<option value=0 ><\/option>"),t!=null)for(var i=0;i<t.tables[0].rows.length;i++)h.append("<option value="+VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_bankaccount_id)+">"+VIS.Utility.encodeText(t.tables[0].rows[i].cells.accountno)+"<\/option>");t.dispose();t=null;n=null;h.prop("selectedIndex",0);sf>0&&(h.val(sf).prop("selected",!0),sf=0);l.getMaxStatement("LO");l.loadSearchPaymentMethod()}var n="SELECT ACCOUNTNO,C_BANKACCOUNT_ID FROM C_BANKACCOUNT WHERE ISACTIVE='Y' AND C_BANK_ID="+bi.val(),i=VIS.DB.executeDataSet(n.toString(),null,t)},LoadPaymentsPages:function(n,i,r){gi=si.val()!=null&&si.val()!=""?!0:!1;t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadPaymentsPages",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_accountID:n,_paymentPageNo:vi,_PAGESIZE:yu,_paymentMethodID:i,_transactionType:r,businessPartnerId:ru.value,txtSearch:_txtSearchPayment.val()},success:function(n){n!=null&&n!=""&&(iu=JSON.parse(n))}})},loadPayments:function(n,i,r,u){function f(n){var u,i,f,e;if(n=t.parseJSON(n),n.length>0&&(storepaymentdata=storepaymentdata.concat(n)),n=storepaymentdata,u="",ti.html(""),n!=null&&n.length>0)for(i=0;i<n.length;i++)f=new Date(n[i].DateAcct).toLocaleDateString(),e="va012-red-color",e=n[i].c_bankstatementline_id==null||n[i].c_bankstatementline_id=="0"||n[i].c_bankstatementline_id==0?"va012-red-color":"va012-green-color",u="",u='<div class="drag-no-drag"><div draggable="true" class="va012-mid-data-wrap ',(r=="PY"||r=="CO")&&(u+=e),u+=' " paymentdata="'+VIS.Utility.encodeText(new Date(n[i].DueDate).toLocaleDateString())+"_"+VIS.Utility.encodeText(n[i].DueAmt)+'" data-uid="'+n[i].c_payment_id,u+=' " paymentamount = " '+VIS.Utility.Util.getValueOfDecimal(n[i].convertedamount,"N")+'"><div class="va012-payment-wrap" ><div class="row"> <div class="col-md-3 col-sm-3">    <div class="va012-form-check">        <input type="checkbox" data-uid="'+n[i].c_payment_id+'"  >    <div title="'+VIS.Msg.getMsg("VA012_PaymentAmount")+'" class="va012-inside-form-check" style=" float: left; width: 85%; ">      <label style=" width: 100%; ">'+n[i].currency+" "+parseFloat(n[i].paymentamount).toLocaleString(navigator.language,{minimumFractionDigits:p,maximumFractionDigits:p})+"<\/label>",n[i].isconverted=="Y"&&(u+="      <span>"+n[i].basecurrency+" "+parseFloat(n[i].convertedamount).toLocaleString(navigator.language,{minimumFractionDigits:p,maximumFractionDigits:p})+"<\/span>"),u+='   <\/div><\/div>    <!-- end of form-group -->  <\/div>  <!-- end of col -->  <div class="col-md-4 col-sm-4">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Business Partner">'+VIS.Utility.encodeText(n[i].businesspartner)+'<\/p>         <span title="'+VIS.Msg.getMsg("VA012_InvReference")+'">'+VIS.Utility.encodeText(n[i].bpgroup)+'<\/span>       <span title="Document No.">'+VIS.Utility.encodeText(n[i].paymentno)+'<\/span>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col --> <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text"><p title="Payment Type">'+VIS.Utility.encodeText(n[i].paymenttype)+"<\/p><\/div><\/div><!-- end of form-group --><\/div><!-- end of col -->",u+=r=="PY"&&ye>0?'  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Deposit Slip No">'+VIS.Utility.encodeText(n[i].depositslipno)+'<\/p>           <p title="Authentication Code">'+VIS.Utility.encodeText(n[i].authcode)+'<\/p>           <p title="Account Date">'+f+'<\/p>           <p title="Payment Method">'+n[i].PaymentMethod+"<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->":'  <div class="col-md-2 col-sm-2">     <div class="va012-form-check">         <div class="va012-pay-text">           <p title="Authentication Code">'+VIS.Utility.encodeText(n[i].authcode)+'<\/p>           <p title="Account Date">'+f+'<\/p>           <p title="Payment Method">'+n[i].PaymentMethod+"<\/p>  <\/div> <\/div><!-- end of form-group --><\/div><!-- end of col -->",u+="<\/div><!-- end of row --><\/div> <!-- end of payment-wrap --><\/div> <!-- end of mid-data-wrap -->",ti.append(u);_sql=null;l.setPaymentListHeight();l.dragPayments()}n>0&&(ni(t(uf),!0,"inherit"),window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadPayments",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{_accountID:n,_paymentPageNo:vi,_PAGESIZE:re,_paymentMethodID:i,_transactionType:r,statementDate:u==null||u==""?new Date:u,businessPartnerId:ru.value,txtSearch:_txtSearchPayment.val()},success:function(n){n!=null&&n!=""&&(f(n),ni(t(uf),!1,"inherit"))},error:function(){ni(t(uf),!1,"inherit")}})},2))},setPaymentListHeight:function(){var n;clearTimeout(n);n=setTimeout(function(){t("#VA012-content-area"+$self.windowNo).height(t("#VA012_mainContainer_"+$self.windowNo).height()-20);bt.attr("activestatus")=="1"?t("#VA012_paymentList_"+$self.windowNo).height(t("#VA012_middleWrap_"+$self.windowNo).height()-t("#VA012_formBtnNewRecord_"+$self.windowNo).height()-t("#VA012_formNewRecord_"+$self.windowNo).height()-t("#VA012_paymentHeaderWrap_"+$self.windowNo).height()-42):t("#VA012_paymentList_"+$self.windowNo).height(t("#VA012_middleWrap_"+$self.windowNo).height()-t("#VA012_formBtnNewRecord_"+$self.windowNo).height()-t("#VA012_paymentHeaderWrap_"+$self.windowNo).height()-27)},2)},loadSearchPaymentMethod:function(){function n(n){if(vt.html(""),vt.append("<option value=0 >"+VIS.Msg.getMsg("VA012_SelectPaymentMethod")+"<\/option>"),n!=null)for(var t=0;t<n.length;t++)vt.append("<option value="+n[t].chargeID+">"+VIS.Utility.encodeText(n[t].name)+"<\/option>");vt.prop("selectedIndex",0);h.trigger("change")}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetPaymentMethods",null,n)},paymentScroll:function(){iu=0;t(this).scrollTop()+t(this).innerHeight()+2>=this.scrollHeight&&(l.LoadPaymentsPages(h.val(),vt.val(),ot.val()),vi<iu&&(vi++,l.loadPayments(h.val(),vt.val(),ot.val(),at.val())))},statementScroll:function(){he=0;t(this).scrollTop()>0&&t(this).scrollTop()+t(this).innerHeight()+1>=this.scrollHeight&&(tt.LoadStatementsPages(),yi<he&&(yi++,tt.loadStatement(hi)))},dragPayments:function(){ti.find(".va012-mid-data-wrap").draggable({start:function(n,t){t.helper.addClass("va012-dragging")},drag:function(){},stop:function(n,t){t.helper.removeClass("va012-dragging")},cursor:"move",cursorAt:{left:5},revert:"invalid",helper:"clone"})},dropPayments:function(){pt.find(".va012-right-data-wrap").droppable({hoverClass:"va012-dropping",drop:function(n,s){var b,it,a,w,k,nt,h;if(t(s.draggable).data("uid")>0&&t(this).data("uid")>0){if(ot.val()=="PY"){if(b=t(s.draggable).data("uid"),t(s.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_PaymentAlreadyMatchedOthrStatement",null,"","");return}h=t(this).data("uid");l.checkPaymentCondition(t(s.draggable).data("uid"),t(this).data("uid"),r(i.getControl().val()))&&(tt.statementOpenEdit(t(this).data("uid"),b),window.setTimeout(function(){if(r(c.getControl().val())==0){var n=d.val();u.refreshForm();d.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}d.attr("readonly",!0);ui=!0;g.setValue(b,!1,!0);v.val()>0?v.attr("disabled",!0):v.attr("disabled",!1);l.setInvoiceAndBPartner(t(s.draggable).data("uid"),"PY");ui=!1},500))}else if(ot.val()=="IS"){if(it=t(s.draggable).data("uid"),parseInt(f.attr("data-uid"))!=t(this).data("uid")&&u.scheduleRefresh(),l.checkScheduleCondition(t(s.draggable).data("uid"),t(this).data("uid"),y.toString(),r(i.getControl().val()))){if(kf(parseInt(t(s.draggable).data("uid")),y))VIS.ADialog.info("VA012_AlreadySelected",null,"","");else if(y.push(parseInt(t(s.draggable).data("uid"))),pi.push(t(s.draggable).attr("paymentdata")),yt.push(t(s.draggable).attr("paymentamount")),Number(yt[0])=="0"){for(a=0,w=0;w<yt.length;w++)a+=VIS.Utility.Util.getValueOfDecimal(yt[w]);a<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"));i.setValue(VIS.Utility.Util.getValueOfDecimal(a.toFixed(p)))}ui=!0;tt.statementOpenEdit(t(this).data("uid"),it);di.val(pi.toString());window.setTimeout(function(){if(r(c.getControl().val())==0){var n=d.val();u.refreshForm();u.scheduleRefresh();d.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}l.setInvoiceAndBPartner(t(s.draggable).data("uid"),"IS");d.attr("readonly",!0);yt.length==1&&(yt[0]=VIS.Utility.Util.getValueOfString(r(c.getControl().val())));c.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())])},500)}}else ot.val()=="PO"&&(k=t(s.draggable).data("uid"),parseInt(f.attr("data-uid"))!=t(this).data("uid")&&u.prepayRefresh(),l.checkPrepayCondition(t(s.draggable).data("uid"),t(this).data("uid"),gr.toString(),r(i.getControl().val()))&&(tt.statementOpenEdit(t(this).data("uid"),k),window.setTimeout(function(){if(r(c.getControl().val())==0){var n=d.val();u.refreshForm();u.prepayRefresh();d.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}d.attr("readonly",!0);ui=!0;ft.setValue(k,!1,!0);ui=!1;l.setInvoiceAndBPartner(t(s.draggable).data("uid"),"PO")},500)));if(ot.val()=="CO"){if(nt=t(s.draggable).data("uid"),t(s.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_CashLineAlreadyMatchedOthrStmt",null,"","");return}h=t(this).data("uid");l.checkContraCondition(t(s.draggable).data("uid"),t(this).data("uid"),r(i.getControl().val()))&&(tt.statementOpenEdit(h,nt),window.setTimeout(function(){if(r(c.getControl().val())==0){var n=d.val();u.refreshForm();d.val(n);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}d.attr("readonly",!0);ui=!0;ht.setValue(nt,!1,!0);ui=!1},500))}}}});f.droppable({hoverClass:"va012-dropping",drop:function(n,u){var s,v,f,a,w;if(t(u.draggable).data("uid")>0){if(ot.val()=="CO")if(b.val()=="C"){if(st.val()!="CB"){VIS.ADialog.info("VA012_ContraSelectCashToBank",null,"","");return}}else{VIS.ADialog.info("VA012_SelectVoucherContra",null,"","");return}else if(b.val()!="M"){VIS.ADialog.info("VA012_SelectVoucherPayment",null,"","");return}if(ot.val()=="PY"){if(t(u.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_PaymentAlreadyMatchedOthrStatement",null,"","");return}if(t(u.draggable).data("uid")>0)if(VIS.Utility.Util.getValueOfInt(ri)==0)g.setValue(t(u.draggable).data("uid"),!1,!0);else{VIS.Utility.Util.getValueOfInt(ri)==VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid"))?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"","");return}}if(ot.val()=="IS"&&l.checkScheduleCondition(t(u.draggable).data("uid"),t(this).attr("data-uid"),y.toString(),r(i.getControl().val()))){if(f=0,kf(parseInt(t(u.draggable).data("uid")),y)){VIS.ADialog.info("VA012_AlreadySelected",null,"","");return}if(s=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetConvtAmount",{recordID:parseInt(t(u.draggable).data("uid")),bnkAct_Id:h.val(),transcType:ot.val(),stmtDate:d.val()}),s.length==0||s[0].DueAmount==0){VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}if(v=t(this).attr("data-uid"),y.push(parseInt(t(u.draggable).data("uid"))),pi.push(t(u.draggable).attr("paymentdata")),yt.push(s[0].DueAmount),f=0,Number(yt.length)>0)for(a=0;a<yt.length;a++)f+=VIS.Utility.Util.getValueOfDecimal(yt[a]);f<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),f>0&&i.getControl().removeClass("va012-mandatory"));v==0?i.setValue(VIS.Utility.Util.getValueOfDecimal(f.toFixed(p))):d.attr("readonly",!0);l.setInvoiceAndBPartner(t(u.draggable).data("uid"),"IS");s[0]._paymentMethod_Id?nt.val(s[0]._paymentMethod_Id).prop("selected",!0):nt.val(0).prop("selected",!0);nt.trigger("change");di.val(pi.toString());c.setValue(VIS.Utility.Util.getValueOfDecimal(f.toFixed(p)));c.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]);w=y!=null?y.toString():null;nf(w)}if(ot.val()=="PO"){if(VIS.Utility.Util.getValueOfInt(kt)!=0){VIS.Utility.Util.getValueOfInt(kt)==VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid"))?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"","");return}ft.setValue(t(u.draggable).data("uid"),!1,!0)}if(ot.val()=="CO"&&t(u.draggable).data("uid")>0){if(t(u.draggable).hasClass("va012-green-color")){VIS.ADialog.info("VA012_CashLineAlreadyMatchedOthrStmt",null,"","");return}if(VIS.Utility.Util.getValueOfInt(oi)!=0){VIS.Utility.Util.getValueOfInt(oi)==VIS.Utility.Util.getValueOfInt(t(u.draggable).data("uid"))?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"","");return}if(l.checkContraCondition(t(u.draggable).data("uid"),t(this).attr("data-uid"),r(i.getControl().val()))){if(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))==0){VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}c.setValue(r(i.getControl().val()));i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]);ht.setValue(t(u.draggable).data("uid"),!1,!0)}}}ui=!1}})},checkFormPaymentCondition:function(n,u){var f=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckFormPaymentCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_paymentID:n,_amount:u},success:function(n){n=t.parseJSON(n);n._status=="Success"?(f=!0,n._amount!=null&&n._amount!=0&&(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(p))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0")))):(VIS.ADialog.info(n._status,null,"",""),f=!1)},error:function(){VIS.ADialog.info("error",null,"","");f=!1}}),f},checkFormPrepayCondition:function(n,u){var s=0,f;return et.value&&(s=et.value),f=!1,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckFormPrepayCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_orderID:n,_amount:u,_currencyId:lt,_formBPartnerID:s},success:function(n){n=t.parseJSON(n);n._status=="Success"?(f=!0,n._amount>0&&(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(p))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0")))):(VIS.ADialog.info(n._status,null,"",""),f=!1)},error:function(){VIS.ADialog.info("error",null,"","");f=!1}}),f},checkInvoiceCondition:function(n,i){var r=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckInvoiceCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_invoiceID:n,_amount:i},success:function(n){n=t.parseJSON(n);n=="Success"?r=!0:(VIS.ADialog.info(n,null,"",""),r=!1)},error:function(){VIS.ADialog.info("error",null,"","");r=!1}}),r},checkPaymentCondition:function(n,l,a){var y=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckPaymentCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:l,_amount:a,statmtDate:d.val(),accountID:h.val()},success:function(n){if(n=t.parseJSON(n),n._status=="Success")if(y=!0,n._amount!=null&&n._amount!=0){if(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(p))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"),i.getControl().addClass("va012-mandatory"),c.getControl().addClass("va012-mandatory")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),i.getControl().removeClass("va012-mandatory"),c.getControl().removeClass("va012-mandatory")),c.setValue(VIS.Utility.Util.getValueOfDecimal(n._trxamount.toFixed(p))),n._currency_Id!=0&&VIS.Utility.Util.getValueOfString(g.value)!=null){s.val(lt).prop("selected",!0);for(var h=0;s[0].length>h;h++)VIS.Utility.Util.getValueOfInt(s[0][h].value)==lt?t(s[0][h]).show():t(s[0][h]).hide();s.removeClass("va012-mandatory");s.attr("disabled",!1);t(v[0][0]).hide();v.val(n._conversionType_Id).prop("selected",!0);v.attr("disabled",!0)}else s.val(lt).prop("selected",!0),s.attr("disabled",!0),s.removeClass("va012-mandatory"),v.val(n._conversionType_Id).prop("selected",!0);v.trigger("change");n._paymentMethod_Id?(nt.val(n._paymentMethod_Id).prop("selected",!0),nt.attr("disabled",!0),nt.removeClass("va012-mandatory")):nt.addClass("va012-mandatory");n._checkNo&&(yr.show(),rt.val(n._checkNo),rt.attr("disabled",!0),rt.removeClass("va012-mandatory"));n._checkDate&&(pr.show(),ct.val(Globalize.format(new Date(n._checkDate),"yyyy-MM-dd")),ct.attr("disabled",!0),ct.removeClass("va012-mandatory"))}else if(l==0&&a!=0){if(f[0].attributes["data-uid"].value>0&&(l=f[0].attributes["data-uid"].value),g!=null&&g.value>0&&l>0)return tt.statementListRecordEdit(l,g.value),d.attr("readonly",!0),y=!0}else l==0&&(u.refreshForm(),VIS.ADialog.info("VA012_ConversionRateNotFound",null,"",""),y=!1);else VIS.ADialog.info(n._status,null,"",""),y=!1},error:function(){VIS.ADialog.info("error",null,"","");y=!1}}),y},checkScheduleCondition:function(n,i,r,u){var e,f;if(lt==null||lt==0){VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"","");return}return e=0,et.value&&(e=et.value),f=!1,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckScheduleCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:i,_listToCheck:r,_amount:u,_currencyId:lt,_formBPartnerID:e},success:function(n){n=t.parseJSON(n);n=="Success"?f=!0:(VIS.ADialog.info(n,null,"",""),f=!1)},error:function(){VIS.ADialog.info("error",null,"","");f=!1}}),f},checkScheduleTotal:function(n,i,r){var u=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckScheduleTotal",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_listToCheck:n,_amount:i,_currencyId:lt,_destinationID:r},success:function(n){n=t.parseJSON(n);n=="Success"?u=!0:(VIS.ADialog.info(n,null,"",""),u=!1)},error:function(){VIS.ADialog.info("error",null,"","");u=!1}}),u},checkPrepayCondition:function(n,u,h,c){var a=0,l,y;return et.value&&(a=et.value),l=!1,y=u,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckPrepayCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:u,_listToCheck:h,_amount:c,_currencyId:lt,_formBPartnerID:a,stateDate:d.val()},success:function(h){if(h=t.parseJSON(h),h._status=="Success")if(l=!0,h._amount!=0){if(i.setValue(VIS.Utility.Util.getValueOfDecimal(h._amount.toFixed(p))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),r(i.getControl().val())>0&&i.getControl().removeClass("va012-mandatory")),h._currency_Id!=0&&VIS.Utility.Util.getValueOfString(ft.value)!=null){s.val(h._currency_Id).prop("selected",!0);for(var a=0;s[0].length>a;a++)VIS.Utility.Util.getValueOfInt(s[0][a].value)==h._currency_Id||VIS.Utility.Util.getValueOfInt(s[0][a].value)==lt?t(s[0][a]).show():t(s[0][a]).hide();s.removeClass("va012-mandatory");s.attr("disabled",!1);t(v[0][0]).hide();v.val(h._conversionType_Id).prop("selected",!0);v.attr("disabled",!1)}else s.val(lt).prop("selected",!0),s.attr("disabled",!0),s.removeClass("va012-mandatory"),v.val(h._conversionType_Id).prop("selected",!0);v.trigger("change");h._paymentMethod_Id?(nt.val(h._paymentMethod_Id).prop("selected",!0),nt.attr("disabled",!1)):(nt.val(0).prop("selected",!0),nt.attr("disabled",!1));nt.trigger("change")}else{if(u==0&&c!=0&&(f[0].attributes["data-uid"].value>0&&(u=f[0].attributes["data-uid"].value),n>0&&u>0))return tt.statementListRecordEdit(u,n),d.attr("readonly",!0),l=!0;l=y>0?!0:!1}else VIS.ADialog.info(h._status,null,"",""),l=!1},error:function(){VIS.ADialog.info("error",null,"","");l=!1}}),l},checkContraCondition:function(n,u,h){var l=0,c;return et.value&&(l=et.value),c=!1,t.ajax({url:VIS.Application.contextUrl+"BankStatement/CheckContraCondition",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragSourceID:n,_dragDestinationID:u,_amount:h,_currencyId:lt,_formBPartnerID:l,stateDate:d.val()},success:function(l){if(l=t.parseJSON(l),l._status=="Success")if(c=!0,i.setValue(VIS.Utility.Util.getValueOfDecimal(l._amount.toFixed(p))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),r(i.getControl().val())>0&&i.getControl().removeClass("va012-mandatory")),l._amount!=0&&VIS.Utility.Util.getValueOfString(ht.value)!=null){s.val(lt).prop("selected",!0);for(var a=0;s[0].length>a;a++)VIS.Utility.Util.getValueOfInt(s[0][a].value)==lt?t(s[0][a]).show():t(s[0][a]).hide();if(s.removeClass("va012-mandatory"),s.attr("disabled",!1),t(v[0][0]).hide(),v.val(l._conversionType_Id).prop("selected",!0),v.removeClass("va012-mandatory"),v.attr("disabled",!0),u==0&&h!=0&&(f[0].attributes["data-uid"].value>0&&(u=f[0].attributes["data-uid"].value),n>0&&u>0))return tt.statementOpenEdit(u,n),d.attr("readonly",!0),c=!0}else VIS.Utility.Util.getValueOfInt(u)>0?c=!0:(VIS.ADialog.info("VA012_ConversionRateNotFound",null,"",""),c=!1);else VIS.ADialog.info(l._status,null,"",""),c=!1},error:function(){VIS.ADialog.info("error",null,"","");c=!1}}),c},matchByDrag:function(n,u){var f=!1;return t.ajax({url:VIS.Application.contextUrl+"BankStatement/MatchByDrag",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_dragPaymentID:n,_dragStatementID:u},success:function(n){n=t.parseJSON(n);n._status=="Success"?(f=!0,n._amount!=null&&n._amount!=0&&(i.setValue(VIS.Utility.Util.getValueOfDecimal(n._amount.toFixed(p))),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0")),it.trigger("focus"))):(VIS.ADialog.info(n._status,null,"",""),f=!1)},error:function(){VIS.ADialog.info("error",null,"","");f=!1}}),f}};this.vetoablechange=function(n){if(n.propertyName=="VA012_txtDifference_"+$self.windowNo+"")w.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(p)));else if(n.propertyName=="VA012_txtTaxAmount_"+$self.windowNo+"")wt.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(p)));else if(n.propertyName=="VA012_txtTrxAmt_"+$self.windowNo+"")c.setValue(VIS.Utility.Util.getValueOfDecimal(n.newValue.toFixed(p)));else if(n.propertyName=="VA012_txtAmount_"+$self.windowNo+""){var t=r(i.getControl().val());i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(t).toFixed(p)))}};tt={statementDialog:function(){function p(){s=$statement.find("#VA012_STAT_cmbBank_"+$self.windowNo);r=$statement.find("#VA012_STAT_cmbBankAccount_"+$self.windowNo);e=$statement.find("#VA012_STAT_cmbBankAccountClassName_"+$self.windowNo);v=$statement.find("#VA012_STAT_statementDate_"+$self.windowNo);c=$statement.find("#VA012_STAT_txtStatementNo_"+$self.windowNo);o=$statement.find("#VA012_ctrlLoadFile_"+$self.windowNo);STAT_ctrlLoadFileTxt=$statement.find("#VA012_ctrlLoadFileTxt_"+$self.windowNo);_tabFile=$statement.find("#VA012_STAT_tabFile_"+$self.windowNo);_tabSchedule=$statement.find("#VA012_STAT_tabSchedule_"+$self.windowNo);rf=$statement.find("#VA012_STAT_cmbBankAccountClassName_"+$self.windowNo)}function w(){s.html("");s.append("<option value="+bi.val()+">"+bi.children()[bi[0].selectedIndex].text+"<\/option>");s.prop("selectedIndex",0)}function b(){r.html("");r.append("<option value="+h.val()+">"+h.children()[h[0].selectedIndex].text+"<\/option>");r.prop("selectedIndex",0)}function k(){function t(t){var i,r;if(e.html(""),e.append("<option value=0 ><\/option>"),t!=null)for(i=0;i<t.tables[0].rows.length;i++)r=t.tables[0].rows[i].cells.va012_bankstatementclass_id,e.append("<option value="+r+">"+VIS.Utility.encodeText(t.tables[0].rows[i].cells.name)+"<\/option>");t.dispose();t=null;n=null;e.prop("selectedIndex",0)}var n=" SELECT BSC.VA012_BANKSTATEMENTCLASSNAME AS NAME, CONCAT(CONCAT(SC.NAME,'_'),VA012_BANKSTATEMENTCLASS_ID) AS VA012_BANKSTATEMENTCLASS_ID FROM VA012_BankStatementClass BSC INNER JOIN VA012_STATEMENTCLASS SC ON (BSC.VA012_STATEMENTCLASS_ID=SC.VA012_STATEMENTCLASS_ID) WHERE C_BANKACCOUNT_ID = "+h.val(),i=VIS.DB.executeDataSet(n.toString(),null,t)}function d(){function t(t){if(t!=null)for(var i=0;i<t.tables[0].rows.length;i++)y=VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_charge_id);t.dispose();t=null;n=null}var n="SELECT C_CHARGE_ID, NAME FROM C_CHARGE WHERE ISACTIVE = 'Y' AND AD_CLIENT_ID = "+VIS.Env.getCtx().getAD_Client_ID()+" AND ROWNUM = 1 ORDER BY NAME  ",i=VIS.DB.executeDataSet(n.toString(),null,t)}function g(){l=null;$statement=null;s=null;r=null;c=null;o=null;STAT_ctrlLoadFileTxt=null;_tabSchedule=null;_tabFile=null;i=null}var s=null,r=null,e=null,v=null,y=null,c=null,o=null,i=null,l,f;$statement=t("<div class='va012-popform-content'>");l="";l="<div><div class='va012-left-btn'><a id='VA012_STAT_tabFile_"+$self.windowNo+"' class='btn va012-blueBtn' activestatus='1'>"+VIS.Msg.getMsg("VA012_File")+"<\/a><\/div><\/div><div style='border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left;'><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_Bank")+"<\/label><select id='VA012_STAT_cmbBank_"+$self.windowNo+"' class='vis-ev-col-readonly' disabled><\/select><\/div> <div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_BankAccount")+"<\/label><select id='VA012_STAT_cmbBankAccount_"+$self.windowNo+"' class='vis-ev-col-readonly' disabled><\/select><\/div><div class=va012-popform-data><label id=VA012_STAT_lblStatementDate_"+$self.windowNo+">"+VIS.Msg.getMsg("VA012_StatementDate")+'<\/label><input type=date max="9999-12-31" class=vis-ev-col-readonly disabled id=VA012_STAT_statementDate_'+$self.windowNo+"><\/div><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_ClassName")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_STAT_cmbBankAccountClassName_'+$self.windowNo+"'><\/select><\/div><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_StatementNumber")+"<sup style=\"color: red;\">*<\/sup><\/label><input type='text' id='VA012_STAT_txtStatementNo_"+$self.windowNo+"' /> <\/div><div class='va012-popform-data va012-pop-file'><label>"+VIS.Msg.getMsg("VA012_SelectFile")+"<sup style=\"color: red;\">*<\/sup><\/label><input type='text' id='VA012_ctrlLoadFileTxt_"+$self.windowNo+"' disabled><div class='va012-file-upload'><label for='file-input' class='va012-file-label'>"+VIS.Msg.getMsg("VA012_Browse")+"<\/label><input id='VA012_ctrlLoadFile_"+$self.windowNo+"' type='file' accept='.csv,text/plain,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel'/><\/div><\/div><\/div>";$statement.append(l);p();w();b();k();v.val(Globalize.format(new Date(at.val()),"yyyy-MM-dd"));d();f=new VIS.ChildDialog;f.setContent($statement);f.setTitle(VIS.Msg.getMsg("VA012_LoadStatement"));f.setWidth("500px");f.setEnableResize(!1);f.setModal(!0);f.show();o.on("change",function(){var u=this;r.val()!=null&&r.val()>0?(i=t.parseJSON(n.UploadExcel(u,null,null)),STAT_ctrlLoadFileTxt.val(i._orgfilename)):(o=null,VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"",""))});f.onOkClick=function(){if(si.val(""),_tabFile.attr("activestatus")=="1"){if(r.val()==null||r.val()==""||r.val()=="0")return VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"",""),!1;if(e.val()==null||e.val()==""||e.val()=="0")return VIS.ADialog.info("VA012_PleaseSelectClassFirst",null,"",""),!1;if(c.val()==null||c.val()=="")return VIS.ADialog.info("VA012_PleaseEnterStatementNo",null,"",""),!1;if(o.val()==""==null||o.val()=="")return VIS.ADialog.info("VA012_SelectFileFirst",null,"",""),!1;if(i!=null){if(i._filename==null||i._filename==""||i._path==null||i._path==""){VIS.ADialog.info("VA012_ErrorInGettingFile",null,"","");return}if(i._error!=null&&i._error!=""){VIS.ADialog.info(i._error,null,"","");return}var n=i._path,f=i._filename,s=r.val(),h=c.val(),w=$statement,l=e.val(),p=y;ni(a,!0,"absolute");window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/ImportStatement",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_path:n,_filename:f,_bankaccount:s,_bankAccountCurrency:lt,_statementno:h,_statementClassName:l,_statementCharges:p,statementDate:v.val()},success:function(n){hi=n._statementID;hi!=null&&hi!=""?(ii=[],pt.html(""),yi=1,ni(a,!1,"absolute"),tt.loadStatement(hi),u.refreshForm()):n._error!=null&&n._error!=""&&(ni(a,!1,"absolute"),VIS.ADialog.info(n._error,null,"",""))},error:function(){ni(a,!1,"absolute");VIS.ADialog.info("error",null,"","")}})},2)}}if(_tabSchedule.attr("activestatus")=="1")return alert("Schedule"),!1};f.onCancelClick=function(){};f.onClose=function(){g()};_tabFile.on(VIS.Events.onTouchStartOrClick,function(){_tabFile.removeClass("va012-grayBtn");_tabFile.addClass("va012-blueBtn");_tabFile.attr("activestatus","1");_tabSchedule.removeClass("va012-blueBtn");_tabSchedule.addClass("va012-grayBtn");_tabSchedule.attr("activestatus","0")});_tabSchedule.on(VIS.Events.onTouchStartOrClick,function(){_tabSchedule.removeClass("va012-grayBtn");_tabSchedule.addClass("va012-blueBtn");_tabSchedule.attr("activestatus","1");_tabFile.removeClass("va012-blueBtn");_tabFile.addClass("va012-grayBtn");_tabFile.attr("activestatus","0")})},LoadStatementsPages:function(){gi=si.val()!=null&&si.val()!=""?!0:!1;t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadStatementsPages",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_cmbBankAccount:h.val(),_txtSearch:si.val(),_statementPageNo:yi,_PAGESIZE:re,_SEARCHREQUEST:gi},success:function(n){n!=null&&n!=""&&(he=JSON.parse(n))}})},loadStatement:function(){if(gi=si.val()!=null&&si.val()!=""?!0:!1,h.val()>0){ni(t(pt),!0,"inherit");window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadConciledOrUnConciledStatements",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_cmbBankAccount:h.val(),_txtSearch:si.val(),_currencyID:lt!=null?lt:0,_searchRequest:gi},success:function(n){var r=t.parseJSON(n);i(r);ni(t(pt),!1,"inherit")},error:function(){ni(t(pt),!1,"inherit")}})},2);function i(n){n!=null&&n.length>0?(fu.html(""),uu.html(""),uu.append("<p>"+VIS.Msg.getMsg("VA012_Reconciled")+"<\/p><p style='margin-top: 4px;'>"+VIS.Msg.getMsg("VA012_Unreconciled")+"<\/p>"),fu.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>"+n[0].basecurrency+"<\/span> "+parseFloat(n[0].reconciled).toLocaleString(navigator.language,{minimumFractionDigits:p,maximumFractionDigits:p})+"<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'> <span class='va012-base-curr'>"+n[0].basecurrency+"<\/span> "+parseFloat(n[0].unreconciled).toLocaleString(navigator.language,{minimumFractionDigits:p,maximumFractionDigits:p})+"<\/span>")):(fu.html(""),uu.html(""),uu.append("<p>"+VIS.Msg.getMsg("VA012_Reconciled")+"<\/p><p style='margin-top: 4px;'>"+VIS.Msg.getMsg("VA012_Unreconciled")+"<\/p>"),fu.append("<span style='padding-bottom: 2px;' class='va012-amount va012-font-green'><span class='va012-base-curr'>"+vu+"<\/span> 0<\/span><span style='padding-bottom: 2px;' class='va012-amount va012-font-red'><span class='va012-base-curr'>"+vu+"<\/span> 0<\/span>"));tt.setStatementListHeight()}var n="va012-red-color";window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/LoadStatements",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_cmbBankAccount:h.val(),_txtSearch:si.val(),_statementPageNo:yi,_PAGESIZE:re,_SEARCHREQUEST:gi},success:function(n){n!=null&&n!=""&&(r(n),ni(t(pt),!1,"inherit"))},error:function(){ni(t(pt),!1,"inherit")}})},2);function r(i){var u,r;if(i=t.parseJSON(i),u="",i!=null&&i.length>0)for(r=0;r<i.length;r++)u="",n=i[r].docstatus=="CO"||i[r].docstatus=="CL"||i[r].docstatus=="RE"?"va012-gray-color":i[r].c_payment_id==null||i[r].c_payment_id=="0"||i[r].c_payment_id==0?i[r].c_cashline_id!=null&&i[r].c_cashline_id!="0"&&i[r].c_cashline_id!=0?"va012-green-color":i[r].c_charge_id!=null&&i[r].c_charge_id!="0"&&i[r].c_charge_id!=0?i[r].STMTAMT==i[r].trxamount?"va012-green-color":"va012-red-color":(i[r].c_charge_id==null||i[r].c_charge_id=="")&&(i[r].trxno==null||i[r].trxno=="")?"va012-red-color":"va012-red-color":"va012-green-color",u='<div  data-uid="'+i[r].c_bankstatementline_id+'" class="va012-right-data-wrap '+n+'"><div class="va012-statement-wrap"><div class="va012-fl-padd"><div class="col-md-4 col-sm-4 va012-padd-0"><div class="va012-form-check"> <input type="checkbox" data-uid="'+i[r].c_bankstatementline_id+'" > <div class="va012-form-text"> <span style="background: rgba(var(--v-c-on-secondary), .4);color: rgba(var(--v-c-on-primary), 1); padding: 3px;margin-left: 2px;">'+i[r].statementno+"/"+i[r].page+"/"+i[r].line+"<\/span><label>"+new Date(i[r].stmtLineDate).toLocaleDateString()+"<\/label><label>"+i[r].currency+" "+parseFloat(i[r].trxamount).toLocaleString(navigator.language,{minimumFractionDigits:p,maximumFractionDigits:p})+"<\/label>",u+=i[r].trxno==""||i[r].trxno==null?'<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p>'+VIS.Utility.encodeText(i[r].description)+"<\/p><span>"+VIS.Utility.encodeText(i[r].invoiceno)+'<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="'+i[r].c_bankstatementline_id+'" class="glyphicon glyphicon-edit" title='+VIS.Msg.getMsg("EditRecord")+'><\/span> <span data-uid="'+i[r].c_bankstatement_id+'" class="glyphicon glyphicon-zoom-in" title='+VIS.Msg.getMsg("ZoomToRecord")+'><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0 va012-width-xs"><div class="va012-form-data">':'<\/div><\/div><!-- end of form-group --> <\/div><!-- end of col --><div class="col-md-4 col-sm-4 va012-padd-0 va012-width-sm"><div class="va012-form-check"><div class="va012-pay-text"> <p>'+VIS.Utility.encodeText(i[r].description)+"<\/p> <span>"+VIS.Utility.encodeText(i[r].bpgroup)+"<\/span><span>"+VIS.Utility.encodeText(i[r].invoiceno)+'<\/span> <\/div><\/div> <!-- end of form-group --><\/div> <!-- end of col --> <div class="col-md-2 col-sm-2 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p>'+VIS.Utility.encodeText(i[r].trxno)+'<\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0"><div class="va012-form-check"><div class="va012-pay-text"> <p><span data-uid="'+i[r].c_bankstatementline_id+'" class="glyphicon glyphicon-edit"><\/span> <span data-uid="'+i[r].c_bankstatement_id+'" class="glyphicon glyphicon-zoom-in"><\/span> <\/p> <\/div><\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <div class="col-md-1 col-sm-1 va012-padd-0 va012-width-xs"><div class="va012-form-data">',u+=" <\/div> <!-- end of form-group --> <\/div> <!-- end of col --> <\/div> <!-- end of row --><\/div><!-- end of payment-wrap --><\/div><!-- end of right-data-wrap -->",pt.append(u);_sql=null;tt.setStatementListHeight();l.dropPayments()}}},setStatementListHeight:function(){var n=t("#VA012_mainContainer_"+$self.windowNo).height();n==0&&(n=window.innerHeight-107);t("#VA012_contentArea_"+$self.windowNo).height(n-20);t("#VA012_lstStatement_"+$self.windowNo).height(t("#VA012_rightWrap_"+$self.windowNo).height()-t("#VA012_rightTop_"+$self.windowNo).height()-18)},statementOpenEdit:function(n,t){return bt.attr("activestatus","1"),bt.attr("src","Areas/VA012/Images/hide.png"),bt.attr("title","Collapse"),bt.removeClass("vis vis-plus"),bt.addClass("fa fa-minus"),f.show(),l.setPaymentListHeight(),tt.statementListRecordEdit(n,t),n=0,!0},statementListEdit:function(n){var i=t(n.target),r=0;i.hasClass("glyphicon-edit")&&(r=i.data("uid"),bt.attr("activestatus","1"),bt.attr("src","Areas/VA012/Images/hide.png"),bt.attr("title","Collapse"),f.show(),bt.removeClass("vis vis-plus"),bt.addClass("fa fa-minus"),l.setPaymentListHeight(),u.scheduleRefresh(),u.prepayRefresh(),nr=!0,tt.statementListRecordEdit(r,0),r=0,l.addEffect(i,f))},openStatement:function(n){var e=t(n.target),f=0,o,i,r,u;if(e.hasClass("glyphicon glyphicon-zoom-in")){f=e.data("uid");o="select ad_window_id from ad_window where name = 'Bank Statement'";i=0;try{r=VIS.DB.executeDataReader(o);r.read()&&(i=r.getInt(0));r.dispose();i>0&&(u=new VIS.Query,u.addRestriction("C_BankStatement_ID",VIS.Query.prototype.EQUAL,f),u.setRecordCount(1),VIS.viewManager.startWindow(i,u))}catch(n){console.log(n)}f=0}},selectedStatementLinesList:function(n){var i=t(n.target);n.target.type=="checkbox"&&(i.is(":checked")&&(_bankStatementLineID=parseInt(i.data("uid")),ii.push(_bankStatementLineID),_bankStatementLineID=0),i.is(":checked")||(_bankStatementLineID=parseInt(i.data("uid")),ii.splice(ii.indexOf(_bankStatementLineID),1),_bankStatementLineID=0))},statementListRecordEdit:function(n,t){VIS.Utility.Util.getValueOfInt(t)==0&&u.refreshForm();tt.getStatementLineForEdit(n,t,tt.afterRecordGet)},selectedScheduleList:function(n){var i=t(n.target);n.target.type=="checkbox"&&(i.is(":checked"),!i.is(":checked"))},getStatementLineForEdit:function(n,i,r){t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/GetStatementLine",contentType:"application/json; charset=utf-8",data:JSON.stringify({_bankStatementLineID:n,trxType:ot.val(),payment_ID:i!=null?i:0}),success:function(n){r(n)},error:function(n){VIS.ADialog.info(n,null,"","")}})},afterRecordGet:function(n){var u,l,a,h;if(n!=null&&n!=""){if(u=t.parseJSON(n),f.attr("data-uid",u._bankStatementLineID),gt.val(u._txtStatementNo),ci.val(u._txtStatementPage),ir.val(u._txtStatementLine),d.val(Globalize.format(new Date(u._dtStatementDate),"yyyy-MM-dd")),rr.val(u._cmbPaymentMethod).prop("selected",!0),u._cmbVoucherMatch!=null&&u._cmbVoucherMatch!=""?b.val(u._cmbVoucherMatch).prop("selected",!0):b.prop("selectedIndex",0),ot.val()=="CO"&&b.val("C").prop("selected",!0),b.trigger("change"),u._cmbContraType!=null&&u._cmbContraType!=""?st.val(u._cmbContraType).prop("selected",!0):st.prop("selectedIndex",0),b.val()!=null&&b.val()!=""&&st.val()!=null&&st.val()!=""&&(st.val("CB").prop("selected",!0),st.trigger("change")),tr.val(u._cmbCashBook).prop("selected",!0),tu.val(u._txtCheckNo),i.setValue(VIS.Utility.Util.getValueOfDecimal(u._txtAmount.toFixed(p))),c.setValue(VIS.Utility.Util.getValueOfDecimal(u._txtTrxAmt.toFixed(p))),r(i.getControl().val())<=0?i.getControl().addClass("va012-mandatory"):i.getControl().removeClass("va012-mandatory"),u._reconciled&&(i.getControl().attr("disabled",!0),du=u._reconciled),r(c.getControl().val())<=0?c.getControl().addClass("va012-mandatory"):c.getControl().removeClass("va012-mandatory"),(b.val()=="M"||b.val()=="C")&&r(c.getControl().val())!=0&&(l=VIS.Utility.Util.getValueOfDecimal(u._txtDifference.toFixed(p)),w.setValue(l),w.getControl().trigger("blur"),u._txtDifference<0?w.getControl().addClass("va012-mandatory"):w.getControl().removeClass("va012-mandatory"),b.val()=="C"&&b.trigger("change")),u._cmbDifferenceType!=null&&u._cmbDifferenceType!=""?(ki.find("*").prop("disabled",!1),k.val(u._cmbDifferenceType).prop("selected",!0)):k.prop("selectedIndex",0),k.trigger("change"),r(i.getControl().val())<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0")),er.val(u._txtVoucherNo),eu.val(u._txtDescription),fr.val(u._cmbCharge).prop("selected",!0),it.val(u._txtCharge),it.attr("chargeid",u._cmbCharge),VIS.Utility.Util.getValueOfInt(u._cmbCharge)==0&&u._cmbDifferenceType!=""&&u._cmbDifferenceType!=null?it.addClass("va012-mandatory"):it.removeClass("va012-mandatory"),ut.val(u._cmbTaxRate).prop("selected",!0),VIS.Utility.Util.getValueOfInt(u._cmbTaxRate)==0&&u._cmbDifferenceType!=""&&u._cmbDifferenceType!=null?ut.addClass("va012-mandatory"):ut.removeClass("va012-mandatory"),wt.setValue(VIS.Utility.Util.getValueOfDecimal(u._txtTaxAmount.toFixed(p))),su.prop("checked",u._chkUseNextTime),u._ctrlCashLine>0?(ht.setValue(u._ctrlCashLine,!1,!0),nr=!1):ui||(ht.setValue(),u._ctrlPayment<=0&&(nr=!1)),g&&g.value>0&&u._ctrlPayment==0&&(u._ctrlPayment=g.value),u._ctrlPayment>0?(g.setValue(u._ctrlPayment,!1,!0),er.val()==""&&(a=VIS.Utility.Util.getValueOfString(VIS.DB.executeScalar("select trxno from C_Payment where C_Payment_ID="+u._ctrlPayment)),er.val(a)),nr=!1):ui||(g.setValue(),nr=!1),u._ctrlOrder>0?(ui=!0,ft.setValue(u._ctrlOrder,!1,!0),ui=!1):ui||ft.setValue(),u._ctrlBusinessPartner>0?et.setValue(u._ctrlBusinessPartner,!1,!0):ui||et.setValue(),u._ctrlInvoice>0?dt.setValue(u._ctrlInvoice,!1,!0):ui||dt.setValue(),u._txtCurrency!=0){for(s.val(u._txtCurrency).prop("selected",!0),h=0;s[0].length>h;h++)VIS.Utility.Util.getValueOfInt(s[0][h].value)==u._txtCurrency||VIS.Utility.Util.getValueOfInt(s[0][h].value)==lt?t(s[0][h]).show():t(s[0][h]).hide();s.removeClass("va012-mandatory");s.attr("disabled",!1)}u._txtConversionType==0?(v.prop("selectedIndex",0),v.addClass("va012-mandatory"),v.attr("disabled",!1)):(v.val(u._txtConversionType).prop("selected",!0),v.removeClass("va012-mandatory"),u._ctrlPayment>0?v.attr("disabled",!0):u._ctrlCashLine>0?v.attr("disabled",!0):(v.attr("disabled",!1),t(v[0][0]).hide()));VIS.Utility.Util.getValueOfDecimal(u._txtDifference.toFixed(p))!=0&&(y.length==0||y.length>0&&f.attr("data-uid")!=0&&Math.abs(r(c.getControl().val()))<Math.abs(r(i.getControl().val())))&&(VIS.Utility.Util.getValueOfInt(ft.value)==0&&f.attr("data-uid")==0||f.attr("data-uid")!=0)&&(k.find("option[value=0]").prop("disabled",!0),k.find("option[value=OU]").prop("disabled",!0),k.find("option[value=DA]").prop("disabled",!0),k.find("option[value=WO]").prop("disabled",!0));it.trigger("focus");u._txtPaymentMethod?(nt.val(u._txtPaymentMethod).prop("selected",!0),u._ctrlPayment?nt.attr("disabled",!0):nt.attr("disabled",!1)):(nt.val(0).prop("selected",!0),nt.attr("disabled",!1));rt.val(u._txtCheckNum);u._txtCheckDate&&ct.val(Globalize.format(new Date(u._txtCheckDate),"yyyy-MM-dd"));u._txtCheckNum?(yr.show(),rt.addClass("va012-mandatory"),pr.show(),ct.addClass("va012-mandatory")):nt.trigger("change")}},matchStatementDialog:function(){function p(){function t(t){if(e.html(""),e.append("<option value=0 >-<\/option>"),t!=null)for(var i=0;i<t.tables[0].rows.length;i++)e.append("<option value="+VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_bankstatement_id)+">"+VIS.Utility.encodeText(t.tables[0].rows[i].cells.name)+"<\/option>");t.dispose();t=null;n=null}var n="Select Cb.C_Bankstatement_Id, CB.NAME,Cb.Docstatus, COUNT(VA012_ISMATCHINGCONFIRMED) FROM C_BankStatement CB INNER JOIN C_BankStatementLine CBL ON (cbl.C_BANKSTATEMENT_ID = Cb.C_BANKSTATEMENT_ID) Where Cb.Isactive = 'Y' And Cb.Ad_Client_Id = "+VIS.Env.getCtx().getAD_Client_ID()+" And Cb.C_Bankaccount_Id = "+h.val()+" And Cb.Docstatus NOT IN  ('CO','CL','VO') GROUP BY CB.C_BANKSTATEMENT_ID,Cb.Docstatus, CB.NAME",i=VIS.DB.executeDataSet(n.toString(),null,t)}function w(){function n(n){if(o.html(""),o.append("<option value=0 >-<\/option>"),n!=null)for(var t=0;t<n.length;t++)o.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_Tax_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>")}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/LoadTaxRate",null,n)}function b(){n=$match.find("#VA012_cmbMatchingBase_"+$self.windowNo);i=$match.find("#VA012_divMatchingBase_"+$self.windowNo);s=$match.find("#VA012_cmbMatchingCriteria_"+$self.windowNo);e=$match.find("#VA012_cmbStatementNo_"+$self.windowNo);v=$match.find("#VA012_ChargeSrch_"+$self.windowNo);o=$match.find("#VA012_cmbTaxRate_"+$self.windowNo);y=$match.find("#VA012_accept_"+$self.windowNo);_ChargeLookUp=VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(),$self.windowNo,3787,VIS.DisplayType.Search);c=new VIS.Controls.VTextBoxButton("C_Charge_ID",!0,!1,!0,VIS.DisplayType.Search,_ChargeLookUp);v.append(c.getControl().css("width","93%")).append(c.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"))}function k(n){var i=t(n.target);i.hasClass("glyphicon-remove")&&(r.splice(r.indexOf(i.data("uid")),1),i.parent().parent().remove())}function d(){n=null;i=null;r=[];s=null;w2ui["VA012_gridPayment_"+$self.windowNo]!=null&&w2ui["VA012_gridPayment_"+$self.windowNo].destroy()}var n=null,i=null,r=[],s=null,e=null,v=null,c=null,o=null,y=null,a,f;$match=t("<div class='va012-popform-content'>");a="";a="<div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_StatementNo")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbStatementNo_'+$self.windowNo+"'><\/select><\/div> <div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_MatchingBase")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbMatchingBase_'+$self.windowNo+"'><\/select><\/div> <div id='VA012_divMatchingBase_"+$self.windowNo+"' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div><div class='va012-popform-data'><label>"+VIS.Msg.getMsg("VA012_MatchingCriteria")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbMatchingCriteria_'+$self.windowNo+"'><option value='0'><\/option><option value='AT'>"+VIS.Msg.getMsg("VA012_MatchAnyTwo")+"<\/option><option value='AR'>"+VIS.Msg.getMsg("VA012_MatchAnyThree")+"<\/option><option value='AL'>"+VIS.Msg.getMsg("VA012_MatchAll")+"<\/option><\/select><\/div> <div class='va012-popform-data'><label title = '"+VIS.Msg.getMsg("VA012_SetChargeType")+"' > "+VIS.Msg.getMsg("VA012_Charge")+'<sup style="color: red;">*<\/sup><\/label><div id=\'VA012_ChargeSrch_'+$self.windowNo+"'><\/div><\/div> <div class='va012-popform-data'><label title =' "+VIS.Msg.getMsg("VA012_SetTaxRate")+"' >"+VIS.Msg.getMsg("VA012_TaxRate")+'<sup style="color: red;">*<\/sup><\/label><select id=\'VA012_cmbTaxRate_'+$self.windowNo+"'><\/select><\/div> <div class='va012-frm-btn va012-btn-blue' style='float: right;'><label style='font-weight: normal;' id ='VA012_accept_"+$self.windowNo+"'>"+VIS.Msg.getMsg("VA012_Accept")+"<\/label><\/div> <\/div>";$match.append(a);b();so(n);p();w();f=new VIS.ChildDialog;f.setContent($match);f.setTitle(VIS.Msg.getMsg("VA012_MatchStatement"));f.setWidth(700);f.setHeight(650);f.setEnableResize(!1);f.setModal(!0);f.show();f.hideButtons();y.click(function(){if(r.length>0){if(e.val()==null||e.val()==""||e.val()=="0")return VIS.ADialog.info("VA012_NoLinesFoundToMatch",null,"",""),!1;if(h.val()==null||h.val()==""||h.val()=="0")return VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"",""),!1;if(s.val()==null||s.val()==""||s.val()=="0")return VIS.ADialog.info("VA012_SelectMatchingCriteria",null,"",""),!1;if(s.val()=="AT"&&r.length<2)return VIS.ADialog.info("VA012_SelectMin2MatchingBase",null,"",""),!1;if(s.val()=="AR"&&r.length<3)return VIS.ADialog.info("VA012_SelectMin3MatchingBase",null,"",""),!1;if(c.value==null||VIS.Utility.Util.getValueOfInt(c.value)==0)return VIS.ADialog.info("VA012_NoChargeSelected",null,"",""),!1;if(o.val()==null||o.val()==""||o.val()=="0")return VIS.ADialog.info("VA012_NoTaxRateSelected",null,"",""),!1;ni($match,!0,"absolute");window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"BankStatement/MatchStatementGridData",type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",async:!1,data:{_matchingBaseItemList:r.toString(),_cmbMatchingCriteria:s.val(),_BankAccount:h.val(),_StatementNo:e.val(),_BankCharges:VIS.Utility.Util.getValueOfInt(c.value),_TaxRate:o.val()},success:function(f){if(f!=null&&f!=""){f=t.parseJSON(f);n.prop("selectedIndex",0);e.prop("selectedIndex",0);c.value=null;o.prop("selectedIndex",0);r=[];var s="";i.html("");f.length>0?(no(i,f),_statementlineslist=[],pt.html(""),yi=1,tt.loadStatement(hi),ti.html(""),u.scheduleRefresh(),u.prepayRefresh(),vi=1,l.loadPayments(h.val(),vt.val(),ot.val(),at.val())):(s="<div> <p> <b>"+VIS.Msg.getMsg("va012_norecordmatched")+"<\/b> <\/div>",i.append(s));ni($match,!1,"absolute")}else ni($match,!1,"absolute"),VIS.ADialog.info(f.toString(),null,"","")},error:function(){ni($match,!1,"absolute");VIS.ADialog.info("error",null,"","")}})},2)}else return VIS.ADialog.info("VA012_NoMatchingBaseSelected",null,"",""),!1;return!1});f.onCancelClick=function(){w2ui["VA012_gridPayment_"+$self.windowNo]!=null&&w2ui["VA012_gridPayment_"+$self.windowNo].destroy()};f.onClose=function(){d()};n.on("change",function(){if(r.length<=0&&i.html(""),!kf(n.val(),r)&&n.val()!="0"&&n.val()!=""){r.push(n.val());var u="<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='"+n.val()+"'class='glyphicon glyphicon-remove'><\/span><\/a> <span>"+n.children()[n[0].selectedIndex].text;t(i)[0]!=undefined&&t(i)[0].classList.contains("w2ui-reset","w2ui-grid")&&i.removeClass("w2ui-reset w2ui-grid");i.append(u)}});i.on(VIS.Events.onTouchStartOrClick,k)},matchStatementGridDialog:function(){var n=new VIS.ChildDialog;n.setContent(gu);n.setTitle(VIS.Msg.getMsg("VA012_MatchStatementGrid"));n.setWidth("780px");n.setHeight(450);n.setEnableResize(!0);n.setModal(!0);n.show();no()},paymentScheduleDialog:function(){function ot(){var o="",u=0,n,t;for($_divPaymentSchedules.html(""),n=0;n<y.length;n++)o="<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='"+y[n]+"'  data-udata='"+pi[n]+"' class='glyphicon glyphicon-remove'><\/span><\/a> <span>"+pi[n]+"<\/span> <\/div>",$_divPaymentSchedules.append(o),yt.length>0&&(u+=VIS.Utility.Util.getValueOfDecimal(yt[n]));f[0].attributes["data-uid"].value==0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(p)));c.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(p)));r(i.getControl().val())<0&&e.attr("v_active","0");i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]);y!=null&&y.length>0?nf(y.toString()):nf(null);y.length>0&&(t=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetAutoCheckNo",{bnkAct_Id:h.val(),_PayMethod:0,_InvSchdleList:y}),t&&(nt.val(t._paymentMethod_Id).prop("selected",!0),t._checkNo?rt.val(t._checkNo):rt.val(""),nt.trigger("change")))}function ht(n){var l=t(n.target),u,s,a;if(l.hasClass("glyphicon-remove")){if(yt!=null&&yt.length>0){if(yt.length>y.length?yt.splice(y.indexOf(l.data("uid"))+1,1):yt.length==y.length&&yt.splice(y.indexOf(l.data("uid")),1),u=0,Number(yt.length)>0)for(s=0;s<yt.length;s++)u+=VIS.Utility.Util.getValueOfDecimal(yt[s]);u<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0")):(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"));f[0].attributes["data-uid"].value==0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(p)))}for(y.splice(y.indexOf(l.data("uid")),1),pi.splice(pi.indexOf(l.data("udata")),1),y.length==0&&f[0].attributes["data-uid"].value>0&&tt.statementListRecordEdit(f[0].attributes["data-uid"].value,0),l.parent().parent().remove(),di.val(pi.toString()),u=0,s=0;s<yt.length;s++)u+=VIS.Utility.Util.getValueOfDecimal(yt[s]);f[0].attributes["data-uid"].value==0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(p)));c.setValue(VIS.Utility.Util.getValueOfDecimal(u.toFixed(p)));i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]);u==0&&et.setValue();y!=null&&y.length>0?nf(y.toString()):nf(null);y.length>0?(a=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetAutoCheckNo",{bnkAct_Id:h.val(),_PayMethod:0,_InvSchdleList:y}),a&&(nt.val(a[0]._paymentMethod_Id).prop("selected",!0),a[0]._checkNo?rt.val(a[0]._checkNo):rt.val(""))):nt.val(0).prop("selected",!0);nt.trigger("change")}}function ct(){$_divPaymentSchedules=$paymentSchedule.find("#VA012_divPaymentSchedules_"+$self.windowNo);w=$paymentSchedule.find("#VA012_ctrlPSInvoice_"+$self.windowNo);b=$paymentSchedule.find("#VA012_ctrlPSBP_"+$self.windowNo);n=$paymentSchedule.find("#VA012_cmbPaymentSchedule_"+$self.windowNo)}function st(){it=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,3484,VIS.DisplayType.MultiKey,"C_Invoice_ID",0,!1,"DocStatus IN ('CO','CL') AND C_Invoice.C_BPartner_ID="+ut);s=new VIS.Controls.VTextBoxButton("C_Invoice_ID",!1,!1,!0,VIS.DisplayType.MultiKey,it);s.isMultiKeyTextBox=!0;s.getControl().addClass("va012-input-size-2");w.append(s.getControl());w.append(s.getBtn(0));w.append(s.getBtn(1));s.fireValueChanged=function(){g=null;g=s.value;n.html("");at()}}function lt(){ft=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,2893,VIS.DisplayType.Search,"C_BPartner_ID",0,!1,null);a=new VIS.Controls.VTextBoxButton("C_BPartner_ID",!1,!1,!0,VIS.DisplayType.Search,yf);a.getControl().addClass("va012-input-size-2");b.append(a.getControl());b.append(a.getBtn(0));b.append(a.getBtn(1));a.fireValueChanged=function(){ut=0;ut=a.value;it=null;s=null;w.html("");g=null;st()}}function at(){function i(t){if(n.html(""),n.append("<option value=0 ><\/option>"),t!=null)for(var i=0;i<t.length;i++){if(t[i].DueAmount==0){VIS.ADialog.info("VA012_ConversionRateNotFound",null," "+VIS.Msg.getMsg("VA012_InvoiceSchedule")+": "+VIS.Utility.Util.getValueOfString(t[i].c_invoicepayschedule_id),"");return}n.append("<option paymentamount="+t[i].DueAmount+" paymentdata='"+VIS.Utility.encodeText(new Date(t[i].DueDate).toLocaleDateString())+"_"+VIS.Utility.encodeText(t[i].DueAmt)+"' value="+VIS.Utility.Util.getValueOfInt(t[i].c_invoicepayschedule_id)+">"+VIS.Utility.encodeText(new Date(t[i].DueDate).toLocaleDateString()+"_"+t[i].DueAmt)+"<\/option>")}n.prop("selectedIndex",0)}t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetInvPaySchedule",dataType:"json",data:{seltdInvoice:g,accountID:h.val(),statemtDate:d.val()},success:function(n){var t=JSON.parse(n);(t!=null||t!="")&&i(t)}})}function vt(){it=null;s=null;g=null;w=null;ft=null;a=null;ut=null;b=null;n=null}var k,v;if(y.length==0&&pi.length==0)var it=null,s=null,g=null,w=null,ft=null,a=null,ut=null,b=null,n=null;$paymentSchedule=t("<div class='va012-popform-content'>");k="";k="<div> <label>"+VIS.Msg.getMsg("VA012_BusinessPartner")+"<\/label> <div id='VA012_ctrlPSBP_"+$self.windowNo+"' ><\/div> <\/div>";k+="<div> <label>"+VIS.Msg.getMsg("VA012_Invoice")+"<\/label> <div id='VA012_ctrlPSInvoice_"+$self.windowNo+"' ><\/div> <\/div>";k+="<div> <label>"+VIS.Msg.getMsg("VA012_PaymentSchedules")+"<\/label> <select id='VA012_cmbPaymentSchedule_"+$self.windowNo+"'  style=' width: 100%; ' ><\/select> <\/div>";k+="<div id='VA012_divPaymentSchedules_"+$self.windowNo+"' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px;margin-top: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>";$paymentSchedule.append(k);ct();v=new VIS.ChildDialog;v.setContent($paymentSchedule);v.setTitle(VIS.Msg.getMsg("VA012_PaymentSchedules"));v.setWidth("500px");ot();v.setEnableResize(!1);v.setModal(!0);v.show();lt();st();et.value&&(a.setValue(et.value,!1,!0),b.find("*").prop("disabled",!0));dt.value&&(s.setValue(dt.value,!1,!0),w.find("*").prop("disabled",!0));n.on("change",function(){n.val()>0&&l.checkScheduleCondition(n.val(),parseInt(f.attr("data-uid")),y.toString(),r(i.getControl().val()))&&(kf(parseInt(n.val()),y)?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(y.push(parseInt(n.val())),pi.push(this.options[this.selectedIndex].getAttribute("paymentdata")),yt.push(this.options[this.selectedIndex].getAttribute("paymentamount")),ot(),l.setInvoiceAndBPartner(n.val(),"IS")),di.val(pi.toString()))});$_divPaymentSchedules.on(VIS.Events.onTouchStartOrClick,ht);v.onOkClick=function(){};v.onCancelClick=function(){u.scheduleRefresh();u.refreshForm();vt()}},prepayOrderDialog:function(){function r(){var t="",n;for($_divPrepayOrders.html(""),n=0;n<gr.length;n++)t="<div class='va012-matchingbaselist'>  <a class='va012-remove-icon'> <span data-uid='"+gr[n]+"'  data-udata='"+nu[n]+"' class='glyphicon glyphicon-remove'><\/span><\/a> <span>"+nu[n]+"<\/span> <\/div>",$_divPrepayOrders.append(t)}function u(n){var i=t(n.target);i.hasClass("glyphicon-remove")&&(gr.splice(gr.indexOf(i.data("uid")),1),nu.splice(nu.indexOf(i.data("udata")),1),i.parent().parent().remove(),af.val(nu.toString()))}function f(){$_divPrepayOrders=$prepayOrder.find("#VA012_divPrepayOrders_"+$self.windowNo)}var i,n;$prepayOrder=t("<div class='va012-popform-content'>");i="";i="<div id='VA012_divPrepayOrders_"+$self.windowNo+"' style='width:100%;border: 2px solid rgba(var(--v-c-primary), 1);padding: 10px; float: left; margin-bottom: 10px; min-height: 150px; max-height: 200px; overflow:auto'><\/div> <\/div>";$prepayOrder.append(i);f();n=new VIS.ChildDialog;n.setContent($prepayOrder);n.setTitle(VIS.Msg.getMsg("VA012_PrepayOrders"));n.setWidth("500px");r();n.setEnableResize(!1);n.setModal(!0);n.show();$_divPrepayOrders.on(VIS.Events.onTouchStartOrClick,u)}};u={newRecord:function(){function tt(n){datasource=[];for(var t=0;t<n.length;t++)datasource.push({label:n[t].name,value:n[t].name,ids:n[t].chargeID});it.autocomplete("option","source",datasource);it.autocomplete("search","");it.trigger("focus")}function ot(n,i){it.attr("chargeid",0);t.ajax({url:VIS.Application.contextUrl+"BankStatement/GetCharge",dataType:"json",data:{searchText:n,voucherType:b.val()!=null?b.val():"",bankAcct:h.val()!=null?h.val():0},success:function(n){var r=JSON.parse(n);datasource=[];i(t.map(r,function(n){return{label:n.name,value:n.name,ids:n.chargeID}}));t(self.div).autocomplete("search","");t(self.div).trigger("focus")}})}function n(){b.val()=="V"?(s.val(lt).prop("selected",!0),s.removeClass("va012-mandatory"),s.attr("disabled",!0)):(t(s[0]).siblings().show(),s.val(0).prop("selected",!0),s.addClass("va012-mandatory"),s.attr("disabled",!1))}f=a.find("#VA012_formNewRecord_"+$self.windowNo);cf=a.find("#VA012_formBtnNewRecord_"+$self.windowNo);u.getNewRecordDesign();u.getNewRecordControls();u.loadCurrency();u.loadPaymentMethod();u.loadVoucherMatch();u.loadContraType();u.loadCashBook();u.loadDifferenceType();u.loadTransferType();u.loadNewFormCurrency();u.loadConversionTypes();u.loadPaymentMethods();u.loadCharge();u.loadTaxRate();u.loadPayment();u.loadOrder();u.loadBusinessPartner();u.loadInvoice();u.loadCashLine();r(i.getControl().val())<=0&&i.getControl().addClass("va012-mandatory");gt.val()!=""&&gt.removeClass("va012-mandatory");d.val()!=""&&d.removeClass("va012-mandatory");it.on("blur",function(){(it.val()==""||it.val()==null)&&it.attr("chargeid",0)});oe.on(VIS.Events.onTouchStartOrClick,function(){VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetCharge",{searchText:"",voucherType:b.val()!=null?b.val():"",bankAcct:h.val()!=null?h.val():0},tt)});it.autocomplete({minLength:0,scroll:!0,source:function(n,t){n.term.trim().length!=0&&ot(n.term,t)},select:function(n,i){t(this).val(i.item.ids);t(this).attr("chargeid",i.item.ids);parseInt(t(this).val())&&it.removeClass("va012-mandatory")}});bt.on(VIS.Events.onTouchStartOrClick,function(){bt.attr("activestatus")=="0"?(f.show(),bt.attr("activestatus","1"),bt.removeClass("vis vis-plus"),bt.addClass("fa fa-minus"),bt.attr("title","Collapse")):(f.hide(),bt.attr("activestatus","0"),bt.addClass("vis vis-plus"),bt.removeClass("fa fa-minus"),bt.attr("title","Expand"));r(i.getControl().val())<=0&&i.getControl().addClass("va012-mandatory");gt.val()!=""&&gt.removeClass("va012-mandatory");d.val()!=""&&d.removeClass("va012-mandatory");u.scheduleRefresh();u.prepayRefresh();u.refreshForm();s.trigger("change");l.setPaymentListHeight()});fe.on(VIS.Events.onTouchStartOrClick,function(){u.scheduleRefresh();u.prepayRefresh();u.refreshForm();s.trigger("change")});f.hide();b.on("change",function(){b.val()=="M"?(VIS.Utility.Util.getValueOfInt(oi)!=0&&event!=null&&event.currentTarget.className!=wi[0].className&&(u.refreshSelectedValues(),n()),_divCtrlCashLine.find("*").prop("disabled",!0),_divCtrlCashLine.hide(),or.find("*").prop("disabled",!0),br.find("*").prop("disabled",!0),sr.find("*").prop("disabled",!0),kr.find("*").prop("disabled",!0),or.hide(),br.hide(),sr.hide(),kr.hide(),_divPaymentMethod.show(),ye>0?(li.show(),li.find("*").prop("disabled",!1)):(li.find("*").prop("disabled",!0),li.hide()),k.val()=="CH"?(u.loadCharge(),fi.find("*").prop("disabled",!1),ei.find("*").prop("disabled",!1),ai.find("*").prop("disabled",!1)):(fi.hide(),ei.hide(),ai.hide(),fi.find("*").prop("disabled",!0),ei.find("*").prop("disabled",!0),ai.find("*").prop("disabled",!0)),divRow4Col1TrxAmt.show(),cu.show(),ki.show(),hr.show(),cr.show(),lr.show(),ar.show(),vr.show(),hr.find("*").prop("disabled",!1),cr.find("*").prop("disabled",!1),lr.find("*").prop("disabled",!1),ar.find("*").prop("disabled",!1),vr.find("*").prop("disabled",!1),di.prop("disabled",!0),hu.css("pointer-events","auto"),ut.removeClass("va012-mandatory"),it.removeClass("va012-mandatory"),k.val()!="CH"&&(st.prop("selectedIndex",0),it.attr("chargeid",0),it.val(""),ut.prop("selectedIndex",0),wt.setValue(0))):b.val()=="V"?((oi!=0||ri!=0||y.length>0||kt!=0&&event!=null&&event.currentTarget.className!=wi[0].className)&&(u.refreshSelectedValues(),n()),u.loadCharge(),_divCtrlCashLine.find("*").prop("disabled",!0),_divCtrlCashLine.hide(),or.find("*").prop("disabled",!0),br.find("*").prop("disabled",!0),sr.find("*").prop("disabled",!0),kr.find("*").prop("disabled",!0),or.hide(),st.prop("selectedIndex",0),br.hide(),sr.hide(),kr.hide(),li.show(),fi.show(),ei.show(),ai.show(),li.find("*").prop("disabled",!1),fi.find("*").prop("disabled",!1),ei.find("*").prop("disabled",!1),_divPaymentMethod.show(),VIS.Utility.Util.getValueOfInt(it.attr("chargeid"))==0&&it.addClass("va012-mandatory"),VIS.Utility.Util.getValueOfInt(ut.val())==0&&ut.addClass("va012-mandatory"),hr.find("*").prop("disabled",!0),cr.find("*").prop("disabled",!0),lr.find("*").prop("disabled",!1),ar.find("*").prop("disabled",!0),vr.find("*").prop("disabled",!0),hu.css("pointer-events","none"),divRow4Col1TrxAmt.hide(),cu.hide(),ki.hide(),hr.hide(),cr.hide(),lr.hide(),ar.hide(),vr.hide()):b.val()=="C"&&((ri!=0||y.length>0||kt!=0&&event!=null&&event.currentTarget.className!=wi[0].className)&&(u.refreshSelectedValues(),n()),u.loadCharge(),or.show(),sr.show(),or.find("*").prop("disabled",!1),sr.find("*").prop("disabled",!1),divRow4Col1TrxAmt.show(),cu.show(),ki.show(),_divPaymentMethod.hide(),r(w.getControl().val())==0&&(li.find("*").prop("disabled",!0),fi.find("*").prop("disabled",!0),ei.find("*").prop("disabled",!0),ai.find("*").prop("disabled",!0),li.hide(),fi.hide(),ei.hide(),ai.hide()),hr.find("*").prop("disabled",!0),cr.find("*").prop("disabled",!0),lr.find("*").prop("disabled",!0),ar.find("*").prop("disabled",!0),vr.find("*").prop("disabled",!0),hu.css("pointer-events","none"),hr.hide(),cr.hide(),lr.hide(),ar.hide(),vr.hide(),(st.val()==null||st.val()==""||st.val()==0)&&st.addClass("va012-mandatory"),ut.removeClass("va012-mandatory"),it.removeClass("va012-mandatory"));wi.text(VIS.Msg.getMsg("VA012_More"));l.setPaymentListHeight()});k.on("change",function(){k.val()=="CH"?(li.show(),fi.show(),ei.show(),ai.show(),li.find("*").prop("disabled",!1),fi.find("*").prop("disabled",!1),ei.find("*").prop("disabled",!1),(it.val()==null||it.val()=="")&&it.addClass("va012-mandatory"),ut.val()==0&&ut.addClass("va012-mandatory")):(b.val()=="M"||b.val()=="C")&&(fi.find("*").prop("disabled",!0),ei.find("*").prop("disabled",!0),ai.find("*").prop("disabled",!0),fi.hide(),ei.hide(),ai.hide(),fr.prop("selectedIndex",0),it.attr("chargeid",0),it.val(""),ut.prop("selectedIndex",0),wt.setValue(0),it.removeClass("va012-mandatory"),ut.removeClass("va012-mandatory"));k.val()<=0&&r(w.getControl().val())!=0?k.addClass("va012-mandatory"):k.removeClass("va012-mandatory");l.setPaymentListHeight()});st.on("change",function(){st.val()!=null&&st.val()!=""&&st.val()!=0?st.removeClass("va012-mandatory"):st.addClass("va012-mandatory");st.val()=="CB"?(br.find("*").prop("disabled",!1),kr.find("*").prop("disabled",!1)):(tr.prop("selectedIndex",0),tu.val(""),br.find("*").prop("disabled",!0),kr.find("*").prop("disabled",!0));st.val()=="BB"?(_divCtrlCashLine.find("*").prop("disabled",!0),_divCtrlCashLine.hide(),li.show(),fi.show(),ei.show(),ai.show(),li.find("*").prop("disabled",!1),fi.find("*").prop("disabled",!1),ei.find("*").prop("disabled",!1),it.addClass("va012-mandatory"),ut.addClass("va012-mandatory")):b.val()=="C"&&(_divCtrlCashLine.show(),_divCtrlCashLine.find("*").prop("disabled",!1),li.find("*").prop("disabled",!0),r(w.getControl().val())==0&&(fi.find("*").prop("disabled",!0),ei.find("*").prop("disabled",!0),ai.find("*").prop("disabled",!0),fi.hide(),ei.hide(),ai.hide()),ai.hide());l.setPaymentListHeight()});s.on("change",function(){VIS.Utility.Util.getValueOfInt(s.val())>0?s.removeClass("va012-mandatory"):s.addClass("va012-mandatory")});nt.on("change",function(){if(VIS.Utility.Util.getValueOfInt(nt.val())>0){var n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetAutoCheckNo",{bnkAct_Id:h.val(),_PayMethod:nt.val(),_InvSchdleList:y});n._paymentBaseType=="S"?(yr.show(),y.length>0&&n&&(n._checkNo?(rt.val(n._checkNo),rt.attr("disabled",!0),rt.removeClass("va012-mandatory")):(rt.val(""),rt.attr("disabled",!1),rt.addClass("va012-mandatory")),n._status&&(rt.val(""),VIS.ADialog.info("",null,n._status,""))),rt.val()?(rt.attr("disabled",!0),rt.removeClass("va012-mandatory")):(rt.attr("disabled",!1),rt.addClass("va012-mandatory")),pr.show(),ct.val()?(ct.attr("disabled",!0),ct.removeClass("va012-mandatory")):(ct.attr("disabled",!1),ct.addClass("va012-mandatory"))):(yr.hide(),rt.val(""),rt.removeClass("va012-mandatory"),pr.hide(),ct.val(""),ct.removeClass("va012-mandatory"));nt.removeClass("va012-mandatory")}else nt.attr("disabled",!1),nt.addClass("va012-mandatory"),rt.val(""),yr.hide(),rt.removeClass("va012-mandatory"),ct.val(""),pr.hide(),ct.removeClass("va012-mandatory")});rt.on("change",function(){rt.val()?rt.removeClass("va012-mandatory"):rt.addClass("va012-mandatory")});ct.on("change",function(){ct.val()?(g.value||ct.val()>d.val()&&(ct.val(""),VIS.ADialog.info("VA012_ChkDateCantbeGratrStmtDate",null,"","")),ct.removeClass("va012-mandatory")):ct.addClass("va012-mandatory")});v.on("change",function(){if(VIS.Utility.Util.getValueOfInt(v.val())>0){var n=null;y!=null&&y.length>0&&(n=y.toString());n!=null||VIS.Utility.Util.getValueOfInt(ft.value)!=0||VIS.Utility.Util.getValueOfInt(g.value)!=0||VIS.Utility.Util.getValueOfInt(ht.value)!=0?t.ajax({type:"POST",url:VIS.Application.contextUrl+"BankStatement/GetConvertedAmount",contentType:"application/json; charset=utf-8",data:JSON.stringify({currency:lt,conversionType:v.val(),stmtDate:d.val(),_schedules:n,_accountId:h.val(),orderId:kt,paymentId:ri,cashLineId:oi}),success:function(n){n=JSON.parse(n);n!=null&&(n._convertedAmt==0?n.schedule_Ids!=null&&n.schedule_Ids.length>0&&(VIS.Utility.Util.getValueOfInt(f.attr("data-uid"))==0&&i.setValue(),c.setValue(),i.getControl().addClass("va012-mandatory"),c.getControl().addClass("va012-mandatory"),VIS.ADialog.info("VA012_ConversionRateNotFound",null," - DocNo: "+n.schedule_Ids.toString(),"")):(VIS.Utility.Util.getValueOfInt(f.attr("data-uid"))==0?(i.setValue(n._convertedAmt),n._convertedAmt>0?i.getControl().removeClass("va012-mandatory"):i.getControl().addClass("va012-mandatory")):(c.setValue(n._convertedAmt),i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())])),kt==0&&VIS.Utility.Util.getValueOfInt(f.attr("data-uid"))==0&&(c.setValue(n._convertedAmt),i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]))));t(v[0][0]).hide();v.removeClass("va012-mandatory")},error:function(n){VIS.ADialog.info(n,null,"","")}}):v.removeClass("va012-mandatory")}else v.addClass("va012-mandatory")});ut.on("change",function(){if(wt.setValue(0),ut.val()>0){var n=0;if(n=r(w.getControl().val())!=0&&b.val()!="V"?r(w.getControl().val()):r(i.getControl().val()),n!=0){bf(ut.val(),n,p,t);function t(n){n=JSON.parse(n);n!=null&&(wt.setValue(VIS.Utility.Util.getValueOfDecimal(n.TaxAmt)),ut.removeClass("va012-mandatory"))}}}else ut.addClass("va012-mandatory")});wi.on(VIS.Events.onTouchStartOrClick,function(){wi.text()==VIS.Msg.getMsg("VA012_More")?(wi.attr("visiblestatus","1"),wi.text(VIS.Msg.getMsg("VA012_Hide")),or.show(),sr.show(),_divCtrlCashLine.show(),li.show(),fi.show(),ei.show(),ai.show(),divRow4Col1TrxAmt.show(),cu.show(),ki.show(),hr.show(),cr.show(),lr.show(),ar.show(),vr.show()):(wi.attr("visiblestatus","0"),wi.text(VIS.Msg.getMsg("VA012_More")),b.trigger("change"));l.setPaymentListHeight()});f.on("keyup",function(n){n.which==32&&(e.is(":focus")&&e.trigger("click"),o.is(":focus")&&o.trigger("click"),wi.is(":focus")&&wi.trigger("click"));n.which==13&&ku.is(":focus")&&ku.trigger("click")});ku.on(VIS.Events.onTouchStartOrClick,function(){var n=u.getFormData(),f,t;if(du){VIS.ADialog.info("VA012_BSLAlreadyReconciled",null,"","");return}if(n[0]._cmbBankAccount==null||n[0]._cmbBankAccount==""||n[0]._cmbBankAccount=="0"){VIS.ADialog.info("VA012_SelectBankAccountFirst",null,"","");return}if(n[0]._txtStatementNo==null||n[0]._txtStatementNo==""||n[0]._txtStatementNo=="0"){VIS.ADialog.info("VA012_PleaseEnterStatementNo",null,"","");return}if(n[0]._dtStatementDate==null||n[0]._dtStatementDate==""||n[0]._dtStatementDate=="0"){VIS.ADialog.info("VA012_PleaseEnterStatementDate",null,"","");return}if(VIS.Utility.Util.getValueOfInt(n[0]._txtCurrency)==0){VIS.ADialog.info("VA012_PleaseSelectCurrency",null,"","");return}if(VIS.Utility.Util.getValueOfInt(n[0]._txtConversionType)==0){VIS.ADialog.info("VA012_PleaseSelectConversionType",null,"","");return}if(n[0]._txtAmount==null||n[0]._txtAmount==""||n[0]._txtAmount=="0"||n[0]._txtAmount=="0.00"){VIS.ADialog.info("VA012_PleaseEnterAmount",null,"","");return}if(!n[0]._txtPaymentMethod&&!n[0]._ctrlCashLine){VIS.ADialog.info("VA012_PleaseSelectPayMethod",null,"","");return}if(!n[0]._ctrlPayment&&rt.hasClass("va012-mandatory")&&(n[0]._txtCheckNum==null||n[0]._txtCheckNum=="")){VIS.ADialog.info("VA012_PleaseEnterCheckNo",null,"","");return}if(!n[0]._ctrlPayment&&ct.hasClass("va012-mandatory")&&!n[0]._txtCheckDate){VIS.ADialog.info("VA012_PleaseSelectCheckDate",null,"","");return}if(!(n[0]._ctrlInvoice==null||n[0]._ctrlInvoice==""||n[0]._ctrlInvoice=="0")&&!(n[0]._ctrlBusinessPartner==null||n[0]._ctrlBusinessPartner==""||n[0]._ctrlBusinessPartner=="0")&&(n[0]._ctrlPayment==null||n[0]._ctrlPayment==""||n[0]._ctrlPayment=="0")&&(n[0]._scheduleList==null||n[0]._scheduleList=="")){VIS.ADialog.info("VA012_PleaseSelectPaySchedule",null,"","");return}if(!(n[0]._ctrlBusinessPartner==null||n[0]._ctrlBusinessPartner==""||n[0]._ctrlBusinessPartner=="0")&&(n[0]._ctrlInvoice==null||n[0]._ctrlInvoice==""||n[0]._ctrlInvoice=="0")&&(n[0]._ctrlPayment==null||n[0]._ctrlPayment==""||n[0]._ctrlPayment=="0")&&(n[0]._scheduleList==null||n[0]._scheduleList=="")&&(n[0]._ctrlOrder==null||n[0]._ctrlOrder==""||n[0]._ctrlOrder=="0")&&(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0")){VIS.ADialog.info("VA012_PleaseSelectAnyOne",null,"","");return}if(n[0]._cmbVoucherMatch=="C")if(n[0]._cmbContraType=="BB"){if(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0"){VIS.ADialog.info("VA012_PleaseSelectCharge",null,"","");it.addClass("va012-mandatory");return}if(n[0]._cmbTaxRate==null||n[0]._cmbTaxRate==""||n[0]._cmbTaxRate=="0"){VIS.ADialog.info("VA012_PleaseSelectTaxRate",null,"","");ut.addClass("va012-mandatory");return}}else if(n[0]._cmbContraType=="CB"){if(n[0]._ctrlCashLine==null||n[0]._ctrlCashLine==""||n[0]._ctrlCashLine=="0"){VIS.ADialog.info("VA012_PleaseSelectCashJournalLine",null,"","");return}}else{VIS.ADialog.info("VA012_PleaseSelectContraType",null,"","");return}if(n[0]._cmbVoucherMatch=="V"){if(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0"){VIS.ADialog.info("VA012_PleaseSelectCharge",null,"","");it.addClass("va012-mandatory");return}if(n[0]._cmbTaxRate==null||n[0]._cmbTaxRate==""||n[0]._cmbTaxRate=="0"){VIS.ADialog.info("VA012_PleaseSelectTaxRate",null,"","");ut.addClass("va012-mandatory");return}}if(parseFloat(n[0]._txtDifference)!=0&&n[0]._cmbVoucherMatch=="M"&&(n[0]._cmbDifferenceType==null||n[0]._cmbDifferenceType==""||n[0]._cmbDifferenceType=="0")){VIS.ADialog.info("VA012_PleaseSelectDifferenceType",null,"","");return}if(parseFloat(n[0]._txtDifference)!=0&&n[0]._cmbDifferenceType=="CH"){if(n[0]._cmbCharge==null||n[0]._cmbCharge==""||n[0]._cmbCharge=="0"){VIS.ADialog.info("VA012_PleaseSelectCharge",null,"","");it.addClass("va012-mandatory");return}if(n[0]._cmbTaxRate==null||n[0]._cmbTaxRate==""||n[0]._cmbTaxRate=="0"){VIS.ADialog.info("VA012_PleaseSelectTaxRate",null,"","");ut.addClass("va012-mandatory");return}}if(parseFloat(n[0]._txtDifference)!=0&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlPayment)!=0&&n[0]._cmbDifferenceType!="CH"){VIS.ADialog.info("VA012_PlsSelectDiffTypeCharge",null,"","");return}if(VIS.Utility.Util.getValueOfDecimal(n[0]._txtDifference)!=0&&VIS.Utility.Util.getValueOfInt(n[0]._scheduleList.length)>0&&Math.abs(r(i.getControl().val()))>Math.abs(r(c.getControl().val()))&&n[0]._cmbDifferenceType!="CH"){VIS.ADialog.info("MoreScheduleAmount",null,"","");return}if(VIS.Utility.Util.getValueOfString(n[0]._scheduleList)==""&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlPayment)==0&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlOrder)==0&&VIS.Utility.Util.getValueOfInt(n[0]._ctrlCashLine)==0&&VIS.Utility.Util.getValueOfInt(n[0]._cmbCharge)==0){VIS.ADialog.info("VA012_PleaseSelectAnyOne",null,"","");return}if(VIS.Utility.Util.getValueOfString(n[0]._cmbDifferenceType)=="CH"||VIS.Utility.Util.getValueOfString(n[0]._cmbVoucherMatch)=="V"){if(f=VIS.Utility.Util.getValueOfInt(n[0]._cmbTaxRate),t=0,t=VIS.Utility.Util.getValueOfString(n[0]._cmbDifferenceType)=="CH"?VIS.Utility.Util.getValueOfDecimal(n[0]._txtDifference):VIS.Utility.Util.getValueOfDecimal(n[0]._txtAmount),f>0&&t!=0){bf(n[0]._cmbTaxRate,t,p,e);function e(t){t=JSON.parse(t);t!=null&&(n[0]._surChargeAmt=t.SurchargeAmt,n[0]._txtTaxAmount=t.TaxAmt,ni(a,!0,"absolute"),u.insertNewRecord(n,u.afterInsertion))}}}else ni(a,!0,"absolute"),u.insertNewRecord(n,u.afterInsertion)});gt.on("keypress",function(){ci.val("1");ir.val("10")});gt.on("change",function(){gt.val()==""?gt.addClass("va012-mandatory"):gt.removeClass("va012-mandatory")});ir.on("keypress",function(n){if(n.which!=8&&n.which!=0&&(n.which<48||n.which>57))return!1});ci.on("keypress",function(n){if(n.which!=8&&n.which!=0&&(n.which<48||n.which>57))return!1});ci.on("change",function(){_origin="LO";t.ajax({url:VIS.Application.contextUrl+"BankStatement/MaxStatement",type:"GET",datatype:"json",data:{_bankAccount:h.val()==null?0:h.val(),_origin:_origin,_pageNo:ci.val()<=0?0:ci.val()},contentType:"application/json; charset=utf-8",success:function(n){n!=null&&n!=""&&(n=t.parseJSON(t.parseJSON(n)),ci.val()<=0&&gt.val()==n.statementNo?(ir.val(n.lineno),ci.val(n.pageno),VIS.ADialog.info("VA012_NotAcceptZero",null,"","")):ci.val()>0&&gt.val()==n.statementNo?ir.val(n.lineno):ci.val()<=0&&(ci.val("1"),VIS.ADialog.info("VA012_NotAcceptZero",null,"","")))}})});lf.on(VIS.Events.onTouchStartOrClick,function(){u.scheduleRefresh();u.prepayRefresh();u.refreshForm();(gt.val()==""||gt.val()==null)&&gt.val("0");l.getMaxStatement("BT");f.attr("data-uid",0)});wt.getControl().on("change",function(){r(wt.getControl().val())==0||r(wt.getControl().val())==null?wt.setValue(0):wt.setValue(VIS.Utility.Util.getValueOfDecimal(r(wt.getControl().val())))});c.getControl().on("blur",function(n,t,u){if(b.val()!="V")if(VIS.Utility.Util.getValueOfDecimal(t)!=0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(t).toFixed(p)))),VIS.Utility.Util.getValueOfDecimal(u)!=0&&(c.setValue(),c.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(u).toFixed(p)))),VIS.Utility.Util.getValueOfDecimal(r(c.getControl().val()))==0?(c.setValue(0),c.getControl().addClass("va012-mandatory")):VIS.Utility.Util.getValueOfDecimal(r(c.getControl().val()))<0?c.getControl().addClass("va012-mandatory"):(c.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(r(c.getControl().val())).toFixed(p))),c.getControl().removeClass("va012-mandatory")),w.getControl().attr("vchangable")=="Y"&&(w.setValue(0),ki.find("*").prop("disabled",!0)),b.val()=="M"||b.val()=="C"){if(w.getControl().attr("vchangable")=="Y"&&(w.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(r(c.getControl().val())-r(i.getControl().val())).toFixed(p))),VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0?(VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))<0?w.getControl().addClass("va012-mandatory"):w.getControl().removeClass("va012-mandatory"),ki.find("*").prop("disabled",!1),(y.length==0||y.length>0&&f.attr("data-uid")!=0&&Math.abs(r(c.getControl().val()))<Math.abs(r(i.getControl().val())))&&(VIS.Utility.Util.getValueOfInt(ft.value)==0&&f.attr("data-uid")==0||f.attr("data-uid")!=0)&&(k.find("option[value=0]").prop("disabled",!0),k.find("option[value=OU]").prop("disabled",!0),k.find("option[value=DA]").prop("disabled",!0),k.find("option[value=WO]").prop("disabled",!0),k.val()!="CH"&&k.val("0").prop("selected",!0)),k.val()<=0?k.addClass("va012-mandatory"):k.removeClass("va012-mandatory")):(ki.find("*").prop("disabled",!0),k.val("0").prop("selected",!0),k.trigger("change"),k.removeClass("va012-mandatory"))),VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0&&ut.val()>0){bf(ut.val(),r(w.getControl().val()),p,e);function e(n){n=JSON.parse(n);n!=null&&n!=0&&wt.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(n.TaxAmt).toFixed(p)));ut.val()>0&&VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0&&(VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))<0?w.getControl().addClass("va012-mandatory"):w.getControl().removeClass("va012-mandatory"));VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0&&(VIS.Utility.Util.getValueOfInt(g.getValue())!=0||VIS.Utility.Util.getValueOfInt(ht.getValue())!=0)?(k.val("CH").prop("selected",!0),k.trigger("change")):VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0&&y.toString()!=""||(k.val("0").prop("selected",!0),k.trigger("change"))}}}else VIS.Utility.Util.getValueOfDecimal(r(w.getControl().val()))!=0&&VIS.Utility.Util.getValueOfInt(g.getValue())!=0&&(k.val("CH").prop("selected",!0),k.trigger("change"))});w.getControl().on("blur",function(){r(w.getControl().val())==0||r(w.getControl().val())==null?ki.find("*").prop("disabled",!0):ki.find("*").prop("disabled",!1)});i.getControl().on("blur",function(n,t){VIS.Utility.Util.getValueOfDecimal(t)!=0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(t).toFixed(p))));VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))==0&&(i.setValue(0),i.getControl().addClass("va012-mandatory"));var u=VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()));if(o.attr("v_active")=="1"&&u>0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(-1*u).toFixed(p)))),e.attr("v_active")=="1"&&u<0&&(i.setValue(),i.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(-1*u).toFixed(p)))),VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))<0?(o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"),i.getControl().addClass("va012-mandatory")):VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))>0&&(e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),i.getControl().removeClass("va012-mandatory")),VIS.Utility.Util.getValueOfInt(ut.val())>0&&r(i.getControl().val())!=0&&b.val()=="V"){bf(ut.val(),r(i.getControl().val()),p,f);function f(n){n=JSON.parse(n);n!=null&&n!=0&&(wt.setValue(VIS.Utility.Util.getValueOfDecimal(parseFloat(n.TaxAmt).toFixed(p))),ut.removeClass("va012-mandatory"));c.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())])}}else c.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())])});vf.hover(function(){$tooltip=t('<div  class="va012-div-tooltip"><h4>'+VIS.Msg.getMsg("VA012_Information")+"<\/h4><p>"+VIS.Msg.getMsg("VA012_InformationText")+"<\/p><\/div>");a.append($tooltip);t(".va012-div-tooltip").show()},function(){a.find(".va012-div-tooltip").remove()});d.on("blur",function(){if(d.val()=="")d.addClass("va012-mandatory");else if(!(f[0].attributes["data-uid"].value>0)||!(g.getValue()>0||ht.getValue()>0||dt.getValue()>0||ft.getValue()>0||y.length>0)){d.removeClass("va012-mandatory");var u=0,n=null,t=null;if(b.val()=="M"?di.val()!=0&&(g.getValue()==null||g.getValue()==0)?y.length!=0&&(n="IS",t=y.join()):(di.val()==null||di.val()==0)&&g.getValue()!=null&&g.getValue()!=0?(n="PY",t=g.getValue()):VIS.Utility.Util.getValueOfInt(ft.value)!=0&&VIS.Utility.Util.getValueOfInt(et.value)!=0&&(n="PO",t=ft.value,i.getControl().attr("disabled",!0)):b.val()=="C"&&VIS.Utility.Util.getValueOfInt(ht.value)!=0&&VIS.Utility.Util.getValueOfInt(g.getValue())==0&&VIS.Utility.Util.getValueOfInt(di.val())==0&&(n="CO",t=ht.value),n!=null&&t!=null){VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetConvtAmount",{recordID:t,bnkAct_Id:h.val(),transcType:n,stmtDate:d.val()},s);function s(t){for(var f=0;f<t.length;f++){if(t.length==0||t[f].DueAmount==0){i.setValue();c.setValue();w.setValue();w.getControl().trigger("blur");i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]);VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}u+=t[f].DueAmount}if(u!=0)i.setValue(u),n!="PO"?(c.setValue(u),i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())])):(i.getControl().removeClass("va012-mandatory"),i.getControl().attr("disabled",!0),e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"));else{i.setValue();c.setValue();w.setValue();w.getControl().trigger("blur");VIS.ADialog.info("VA012_ConversionRateNotFound",null,"","");return}}}}});vf.mousemove(function(n){t(".va012-div-tooltip").css("top",n.pageY-50).css("left",n.pageX)});e.on(VIS.Events.onTouchStartOrClick,function(){r(c.getControl().val())==0&&VIS.Utility.Util.getValueOfInt(ft.value)>0||b.val()=="V"&&(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))<0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))*-1),e.removeClass("va012-inactive"),e.addClass("va012-active"),e.attr("v_active","1"),o.removeClass("va012-active"),o.addClass("va012-inactive"),o.attr("v_active","0"),i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]))});o.on(VIS.Events.onTouchStartOrClick,function(){r(c.getControl().val())==0&&VIS.Utility.Util.getValueOfInt(ft.value)>0||b.val()=="V"&&(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))>0&&i.setValue(VIS.Utility.Util.getValueOfDecimal(r(i.getControl().val()))*-1),o.removeClass("va012-inactive"),o.addClass("va012-active"),o.attr("v_active","1"),e.removeClass("va012-active"),e.addClass("va012-inactive"),e.attr("v_active","0"),i.getControl().trigger("blur",[r(i.getControl().val()),r(c.getControl().val())]))})},getNewRecordDesign:function(){},getNewRecordControls:function(){gt=f.find("#VA012_txtStatementNo_"+$self.windowNo);lf=f.find("#VA012_btnStatementNo_"+$self.windowNo);ci=f.find("#VA012_txtStatementPage_"+$self.windowNo);ir=f.find("#VA012_txtStatementLine_"+$self.windowNo);d=f.find("#VA012_dtStatementDate_"+$self.windowNo);rr=f.find("#VA012_cmbPaymentMethod_"+$self.windowNo);st=f.find("#VA012_cmbContraType_"+$self.windowNo);tr=f.find("#VA012_cmbCashBook_"+$self.windowNo);ur=f.find("#VA012_cmbTransferType_"+$self.windowNo);tu=f.find("#VA012_txtCheckNo_"+$self.windowNo);b=f.find("#VA012_cmbVoucherMatch_"+$self.windowNo);i.getControl().addClass("va012-mandatory");c.getControl().addClass("va012-mandatory");k=f.find("#VA012_cmbDifferenceType_"+$self.windowNo);er=f.find("#VA012_txtVoucherNo_"+$self.windowNo);eu=f.find("#VA012_txtDescription_"+$self.windowNo);fr=f.find("#VA012_cmbCharge_"+$self.windowNo);it=f.find("#VA012_txtCharge_"+$self.windowNo);ut=f.find("#VA012_cmbTaxRate_"+$self.windowNo);ou=f.find("#VA012_ctrlCashLine_"+$self.windowNo);wr=f.find("#VA012_ctrlPayment_"+$self.windowNo);pu=f.find("#VA012_ctrlOrder_"+$self.windowNo);wu=f.find("#VA012_ctrlInvoice_"+$self.windowNo);bu=f.find("#VA012_ctrlBusinessPartner_"+$self.windowNo);su=f.find("#VA012_chkUseNextTime_"+$self.windowNo);ku=f.find("#VA012_btnSave_"+$self.windowNo);hu=f.find("#VA012_btnPaymentSchedule_"+$self.windowNo);ue=f.find("#VA012_btnPrepay_"+$self.windowNo);di=f.find("#VA012_txtPaymentSchedule_"+$self.windowNo);af=f.find("#VA012_txtPrepayOrder_"+$self.windowNo);bt=cf.find("#VA012_btnNewRecord_"+$self.windowNo);fe=cf.find("#VA012_btnUndo_"+$self.windowNo);ee=a.find("#VA012_btnDelete_"+$self.windowNo);vf=f.find("#VA012_btnAmount_"+$self.windowNo);e=f.find("#VA012_btnIn_"+$self.windowNo);o=f.find("#VA012_btnOut_"+$self.windowNo);s=f.find("#VA012_txtCurrency_"+$self.windowNo);v=f.find("#VA012_txtConversionType_"+$self.windowNo);nt=f.find("#VA012_txtPaymentMethod_"+$self.windowNo);rt=f.find("#VA012_txtCheckNum_"+$self.windowNo);ct=f.find("#VA012_txtCheckDate_"+$self.windowNo)},loadPaymentMethod:function(){function t(t){if(rr.html(""),rr.append("<option value=0 ><\/option>"),t!=null)for(var i=0;i<t.tables[0].rows.length;i++)rr.append("<option value="+VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.va009_paymentmethod_id)+">"+VIS.Utility.encodeText(t.tables[0].rows[i].cells.va009_name)+"<\/option>");t.dispose();t=null;n=null;rr.prop("selectedIndex",0)}var n="SELECT VA009_NAME,VA009_PAYMENTMETHOD_ID FROM VA009_PAYMENTMETHOD WHERE ISACTIVE='Y'  AND AD_CLIENT_ID="+VIS.Env.getCtx().getAD_Client_ID()+" AND AD_ORG_ID="+VIS.Env.getCtx().getAD_Org_ID(),i=VIS.DB.executeDataSet(n.toString(),null,t)},loadCurrency:function(){lt=VIS.DB.executeScalar("SELECT C_CURRENCY_ID FROM C_BANKACCOUNT WHERE C_BANKACCOUNT_ID="+h.val());p=VIS.DB.executeScalar("SELECT STDPRECISION FROM C_CURRENCY WHERE C_CURRENCY_ID="+lt)},loadCashBook:function(){function t(t){if(tr.html(""),tr.append("<option value=0 ><\/option>"),t!=null)for(var i=0;i<t.tables[0].rows.length;i++)tr.append("<option value="+VIS.Utility.Util.getValueOfInt(t.tables[0].rows[i].cells.c_cashbook_id)+">"+VIS.Utility.encodeText(t.tables[0].rows[i].cells.name)+"<\/option>");t.dispose();t=null;n=null;tr.prop("selectedIndex",0)}var n="SELECT NAME,C_CashBook_ID FROM C_CashBook WHERE ISACTIVE='Y'  AND AD_CLIENT_ID="+VIS.Env.getCtx().getAD_Client_ID()+" AND AD_ORG_ID="+VIS.Env.getCtx().getAD_Org_ID(),i=VIS.DB.executeDataSet(n.toString(),null,t)},loadContraType:function(){st.html("");st.append("<option value=0 ><\/option>");st.append("<option value='BB' >"+VIS.Msg.getMsg("VA012_BankToBank")+"<\/option>");st.append("<option value='CB' >"+VIS.Msg.getMsg("VA012_CashToBank")+"<\/option>");st.prop("selectedIndex",0)},loadTransferType:function(){ur.html("");ur.append("<option value=0 ><\/option>");ur.append("<option value='CH' >"+VIS.Msg.getMsg("VA012_Cash")+"<\/option>");ur.append("<option value='CK' >"+VIS.Msg.getMsg("VA012_Check")+"<\/option>");ur.prop("selectedIndex",0)},loadVoucherMatch:function(){b.html("");b.append("<option value='M' >"+VIS.Msg.getMsg("VA012_Payment")+"<\/option>");b.append("<option value='V' >"+VIS.Msg.getMsg("VA012_Voucher")+"<\/option>");b.append("<option value='C' >"+VIS.Msg.getMsg("VA012_Contra")+"<\/option>");b.prop("selectedIndex",0)},loadDifferenceType:function(){k.html("");k.append("<option value=0 ><\/option>");k.append("<option value='OU' >"+VIS.Msg.getMsg("VA012_OverUnderPayment")+"<\/option>");k.append("<option value='DA' >"+VIS.Msg.getMsg("VA012_DiscountAmount")+"<\/option>");k.append("<option value='WO' >"+VIS.Msg.getMsg("VA012_WriteoffAmount")+"<\/option>");k.append("<option value='CH' >"+VIS.Msg.getMsg("VA012_Charge")+"<\/option>");k.prop("selectedIndex",0)},loadCharge:function(){function n(n){if(fr.html(""),fr.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)fr.append("<option value="+n[t].chargeID+">"+VIS.Utility.encodeText(n[t].name)+"<\/option>");fr.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetChargeData",{voucherType:b.val()!=null?b.val():"",bankAcct:h.val()!=null?h.val():0},n)},loadTaxRate:function(){function n(n){if(ut.html(""),ut.append("<option value=0 ><\/option>"),n!=null)for(var t=0;t<n.length;t++)ut.append("<option value="+n[t].C_Tax_ID+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");ut.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/LoadTaxRate",null,n)},loadPayment:function(){wr!=undefined&&wr!=null&&wr.empty();var n=h.val()!=null?"DocStatus IN ('CO','CL') AND C_BankAccount_ID = "+h.val():"DocStatus IN ('CO','CL')";le=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,5043,VIS.DisplayType.Search,"C_Payment_ID",0,!1,n);g=new VIS.Controls.VTextBoxButton("C_Payment_ID",!1,!1,!0,VIS.DisplayType.Search,le);g.getControl().addClass("va012-input-size-2");g.getControl().attr("tabindex","10");wr.append(g.getControl());wr.append(g.getBtn(0));wr.append(g.getBtn(1));g.fireValueChanged=function(){if(VIS.Utility.Util.getValueOfInt(g.value)!=0&&VIS.Utility.Util.getValueOfInt(ri)!=0){VIS.Utility.Util.getValueOfInt(ri)==g.value?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(g.setValue(ri,!1,!0),VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"",""));return}if(ri=0,ri=g.value,ui||nr||g.value&&(l.checkPaymentCondition(ri,0,r(i.getControl().val()))?l.setInvoiceAndBPartner(ri,"PY"):g.setValue()),nr=!1,!g.value&&ri==null&&g.value==null){var n=f[0].attributes["data-uid"].value;f[0].attributes["data-uid"].value!=0||ri!=null||g.value||u.refreshForm();n>0&&ri==null&&g.value==null&&tt.statementListRecordEdit(n,0)}};nr=!1},loadOrder:function(){de=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,5043,VIS.DisplayType.Search,"C_Order_ID",0,!1,"C_ORDER_ID IN (SELECT ORD.C_ORDER_ID  FROM C_Order ORD  LEFT JOIN C_DocType DT  ON (ORD.C_DOCTYPETARGET_ID=DT.C_DOCTYPE_ID)  INNER JOIN VA009_PaymentMethod PM  ON (PM.VA009_PAYMENTMETHOD_ID =ORD.VA009_PAYMENTMETHOD_ID )  WHERE DT.DOCSUBTYPESO         ='PR'   AND ORD.DOCSTATUS             ='WP'   AND ORD.ISACTIVE              ='Y'   AND PM.VA009_PAYMENTBASETYPE! ='B')");ft=new VIS.Controls.VTextBoxButton("C_Order_ID",!1,!1,!0,VIS.DisplayType.Search,de);ft.getControl().addClass("va012-input-size-2");ft.getControl().attr("tabindex","13");pu.append(ft.getControl());pu.append(ft.getBtn(0));pu.append(ft.getBtn(1));ft.fireValueChanged=function(){if(VIS.Utility.Util.getValueOfInt(ft.value)!=0&&VIS.Utility.Util.getValueOfInt(kt)!=0){VIS.Utility.Util.getValueOfInt(kt)==ft.value?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(ft.setValue(kt,!1,!0),VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"",""));return}if(kt=0,kt=ft.value,ft.value&&(ui||(l.checkPrepayCondition(ft.value,0,null,r(i.getControl().val()))?(l.setInvoiceAndBPartner(kt,"PO"),(f[0].attributes["data-uid"].value>0&&!kt||f[0].attributes["data-uid"].value==0&&kt)&&i.getControl().attr("disabled",!0)):(kt=0,ft.setValue()))),!kt&&!ft.value){var n=f[0].attributes["data-uid"].value;f[0].attributes["data-uid"].value!=0||kt!=null||ft.value||u.refreshForm();n>0&&kt==null&&!ft.value&&tt.statementListRecordEdit(n,0)}}},loadCashLine:function(){var n=" C_CASHLINE_ID IN (SELECT CSL.C_CASHLINE_ID  FROM C_Cash CS  INNER JOIN C_CashLine CSL  ON (CS.C_CASH_ID=CSL.C_CASH_ID)  INNER JOIN C_Charge chrg  ON (chrg.c_charge_id =csl.c_charge_id)  WHERE CS.ISACTIVE          ='Y'  AND CSL.CashType           ='C'  AND chrg.dtd001_chargetype ='CON'  AND CS.DOCSTATUS          IN ('CO','CL')  AND CSL.VA012_ISRECONCILED ='N'  AND CSL.C_BankAccount_ID ="+(h.val()==null?0:h.val())+" )";ou.html("");ce=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,1008317,VIS.DisplayType.Search,"C_CashLine_ID",0,!1,n);ht=new VIS.Controls.VTextBoxButton("C_CashLine_ID",!1,!1,!0,VIS.DisplayType.Search,ce);ht.getControl().addClass("va012-input-size-2");ht.getControl().attr("tabindex","10");ou.append(ht.getControl());ou.append(ht.getBtn(0));ou.append(ht.getBtn(1));ht.fireValueChanged=function(){if(VIS.Utility.Util.getValueOfInt(ht.value)!=0&&VIS.Utility.Util.getValueOfInt(oi)!=0){VIS.Utility.Util.getValueOfInt(oi)==ht.value?VIS.ADialog.info("VA012_AlreadySelected",null,"",""):(ht.setValue(oi,!1,!0),VIS.ADialog.info("VA012_PlzRemoveOrUndoPrevSelectedRecord",null,"",""));return}if(oi=0,oi=ht.value,ht.value&&(ui||nr||l.checkContraCondition(ht.value,0,r(i.getControl().val()))||(oi=0,ht.setValue()),nr=!1),nr=!1,oi==null&&ht.value==null){var n=f[0].attributes["data-uid"].value;f[0].attributes["data-uid"].value!=0||oi!=null||ht.value||u.refreshForm();n>0&&oi==null&&ht.value==null&&tt.statementListRecordEdit(n,0)}}},loadBusinessPartner:function(){yf=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,2893,VIS.DisplayType.Search,"C_BPartner_ID",0,!1,null);et=new VIS.Controls.VTextBoxButton("C_BPartner_ID",!1,!1,!0,VIS.DisplayType.Search,yf);et.getControl().addClass("va012-input-size-2");et.getControl().attr("tabindex","12");bu.append(et.getControl());bu.append(et.getBtn(0));bu.append(et.getBtn(1));et.fireValueChanged=function(){lu=0;lu=et.value}},loadInvoice:function(){ae=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,3484,VIS.DisplayType.MultiKey,"C_Invoice_ID",0,!1,"DocStatus IN ('CO','CL')");dt=new VIS.Controls.VTextBoxButton("C_Invoice_ID",!1,!1,!0,VIS.DisplayType.MultiKey,ae);dt.isMultiKeyTextBox=!0;dt.getControl().addClass("va012-input-size-2");dt.getControl().attr("tabindex","11");wu.append(dt.getControl());wu.append(dt.getBtn(0));wu.append(dt.getBtn(1));dt.fireValueChanged=function(){dr=null;dr=dt.value;dt.value&&(l.checkInvoiceCondition(dr,r(i.getControl().val()))?l.setBPartner(dr):dt.setValue())}},getFormData:function(){var n={},t=[];return n._bankStatementLineID=f.attr("data-uid"),n._txtStatementNo=gt.val(),n._txtStatementPage=ci.val(),n._txtStatementLine=ir.val(),n._dtStatementDate=d.val(),n._cmbPaymentMethod=rr.val(),n._cmbCurrency=lt,n._cmbVoucherMatch=b.val(),n._txtDescription=VIS.Utility.encodeText(eu.val()),n._txtVoucherNo=VIS.Utility.encodeText(er.val()),n._cmbCharge=it.attr("chargeid"),n._cmbTaxRate=ut.val(),n._txtTaxAmount=r(wt.getControl().val()),n._ctrlPayment=ri,n._ctrlOrder=kt,n._ctrlCashLine=oi,n._ctrlInvoice=dr,n._ctrlBusinessPartner=lu,n._chkUseNextTime=su.is(":checked"),n._cmbBank=bi.val(),n._cmbBankAccount=h.val(),n._cmbBankAccountClasses=rf.val(),n._cmbTransactionType=ot.val(),n._scheduleList=y.toString(),n._cmbContraType=st.val(),n._cmbCashBook=tr.val(),n._cmbTransferType=ur.val(),n._txtCheckNo=tu.val(),n._cmbDifferenceType=k.val(),k.val()=="CH"&&b.val()!="C"?(n._txtAmount=r(c.getControl().val()),n._txtTrxAmt=r(i.getControl().val())):(n._txtAmount=r(i.getControl().val()),n._txtTrxAmt=r(c.getControl().val())),n._txtDifference=r(w.getControl().val()),n._txtConversionType=v.val(),n._txtCurrency=s.val(),n._txtPaymentMethod=nt.val(),n._txtCheckNum=rt.val(),n._txtCheckDate=ct.val(),t.push(n),t},insertNewRecord:function(n,i){t.ajax({type:"POST",url:VIS.Application.contextUrl+"VA012/BankStatement/InsertData",contentType:"application/json; charset=utf-8",data:JSON.stringify({_formData:n}),success:function(n){i(n)},error:function(n){VIS.ADialog.info(n,null,"","")}})},afterInsertion:function(n){if(n!=null&&n!=""){var i=t.parseJSON(n);i=="Success"?(ni(a,!1,"absolute"),VIS.ADialog.info("VA012_RecordSaved",null,"",""),ii=[],pt.html(""),yi=1,tt.loadStatement(hi),ti.html(""),u.scheduleRefresh(),u.prepayRefresh(),vi=1,storepaymentdata=[],l.loadPayments(h.val(),vt.val(),ot.val(),at.val()),u.scheduleRefresh(),u.prepayRefresh(),u.refreshForm(),s.addClass("va012-mandatory"),v.addClass("va012-mandatory")):(ni(a,!1,"absolute"),i.contains(" ")?VIS.ADialog.info("",null,i,""):VIS.ADialog.info(i,null,"",""))}},refreshForm:function(){f.attr("data-uid",0);(event==undefined||event.currentTarget.id!=lf[0].id)&&l.getMaxStatement("LO");d.attr("readonly",!1);var n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetStatementDate",{bankAcct:h.val()});n!=""&&n!=null?d.val(Globalize.format(new Date(n),"yyyy-MM-dd")):d.val(ve);rr.prop("selectedIndex",0);b.prop("selectedIndex",0);b.trigger("change");i.getControl().attr("disabled",!1);i.setValue(0);c.setValue(0);w.setValue(0);w.getControl().trigger("blur");w.getControl().attr("vchangable","Y");k.prop("selectedIndex",0);k.removeClass("va012-mandatory");eu.val("");er.val("");fr.prop("selectedIndex",0);it.attr("chargeid",0);it.val("");ut.prop("selectedIndex",0);wt.setValue(0);su.attr("checked",!1);g.setValue();ft.setValue();ht.setValue();et.setValue();dt.setValue();lu=0;ri=0;kt=0;oi=0;dr=null;e.trigger("click");u.loadCurrency();st.prop("selectedIndex",0);tr.prop("selectedIndex",0);ur.prop("selectedIndex",0);tu.val("");this.loadNewFormCurrency();v.addClass("va012-mandatory");this.loadConversionTypes();nt.attr("disabled",!1);nt.addClass("va012-mandatory");this.loadPaymentMethods();s.addClass("va012-mandatory");v.prop("selectedIndex",0);v.attr("disabled",!1);s.attr("disabled",!1);du=!1;rt.val("");yr.hide();rt.removeClass("va012-mandatory");ct.val("");pr.hide();ct.removeClass("va012-mandatory")},scheduleRefresh:function(){y=[];pi=[];yt=[];di.val("")},prepayRefresh:function(){gr=[];nu=[];af.val("")},refreshSelectedValues:function(){f.attr("data-uid",0);l.getMaxStatement("LO");d.attr("readonly",!1);var n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"BankStatement/GetStatementDate",{bankAcct:h.val()});n!=""&&n!=null?d.val(Globalize.format(new Date(n),"yyyy-MM-dd")):d.val(ve);rr.prop("selectedIndex",0);i.getControl().attr("disabled",!1);i.setValue(0);c.setValue(0);w.setValue(0);w.getControl().trigger("blur");w.getControl().attr("vchangable","Y");k.prop("selectedIndex",0);k.removeClass("va012-mandatory");eu.val("");er.val("");fr.prop("selectedIndex",0);it.attr("chargeid",0);it.val("");ut.prop("selectedIndex",0);wt.setValue(0);su.attr("checked",!1);g.setValue();ft.setValue();ht.setValue();et.setValue();dt.setValue();lu=0;ri=0;kt=0;oi=0;dr=null;u.scheduleRefresh();e.trigger("click");st.prop("selectedIndex",0);tr.prop("selectedIndex",0);ur.prop("selectedIndex",0);tu.val("");this.loadNewFormCurrency();v.addClass("va012-mandatory");this.loadConversionTypes();this.loadPaymentMethods();nt.attr("disabled",!1);nt.addClass("va012-mandatory");s.addClass("va012-mandatory");v.prop("selectedIndex",0);v.attr("disabled",!1);s.attr("disabled",!1);du=!1;rt.val("");yr.hide();rt.removeClass("va012-mandatory");ct.val("");pr.hide();ct.removeClass("va012-mandatory")},newRecordDispose:function(){f=null;cf=null;gt=null;lf=null;ci=null;ir=null;d=null;rr=null;st=null;tr=null;ur=null;tu=null;lt=null;b=null;i=null;w=null;k=null;vf=null;e=null;o=null;eu=null;er=null;fr=null;it=null;ut=null;wt=null;ou=null;pu=null;wr=null;wu=null;bu=null;su=null;ku=null;hu=null;ue=null;di=null;af=null;bt=null;fe=null;ee=null;wi=null;ke=null;le=null;ft=null;kt=null;g=null;ro=null;ri=null;ht=null;ce=null;oi=null;yf=null;et=null;lu=null;ae=null;dt=null;dr=null;ve=null;pf=null;s=null;v=null;du=null;nt=null;ct=null;rt=null},loadNewFormCurrency:function(){var n=null,r,i;if(t(s[0]).empty(),r=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,457,VIS.DisplayType.TableDir,"C_Currency_ID",0,!1,"IsMyCurrency='Y'"),n=r.getData(!0,!0,!1,!1),s.append('<option value="0" ><\/option>'),n!=null&&n!=undefined&&n.length>0){for(i=0;i<n.length;i++)s.append("<option value="+n[i].Key+">"+n[i].Name+"<\/option>");s.val(0);s.addClass("va012-mandatory")}},loadConversionTypes:function(){var n=null,r,i;if(t(v[0]).empty(),r=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,10269,VIS.DisplayType.TableDir,"C_ConversionType_ID",0,!1,"IsActive='Y'"),n=r.getData(!0,!0,!1,!1),v.append('<option value="0" ><\/option>'),n!=null&&n!=undefined&&n.length>0){for(i=0;i<n.length;i++)v.append("<option value="+n[i].Key+">"+n[i].Name+"<\/option>");v.val(0);v.addClass("va012-mandatory")}},loadPaymentMethods:function(){var n=null,r,i;if(t(nt[0]).empty(),wf&&(r=VIS.MLookupFactory.get(VIS.Env.getCtx(),$self.windowNo,wf,VIS.DisplayType.TableDir,"VA009_PaymentMethod_ID",0,!1,"VA009_PaymentMethod.IsActive='Y' AND VA009_PaymentMethod.VA009_PAYMENTBASETYPE!='B'"),n=r.getData(!0,!0,!1,!1),nt.append('<option value="0" ><\/option>'),n!=null&&n!=undefined&&n.length>0)){for(i=0;i<n.length;i++)nt.append("<option value="+n[i].Key+">"+n[i].Name+"<\/option>");nt.val(0);nt.addClass("va012-mandatory");yr.hide();rt.removeClass("va012-mandatory");pr.hide();ct.removeClass("va012-mandatory")}}};t(window).resize(function(){l.setPaymentListHeight();tt.setStatementListHeight();ef.height(t("#VA012_mainContainer_"+$self.windowNo).height())});this.getRoot=function(){return a};this.setSize=function(){var n=t("#VA012_mainContainer_"+$self.windowNo).height();n==0&&(n=window.innerHeight-107);ef.height(n)};this.disposeComponents=function(){$self=null;a=null;bi=null;h=null;rf=null;at=null;we=null;vt=null;ot=null;df=null;gf=null;pt=null;ti=null;hi="";uu=null;fu=null;to=null;io=null;or=null;br=null;_divCtrlCashLine=null;sr=null;kr=null;li=null;be=null;divRow4Col1TrxAmt=null;cu=null;ki=null;fi=null;oe=null;ei=null;ai=null;hr=null;cr=null;lr=null;ar=null;vr=null;si=null;se=null;ne=null;te=null;ie=null;ff=null;ef=null;vu=null;pe=null;ii=[];y=[];pi=[];gr=[];nu=[];u.newRecordDispose();wf=null;ru=_txtSearchPayment=_btnSearchPayment=null}}i.prototype.sizeChanged=function(n){_table.height(n)};i.prototype.dispose=function(){this.disposeComponents();this.frame&&this.frame.dispose();this.frame=null};i.prototype.init=function(n,t){this.windowNo=n;this.frame=t;this.Initialize();this.frame.getContentGrid().append(this.getRoot());this.setSize()};n.AForms=n.AForms||{};n.AForms.bankStatement=i}(VA012,jQuery);VA012=window.VA012||{},function(n,t){n.UploadExcel=function(i,r,u){function ut(n){for(u.children().remove(),j=0;j<n.ExcelCol.length;j++)j==1?u.append("<li index="+j+" style='border:none;float:none' >"+n.ExcelCol[j]+"<\/li>"):u.append("<li index="+j+" >"+n.ExcelCol[j]+"<\/li>")}var k=null,f=[],l=[],a=0,o=0,c=Date.now().toString(),s=1048576,v=0,h=0,p=[],e=null,nt=i,ft=t(window).width(),et=t(window).height(),c=Date.now().toString(),ot=r;savedFileName="";var d=t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:40%;width: 40%;left: 32%;position:absolute;z-index:99999;'>"),w=null,b=null;this.isWait=!1;self=this;var tt=function(){var n=null,i=0,t;for(t in f)i=parseInt(f[t].size/s),e.size%s>0&&i++,v+=i,n={},n.Name=f[t].name,n.Size=f[t].size,p.push(n);g()},g=function(){var t;if(f==null||f.length==0){y(!1);return}if(!(o>=f.length)){var n=new XMLHttpRequest,i=new FormData,r=f[o].name.substring(0,f[o].name.lastIndexOf("."))+c+f[o].name.substring(f[o].name.lastIndexOf("."));savedFileName=r;i.append("file",f[o].slice(h*s,h*s+Number(s)));n.open("POST",VIS.Application.contextUrl+"VA012/UploadExcel/SaveFileinTemp?fileName="+r+"&folderKey="+c+"&orgFileName="+f[o].name,!1);n.send(i);k=n.responseText;a++;h++;t=parseInt(f[o].size/s);f[o].size%s>0&&t++;h==t&&(o++,h=0);a<=v&&rt(parseInt(a/v*80));window.setTimeout(function(){g()},2)}},it=function(n){for(var t=[],i,w,r,b,u=0;u<n.files.length;u++){if(e=n.files[u],e==undefined)return;if(e.size<=0)return f=[],l=[],a=0,o=0,c=null,s=null,v=0,h=0,p=[],e=null,VIS.ADialog.info("VADMS_FileSizeShouldGreaterThan0KB"),y(!1),!1;if(e.name.indexOf("&")>-1||e.name.indexOf("?")>-1||e.name.indexOf("#")>-1||e.name.indexOf("/")>-1||e.name.indexOf("\\")>-1){t.push(e.name);continue}for(i in f)if(e.name==f[i].name){window.setTimeout(function(){y(!1);VIS.ADialog.info("fileAlreadyAttached")},20);return}if(l!=null)for(i in l)if(e.name==l[i].Name&&!l[i].IsDeleted){window.setTimeout(function(){y(!1);VIS.ADialog.info("fileAlreadyAttached")},20);return}w={};w.Name=e.name;w.Size=e.size;f.push(e)}if(t.length>0){r="";for(b in t)r+=t[b].toString()+"\n";r+=t.length==1?"File has":"Files have";r+=" invalid name. Please change the file name and try again.";y(!1);VIS.ADialog.info("",!0,r)}},y=function(n){if(t("body").find("#progressbar").remove(),n){w=t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute;height: 35px;'>");b=t("<span class='vis-ui-label'  style='position:absolute;left: 60%;top: 4px;'>").append("0%");w.append(b);d.append(w);var i=t("<div id='progressbar' style='z-index: 999999;' class='vadms-Busy-Progress'><\/div>");i.append(d);i.appendTo("<body>")}else t("body").find("progressbar").remove()},rt=function(n){w.css("width",n+"%");b.empty();b.append(n+"%")};return this.getFolderKey=c,this.getSavedFileName=savedFileName,this.GetUploadedExcelColumns=function(){var t,u,i;if(o>=f.length)return t=[],u=VIS.Application.contextUrl+"VA012/UploadExcel/SaveAttachmentEntries",t.push({Files:JSON.stringify(p)}),t.push({FolderKey:c}),t.push({FileName:savedFileName}),t.push({Mapping:r}),i=n.ControllerRequestAjaxParameter1(u,t,!1),r.ExcelCol=i.ExcelCol,r.FileName=i.FileName,ut(i),i},y(!0),it(i),tt(),k}}(VA012,jQuery);VA012=window.VA012||{},function(n){function t(){VIS.CalloutEngine.call(this,"VA012.VA012_Contra")}var r=VIS.Logging.Level,i=VIS.Utility.Util;VIS.Utility.inheritPrototype(t,VIS.CalloutEngine);t.prototype.SetContra=function(n,t,r,u,f){if(this.isCalloutActive())return"";if(this.setCalloutActive(!0),f==null)r.setValue("VA012_IsContra",!1);else{var e=i.getValueOfString(VIS.DB.executeScalar("SELECT DTD001_ChargeType FROM C_Charge WHERE  C_Charge_ID="+f.toString()));e=="CON"?r.setValue("VA012_IsContra",!0):r.setValue("VA012_IsContra",!1)}return this.setCalloutActive(!1),""};t.prototype.SetConversionType=function(n,t,i,r,u,f){var o,h,e;if(this.isCalloutActive()||u==null||u.toString()=="")return i.setValue("StmtAmt",0),i.setValue("TrxAmt",0),i.setValue("ChargeAmt",0),i.setValue("C_ConversionType_ID",0),"";if(this.setCalloutActive(!0),VIS.Utility.Util.getValueOfInt(i.getValue("C_CashLine_ID"))>0){if(o=i.getValue("DateAcct"),o==null)return i.setValue("C_CashLine_ID",0),this.setCalloutActive(!1),"PlzSelectStmtDate";if(h=i.getValue("C_CashLine_ID").toString()+","+i.getValue("C_Currency_ID").toString()+","+o.toString()+","+i.getValue("AD_Org_ID").toString(),e=VIS.dataContext.getJSONRecord("VA012/Statement/GetCashDetails",h),e!=null){e.Amount!=0?(i.setValue("StmtAmt",e.Amount),i.setValue("TrxAmt",e.Amount),i.setValue("C_ConversionType_ID",e.C_ConversionType_ID)):(i.setValue("StmtAmt",0),i.setValue("TrxAmt",0),i.setValue("C_ConversionType_ID",0),i.setValue("C_CashLine_ID",0),VIS.ADialog.info("VA012_ConversionRateNotFound"));var c=VIS.Utility.Util.getValueOfDecimal(i.getValue("StmtAmt")),l=VIS.Utility.Util.getValueOfDecimal(i.getValue("TrxAmt")),s=c-l,a=VIS.Utility.Util.getValueOfDecimal(i.getValue("InterestAmt"));s=s-a;i.setValue("ChargeAmt",s)}}else i.getValue("C_Payment_ID")<=0&&i.setValue("C_ConversionType_ID",0);return this.setCalloutActive(!1),n=t=i=r=u=f=null,""};t.prototype.SetTenderType=function(n,t,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);var o=VIS.dataContext.getJSONRecord("VA012/Statement/GetPaymentRule",i.getValueOfInt(f));return o!=null&&o!=""&&(o=="D"?r.setValue("TenderType","D"):o=="K"?r.setValue("TenderType","C"):o=="S"?r.setValue("TenderType","K"):o=="T"?r.setValue("TenderType","A"):o=="L"?r.setValue("TenderType","L"):r.setValue("TenderType","A")),this.setCalloutActive(!1),n=t=r=u=f=e=null,""};t.prototype.SetPaymentMethod=function(n,t,r,u,f,e){var s,o;return this.isCalloutActive()||f==null||f.toString()==""?"":(this.setCalloutActive(!0),s="1",u.getColumnName()=="C_Invoice_ID"&&(s="1"),u.getColumnName()=="C_Order_ID"&&(s="2"),o=VIS.dataContext.getJSONRecord("VA012/Statement/GetPaymentMethod",i.getValueOfInt(f)+","+s),this.setCalloutActive(!1),o!=null&&o!=""&&(r.setValue("VA009_PaymentMethod_ID",o.VA009_PaymentMethod_ID),r.setValue("C_ConversionType_ID",o.C_ConversionType_ID)),n=t=r=u=f=e=null,"")};n.Model=n.Model||{};n.Model.VA012_Contra=t}(VA012,jQuery)
